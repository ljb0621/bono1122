<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ethereal Aesthetic UI</title>
    <!-- å¤–éƒ¨å­—ä½“å’Œå›¾æ ‡ -->
    <link href="https://fonts.googleapis.com/css2?family=Alex+Brush&family=Montserrat:wght@200;300;400;500&family=Playfair+Display:ital,wght@0,400;0,500;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- æœ¬åœ°æ ·å¼è¡¨ -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/animations.css">
    
    <!-- [æ–°å¢] è¿™é‡Œä¸“é—¨ç”¨æ¥æ”¾ä½ è¾“å…¥çš„è‡ªå®šä¹‰CSS -->
    <style id="dynamic-custom-css"></style>
</head>
<body>


    <div class="phone">
        <div class="ambient-bg"></div>
                <!-- === [é‡åˆ¶ç‰ˆ] Bonoæœº å¼€æœºåŠ¨ç”» (æŠ½è±¡è èè®¾è®¡) === -->
        <div id="boot-screen">
            <div class="boot-container">
                
                <!-- æŠ½è±¡è èå›¾æ ‡ -->
                <div class="pineapple-icon">
                    <!-- çš‡å† /å¶å­ -->
                    <div class="p-crown">
                        <span></span><span></span><span></span>
                    </div>
                    <!-- æœå®ä¸»ä½“ (å¸¦æ³¢ç‚¹) -->
                    <div class="p-body">
                        <div class="p-pattern"></div>
                    </div>
                </div>

                <!-- æ–‡å­—æ’ç‰ˆ -->
                <div class="boot-text-group">
                    <div class="b-main-title">bono.</div>
                    <div class="b-sub-title">DESIGNED BY PINEAPPLE</div>
                </div>

            </div>
        </div>


        <div class="status-bar">
            <span id="sb-time-display" style="font-weight:600;"></span>
            <div style="display:flex; gap:6px; opacity:0.6;">
                <i class="fas fa-signal"></i>
                <i class="fas fa-battery-three-quarters"></i>
            </div>
        </div>
        <div id="danmaku-layer" class="danmaku-container"></div> 


          <div class="screen-container" id="screen">
            
    <!-- === ç¬¬ä¸€é¡µ (P1): ä¸»é¡µ & åŸºç¡€APP === -->
    <div class="page" id="p1">
        <div class="unified-header-widget">
            <div class="greeting-text" id="greetingText"></div>
            <div class="clock-profile-combo">
                <div class="time-block">
                    <span id="h">14</span><span class="time-colon">:</span><span id="m">30</span>
                </div>
                <div class="vertical-divider"></div>
                <div class="profile-stack">
                    <div class="mini-profile-row">
                        <div class="editable-name" contenteditable="true">Hannah</div>
                        <div class="avatar-circle-sm" data-edit-key="avatar" onclick="triggerChangeImage(this, 'img')">
                            <img src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=200&auto=format&fit=crop">
                        </div>
                    </div>
                    <div class="date-pill" id="fullDate">Jan 30</div>
                </div>
            </div>
        </div>

        <div class="music-widget" id="home-music-widget" onclick="openMusicPlayer()">
    <div class="music-info">
        <div style="font-size:9px; color:#aaa; margin-bottom:5px; letter-spacing:1px;">NOW PLAYING</div>
        <!-- å¢åŠ äº† contenteditable å’Œ onblur ç”¨äºä¿å­˜æ–‡å­— -->
        <div class="music-title" id="home-music-title" contenteditable="true" onclick="event.stopPropagation()" onblur="saveHomeMusicText()">Lover</div>
        <div class="music-artist" id="home-music-artist" contenteditable="true" onclick="event.stopPropagation()" onblur="saveHomeMusicText()">Taylor Swift</div>
        <div class="wave-box"><div class="wave"></div><div class="wave"></div><div class="wave"></div><div class="wave"></div></div>
    </div>
    <div class="vinyl-record">
        <!-- ä¿ç•™äº†åŸæ¥çš„æ¢å›¾åŠŸèƒ½ï¼ŒåŠ äº† stopPropagation é˜²æ­¢ç‚¹å‡»æ¢å›¾æ—¶æ‰“å¼€æ’­æ”¾å™¨ -->
        <div class="vinyl-inner" data-edit-key="music" onclick="event.stopPropagation(); triggerChangeImage(this, 'bg')"></div>
    </div>
</div>

        <div class="grid-apps">
            <div class="app-cell" data-app-id="wechat" onclick="openWeChatApp()"><div class="icon-box"><i class="fab fa-weixin" style="color:#07c160;"></i></div><span class="app-label">WeChat</span></div>
            <div class="app-cell" data-app-id="api" onclick="toggleSettings()"><div class="icon-box"><i class="fas fa-link"></i></div><span class="app-label">API</span></div>
            <div class="app-cell" data-app-id="theme" onclick="toggleSettings('theme')"><div class="icon-box"><i class="fas fa-magic"></i></div><span class="app-label">Theme</span></div>
            <div class="app-cell" data-app-id="lovespace"><div class="icon-box"><i class="fas fa-heart" style="color:#e91e63;"></i></div><span class="app-label">Love Space</span></div>
            <div class="app-cell" data-app-id="worldbook"><div class="icon-box"><i class="fas fa-globe-asia"></i></div><span class="app-label">WorldBook</span></div>
            <div class="app-cell" data-app-id="presets" onclick="openPresetsApp()"><div class="icon-box"><i class="fas fa-sliders-h"></i></div><span class="app-label">Presets</span></div>
            <div class="app-cell" data-app-id="game"><div class="icon-box"><i class="fas fa-gamepad"></i></div><span class="app-label">Game</span></div>
            <div class="app-cell" data-app-id="novel"><div class="icon-box"><i class="fas fa-book-open"></i></div><span class="app-label">Novel</span></div>
        </div>
    </div>

    <!-- === ç¬¬äºŒé¡µ (P2): ç›¸å†Œ & ç›´æ’­ === -->
    <div class="page" id="p2">
        <div style="text-align:center; margin-bottom:10px;">
            <div class="app-label" style="font-family:'Alex Brush'; font-size:36px;" contenteditable="true">Our Memories</div>
            <div style="font-size:10px; color:#999; letter-spacing:2px; text-transform:uppercase;">Collect Moments</div>
        </div>

        <div class="photo-stack">
            <div class="stack-item"><img src="https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?q=80&w=200&auto=format&fit=crop" data-edit-key="photo1" onclick="triggerChangeImage(this, 'self')"></div>
            <div class="stack-item"><img src="https://images.unsplash.com/photo-1516975080664-ed2fc6a32937?q=80&w=200&auto=format&fit=crop" data-edit-key="photo2" onclick="triggerChangeImage(this, 'self')"></div>
            <div class="stack-item"><img src="https://images.unsplash.com/photo-1519681393784-d120267933ba?q=80&w=200&auto=format&fit=crop" data-edit-key="photo3" onclick="triggerChangeImage(this, 'self')"></div>
        </div>

        <div class="grid-apps">
            <div class="app-cell" data-app-id="pay" onclick="openPayApp()"><div class="icon-box"><i class="fas fa-qrcode"></i></div><span class="app-label">Pay</span></div>
            <div class="app-cell" data-app-id="map"><div class="icon-box"><i class="fas fa-map-marker-alt"></i></div><span class="app-label">Map</span></div>
            <div class="app-cell" data-app-id="live" onclick="openLiveApp()">
                <div class="icon-box" style="background: #111; border: 1px solid rgba(255,255,255,0.1);"><i class="fas fa-satellite-dish" style="color: #fff;"></i></div>
                <span class="app-label" style="font-weight:600; color:#333;">LIVE.</span>
            </div>
            <div class="app-cell" data-app-id="cam"><div class="icon-box"><i class="fas fa-camera"></i></div><span class="app-label">Cam</span></div>
        </div>
    </div>

    <!-- === ç¬¬ä¸‰é¡µ (P3): éŸ©ç³»CDæœº + å®ç”¨APPç½‘æ ¼ === -->
    <div class="page" id="p3">
        <!-- CDæœºç»„ä»¶ -->
        <div class="k-mood-board">
            <div class="k-cd-player">
                <div class="k-disc-wrap">
                    <div class="k-disc" data-edit-key="k_cd_cover" onclick="triggerChangeImage(this, 'bg')" style="background-image: url('https://images.unsplash.com/photo-1459749411177-d4a428c37ae5?q=80&w=200&auto=format&fit=crop');"><div class="k-disc-center"></div></div>
                </div>
                <div class="k-song-info">
                    <div class="k-play-btn"><i class="fas fa-play"></i></div>
                    <div style="flex:1;">
                        <div contenteditable="true" class="k-song-title">Palette</div>
                        <div contenteditable="true" class="k-artist">IU (ì•„ì´ìœ )</div>
                    </div>
                </div>
            </div>
            <div class="k-polaroid">
                <div class="k-tape"></div>
                <div class="k-photo-frame" data-edit-key="k_polaroid_img" onclick="triggerChangeImage(this, 'bg')" style="background-image: url('https://images.unsplash.com/photo-1516483638261-f4dbaf036963?q=80&w=300&auto=format&fit=crop');"></div>
                <div class="k-handwriting" contenteditable="true">Vibe â˜ï¸</div>
            </div>
        </div>

        <!-- è¿™é‡Œçš„APPå…¨éƒ½åœ¨ï¼Galgame, Pet, Fate... -->
        <div class="grid-apps">
            <div class="app-cell" data-app-id="galgame" onclick="alert('Galgame åŠŸèƒ½å¼€å‘ä¸­...')"><div class="icon-box"><i class="fas fa-gamepad"></i></div><span class="app-label">Galgame</span></div>
            <div class="app-cell" data-app-id="pet" onclick="alert('ç”µå­å® ç‰©æ­£åœ¨ç¡è§‰...')"><div class="icon-box"><i class="fas fa-paw"></i></div><span class="app-label">Pet</span></div>
            <div class="app-cell" data-app-id="tracker" onclick="alert('æƒé™ä¸è¶³')"><div class="icon-box"><i class="fas fa-user-secret"></i></div><span class="app-label">Tracker</span></div>
            <div class="app-cell" data-app-id="mihuashi" onclick="alert('ç”»å¸ˆåˆ—è¡¨...')"><div class="icon-box"><i class="fas fa-palette"></i></div><span class="app-label">Art</span></div>
            <div class="app-cell" data-app-id="divination" onclick="alert('ä»Šæ—¥è¿åŠ¿ï¼šå¤§å‰')"><div class="icon-box"><i class="fas fa-star-half-alt"></i></div><span class="app-label">Fate</span></div>
            <div class="app-cell" data-app-id="myhome" onclick="alert('è¿›å…¥å®¶å›­...')"><div class="icon-box"><i class="fas fa-home"></i></div><span class="app-label">Home</span></div>
            <div class="app-cell" data-app-id="calendar" onclick="alert('æ—¥å†')"><div class="icon-box"><i class="fas fa-calendar"></i></div><span class="app-label">Calendar</span></div>
            <div class="app-cell" data-app-id="bubble" onclick="openBubbleApp()"><div class="icon-box"><i class="far fa-comments"></i></div><span class="app-label">Bubble</span></div>
        </div>
    </div> 
                <!-- === ç¬¬å››é¡µ (P4): ç”Ÿæ´»è®°å½• & ç”µå­å°ç¥¨ (ä¼˜åŒ–ç‰ˆ) === -->
    <div class="page" id="p4">
        
        <!-- 1. æ”¶è—ä¿¡æ¯æ»šåŠ¨ç»„ä»¶ -->
        <div class="collection-ticker-widget">
            <div class="ticker-icon"><i class="fas fa-quote-left"></i></div>
            
            <!-- æ»šåŠ¨æ–‡å­—åŒº -->
            <div class="ticker-wrapper">
                <!-- ç¬¬ä¸€ç»„å†…å®¹ -->
                <div class="ticker-content">
                    <span>è®°å¾—ç»™é˜³å°çš„èŠ±æµ‡æ°´</span><span class="dot">â€¢</span>
                    <span>ä¸‹å‘¨äº”å»çœ‹å±•</span><span class="dot">â€¢</span>
                    <span>å¯†ç  123456</span><span class="dot">â€¢</span>
                    <span>Stay foolish</span><span class="dot">â€¢</span>
                    <span>ä¹°çŒ«ç²®</span><span class="dot">â€¢</span>
                </div>
                <!-- ç¬¬äºŒç»„å†…å®¹ (å¤åˆ¶ä¸€ä»½ç”¨äºæ— ç¼è¿æ¥) -->
                <div class="ticker-content">
                    <span>è®°å¾—ç»™é˜³å°çš„èŠ±æµ‡æ°´</span><span class="dot">â€¢</span>
                    <span>ä¸‹å‘¨äº”å»çœ‹å±•</span><span class="dot">â€¢</span>
                    <span>å¯†ç  123456</span><span class="dot">â€¢</span>
                    <span>Stay foolish</span><span class="dot">â€¢</span>
                    <span>ä¹°çŒ«ç²®</span><span class="dot">â€¢</span>
                </div>
            </div>

            <!-- å³ä¾§åœ†å½¢å›¾ç‰‡ (ç‚¹å‡»å¯æ›´æ¢) -->
            <div class="ticker-img-circle">
                <img src="https://images.unsplash.com/photo-1517841905240-472988babdf9?q=80&w=200&auto=format&fit=crop" 
                     data-edit-key="p4_ticker_img" 
                     onclick="triggerChangeImage(this, 'self')">
            </div>
        </div>

        <!-- 2. å‘ç¥¨/å°ç¥¨é€ å‹ç»„ä»¶ (å˜çŸ­ç‰ˆ) -->
        <div class="receipt-widget short-version">
            <!-- é¡¶éƒ¨æ‰“å­” -->
            <div class="receipt-hole"></div>
            
            <div class="receipt-header">
                <div class="receipt-title">RECEIPT</div>
                <div class="receipt-date">NO.2026-02-22</div>
            </div>
            
            <div class="receipt-divider-dashed"></div>

            <!-- åˆ—è¡¨åŒºåŸŸ -->
            <div class="receipt-list">
                <div class="receipt-item" onclick="openSimulatedApp('taobao')">
                    <div class="r-item-name">
                        <span class="r-qty">01</span>
                        <span>SHOPPING (Taobao)</span>
                    </div>
                    <div class="r-item-price">OPEN <i class="fas fa-chevron-right" style="font-size:8px;"></i></div>
                </div>
                
                <div class="receipt-item" onclick="openSimulatedApp('meituan')">
                    <div class="r-item-name">
                        <span class="r-qty">02</span>
                        <span>DELIVERY (Meituan)</span>
                    </div>
                    <div class="r-item-price">OPEN <i class="fas fa-chevron-right" style="font-size:8px;"></i></div>
                </div>
            </div>

            <div class="receipt-divider-line"></div>

            <div class="receipt-footer">
                <div class="receipt-total">
                    <span>TOTAL</span>
                    <span style="font-weight:700;">Â¥ 999.00</span>
                </div>
                <div class="receipt-barcode">
                    ||| || ||| | |||| || || | |||| |||
                </div>
            </div>
        </div>

        <!-- 3. APP ç½‘æ ¼ (æ ·å¼ä¸P3ä¸€è‡´ï¼Œä½ç½®ä¸‹ç§») -->
        <div class="grid-apps p4-apps">
            <div class="app-cell" data-app-id="notes" onclick="alert('ä¾¿ç­¾')"><div class="icon-box"><i class="far fa-sticky-note"></i></div><span class="app-label">Notes</span></div>
            <div class="app-cell" data-app-id="files" onclick="alert('æ–‡ä»¶ç®¡ç†')"><div class="icon-box"><i class="far fa-folder"></i></div><span class="app-label">Files</span></div>
            <div class="app-cell" data-app-id="clock" onclick="alert('é—¹é’Ÿ')"><div class="icon-box"><i class="far fa-clock"></i></div><span class="app-label">Clock</span></div>
            <!-- ç©ºä½å ä½ç¬¦ -->
            <div class="app-cell" style="opacity:0.3;"><div class="icon-box" style="border:1px dashed #ccc; box-shadow:none;"><i class="fas fa-plus"></i></div></div>
        </div>

    </div>


  

        <!-- Dock Bar -->
        <div class="dock-bar">
    <i class="fas fa-phone-alt" style="font-size:20px; color:#555;"></i>
    <div class="dock-icon-special" onclick="toggleChat()">
        <i class="fas fa-comment"></i>
        <div id="dock-dot" class="unread-dot"></div> <!-- âœ… æ”¾å…¥å›¾æ ‡å®¹å™¨å†…éƒ¨ -->
    </div>
    <i class="fas fa-comment-dots" style="font-size:20px; color:#555;"></i>
    <i class="fab fa-chrome" style="font-size:22px; color:#555;"></i>
</div>

<!-- === å¾®ä¿¡å®Œæ•´åº”ç”¨ (å‡çº§éŸ©ç³»èƒ¶å›Šç‰ˆ) === -->
<div class="app-fullscreen-view" id="wechatApp">
    
    <!-- é¡¶éƒ¨æ ‡é¢˜æ  -->
   <!-- === æç®€ç‰ˆï¼šç›´æ¥ç‚¹å‡»æ ‡é¢˜è¿”å› === -->
    <div class="wc-header">
        <span id="wc-header-title" onclick="closeWeChatApp()" style="cursor: pointer; user-select: none;">
            Messages
        </span>

        <div class="wc-header-icons">
            <i class="fas fa-search"></i>
            
            <div style="position: relative;">
                <i class="fas fa-plus-circle" onclick="toggleWeChatMenu(event)" style="cursor: pointer;"></i>
                
                <!-- === ä¿®æ”¹å¼€å§‹ï¼šæ‰¾åˆ°è¿™ä¸ª div å¹¶æ›¿æ¢é‡Œé¢çš„ onclick å’Œæ–‡å­— === -->
<div id="wc-plus-menu" class="wc-plus-dropdown">
    <!-- æ³¨æ„ï¼šè¿™é‡ŒæŠŠ onclick æ”¹æˆäº† showAddFriendModal()ï¼Œæ–‡å­—æ”¹æˆäº† æ·»åŠ å¥½å‹ -->
    <div class="wc-menu-option" onclick="showAddFriendModal()">
        <i class="fas fa-user-plus"></i> æ·»åŠ å¥½å‹
    </div>
    <div class="wc-menu-option" onclick="featureCreateGroup()">
        <i class="fas fa-users"></i> ç»„å»ºç¾¤èŠ
    </div>
    <div class="wc-menu-option" onclick="featureImportCard()">
        <i class="fas fa-file-import"></i> å¯¼å…¥è§’è‰²å¡
    </div>
</div>
<!-- === ä¿®æ”¹ç»“æŸ === -->

            </div>
        </div>
        <input type="file" id="tavern-card-input" accept=".png,.json,.webp" style="display: none;" onchange="handleCardFile(this)">
    </div>




    <!-- ä¸­é—´å†…å®¹åŒºåŸŸ -->
    <div class="wc-body-container">
        
        <!-- Tab 1: èŠå¤©åˆ—è¡¨ -->
        <div class="wc-tab-content active" id="tab-chats">
            <!-- æ–°å¢æœç´¢æ¡†è§†è§‰ -->
            <div class="wc-search-container">
                <div class="wc-search-bar">
                    <i class="fas fa-search" style="margin-right:10px; font-size:12px;"></i> Search messages...
                </div>
            </div>
            <!-- è¿™é‡Œå¯ä»¥æ”¾ä½ çš„èŠå¤©åˆ—è¡¨å®¹å™¨ï¼Œå¦‚æœæœ‰çš„è¯ -->
        </div> <!-- â˜…â˜…â˜… é‡ç‚¹ï¼šåœ¨è¿™é‡Œé—­åˆ tab-chats â˜…â˜…â˜… -->

            
        <!-- Tab 2: é€šè®¯å½• -->
        <div class="wc-tab-content" id="tab-contacts" style="display:none;">
            <div class="wc-search-container">
                <div class="wc-search-bar" id="contacts-add-bar" onclick="openFriendRequestPage()" style="position:relative;">
                    <i class="fas fa-user-plus" style="margin-right:10px;"></i> Add new friends
                    <span id="contacts-request-dot" class="wc-request-dot" style="display:none;"></span>
                </div>
            </div>
            <!-- æ–°çš„ï¼šé€šè®¯å½•å¥½å‹åˆ—è¡¨ï¼ˆç”± JS åŠ¨æ€å¡«å……ï¼‰ -->
            <div id="contacts-list-container"></div>
        </div>


        <!-- Tab 3: æœ‹å‹åœˆ (éŸ©ç³»ç”»å»Šé£) -->
        <div class="wc-tab-content" id="tab-moments" style="display:none; padding-bottom: 20px;">
            <div id="moments-header-bg" class="moments-header-bg" 
                 style="background-image: url('https://images.unsplash.com/photo-1494859802809-d069c3b71a8a?q=80&w=400&auto=format&fit=crop'); cursor:pointer;"
                 onclick="triggerChangeMomentsBg()">
                <div class="user-name-overlay">Daily Moments</div>
                <div class="user-avatar-overlay"><img src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=200&auto=format&fit=crop"></div>
            </div>
            <div id="moments-feed-list"></div>
        </div>

        <!-- Tab 4: ä¸ªäººä¸­å¿ƒ -->
        <div class="wc-tab-content" id="tab-me" style="display:none;">
            <div class="wc-me-header">
<!-- === ä¿®æ”¹ï¼šç»™å¤´åƒåŠ ä¸ªåˆ‡æ¢å°æŒ‰é’® === -->
<div class="wc-avatar lg" id="me-avatar-switcher" style="position:relative;">
    <img src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=200&auto=format&fit=crop">
    <!-- ç‚¹å‡»è¿™ä¸ªå°å›¾æ ‡åˆ‡æ¢èº«ä»½ -->
    <div onclick="openIdentityModal(event)" style="position:absolute; right:-5px; bottom:-5px; width:26px; height:26px; background:#333; color:#fff; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:12px; border:2px solid #fff; z-index:10; cursor:pointer;">
        <i class="fas fa-sync-alt"></i>
    </div>
</div>

                <div class="wc-me-info">
                    <div class="wc-me-name">Hannah</div>
                    <div class="wc-me-id">ID: cute_hannah</div>
                </div>
            </div>

            <!-- === æ–°å¢ï¼šæˆ‘çš„ä¸»äººè®¾ === -->
            <div class="wc-menu-group" style="padding: 15px 20px;">
                <div style="font-size: 13px; font-weight: 700; color: #333; margin-bottom: 10px;">
                    <i class="fas fa-user-edit"></i> æˆ‘çš„ä¸»äººè®¾ (User Persona)
                </div>
                <textarea id="my-global-persona" rows="3" placeholder="ä¾‹å¦‚ï¼šæˆ‘æ˜¯ä¸€ä¸ªè‹¦é€¼çš„äº’è”ç½‘æ‰“å·¥äººï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªæ¯æœˆæœ‰èŠ±ä¸å®Œé›¶èŠ±é’±çš„è´¢é˜€å¤§å°å§..." style="width: 100%; border: none; background: #f9f9f9; border-radius: 12px; padding: 12px; font-size: 12px; font-family: inherit; resize: none; outline: none;" onblur="saveGlobalPersona()"></textarea>
                <div style="font-size: 10px; color: #999; margin-top: 5px;">* AI å°†è¯»å–æ­¤äººè®¾ä¸ºä½ ç”Ÿæˆæ¯æœˆçš„å·¥èµ„æˆ–ç”Ÿæ´»è´¹ã€‚</div>
            </div>

            <div class="wc-menu-group">
                <div class="wc-menu-item"><i class="fas fa-th-large menu-icon"></i> <span>Services</span> <i class="fas fa-chevron-right arrow" style="font-size:10px; color:#ccc"></i></div>
                <div class="wc-menu-item"><i class="fas fa-bookmark menu-icon"></i> <span>Collections</span> <i class="fas fa-chevron-right arrow" style="font-size:10px; color:#ccc"></i></div>
            </div>
            
            <div class="wc-menu-group">
                <div class="wc-menu-item" onclick="toggleSettings()">
                    <i class="fas fa-cog menu-icon"></i> <span>Settings</span> <i class="fas fa-chevron-right arrow" style="font-size:10px; color:#ccc"></i>
                </div>
            </div>
        </div>


    </div>


    <!-- åº•éƒ¨å¯¼èˆªæ  (æ‚¬æµ®èƒ¶å›Š) -->
    <div class="wc-tab-bar">
        <div class="wc-tab-item active" onclick="switchWcTab('chats', this)">
            <i class="fas fa-comment"></i>
            <span>Chat</span>
        </div>
        <div class="wc-tab-item" onclick="switchWcTab('contacts', this)">
            <i class="fas fa-address-book"></i>
            <span>Friends</span>
        </div>
        <div class="wc-tab-item" onclick="switchWcTab('moments', this)">
            <i class="fas fa-compass"></i>
         <div id="moments-dot" class="unread-dot"></div>
            <span>Feed</span>
        </div>
        <div class="wc-tab-item" onclick="switchWcTab('me', this)">
            <i class="fas fa-user"></i>
            <span>Me</span>
        </div>
    </div>
</div>



        <!-- Chat View -->
                <!-- Chat View (æ–°ç‰ˆéŸ©ç³»é«˜å®šç•Œé¢) -->
        <div class="chat-view" id="chatLayer">
            <!-- å¤´éƒ¨ï¼šåŠ äº†åœ¨çº¿çŠ¶æ€å’Œå¸ƒå±€ä¼˜åŒ– -->
        
<div class="chat-header">
    <!-- å·¦ä¾§è¿”å›æŒ‰é’® (ä¿æŒä¸å˜) -->
    <i class="fas fa-chevron-left" onclick="toggleChat()" style="cursor:pointer; padding:10px; font-size:18px;"></i>
    
    <!-- ã€æ–°å¢ã€‘å¼¹å¹•å¼€å…³å›¾æ ‡ (æ”¾åœ¨è¿”å›é”®å³è¾¹) -->
    <i class="fas fa-comment-alt" id="danmaku-toggle" onclick="toggleDanmaku()" title="å¼€å¯/å…³é—­å®æ—¶å¼¹å¹•" style="cursor:pointer; padding:10px; font-size:16px; color:#bbb; transition:0.3s;"></i>

    <!-- ä¸­é—´æ ‡é¢˜ (ä¿æŒä¸å˜) -->
    <span style="display:flex; flex-direction:column; align-items:center; line-height:1.2; flex:1;"> <!-- åŠ  flex:1 è®©å®ƒå±…ä¸­ -->
        HANNAH AI
        <small style="font-size:9px; color:#aaa; font-weight:400; letter-spacing:1px; text-transform:uppercase;">Online</small>
    </span>
    
    <!-- å³ä¾§æŒ‰é’®ç»„ (ä¿æŒä¸å˜) -->
    <div style="display:flex; align-items:center; gap: 0px;">
        <i class="fas fa-heart-pulse" onclick="toggleMindCard(event)" style="cursor:pointer; padding:10px 8px; font-size:19px; color:#ff7e67;" title="æŸ¥çœ‹å¿ƒå£°"></i>
        <i class="fas fa-cog" onclick="openChatSettingsPage()" style="cursor:pointer; padding:10px 8px; font-size:19px; color:#666;" title="èŠå¤©è®¾ç½®"></i>
    </div>
</div>

<!-- ã€æ–°å¢ã€‘åœ¨ chat-view å†…éƒ¨æ·»åŠ å¼¹å¹•é®ç½©å±‚ -->
<!-- è¯·ç¡®ä¿å®ƒåœ¨ chat-header ä¸‹é¢ï¼Œchat-messages ä¸Šé¢ -->




                       <!-- èŠå¤©å†…å®¹åŒº -->
            <div class="chat-messages" id="chatMessages">
                <!-- æ—¶é—´æˆ³ -->
                <div style="text-align:center; margin: 10px 0;">
                    <span style="background:rgba(0,0,0,0.04); padding:4px 12px; border-radius:12px; font-size:10px; color:#999; font-weight:500;">Today 14:02</span>
                </div>

                <!-- æ¥æ”¶çš„æ¶ˆæ¯ (å·¦ä¾§ï¼šå¤´åƒåœ¨å‰ï¼Œæ°”æ³¡åœ¨å) -->
                <div class="chat-row received">
                    <img class="chat-avatar-img" src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=200&auto=format&fit=crop">
                    <div class="message-bubble received">
                        Good afternoon! â˜•ï¸<br>Is there anything I can help you with?
                    </div>
                </div>

                <!-- å‘é€çš„æ¶ˆæ¯ (å³ä¾§ï¼šæ°”æ³¡åœ¨å‰ï¼Œå¤´åƒåœ¨å) -->
                <div class="chat-row sent">
                    <div class="message-bubble sent">
                        I love this new design! âœ¨
                    </div>
                    <img class="chat-avatar-img" src="https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?q=80&w=200&auto=format&fit=crop">
                </div>
            </div>

<!-- === ä¿®æ”¹åçš„èŠå¤©åº•éƒ¨è¾“å…¥åŒº (index.html) === -->
<div class="chat-input-area">
    <form id="chatForm" class="chat-input-form" style="position:relative; z-index:10;">
        
        <!-- === å·¦ä¾§åŒºåŸŸï¼šåŠ å· & è¡¨æƒ… === -->
        <div style="display:flex; align-items:center; gap: 12px; margin-right: 10px;">
            <i class="fas fa-plus-circle" onclick="toggleChatPanel('plus')" style="color:#333; font-size:22px; cursor:pointer;"></i>
            <i class="far fa-smile" onclick="toggleChatPanel('emoji')" style="color:#333; font-size:22px; cursor:pointer;"></i>
        </div>
        
        <!-- ä¸­é—´ï¼šè¾“å…¥æ¡† -->
        <input type="text" id="chatInput" placeholder="Type a message..." autocomplete="off">
        
        <!-- === å³ä¾§åŒºåŸŸï¼šAI å›å¤ & å‘é€ === -->
      <div style="display:flex; align-items:center; gap: 8px; margin-left: 8px;">
    <i id="triggerAiReply" class="fas fa-star" title="ç‚¹äº®æ˜Ÿæ˜Ÿ (è®©AIå›å¤)" style="color:#bbb; font-size:20px; cursor:pointer; transition:all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);"></i>
    <button type="submit" title="å‘é€ (ä»…ä¸Šå±)"><i class="fas fa-paper-plane"></i></button>
</div>

    </form>

    <!-- [æ–°å¢] åº•éƒ¨æ‰©å±•é¢æ¿å®¹å™¨ (ä¿æŒä¸å˜) -->
    <div id="chat-extra-panels" class="chat-panels-container">
        <!-- 1. è¡¨æƒ…é¢æ¿ -->
        <div id="panel-emoji" class="chat-panel" style="display:none;">
            <div class="emoji-tabs">
                <span class="active">Emoji</span>
                <span>Stickers</span>
            </div>
            <div class="emoji-grid">
                <span onclick="insertEmoji('ğŸ˜‚')">ğŸ˜‚</span><span onclick="insertEmoji('â¤ï¸')">â¤ï¸</span>
                <span onclick="insertEmoji('ğŸ˜')">ğŸ˜</span><span onclick="insertEmoji('ğŸ˜­')">ğŸ˜­</span>
                <span onclick="insertEmoji('ğŸ‘')">ğŸ‘</span><span onclick="insertEmoji('ğŸ¤')">ğŸ¤</span>
                <span onclick="insertEmoji('ğŸ™')">ğŸ™</span><span onclick="insertEmoji('ğŸ‰')">ğŸ‰</span>
                <span onclick="insertEmoji('ğŸ¤”')">ğŸ¤”</span><span onclick="insertEmoji('ğŸ˜¡')">ğŸ˜¡</span>
            </div>
            <div class="sticker-grid">
                <img src="https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExcDdtY2Z4b3E4eHRqbnZ6Z3I5eXF6eXF6eXF6eXF6eXF6eXF6eSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9cw/MDJ9IbxxvDUQM/giphy.gif" onclick="sendSticker(this.src)">
                <img src="https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExbmZ6eXF6eXF6eXF6eXF6eXF6eXF6eXF6eXF6eXF6eSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9cw/13CoXDiaCcCzd2/giphy.gif" onclick="sendSticker(this.src)">
                <img src="https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExYnZ6eXF6eXF6eXF6eXF6eXF6eXF6eSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9cw/l0HlCqV35hdEg/giphy.gif" onclick="sendSticker(this.src)">
                <img src="https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExY3Z6eXF6eXF6eXF6eXF6eXF6eXF6eSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9cw/3o7TKs6AWsp1M6Jqne/giphy.gif" onclick="sendSticker(this.src)">
            </div>
        </div>

        <!-- 2. åŠ å·åŠŸèƒ½é¢æ¿ -->
        <div id="panel-plus" class="chat-panel" style="display:none;">
            <div class="plus-grid">
                <div class="plus-item" onclick="triggerImageUpload()">
                    <div class="plus-icon"><i class="fas fa-image"></i></div>
                    <span>ç…§ç‰‡</span>
                </div>
                <div class="plus-item" onclick="sendLocation()">
                    <div class="plus-icon"><i class="fas fa-map-marker-alt"></i></div>
                    <span>ä½ç½®</span>
                </div>
                <div class="plus-item" onclick="triggerNudge()">
                    <div class="plus-icon"><i class="fas fa-hand-point-right"></i></div>
                    <span>æ‹ä¸€æ‹</span>
                </div>
                <div class="plus-item" onclick="sendRedPacket()">
                    <div class="plus-icon"><i class="fas fa-yen-sign" style="color:#fa9d3b;"></i></div>
                    <span>è½¬è´¦</span>
                </div>
                <div class="plus-item" onclick="openVoiceActionModal()">
    <div class="plus-icon"><i class="fas fa-microphone"></i></div>
    <span>è¯­éŸ³</span>
</div>

                <div class="plus-item" onclick="sendMusicShare()">
                    <div class="plus-icon"><i class="fas fa-music"></i></div>
                    <span>ä¸€èµ·å¬</span>
                </div>
                <div class="plus-item" onclick="openOfflineMode()">
    <div class="plus-icon" style="background:#2b2b2b; color:#fff; border:1px solid #2b2b2b;"><i class="fas fa-book-open"></i></div>
    <span>çº¿ä¸‹æ¨¡å¼</span>
</div>
<!-- === ã€æ–°å¢ã€‘å‰§æƒ…æ€»ç»“åŠŸèƒ½å…¥å£ === -->
<div class="plus-item" onclick="openSummaryPage()">

    <div class="plus-icon"><i class="fas fa-clipboard-list"></i></div>
    <span>å‰§æƒ…æ€»ç»“</span>
</div>

            </div>
        </div>
    </div>
    <input type="file" id="chat-image-input" accept="image/*" style="display:none;" onchange="handleChatImage(this)">
</div>



        </div>
<!-- === [æ–°å¢] é¢„è®¾ç®¡ç† APP === -->
<div class="app-fullscreen-view" id="presetsApp">
    <div class="wc-header" style="background:#fff;">
        <span onclick="closePresetsApp()"><i class="fas fa-chevron-down"></i> Presets</span>
        <div class="wc-header-icons">
            <!-- æ–°å¢å¯¼å…¥å¯¼å‡ºæŒ‰é’® -->
            <i class="fas fa-file-export" onclick="exportPresets()" title="å¯¼å‡ºé¢„è®¾" style="font-size:16px;"></i>
            <i class="fas fa-file-import" onclick="triggerImportPresets()" title="å¯¼å…¥é¢„è®¾" style="font-size:16px;"></i>
            <i class="fas fa-plus" onclick="createNewPreset()" title="æ–°å»º" style="margin-left:10px;"></i>
        </div>
        <input type="file" id="preset-import-file" accept=".json" style="display:none;" onchange="handleImportPresets(this)">
    </div>
    <!-- ä¸‹é¢çš„åˆ—è¡¨å®¹å™¨ä¸å˜ -->
    <div class="wc-body-container" style="background:#f7f7f7;">
        <div id="presets-list-container" class="presets-list"></div>
    </div>
    
    <!-- é¢„è®¾ç¼–è¾‘å™¨ -->
    <div id="preset-editor" class="preset-editor-overlay">
    <div class="wc-header" style="background:#fff;">
        <span onclick="closePresetEditor()"><i class="fas fa-chevron-left"></i> Back</span>
        <span onclick="savePresetEditor()">Save</span>
    </div>
    <div class="wc-body-container" style="padding:20px; background:#fff;">
        <!-- åŸæœ‰çš„åç§°è¾“å…¥ -->
        <div class="form-group">
            <label>é¢„è®¾åç§°</label>
            <input type="text" id="pe-name">
        </div>
        <!-- åŸæœ‰çš„ Prompt è¾“å…¥ -->
        <div class="form-group">
            <label>ç³»ç»Ÿæç¤ºè¯ (System Prompt)</label>
            <textarea id="pe-sys-prompt" rows="6" placeholder="System instructions..."></textarea>
        </div>
        
        <!-- === æ–°å¢ï¼šæ­£åˆ™è„šæœ¬æ¨¡å— (Regex Scripts) === -->
        <div class="settings-section-title" style="margin-top:20px; display:flex; justify-content:space-between; align-items:center;">
            <span>æ­£åˆ™è„šæœ¬ (Regex Scripts)</span>
            <button class="btn-secondary" style="height:24px; font-size:12px; padding:0 8px;" onclick="addRegexScriptItem()">+ æ·»åŠ </button>
        </div>
        <div id="pe-regex-container" style="display:flex; flex-direction:column; gap:10px; margin-bottom:20px;">
            <!-- JS åŠ¨æ€æ’å…¥è„šæœ¬é¡¹ -->
        </div>

        <!-- åŸæœ‰çš„è¶Šç‹±è¾“å…¥ -->
        <div class="form-group">
            <label>è¶Šç‹±/å‰ç½®æŒ‡ä»¤ (Jailbreak)</label>
            <textarea id="pe-jailbreak" rows="3"></textarea>
        </div>
        
        <button class="btn-secondary" style="color:red; margin-top:20px;" onclick="deleteCurrentPreset()">åˆ é™¤æ­¤é¢„è®¾</button>
    </div>
</div>
</div>


        <!-- Settings View -->
        <div class="settings-view" id="settingsView">
            <div class="settings-header">
                <i class="fas fa-times" onclick="toggleSettings()" style="cursor:pointer;"></i>
                <span>Settings</span>
                <div class="settings-tabs-switch">
                    <span class="tab-btn active" onclick="switchSettingsTab('ai')">AI Chat</span>
                    <span class="tab-btn" onclick="switchSettingsTab('theme')">Theme</span>
                </div>
            </div>
            
            <div class="settings-content">
                
                <!-- Tab 1: AI è®¾ç½® -->
                <div id="tab-content-ai" class="tab-content active">
                    <div class="form-group">
                        <label>API æœåŠ¡å•†</label>
                        <select id="api-provider-select">
                            <option value="custom">è‡ªå®šä¹‰ / NewAPI</option>
                            <option value="gemini">Google Gemini</option>
                            <option value="claude">Anthropic Claude</option>
                            <option value="deepseek">DeepSeek</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>API Key</label>
                        <input type="password" id="apiKeyInput" placeholder="è¯·è¾“å…¥ä½ çš„ API Key">
                    </div>
                    <div class="form-group" id="api-endpoint-group">
                        <label>API Base URL</label>
                        <input type="text" id="apiEndpointInput" placeholder="https://api.example.com">
                    </div>
                    
                    <div class="form-group">
                        <label>Model</label>
                        <div class="input-with-button">
                            <select id="model-select"></select>
                            <button id="fetch-models-btn" type="button"><i class="fas fa-sync-alt"></i></button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Temperature: <span id="temperature-value">0.7</span></label>
                        <input type="range" id="temperature-slider" min="0" max="2" step="0.1" value="0.7">
                    </div>

                    <hr class="settings-divider">

                    <div class="form-group">
                        <label>åŠ è½½é¢„è®¾ (Load Preset)</label>
                        <select id="preset-select">
                            <option value="">-- é€‰æ‹©ä¸€ä¸ªé¢„è®¾ --</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ä¿å­˜å½“å‰ä¸ºæ–°é¢„è®¾</label>
                        <div class="input-with-button">
                            <input type="text" id="preset-name-input" placeholder="ä¾‹å¦‚ 'ç¿»è¯‘åŠ©æ‰‹'">
                            <button id="save-preset-btn" type="button">Save</button>
                        </div>
                    </div>

                    <button id="save-settings-btn" class="btn-save">ä¿å­˜æ‰€æœ‰è®¾ç½®</button>
                </div>

                <!-- Tab 2: ä¸»é¢˜ç¾åŒ– -->
                <div id="tab-content-theme" class="tab-content" style="display:none;">
                    
                    <div class="form-group" style="display:flex; justify-content:space-between; align-items:center;">
                        <label style="margin:0;">æ˜¾ç¤ºçŠ¶æ€æ </label>
                        <label class="switch">
                            <input type="checkbox" id="show-statusbar-time-toggle" checked>
                            <span class="slider round"></span>
                        </label>
                    </div>
                    
                    <hr class="settings-divider">

                    <div class="form-group">
                        <label>å£çº¸è®¾ç½®</label>
                        <div class="input-with-button">
                            <input type="text" id="wallpaper-url-input" placeholder="å›¾ç‰‡ URL...">
                            <label class="file-upload-btn">
                                <i class="fas fa-image"></i>
                                <input type="file" id="wallpaper-file-input" accept="image/*" style="display:none;">
                            </label>
                        </div>
                        <button onclick="resetWallpaper()" style="margin-top:5px; width:100%; padding:8px; border:1px solid #ddd; background:#fff; border-radius:8px;">æ¢å¤é»˜è®¤å£çº¸</button>
                    </div>

                    <hr class="settings-divider">

                    <!-- === æ–°å¢ï¼šå…¨å±€ CSS ä»£ç ç¼–è¾‘å™¨ === -->
                    <div class="form-group">
                        <label>å…¨å±€è‡ªå®šä¹‰ CSS (Custom CSS)</label>
                        <textarea id="custom-css-input" placeholder="/* åœ¨è¿™é‡Œè¾“å…¥ CSS ä»£ç ï¼Œå®æ—¶ç”Ÿæ•ˆ */&#10;ä¾‹å¦‚: .icon-box { border-radius: 50%; }" spellcheck="false"></textarea>
                        <div class="form-text">è¾“å…¥ CSS ä»£ç å¯æ·±åº¦ç¾åŒ–ç•Œé¢ (æ”¯æŒå®æ—¶é¢„è§ˆ)</div>
                    </div>

                    <hr class="settings-divider">

                    <!-- === æ–°å¢ï¼šä¸»é¢˜é¢„è®¾ä¸å¯¼å…¥å¯¼å‡º === -->
                    <div class="form-group">
                        <label>ä¸»é¢˜é¢„è®¾ç®¡ç† (Theme Presets)</label>
                        <select id="theme-preset-select">
                            <option value="">-- é€‰æ‹©å·²ä¿å­˜çš„ä¸»é¢˜ --</option>
                        </select>
                        <div class="input-with-button" style="margin-top:10px;">
                            <input type="text" id="theme-preset-name" placeholder="é¢„è®¾åç§° (å¦‚: æš—é»‘æ¨¡å¼)">
                            <button id="save-theme-preset-btn" title="ä¿å­˜å½“å‰ä¸»é¢˜"><i class="fas fa-save"></i></button>
                            <button id="delete-theme-preset-btn" title="åˆ é™¤é€‰ä¸­" style="color:#ff4d4f;"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>å¤‡ä»½ä¸åˆ†äº«</label>
                        <div style="display:flex; gap:10px;">
                            <button class="btn-secondary" id="export-theme-btn"><i class="fas fa-file-export"></i> å¯¼å‡º (JSON)</button>
                            <label class="btn-secondary file-btn" style="margin:0;">
                                <i class="fas fa-file-import"></i> å¯¼å…¥
                                <input type="file" id="import-theme-file" accept=".json" style="display:none;">
                            </label>
                        </div>
                    </div>
                    
                    <hr class="settings-divider">

                    <div class="form-group">
                        <label>å­—ä½“æ¥æº</label>
                        <select id="font-source-select" onchange="toggleFontInput(this.value)">
                            <option value="preset">é¢„è®¾å­—ä½“</option>
                            <option value="custom">å¯¼å…¥ URL</option>
                        </select>
                    </div>

                    <div class="form-group" id="group-font-preset">
                        <label>é€‰æ‹©é¢„è®¾</label>
                        <select id="font-family-select">
                            <option value="'Montserrat', sans-serif">Montserrat (Default)</option>
                            <option value="'Playfair Display', serif">Playfair Display (Serif)</option>
                            <option value="'Alex Brush', cursive">Alex Brush (Handwriting)</option>
                            <option value="'Courier New', monospace">Courier New (Retro)</option>
                            <option value="system-ui, sans-serif">System Default</option>
                        </select>
                    </div>

                    <div class="form-group" id="group-font-custom" style="display:none;">
                        <label>å­—ä½“æ–‡ä»¶ URL (woff2/ttf)</label>
                        <input type="text" id="custom-font-url" placeholder="https://example.com/font.woff2">
                    </div>

                    <div class="form-group">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                            <label style="margin:0;">ä¸»é¢˜æ–‡å­—é¢œè‰²</label>
                            <input type="color" id="theme-color-picker" value="#222222" style="width:40px; height:30px; border:none; padding:0; background:none;">
                        </div>
                        
                        <div class="font-preview-box" id="font-preview-box">
                            <div style="font-size:24px; line-height:1.2;">12:30</div>
                            <div style="font-size:14px;">Good Morning</div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>å­—ä½“å¤§å°: <span id="font-scale-value">100%</span></label>
                        <input type="range" id="font-scale-slider" min="0.8" max="1.3" step="0.05" value="1">
                    </div>

                    <hr class="settings-divider">

                    <div class="form-group">
                        <label>è‡ªå®šä¹‰ APP å›¾æ ‡</label>
                        <select id="app-icon-select">
                            <option value="">-- é€‰æ‹© APP --</option>
                        </select>
                        <div style="margin-top:10px; display:flex; align-items:center; gap:10px;">
                            <div id="icon-preview-area" style="width:48px; height:48px; border-radius:12px; background:#eee; display:flex; justify-content:center; align-items:center; overflow:hidden;">
                                <span style="font-size:10px; color:#999;">é¢„è§ˆ</span>
                            </div>
                            <label class="btn-save" style="width:auto; padding:0 15px; display:flex; align-items:center; margin:0; font-size:12px; height:36px;">
                                ä¸Šä¼ å›¾æ ‡ <i class="fas fa-upload" style="margin-left:5px;"></i>
                                <input type="file" id="app-icon-file" accept="image/*" style="display:none;">
                            </label>
                        </div>
                        <button id="reset-icon-btn" style="margin-top:10px; width:100%; padding:8px; border:1px solid #ddd; background:#fff; border-radius:8px; display:none;">é‡ç½®æ­¤å›¾æ ‡</button>
                    </div>

                    <button id="save-theme-btn" class="btn-save" style="margin-top:30px;">ä¿å­˜æ‰€æœ‰ä¸»é¢˜é…ç½®</button>
                </div>

            </div>
        </div><!-- === [æ–°å¢] èŠå¤©è¯¦ç»†è®¾ç½®ç‹¬ç«‹é¡µé¢ === -->
<div class="chat-settings-page-view" id="chatSettingsPage">
    <div class="chat-settings-page-header">
        <!-- è¿”å›æŒ‰é’®ï¼Œç‚¹å‡»å…³é—­é¡µé¢ -->
        <i class="fas fa-chevron-left" onclick="closeChatSettingsPage()"></i>
        <span>èŠå¤©è®¾ç½®</span>
        <!-- å³ä¾§å ä½ï¼Œä¿æŒæ ‡é¢˜å±…ä¸­ -->
        <div style="width: 24px;"></div>
    </div>
    
    <div class="chat-settings-page-content">
             <!-- 1. è§’è‰²ä¿¡æ¯ (é‡æ„ç‰ˆï¼šå¤´åƒä¸Šä¼ ã€çœŸåã€ä¸–ç•Œä¹¦å¤šé€‰) -->
        <div class="settings-section-title" style="margin-top: 0;">è§’è‰²æ¡£æ¡ˆ (Profile)</div>
        
        <!-- å¤´åƒä¿®æ”¹ (æ”¹ä¸ºç‚¹å‡»ä¸Šä¼ å¼) -->
        <div class="form-group">
            <label>å¤´åƒ (Avatar)</label>
            <div style="display:flex; align-items:center; gap:15px;">
                <!-- å¤´åƒé¢„è§ˆåŒºåŸŸ -->
                <div id="cs-avatar-preview" style="width:64px; height:64px; border-radius:16px; background:#eee; border:2px solid #fff; box-shadow: 0 5px 15px rgba(0,0,0,0.08); overflow:hidden; flex-shrink:0;">
                    <img src="" style="width:100%; height:100%; object-fit:cover; display:none;">
                </div>
                <!-- éšè—çš„æ–‡ä»¶è¾“å…¥æ¡†å’ŒæŒ‰é’® -->
                <div>
                    <input type="file" id="cs-avatar-upload" accept="image/*" style="display:none;">
                    <button class="btn-secondary" onclick="document.getElementById('cs-avatar-upload').click()" style="padding: 8px 15px; height:auto; width:auto;">
                        <i class="fas fa-camera"></i> æ›´æ¢å¤´åƒ
                    </button>
                    <!-- éšè—åŸŸï¼Œç”¨äºå­˜å‚¨å®é™…çš„å›¾ç‰‡æ•°æ® -->
                    <input type="hidden" id="cs-avatar-hidden-val">
                </div>
            </div>
        </div>

        <div style="display: flex; gap: 15px;">
            <div class="form-group" style="flex:1;">
                <label>å¤‡æ³¨å (Nickname)</label>
                <input type="text" id="cs-remark" placeholder="èŠå¤©çª—å£æ˜¾ç¤ºçš„åç§°">
            </div>
            <div class="form-group" style="flex:1;">
                <label>çœŸå®å§“å (Real Name) <span style="color:red">*</span></label>
                <input type="text" id="cs-realname" placeholder="è§’è‰²çš„çœŸå">
            </div>
        </div>

        <div class="form-group">
            <!-- å¼€åœºç™½è®¾ç½® -->
<div class="form-group">
    <label>å¼€åœºç™½æ¥æº (Greeting Source)</label>
    <select id="cs-greeting-mode" onchange="toggleGreetingEditor()">
        <option value="none">ä¸å¼€åœºç™½</option>
        <option value="custom">è‡ªå®šä¹‰å¼€åœºç™½</option>
        <option value="tavern">è¯»å–é…’é¦†å¡å¼€åœºç™½</option>
        <!-- === ã€æ–°å¢ã€‘æ›´æ¢å¼€åœºç™½çš„æç¤º === -->
<div class="form-text" style="color: #ff7e67; font-weight: bold; margin-top: -5px; margin-bottom: 10px;">
    <i class="fas fa-info-circle"></i> æ³¨æ„ï¼šæ›´æ¢å¼€åœºç™½åï¼Œä¸ºä¿è¯å‰§æƒ…è¿è´¯ï¼Œè¯·é€‰æ‹©æ¸…ç©ºè§’è‰²èŠå¤©è®°å½•ã€‚
</div>

    </select>
</div>

<div class="form-group" id="cs-greeting-custom-box">
    <label>è‡ªå®šä¹‰å¼€åœºç™½</label>
    <textarea id="cs-greeting-custom" rows="3" placeholder="ä½ è‡ªå·±å†™ç¬¬ä¸€å¥..."></textarea>
</div>

<div class="form-group" id="cs-greeting-tavern-box">
    <label>é…’é¦†å¡å¼€åœºç™½åˆ—è¡¨</label>
    <div id="cs-greeting-list" class="worldbook-checklist-container"></div>
    <textarea id="cs-greeting-tavern" rows="3" readonly placeholder="é€‰æ‹©ååœ¨è¿™é‡Œé¢„è§ˆ"></textarea>
</div>


            <label>äººè®¾ (Persona) <span style="color:red">*</span></label>
            <textarea id="cs-persona" rows="6" placeholder="è§’è‰²çš„æ ¸å¿ƒæ€§æ ¼ã€èº«ä»½è®¾å®š..." style="height:auto; font-size:13px;"></textarea>
            
        </div>


        <!-- ä¸–ç•Œä¹¦ (æ”¹ä¸ºå¤šé€‰æ¡†å®¹å™¨ï¼ŒJSåŠ¨æ€åŠ è½½) -->
        <div class="form-group">
            <label>ä¸–ç•Œä¹¦è®¾å®š (Worldbooks) - å¤šé€‰</label>
            <div id="cs-worldbook-container" class="worldbook-checklist-container">
                <!-- JS å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆå¤é€‰æ¡† -->
                <div style="color:#999; font-size:12px; padding:10px;">æ­£åœ¨åŠ è½½ä¸–ç•Œä¹¦åˆ—è¡¨...</div>
            </div>
        </div>

        <hr class="settings-divider">

        <!-- 2. é«˜çº§åŠŸèƒ½ (é‡æ„ç‰ˆï¼šç¿»è¯‘ä¸‹æ‹‰ã€ä¸»åŠ¨å‘è¨€æ—¶é—´) -->
        <div class="settings-section-title">é«˜çº§åŠŸèƒ½ (Advanced)</div>
            
        <!-- è®°å¿† -->
        <div class="form-group" style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <label style="margin:0; display:block;">ä¸Šä¸‹æ–‡è®°å¿†è½®æ•°</label>
                <span class="form-text" style="margin:0;">ä»…å‘é€æœ€è¿‘ N è½®å¯¹è¯ã€‚</span>
            </div>
            <input type="number" id="cs-memory-limit" placeholder="20" style="width: 80px; text-align:center;" min="5">
        </div>

        <!-- ç¿»è¯‘è®¾ç½® (æ”¹é€ æˆä¸‹æ‹‰æ¡† + è¾“å…¥æ¡†) -->
        <div class="form-group" style="margin-top: 25px;">
            <label>ç¿»è¯‘æ¨¡å¼ (Translation Mode)</label>
            <select id="cs-translation-mode">
                <option value="off">å…³é—­ (Off)</option>
                <option value="ai_to_zh">ç¿»è¯‘AIè¾“å‡ºåˆ°ä¸­æ–‡ (Translate AI output to ZH)</option>
                <option value="ai_to_en">ç¿»è¯‘AIè¾“å‡ºåˆ°è‹±æ–‡ (Translate AI output to EN)</option>
            </select>
            
            <div style="margin-top: 10px;">
                <label style="font-size: 11px; color: #888;">å¼ºåˆ¶è¾“å‡ºè¯­è¨€ (Target Language)</label>
                <input type="text" id="cs-target-lang" placeholder="ä¾‹å¦‚: English, Japanese (ç•™ç©ºåˆ™é»˜è®¤)">
                <span class="form-text" style="display:block; margin-top:4px;">å¼ºåˆ¶ AI ä½¿ç”¨è¯¥è¯­è¨€å›å¤ï¼Œä¼˜å…ˆçº§é«˜äºç¿»è¯‘æ¨¡å¼ã€‚</span>
            </div>
        </div>

        <!-- ä¸»åŠ¨å‘è¨€ (å¢åŠ æ—¶é—´é€‰é¡¹ï¼Œé»˜è®¤éšè—) -->
        <div class="form-group" style="margin-top: 25px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <label style="margin:0; font-weight:500;">æ— æ“ä½œä¸»åŠ¨å‘è¨€</label>
                <label class="switch">
                    <input type="checkbox" id="cs-inactivity-toggle">
                    <span class="slider round"></span>
                </label>
            </div>
            <!-- éšè—çš„æ—¶é—´è¾“å…¥åŒºåŸŸï¼ŒJSæ§åˆ¶æ˜¾ç¤º -->
            <div id="cs-inactivity-time-box" style="display:none; background:#f5f5f7; padding:15px; border-radius:12px;">
                <label style="margin-bottom:5px;">è§¦å‘æ—¶é—´é—´éš” (ç§’)</label>
                <input type="number" id="cs-inactivity-time" placeholder="300" value="300" min="60" style="background:#fff;">
                <span class="form-text" style="display:block; margin-top:4px;">å¦‚æœè¶…è¿‡æ­¤æ—¶é—´æ— å¯¹è¯ï¼ŒAI å°†å°è¯•ä¸»åŠ¨å‘èµ·è¯é¢˜ã€‚</span>
            </div>
        </div>

        <hr class="settings-divider">

        <!-- 3. çŠ¶æ€æ æ­£åˆ™è®¾ç½® (é…’é¦†é£æ ¼é‡æ„ï¼Œé»˜è®¤éšè—) -->
        <div class="settings-section-title" style="display:flex; justify-content:space-between; align-items:center;">
            <span>çŠ¶æ€æ æŠ“å– (Regex)</span>
            <label class="switch" style="transform:scale(0.8);">
                <input type="checkbox" id="cs-status-regex-toggle">
                <span class="slider round"></span>
            </label>
        </div>
        
        <div id="cs-status-regex-box" style="display:none; flex-direction:column; gap:15px; background:#f9f9f9; padding:15px; border-radius:16px; border:1px solid #eee;">
            
            <div class="form-group" style="margin:0;">
                <label>1. çŠ¶æ€æ æ ¼å¼è¦æ±‚ (Prompt Instruction)</label>
                <span class="form-text" style="margin-bottom:5px; display:block;">æç¤º AI æŒ‰ç…§ä»€ä¹ˆæ ¼å¼è¾“å‡ºçŠ¶æ€æ•°æ®ã€‚</span>
                <textarea id="cs-status-format-req" rows="4" placeholder="ä¾‹å¦‚ï¼šè¯·åœ¨å›å¤æœ€åé™„å¸¦çŠ¶æ€æ ï¼Œæ ¼å¼ä¸ºï¼š&#10;[STATUS]&#10;å¿ƒæƒ…:å¼€å¿ƒ&#10;åœ°ç‚¹:å®¶&#10;[/STATUS]" style="font-family:monospace; font-size:11px; height:auto;"></textarea>
            </div>

            <div class="form-group" style="margin:0;">
                <label>2. æå–æ­£åˆ™ (Extraction Regex)</label>
                <span class="form-text" style="margin-bottom:5px; display:block;">ç”¨äºä»å›å¤ä¸­æå–å‡ºçŠ¶æ€æ å†…å®¹å—ã€‚</span>
                <textarea id="cs-status-extract-regex" rows="2" placeholder="ä¾‹å¦‚ï¼š/\[STATUS\]([\s\S]*?)\[\/STATUS\]/i" style="font-family:monospace; font-size:11px; color:#d63384; background:#fff; height:auto;"></textarea>
            </div>

            <div class="form-group" style="margin:0;">
                <label>3. æ­£åˆ™æ›¿æ¢ (Regex Replacement)</label>
                <span class="form-text" style="margin-bottom:5px; display:block;">å°†æå–åˆ°çš„å†…å®¹ä»æœ€ç»ˆæ°”æ³¡ä¸­ç§»é™¤ (ç•™ç©ºåˆ™ä¸ç§»é™¤)ã€‚</span>
                <textarea id="cs-status-replace-regex" rows="2" placeholder="ä¾‹å¦‚ï¼š(ç•™ç©º)" style="font-family:monospace; font-size:11px; background:#fff; height:auto;"></textarea>
            </div>
        </div>


        <!-- ä¿å­˜æŒ‰é’®ï¼Œæ”¾åœ¨æœ€åº•éƒ¨ -->
        <button class="btn-save" onclick="saveChatSettings()" style="margin-top: 30px; margin-bottom: 30px;">ä¿å­˜é…ç½®</button>
       <button class="btn-secondary" onclick="clearCurrentChatHistory()" style="color:#ff4d4f; border-color:#ff4d4f; margin-top:10px; margin-bottom: 30px;">
    <i class="fas fa-exclamation-triangle"></i> æ¸…ç©ºèŠå¤©è®°å½•
</button>
    </div>
</div>
<!-- å¥½å‹èµ„æ–™é¡µï¼ˆå¤ç”¨ chat-settings-page çš„æ ·å¼ï¼‰ -->
<div class="chat-settings-page-view" id="contactProfilePage">
    <div class="chat-settings-page-header">
        <i class="fas fa-chevron-left" onclick="closeContactProfile()"></i>
        <span>å¥½å‹èµ„æ–™</span>
        <div style="width:24px;"></div>
    </div>

    <div class="chat-settings-page-content" style="padding: 20px 0;"> <!-- å»æ‰å†…è¾¹è·ï¼Œé å¡ç‰‡è‡ªå®šå®½åº¦ -->
        <!-- ç¬¬ä¸€éƒ¨åˆ†ï¼šå¤´åƒå’Œåå­—å¡ç‰‡ -->
        <div class="wc-me-header">
            <div class="wc-avatar lg">
                <img id="cp-avatar" src="">
            </div>
            <div class="wc-me-info">
                <div class="wc-me-name" id="cp-name"></div>
                <div class="wc-me-id" id="cp-realname"></div>
            </div>
        </div>

        <!-- ç¬¬äºŒéƒ¨åˆ†ï¼šäººè®¾ç®€ä»‹å¡ç‰‡ï¼ˆæœ¬é¡µç›´æ¥å¯ç¼–è¾‘ï¼‰ -->
<div class="wc-menu-group">
    <div class="wc-menu-item" style="border-bottom:none; padding-bottom:5px;">
        <i class="fas fa-id-card menu-icon"></i>
        <span>äººè®¾ç®€ä»‹</span>
    </div>

    <!-- è¿™é‡Œæ”¹æˆä¸€ä¸ªå¯ç¼–è¾‘çš„æ¡† -->
    <div style="padding: 0 20px 15px;">
        <textarea id="cp-persona-input"
                  class="cp-persona-box"
                  placeholder="ç›´æ¥åœ¨è¿™é‡Œç¼–è¾‘è¿™ä¸ªå¥½å‹çš„äººè®¾â€¦"></textarea>
    </div>

    <div style="padding: 0 20px 20px;">
        <!-- ç‚¹å‡»åªåœ¨å½“å‰èµ„æ–™é¡µä¿å­˜äººè®¾ï¼Œä¸è·³é¡µ -->
        <button class="btn-secondary"
                style="width:100%; border-radius: 12px; height: 38px; background: #f9f9f9;"
                onclick="savePersonaFromProfile()">
            <i class="fas fa-save"></i> ä¿å­˜äººè®¾
        </button>
    </div>
</div>
        <!-- ç¬¬ä¸‰éƒ¨åˆ†ï¼šæœ‹å‹åœˆå…¥å£ï¼ˆå»æ‰å›¾ç‰‡ï¼Œå˜æˆçº¯æ–‡å­—æ¡ç›®ï¼‰ -->
        <div class="wc-menu-group" id="cp-moment-preview" onclick="openContactMoments()" style="cursor:pointer;">
            <div class="wc-menu-item">
                <i class="fas fa-compass menu-icon"></i>
                <span>æœ‹å‹åœˆ</span>
                <div id="cp-moment-text" style="font-size: 12px; color: #999; margin-right: 10px;">ç‚¹å‡»æŸ¥çœ‹</div>
                <i class="fas fa-chevron-right arrow" style="font-size:10px; color:#ccc"></i>
            </div>
        </div>

        <!-- åº•éƒ¨æŒ‰é’®åŒºåŸŸï¼šåšåº¦ä¸€è‡´ -->
        <div style="margin-top:30px; padding: 0 24px; display:flex; flex-direction:column; gap:12px;">
            <button class="btn-save profile-main-btn" onclick="contactProfileSendMsg()">å‘æ¶ˆæ¯</button>
            
            <div style="display: flex; gap: 10px;">
                <button class="btn-cancel profile-main-btn" 
                        style="background:#f5f5f5; color:#555; flex: 1;" 
                        onclick="blockFriendFromProfile()">æ‹‰é»‘</button>
                <button class="btn-cancel profile-main-btn" 
                        style="background:#ffecec; color:#e53935; flex: 1;" 
                        onclick="deleteFriendFromProfile()">åˆ é™¤å¥½å‹</button>
            </div>
        </div>
    </div>
</div>


<!-- ============================================== -->
<!-- [æ–°å¢] ä¸–ç•Œä¹¦ç®¡ç†åº”ç”¨ (WorldBook App) -->
<!-- ============================================== -->
<div class="app-fullscreen-view" id="worldBookApp">
    
    <!-- é¡¶éƒ¨æ ‡é¢˜æ  -->
    <div class="wc-header" style="background: rgba(255,255,255,0.95);">
        <span id="wb-header-title" onclick="closeWorldBookApp()" style="cursor: pointer;">
            <i class="fas fa-chevron-down" style="font-size: 18px; margin-right: 10px;"></i> WorldBook
        </span>
        <div class="wc-header-icons">
            <!-- å¯¼å…¥æŒ‰é’® -->
            <i class="fas fa-file-import" onclick="triggerWorldBookImport()" title="å¯¼å…¥ (JSON/TXT)"></i>
            <!-- æ–°å»ºæŒ‰é’® -->
            <i class="fas fa-plus" onclick="createNewWorldBook()" title="æ–°å»ºä¸–ç•Œä¹¦"></i>
        </div>
        <!-- éšè—çš„æ–‡ä»¶è¾“å…¥æ¡† -->
        <input type="file" id="wb-import-input" accept=".json,.txt,.docx" style="display: none;" onchange="handleWorldBookImport(this)">
    </div>

    <!-- ä¸»å†…å®¹åŒº -->
    <div class="wc-body-container" style="padding: 20px;">
        
        <!-- 1. ä¹¦æ¶åˆ—è¡¨è§†å›¾ -->
        <div id="wb-shelf-view">
            <div class="wb-search-bar">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="Search Lorebooks..." oninput="filterWorldBooks(this.value)">
            </div>
            <div id="wb-list-container" class="wb-grid">
                <!-- JS åŠ¨æ€ç”Ÿæˆä¹¦ç±å¡ç‰‡ -->
            </div>
        </div>

        <!-- 2. ä¹¦ç±è¯¦æƒ…/ç¼–è¾‘è§†å›¾ (é»˜è®¤éšè—) -->
        <div id="wb-detail-view" style="display: none;">
            <!-- ä¹¦ç±å…ƒæ•°æ®è¡¨å• -->
            <div class="wb-edit-card">
                <div class="wb-form-row">
                    <div class="wb-input-group" style="flex: 2;">
                        <label>ä¹¦å (Title)</label>
                        <input type="text" id="wb-edit-title">
                    </div>
                    <div class="wb-input-group" style="flex: 1;">
                        <label>åˆ†ç±» (Tag)</label>
                        <input type="text" id="wb-edit-category" placeholder="General">
                    </div>
                </div>
                
                <div class="wb-form-row">
                    <div class="wb-toggle-group">
                        <label>å…¨å±€å¯ç”¨ (Global)</label>
                        <label class="switch">
                            <input type="checkbox" id="wb-edit-global">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="wb-input-group" style="flex: 1;">
                        <label>æ³¨å…¥ç­–ç•¥ (Strategy)</label>
                        <select id="wb-edit-strategy">
                            <option value="depth">æ·±åº¦æ³¨å…¥ (Depth)</option>
                            <option value="top">é¡¶éƒ¨ (Top)</option>
                            <option value="bottom">åº•éƒ¨ (Bottom)</option>
                        </select>
                    </div>
                </div>

                <div class="wb-action-bar">
                    <button class="btn-secondary" onclick="exportCurrentWorldBook()"><i class="fas fa-download"></i> å¯¼å‡ºJSON</button>
                    <button class="btn-secondary" style="color: #ff4d4f; border-color: #ff4d4f;" onclick="deleteCurrentWorldBook()"><i class="fas fa-trash"></i> åˆ é™¤æ­¤ä¹¦</button>
                </div>
            </div>

            <!-- æ¡ç›®åˆ—è¡¨åŒºåŸŸ -->
            <div class="wb-entries-header">
                <span>å†…å®¹æ¡ç›® (Entries)</span>
                <button class="btn-mini-add" onclick="addNewEntry()"><i class="fas fa-plus"></i></button>
            </div>
            
            <div id="wb-entries-list" class="wb-entries-container">
                <!-- JS åŠ¨æ€ç”Ÿæˆæ¡ç›® -->
            </div>

            <button class="btn-save" onclick="saveCurrentWorldBook()" style="margin-top: 20px;">ä¿å­˜æ‰€æœ‰æ›´æ”¹</button>
            <button class="btn-secondary" onclick="backToShelf()" style="margin-top: 10px;">è¿”å›ä¹¦æ¶</button>
        </div>

    </div>
</div>

<!-- === [æ–°å¢] æ¡ç›®ç¼–è¾‘å¼¹çª— === -->
<div id="wb-entry-modal" class="modal-overlay">
    <div class="modal-box" style="width: 340px;">
        <div class="modal-header">
            <span>ç¼–è¾‘æ¡ç›®</span>
            <i class="fas fa-times" onclick="closeEntryModal()"></i>
        </div>
        <div class="modal-body">
            <div class="input-group">
                <label>è§¦å‘å…³é”®è¯ (Keywords) <span style="color:#aaa; font-weight:400;">(é€—å·åˆ†éš”)</span></label>
                <input type="text" id="entry-keys" placeholder="ä¾‹å¦‚: å¸å›½, çš‡å¸, é¦–éƒ½">
            </div>
            <div class="input-group">
                <label>å†…å®¹ (Content) <span style="color:red">*</span></label>
                <textarea id="entry-content" rows="6" placeholder="å½“å…³é”®è¯å‡ºç°æ—¶ï¼ŒAIä¼šçœ‹åˆ°è¿™æ®µè®¾å®š..."></textarea>
            </div>
            <div class="input-group">
                <label>å¤‡æ³¨ (Comment)</label>
                <input type="text" id="entry-comment" placeholder="ä»…ç”¨äºè‡ªå·±çœ‹">
            </div>
            <div class="wb-form-row">
                 <div class="wb-toggle-group">
                    <label>å¯ç”¨ (Enabled)</label>
                    <label class="switch" style="transform: scale(0.8);">
                        <input type="checkbox" id="entry-enabled" checked>
                        <span class="slider round"></span>
                    </label>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-cancel" onclick="deleteCurrentEntry()" style="color:red;">åˆ é™¤</button>
            <button class="btn-confirm" onclick="saveEntryToMemory()">ç¡®å®š</button>
        </div>
    </div>
</div>
<!-- === éŸ©ç³»é«˜å®šé»‘ç™½ç›´æ’­ APP === -->
<div class="app-fullscreen-view" id="liveApp">
    
    <!-- é¡¶éƒ¨å¯¼èˆªï¼šé€æ˜èƒŒæ™¯ï¼Œæç®€æ–‡å­— -->
    <div class="k-header">
        <div class="k-header-left">
            <i class="fas fa-arrow-left" onclick="closeLiveApp()"></i>
        </div>
        <div class="k-tabs-top">
            <span class="active">æ¨è</span>
            <span>é™„è¿‘</span>
        </div>
        <div class="k-header-right">
            <i class="fas fa-search"></i>
        </div>
    </div>

    <!-- å†…å®¹æ»šåŠ¨åŒº -->
    <div class="k-body-container">
        
        <!-- Tab 1: é¦–é¡µæ¨è (æ‚å¿—æ’ç‰ˆæµ) -->
        <div class="k-tab-content active" id="lv-tab-recommend">
            <!-- é¡¶éƒ¨å¤§å›¾ Banner -->
            <div class="k-hero-banner">
    <div class="k-hero-tag">FEATURED</div>
    <div class="k-hero-title">Late Night<br>Talks.</div>
    <div class="k-hero-subtitle">ä¸»æ’­ï¼šHannah AI</div>
</div>
            
            <!-- ç€‘å¸ƒæµå†…å®¹ -->
            <div class="k-masonry-grid" id="lv-feed-container">
                <!-- JS è‡ªåŠ¨å¡«å…… -->
            </div>
            
            <!-- åº•éƒ¨ç•™ç™½ï¼Œé˜²æ­¢è¢« Dock é®æŒ¡ -->
            <div style="height: 100px;"></div>
        </div>

        <!-- Tab 2: æˆ‘è¦å¼€æ’­ (æç®€é»‘ç™½ç•Œé¢) -->
        <div class="k-tab-content" id="lv-tab-broadcast" style="display:none;">
            <div class="k-broadcast-wrap">
               <div class="k-cam-preview">
    <i class="fas fa-circle-notch fa-spin"></i>
    <p>INITIALIZING CAMERA...</p>
</div>
<div class="k-broadcast-ui">
    <!-- æ³¨æ„ï¼šè¿™é‡Œ placeholder æ”¹æˆäº†ä¸­æ–‡ -->
    <input type="text" class="k-live-input" placeholder="è¾“å…¥ç›´æ’­æ ‡é¢˜...">
    <button class="k-start-btn">GO LIVE</button>
</div>

            </div>
        </div>

        <!-- Tab 3: ç§ä¿¡ (æç®€åˆ—è¡¨) -->
        <div class="k-tab-content" id="lv-tab-messages" style="display:none;">
            <div class="k-page-title">INBOX.</div>
            <div class="k-msg-list" id="lv-msg-list">
                <!-- é™æ€æ¨¡æ‹Ÿ -->
                <div class="k-msg-item">
                    <div class="k-avatar-sq">H</div>
                    <div class="k-msg-text">
                        <div class="top"><span>Hannah AI</span> <span class="time">12:00</span></div>
                        <div class="btm">Are you ready for the stream?</div>
                    </div>
                </div>
            </div>
        </div>

               <!-- Tab 4: ä¸ªäººä¸»é¡µ (æç®€å¤§å›¾é£) -->
        <div class="k-tab-content" id="lv-tab-profile" style="display:none;">
            <div class="k-profile-cover">
                <img src="https://images.unsplash.com/photo-1534528741775-53994a69daeb?q=80&w=400&auto=format&fit=crop">
                <div class="k-profile-overlay">
                    <div class="k-p-name">USER.001</div>
                    <div class="k-p-bio">Digital Nomad / AI Streamer</div>
                </div>
            </div>
            
            <div class="k-stats-bar">
                <div><b>12.5k</b><span>Followers</span></div>
                <div><b>89</b><span>Following</span></div>
                <div><b>1.2M</b><span>Likes</span></div>
            </div>

            <!-- æ–°å¢ï¼šå‘å¸ƒæŒ‰é’® -->
            <div class="k-profile-actions">
                <button class="k-btn-publish" onclick="openLivePublishModal()">
                    <i class="fas fa-plus"></i> å‘å¸ƒä½œå“ (Post)
                </button>
            </div>

            <!-- æ–°å¢ï¼šæˆ‘çš„ä½œå“åŒºåŸŸ -->
            <div class="k-section-header">æˆ‘çš„ä½œå“ (Works)</div>
            <div class="k-archive-grid" id="k-my-works-grid">
                <!-- JS ä¼šåœ¨è¿™é‡Œæ’å…¥æ–°å‘å¸ƒçš„ä½œå“ -->
            </div>
            
            <!-- åŸæœ‰ï¼šå¾€æœŸå›æ”¾ (æ”¾åœ¨ä½œå“ä¸‹é¢) -->
            <div class="k-section-header" style="margin-top:20px;">å¾€æœŸå›æ”¾ (Replays)</div>
            <div class="k-archive-grid">
                <div class="k-archive-item" style="background:#eee;"></div>
                <div class="k-archive-item" style="background:#ddd;"></div>
                <div class="k-archive-item" style="background:#ccc;"></div>
            </div>
            
            <div style="height: 100px;"></div> <!-- åº•éƒ¨å«é«˜ -->
        </div>
            <!-- === æ–°å¢ï¼šå‘å¸ƒä½œå“å¼¹çª— === -->
    <div class="k-full-modal" id="livePublishModal">
        <div class="k-modal-header">
            <i class="fas fa-times" onclick="closeLivePublishModal()" style="cursor:pointer; font-size:18px;"></i>
            <span>å‘å¸ƒä½œå“</span>
            <span onclick="confirmPublishWork()" style="color:#2b2b2b; cursor:pointer;">å‘å¸ƒ</span>
        </div>
        <div class="k-publish-body">
            <!-- å›¾ç‰‡/è§†é¢‘ä¸Šä¼  -->
            <div class="k-upload-box" onclick="document.getElementById('live-file-input').click()">
                <img id="live-preview-img" style="display:none;">
                <i id="live-upload-icon" class="fas fa-camera"></i>
            </div>
            <input type="file" id="live-file-input" accept="image/*" style="display:none;" onchange="handleLiveFilePreview(this)">
            
            <!-- æ–‡æ¡ˆ -->
            <div class="k-input-group">
                <textarea class="k-input-textarea" id="live-desc" rows="4" placeholder="å†™ç‚¹ä»€ä¹ˆ... (Add a caption)"></textarea>
            </div>

            <!-- æ ‡ç­¾ -->
            <div class="k-input-group">
                <label>é€‰æ‹©æ ‡ç­¾ (Tags)</label>
                <select id="live-tag" class="k-tag-select">
                    <option value="#Daily">#æ—¥å¸¸ (Daily)</option>
                    <option value="#OOTD">#ç©¿æ­ (OOTD)</option>
                    <option value="#Food">#ç¾é£Ÿ (Food)</option>
                    <option value="#Travel">#æ—…è¡Œ (Travel)</option>
                </select>
            </div>

            <!-- è°å¯ä»¥çœ‹ -->
            <div class="k-input-group">
                <label>è°å¯ä»¥çœ‹ (Visibility)</label>
                <select id="live-visibility" class="k-visibility-select">
                    <option value="public">å…¬å¼€ (Public)</option>
                    <option value="friends">ä»…å¥½å‹ (Friends)</option>
                    <option value="private">ç§å¯† (Private)</option>
                </select>
            </div>
        </div>
    </div>

    <!-- === æ–°å¢ï¼šä½œå“è¯¦æƒ…å¼¹çª— (ä»¿æŠ–éŸ³) === -->
    <div class="k-full-modal" id="liveWorkDetailModal" style="background:#000;">
        <!-- é¡¶éƒ¨é€æ˜å¯¼èˆª -->
        <div style="position:absolute; top:40px; left:20px; z-index:10; color:#fff;">
            <i class="fas fa-chevron-left" onclick="closeWorkDetailModal()" style="font-size:24px; cursor:pointer; text-shadow:0 1px 3px rgba(0,0,0,0.5);"></i>
        </div>

        <div class="k-detail-media">
            <img id="work-detail-img" src="">
            
            <!-- ä¾§è¾¹äº’åŠ¨æ  -->
            <div class="k-interaction-sidebar">
                <div class="k-action-btn">
                    <div class="k-avatar-sq" style="width:40px; height:40px; border-radius:50%; border:2px solid #fff; margin-bottom:10px;">
                        <img src="https://images.unsplash.com/photo-1534528741775-53994a69daeb?q=80&w=100&auto=format&fit=crop" style="width:100%; height:100%; border-radius:50%;">
                    </div>
                </div>
                <div class="k-action-btn">
                    <div class="k-action-icon"><i class="fas fa-heart"></i></div>
                    <span class="k-action-num" id="work-detail-likes">0</span>
                </div>
                <div class="k-action-btn">
                    <div class="k-action-icon"><i class="fas fa-comment-dots"></i></div>
                    <span class="k-action-num" id="work-detail-comments">0</span>
                </div>
                <div class="k-action-btn">
                    <div class="k-action-icon"><i class="fas fa-share"></i></div>
                    <span class="k-action-num" id="work-detail-shares">0</span>
                </div>
            </div>

            <!-- åº•éƒ¨ä¿¡æ¯ -->
            <div class="k-detail-overlay">
                <div class="k-detail-title">@USER.001</div>
                <div class="k-detail-tags" id="work-detail-desc"></div>
                <div style="font-size:12px; opacity:0.8;">
                    <i class="fas fa-music"></i> åŸå£° - USER.001 çš„åˆ›ä½œ
                </div>
            </div>
        </div>
    </div>



    </div>

    <!-- åº•éƒ¨ Dock (é»‘è‰²æ‚¬æµ®èƒ¶å›Š) -->
    <div class="k-dock-wrapper">
        <div class="k-dock">
            <div class="k-dock-item active" onclick="switchLiveTab('recommend', this)">
                <i class="fas fa-compass"></i>
            </div>
            <div class="k-dock-item" onclick="switchLiveTab('broadcast', this)">
                <!-- ä¸­é—´çš„å¼€æ’­æŒ‰é’®æ˜¯ä¸ªå®å¿ƒåœ† -->
                <div class="k-btn-center"><i class="fas fa-plus"></i></div>
            </div>
            <div class="k-dock-item" onclick="switchLiveTab('messages', this)">
                <i class="far fa-comment-dots"></i> <!-- ç©ºå¿ƒå›¾æ ‡æ›´é«˜çº§ -->
            </div>
            <div class="k-dock-item" onclick="switchLiveTab('profile', this)">
                   <i class="far fa-user"></i>
            </div>
        </div>
    </div>
    
    </div> 
        <!-- ============================================== -->
    <!-- [æ–°å¢] Bubble App (éŸ©ç³»é»‘ç™½åŒæ¨¡å¼ç‰ˆ) -->
    <!-- ============================================== -->
    <div class="app-fullscreen-view" id="bubbleApp">
        
        <!-- 1. æ¨¡å¼é€‰æ‹©é¡µ (å¯åŠ¨ç”»é¢) -->
        <div id="bb-landing-view" class="bb-landing">
            <div class="bb-logo">bubble</div>
            <div class="bb-subtitle">CONNECT WITH YOUR ARTIST</div>
            
            <div class="bb-mode-select">
                <div class="bb-mode-card" onclick="enterBubbleMode('idol')">
                    <div class="bb-mode-icon"><i class="fas fa-microphone-alt"></i></div>
                    <div class="bb-mode-title">æˆ‘æ˜¯çˆ±è±† (ARTIST)</div>
                    <div class="bb-mode-desc">å‘å¸ƒåŠ¨æ€ â€¢ æŸ¥çœ‹å›å¤</div>
                </div>
                <div class="bb-mode-card" onclick="enterBubbleMode('fan')">
                    <div class="bb-mode-icon"><i class="fas fa-heart"></i></div>
                    <div class="bb-mode-title">æˆ‘æ˜¯ç²‰ä¸ (FAN)</div>
                    <div class="bb-mode-desc">æ¥æ”¶æ¶ˆæ¯ â€¢ çºªå¿µæ—¥ 365å¤©</div>
                </div>
            </div>
            <div class="bb-close-btn" onclick="closeBubbleApp()">CLOSE APP</div>
        </div>

                <!-- 2. === æ¨¡å¼ A: çˆ±è±†å¹¿æ’­ç«¯ === -->
        <div id="bb-idol-view" class="bb-view" style="display:none; position:relative;">
            <div class="bb-header">
                <i class="fas fa-chevron-left" onclick="exitBubbleMode()"></i>
                <span>ARTIST DASHBOARD</span>
                <!-- ç‚¹å‡»å³ä¾§å›¾æ ‡ä¹Ÿå¯ä»¥æ‰“å¼€è¯„è®ºåˆ—è¡¨ -->
                <i class="fas fa-list-ul" onclick="openBubbleComments()" style="cursor:pointer;"></i>
            </div>
            
            <div class="bb-idol-content">
                <!-- ç²‰ä¸å›å¤å®æ—¶æµ (ç‚¹å‡»å¯æ‰“å¼€è¯¦æƒ…) -->
                <div class="bb-reply-stream-box" onclick="openBubbleComments()" title="ç‚¹å‡»æŸ¥çœ‹æ‰€æœ‰å›å¤">
                    <div class="bb-section-title" style="display:flex; justify-content:space-between;">
                        <span>LIVE REPLIES</span>
                        <span style="font-size:9px; background:#333; color:#fff; padding:2px 6px; border-radius:4px;">CLICK TO VIEW</span>
                    </div>
                    <!-- æ»šåŠ¨å­—å¹• -->
                    <div class="bb-reply-ticker" id="bb-reply-ticker">
                        <!-- JS å¡«å…… -->
                    </div>
                </div>

                <!-- å‘å¸ƒåŒºåŸŸ -->
                <div class="bb-compose-area">
                    <div class="bb-input-wrapper">
                        <textarea id="bb-idol-input" placeholder="To Fans: åˆ†äº«è¿™ä¸€åˆ»çš„å¿ƒæƒ…... "></textarea>
                    </div>
                    <div class="bb-tools-row">
                        <div class="bb-tool-icon"><i class="far fa-image"></i></div>
                        <div class="bb-tool-icon"><i class="fas fa-microphone"></i></div>
                        <div class="bb-char-count" id="bb-idol-char-count">0/1000</div>
                    </div>
                    <button class="bb-send-btn" onclick="idolSendBroadcast()">SEND TO ALL</button>
                </div>

                <!-- å†å²å‘é€è®°å½• -->
                <div class="bb-history-list">
                    <div class="bb-section-title">SENT HISTORY</div>
                    <div id="bb-sent-history"></div>
                </div>
            </div>

            <!-- [æ–°å¢] è¯„è®ºåˆ—è¡¨å…¨å±å¼¹çª— -->
            <div id="bb-comment-modal" class="bb-comment-modal">
                <div class="bb-comment-header">
                    <span>Replies (<span id="bb-total-replies">0</span>)</span>
                    <i class="fas fa-times" onclick="closeBubbleComments()" style="cursor:pointer; font-size:18px;"></i>
                </div>
                <div class="bb-comment-list" id="bb-comment-list-container">
                    <!-- JS åŠ¨æ€å¡«å…¥è¯„è®º -->
                </div>
            </div>
        </div>


                <!-- 3. === æ¨¡å¼ B: ç²‰ä¸èŠå¤©ç«¯ (æˆ‘æ˜¯ç²‰ä¸ï¼Œçœ‹çˆ±è±†å‘æ¶ˆæ¯) === -->
        <div id="bb-fan-view" class="bb-view" style="display:none; position:relative;">
            <!-- å¤´éƒ¨ -->
            <div class="bb-header fan-mode">
                <i class="fas fa-chevron-left" onclick="exitBubbleMode()"></i>
                <div class="bb-header-info">
                    <!-- è¿™é‡Œåå­—ä¼šåŠ¨æ€å˜ -->
                    <span class="bb-artist-name" id="bb-active-idol-name">Artist</span> 
                    <span class="bb-days-counter">with you 365 days</span>
                </div>
                <!-- æ¨¡æ‹Ÿè§¦å‘æŒ‰é’®ï¼šç‚¹å‡»è¿™é‡Œå¯ä»¥è®©çˆ±è±†å‘æ–°æ¶ˆæ¯ (æµ‹è¯•ç”¨) -->
                <i class="fas fa-bell" onclick="triggerIdolBroadcast()" title="[æµ‹è¯•] è®©çˆ±è±†å‘ä¸€æ¡æ¶ˆæ¯" style="color:#ff7e67;"></i>
            </div>

            <!-- é¡¶éƒ¨æ»šåŠ¨æ¡ (æ˜¾ç¤ºè·¯äººå›å¤) -->
            <div class="bb-fan-ticker-box" onclick="openMobReplies()">
                <div class="bb-ticker-icon"><i class="far fa-comment-dots"></i></div>
                <div class="bb-ticker-content">
                    <span id="bb-ticker-text" class="bb-ticker-text-anim">Waiting for new post...</span>
                </div>
                <i class="fas fa-chevron-right" style="font-size:10px; color:#ccc; margin-left:10px;"></i>
            </div>

            <!-- èŠå¤©ä¸»åŒºåŸŸ -->
            <div class="bb-chat-container" id="bb-chat-container">
                <!-- è¿™é‡Œçš„æ¶ˆæ¯ç”± JS ç”Ÿæˆ -->
            </div>

            <!-- åº•éƒ¨ï¼šæˆ‘çš„å›å¤æ¡† -->
            <div class="bb-input-area">
                <div class="bb-reply-limit">Reply to Artist (3/3)</div>
                <div class="bb-input-box">
                    <input type="text" id="bb-fan-input" placeholder="å›å¤çˆ±è±†..." maxlength="30">
                    <button onclick="fanSendReply()"><i class="fas fa-arrow-up"></i></button>
                </div>
            </div>

            <!-- è·¯äººè¯„è®ºåˆ—è¡¨å…¨å±å¼¹çª— -->
            <div id="bb-mob-modal" class="bb-mob-modal">
                <div class="bb-mob-header">
                    <span>Replies (<span id="bb-mob-count">0</span>)</span>
                    <i class="fas fa-times" onclick="closeMobReplies()" style="cursor:pointer;"></i>
                </div>
                <div class="bb-mob-list" id="bb-mob-list">
                    <!-- JS å¡«å…… -->
                </div>
            </div>
        </div>


    </div>

</div>


    <script src="js/core.js"></script>
    <script src="js/apps.js"></script>

<div id="add-friend-modal" class="modal-overlay">
    <div class="modal-box">
        <div class="modal-header">
            <span>æ·»åŠ å¥½å‹</span>
            <!-- ç‚¹å‡» X å…³é—­ -->
            <i class="fas fa-times" onclick="closeAddFriendModal()"></i>
        </div>
        <div class="modal-body">
            <div class="input-group">
                <label>çœŸå®å§“å <span style="color:red">*</span></label>
                <input type="text" id="af-realname" placeholder="å¿…å¡«ï¼Œå¦‚ï¼šæ—è§">
            </div>
            <div class="input-group">
                <label>å¤‡æ³¨ (æ˜µç§°)</label>
                <input type="text" id="af-remark" placeholder="èŠå¤©åˆ—è¡¨ä¸­æ˜¾ç¤ºçš„åå­—ï¼Œä¸å¡«åˆ™æ˜¾ç¤ºçœŸå">
            </div>
            <div class="input-group">
                <label>è§’è‰²äººè®¾ (æœ€é‡è¦çš„éƒ¨åˆ†)</label>
                <textarea id="af-persona" rows="3" placeholder="AIå°†æ‰®æ¼”è¿™ä¸ªè®¾å®šã€‚ä¾‹ï¼šé«˜å†·å­¦éœ¸ï¼Œè¯´è¯ç®€çŸ­ï¼Œä»ä¸å‘è¡¨æƒ…åŒ…ã€‚"></textarea>
            </div>
            <div class="input-group">
                <label>å…³è”ä¸–ç•Œä¹¦</label>
                <input type="text" id="af-worldbook" placeholder="èƒŒæ™¯è®¾å®šï¼Œå¯é€‰">
            </div>
            <div class="input-group">
                <label>å¼€åœºç™½</label>
                <textarea id="af-greeting" rows="2" placeholder="æ·»åŠ åï¼Œå¯¹æ–¹å‘çš„ç¬¬ä¸€å¥è¯"></textarea>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-cancel" onclick="closeAddFriendModal()">å–æ¶ˆ</button>
            <button class="btn-confirm" onclick="confirmAddFriend()">å®Œæˆ</button>
        </div>
    </div>
</div>
<!-- === [æ–°å¢] åˆ›å»ºç¾¤èŠå¼¹çª— === -->
<div id="create-group-modal" class="modal-overlay">
    <div class="modal-box">
        <div class="modal-header">
            <span>å‘èµ·ç¾¤èŠ</span>
            <i class="fas fa-times" onclick="closeCreateGroupModal()"></i>
        </div>
        <div class="modal-body">
            <div class="input-group">
                <label>ç¾¤èŠåç§°</label>
                <input type="text" id="cg-groupname" placeholder="ä¾‹å¦‚ï¼šå‘¨æœ«å¼€é»‘ç¾¤">
            </div>
            <div class="input-group">
                <label>é€‰æ‹©ç¾¤æˆå‘˜ (ä»å·²æ·»åŠ çš„å¥½å‹ä¸­é€‰)</label>
                <!-- è¿™é‡Œå°†ç”± JS åŠ¨æ€å¡«å……å¥½å‹åˆ—è¡¨ -->
                <div id="cg-friend-list" class="friend-checklist">
                    <div style="text-align:center; color:#999; font-size:12px; padding:20px;">
                        æš‚æ— å¥½å‹ï¼Œè¯·å…ˆå»æ·»åŠ å¥½å‹
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-cancel" onclick="closeCreateGroupModal()">å–æ¶ˆ</button>
            <button class="btn-confirm" onclick="confirmCreateGroup()">åˆ›å»º (0)</button>
        </div>
    </div>
</div>
<!-- === [ä¿®æ”¹ç‰ˆ] è§’è‰²å¿ƒå£°å¡ç‰‡ (V6 - ç°è‰²ç³» + å½“å‰åŠ¨ä½œ) === -->
<div id="mind-card-overlay" class="mind-overlay" onclick="toggleMindCard(event)">
    <div class="mind-card-box" onclick="event.stopPropagation()">
        
        <!-- 1. é¡¶éƒ¨ï¼šå¤´åƒã€åå­—ã€å¥½æ„Ÿåº¦ -->
        <div class="mind-header-v5">
            <div class="mind-avatar-area">
                <img src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=200&auto=format&fit=crop" class="mind-big-avatar">
            </div>
            <div class="mind-header-info">
                <div class="mind-name">Hannah AI</div>
                <!-- å¥½æ„Ÿåº¦ -->
                <div class="affection-bar-container">
                    <div class="affection-bar-label">
                        <span>å¥½æ„Ÿåº¦</span>
                        <span id="affection-percent-text">75%</span>
                    </div>
                    <div class="affection-progress-bar">
                        <div id="affection-fill"></div>
                    </div>
                </div>
            </div>
            <!-- é¢œæ–‡å­— (ç°åœ¨æ˜¯ç°è‰²åº•) -->
            <div class="mind-kaomoji" id="mind-kaomoji-display">(ï½¡â€¢-â€¢ï½¡)</div>
        </div>

                <!-- 2. ä¸­é—´ï¼šçŠ¶æ€ç½‘æ ¼ -->
        <div class="mind-status-tags">
            
            <!-- ç¬¬ä¸€æ’å·¦è¾¹ï¼šåœ°ç‚¹ -->
            <div class="status-tag">
                <i class="fas fa-map-marker-alt"></i>
                <span>Loc:</span>
                <b id="mind-location-val">å›¾ä¹¦é¦†</b>
            </div>

            <!-- ç¬¬ä¸€æ’å³è¾¹ï¼šå¤©æ°” -->
            <div class="status-tag">
                <i class="fas fa-cloud-sun"></i>
                <b id="mind-weather-val">æ™´</b>
            </div>

            <!-- ç¬¬äºŒæ’ï¼šåŠ¨ä½œ (åŠ äº† full-row æ ·å¼ï¼Œè®©å®ƒç‹¬å ä¸€è¡Œ) -->
            <div class="status-tag full-row">
                <i class="fas fa-user-clock"></i>
                <span>Action:</span>
                <b id="mind-action-val">æ­£åœ¨æ•´ç†ä¹¦æ¶</b>
            </div>

            <!-- ç¬¬ä¸‰æ’ï¼šBGM (æœ¬æ¥å°±æ˜¯ç‹¬å ä¸€è¡Œ) -->
            <div class="status-tag now-playing-tag">
                <i class="fas fa-music"></i>
                <div class="marquee-container">
                    <b id="now-playing-bgm">Lover - Taylor Swift</b>
                </div>
            </div>
        </div>

        
        <!-- 3. åº•éƒ¨ï¼šåŒé‡å¿ƒå£° (å°å¿ƒæ€å˜ç°äº†) -->
        <div class="mind-thoughts-container">
            <div class="thought-bubble murmur">
                <div class="bubble-label">ğŸ’­ ç¢ç¢å¿µ</div>
                <div class="bubble-content" id="mind-murmur-text">...</div>
            </div>
            <div class="thought-bubble hidden-thought">
                <div class="bubble-label">ğŸ”’ å°å¿ƒæ€ (Secret)</div>
                <div class="bubble-content" id="mind-hidden-text">...</div>
            </div>
        </div>

    </div>
</div>
<input type="file" id="global-img-changer" accept="image/*" style="display:none" onchange="handleImageFileChange(this)">
<!-- === [æ–°å¢] å‘å¸ƒæœ‹å‹åœˆå¼¹çª— === -->
<div id="post-moment-modal" class="modal-overlay">
    <div class="modal-box" style="width: 340px; max-height: 80vh; display:flex; flex-direction:column;">
        <div class="modal-header">
            <span>å‘å¸ƒæœ‹å‹åœˆ</span>
            <i class="fas fa-times" onclick="closePostMomentModal()"></i>
        </div>
        <div class="modal-body" style="flex:1; overflow-y:auto;">
            <!-- æ­£æ–‡è¾“å…¥ -->
            <div class="input-group">
                <textarea id="pm-text" rows="4" placeholder="è¿™ä¸€åˆ»çš„æƒ³æ³•..." style="border:none; background:transparent; font-size:14px; padding:0; resize:none; min-height:80px;"></textarea>
            </div>
            
            <!-- å›¾ç‰‡å¤„ç†åŒºåŸŸ -->
            <div class="input-group" style="border-top:1px solid #f0f0f0; padding-top:10px;">
                <label>é…å›¾ (Image)</label>
                <!-- é€‰é¡¹å¡ï¼šçœŸå®å›¾ç‰‡ vs AIæè¿° -->
                <div style="display:flex; gap:10px; margin-bottom:10px;">
                    <label style="font-size:12px; display:flex; align-items:center; gap:5px;">
                        <input type="radio" name="pm-img-type" value="real" checked onchange="togglePmImgInput('real')"> çœŸå®ç…§ç‰‡
                    </label>
                    <label style="font-size:12px; display:flex; align-items:center; gap:5px;">
                        <input type="radio" name="pm-img-type" value="desc" onchange="togglePmImgInput('desc')"> è™šæ‹Ÿ/AIæè¿°
                    </label>
                </div>

                <!-- çœŸå®å›¾ç‰‡ä¸Šä¼ æ¡† -->
                <div id="pm-img-real-box">
                    <div style="width:80px; height:80px; background:#f0f0f0; border-radius:8px; display:flex; justify-content:center; align-items:center; cursor:pointer;" onclick="document.getElementById('pm-file-input').click()">
                        <img id="pm-preview-img" style="width:100%; height:100%; object-fit:cover; border-radius:8px; display:none;">
                        <i id="pm-plus-icon" class="fas fa-plus" style="color:#ccc; font-size:20px;"></i>
                    </div>
                    <input type="file" id="pm-file-input" accept="image/*" style="display:none;" onchange="handlePmFilePreview(this)">
                </div>

                <!-- è™šæ‹Ÿæè¿°è¾“å…¥æ¡† -->
                <div id="pm-img-desc-box" style="display:none;">
                    <input type="text" id="pm-img-desc" placeholder="ä¾‹å¦‚ï¼šåœ¨æµ·è¾¹çœ‹æ—¥è½..." style="width:100%;">
                    <div style="font-size:10px; color:#999; margin-top:4px;">* è¾“å…¥æè¿°åï¼Œå°†æ˜¾ç¤ºä¸ºä¸€å¼ ç°è‰²çš„æ„å¢ƒå¡ç‰‡ã€‚</div>
                </div>
            </div>

            <!-- å¯è§èŒƒå›´é€‰æ‹© -->
            <div class="input-group" style="margin-top:15px;">
                <label>è°å¯ä»¥çœ‹ (Who can see)</label>
                <div style="border:1px solid #e0e0e0; border-radius:8px; max-height:150px; overflow-y:auto; padding:5px;" id="pm-visibility-list">
                    <!-- JS åŠ¨æ€å¡«å……å¥½å‹åˆ—è¡¨ -->
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-cancel" onclick="closePostMomentModal()">å–æ¶ˆ</button>
            <button class="btn-confirm" onclick="confirmPostMoment()">å‘è¡¨</button>
        </div>
    </div>
</div>


<!-- === [æ–°å¢] æ°”æ³¡å³é”®èœå• === -->
<div id="wc-bubble-menu" class="wc-bubble-menu">
    <div class="wc-menu-item" onclick="handleMenuAction('copy')">
        <i class="far fa-copy"></i> å¤åˆ¶
    </div>
    <div class="wc-menu-item" onclick="handleMenuAction('quote')">
        <i class="fas fa-quote-right"></i> å¼•ç”¨
    </div>
    <div class="wc-menu-item" onclick="handleMenuAction('forward')">
        <i class="fas fa-share"></i> å¤šé€‰è½¬å‘
    </div>
    <div class="wc-menu-item" onclick="handleMenuAction('delete')" style="color:#ff4d4f;">
        <i class="far fa-trash-alt"></i> åˆ é™¤
    </div>
    <div id="menu-btn-revoke" class="wc-menu-item" onclick="handleMenuAction('revoke')">
        <i class="fas fa-undo"></i> æ’¤å›
    </div>
    <div id="menu-btn-regen" class="wc-menu-item" onclick="handleMenuAction('regen')">
    <i class="fas fa-rotate-left"></i> é‡å›
</div>

</div>

<!-- === [ä¿®æ”¹] å¤šé€‰æ“ä½œåº•éƒ¨æ  (å¢åŠ åˆ é™¤æŒ‰é’®) === -->
<div id="wc-multi-select-bar" class="wc-multi-select-bar">
    <!-- è½¬å‘æŒ‰é’® -->
    <div onclick="executeMultiForward()">
        <i class="fas fa-share-square"></i>
        <span>è½¬å‘</span>
    </div>
    <!-- åˆ é™¤æŒ‰é’® -->
    <div onclick="executeMultiDelete()" style="color: #ff4d4f;">
        <i class="far fa-trash-alt" style="background:#ffecec; color:#ff4d4f;"></i>
        <span>åˆ é™¤</span>
    </div>
    <!-- å–æ¶ˆæŒ‰é’® -->
    <div onclick="exitMultiSelectMode()">
        <i class="fas fa-times"></i>
        <span>å–æ¶ˆ</span>
    </div>
</div>


<!-- === [æ–°å¢] è½¬å‘å¥½å‹é€‰æ‹©å¼¹çª— === -->
<div id="forward-target-modal" class="modal-overlay">
    <div class="modal-box">
        <div class="modal-header">
            <span>é€‰æ‹©è½¬å‘å¯¹è±¡</span>
            <i class="fas fa-times" onclick="closeForwardModal()"></i>
        </div>
        <div class="modal-body">
            <div id="forward-friend-list" class="friend-checklist">
                <!-- JS å¡«å…… -->
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-cancel" onclick="closeForwardModal()">å–æ¶ˆ</button>
            <button class="btn-confirm" onclick="confirmForward()">å‘é€</button>
        </div>
    </div>
</div>
<!-- === [æ–°å¢] èŠå¤©è®°å½•è¯¦æƒ…å…¨å±å¼¹çª— === -->
<div id="history-detail-modal" class="k-full-modal" style="background: #f7f7f7; z-index: 2500;">
    <div class="k-modal-header" style="background: #fff;">
        <i class="fas fa-chevron-left" onclick="closeHistoryDetail()" style="cursor:pointer; font-size:18px;"></i>
        <span id="history-detail-title" style="font-size: 15px; font-weight: 600;">èŠå¤©è®°å½•</span>
        <div style="width:20px;"></div> <!-- å ä½ -->
    </div>
    <div id="history-detail-content" class="wc-body-container" style="padding: 0;">
        <!-- JS ä¼šåœ¨è¿™é‡Œå¡«å……å…·ä½“æ¶ˆæ¯ -->
    </div>
</div>
<!-- å…¨å±€éŸ³é¢‘æ ‡ç­¾ -->
<audio id="global-audio-player"></audio>

<!-- éŸ³ä¹æ’­æ”¾å™¨ç•Œé¢ -->
<div class="app-fullscreen-view music-player-view" id="musicPlayerView">
    <div class="wc-header">
        <i class="fas fa-chevron-down" onclick="closeMusicPlayer()" style="cursor:pointer; padding:10px;"></i>
        <span>Music Player</span>
        <i class="fas fa-plus" onclick="triggerImportMusic()" style="cursor:pointer; padding:10px;"></i>
    </div>
    
    <div class="mp-cover-area">
        <img id="mp-cover-display" class="mp-cover-img" src="https://images.unsplash.com/photo-1459749411177-d4a428c37ae5?q=80&w=300&auto=format&fit=crop">
    </div>

    <div class="mp-controls">
        <div style="font-size:20px; font-weight:700;" id="mp-title-display">Select a Song</div>
        <div style="font-size:12px; color:#888; margin-top:5px;" id="mp-artist-display">...</div>
        
        <div class="mp-btn-row">
            <i class="fas fa-step-backward mp-btn" onclick="playPrevSong()"></i>
            <i class="fas fa-play-circle mp-btn-lg" id="mp-play-btn" onclick="toggleMusicPlay()"></i>
            <i class="fas fa-step-forward mp-btn" onclick="playNextSong()"></i>
        </div>
    </div>

    <div class="mp-playlist" id="mp-playlist-container">
        <!-- åˆ—è¡¨ç”± JS ç”Ÿæˆ -->
    </div>
    
    <!-- éšè—çš„æ–‡ä»¶è¾“å…¥æ¡† -->
    <input type="file" id="music-file-input" accept="audio/*" style="display:none;" onchange="handleMusicFile(this)">
</div>
<!-- === [æ–°å¢] çº¿ä¸‹æ¨¡å¼ (Offline / Tavern Mode) === -->
<div id="offlineModeView" class="offline-mode-view">
    <div id="offline-bg-layer"></div>

    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <div class="offline-header">
        <div class="oh-left" onclick="closeOfflineMode()">
            <i class="fas fa-times" style="font-size: 20px;"></i>
        </div>
        <div class="oh-center">
            <span id="offline-char-name">HANNAH</span>
            <div class="oh-status-dot"></div>
        </div>
        <div class="oh-right" style="display:flex; gap:15px;">
            <!-- è®¾ç½®æŒ‰é’® -->
            <i class="fas fa-sliders-h" onclick="toggleOfflineSettings()" style="font-size: 18px;"></i>
            <i class="fas fa-heart-pulse" onclick="toggleMindCard(event)" style="font-size: 18px;"></i>
        </div>
    </div>

    <!-- å†…å®¹åŒºåŸŸ -->
    <div id="offline-log-container" class="offline-content"></div>

    <!-- åº•éƒ¨è¾“å…¥åŒº -->
    <div class="offline-input-area">
        <div class="offline-tools">
            <span onclick="insertOfflineAction('*')">*åŠ¨ä½œ*</span>
            <span onclick="insertOfflineAction('ã€Œ')">ã€Œè¯´è¯ã€</span>
            <!-- åŸæœ‰çš„å¼¹å¹•å¼€å…³ -->
            <span id="offline-danmaku-btn" onclick="toggleDanmaku()">å¼¹å¹•å¼€å…³</span>
            <!-- [æ–°å¢] å‰§æƒ…é€‰é¡¹å¼€å…³ -->
            <span id="offline-options-btn" onclick="toggleOfflineOptions()">é€‰é¡¹åˆ†æ”¯: OFF</span>
        </div>
        <div class="offline-textarea-wrap">
            <textarea id="offline-input" placeholder="æè¿°ä½ çš„åŠ¨ä½œæˆ–è¯­è¨€... (Enter å‘é€)" onkeydown="if(event.key==='Enter' && !event.shiftKey){event.preventDefault(); sendOfflineMessage();}"></textarea>
            <button class="offline-send-btn" onclick="sendOfflineMessage()"><i class="fas fa-arrow-up"></i></button>
        </div>
    </div>

    <!-- [æ–°å¢] çº¿ä¸‹è®¾ç½®é¢æ¿ -->
   <div id="offline-settings-panel" class="offline-settings-modal">
    <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
        <span style="font-weight:700;">çº¿ä¸‹æ¨¡å¼è®¾ç½®</span>
        <i class="fas fa-chevron-down" onclick="toggleOfflineSettings()"></i>
    </div>
    
    <div class="offline-settings-scroll" style="max-height: 400px; overflow-y: auto; padding-right: 5px;">
        <div class="form-group">
            <label>é€‰æ‹©é¢„è®¾ (Preset)</label>
            <select id="offline-active-preset" onchange="saveOfflineConfig()">
                <!-- JS å¡«å…… -->
            </select>
        </div>

        <div class="form-group">
            <label>å›å¤æœ€å¤§å­—æ•° (Target Length): <span id="off-len-val">200</span></label>
            <input type="range" id="offline-max-len" min="50" max="5000" step="50" oninput="document.getElementById('off-len-val').innerText=this.value; saveOfflineConfig();">
            <div class="form-text">æ³¨æ„ï¼šè¿™åªæ˜¯ç»™ AI çš„å»ºè®®é•¿åº¦ï¼Œå¹¶éç»å¯¹æˆªæ–­ã€‚</div>
        </div>

        <hr class="settings-divider">

        <!-- æ–°å¢ï¼šèƒŒæ™¯å›¾è®¾ç½® -->
        <div class="form-group">
            <label>è‡ªå®šä¹‰èƒŒæ™¯å›¾ (Background)</label>
            <div style="display:flex; gap:10px;">
                <input type="text" id="offline-bg-input" placeholder="è¾“å…¥å›¾ç‰‡ URL" onchange="saveOfflineConfig()">
                <button class="btn-secondary" onclick="document.getElementById('global-img-changer').click(); window.tempImgTarget='offline';" style="width:40px;"><i class="fas fa-upload"></i></button>
            </div>
        </div>

        <!-- æ–°å¢ï¼šè‡ªå®šä¹‰ CSS -->
        <div class="form-group">
            <label>æ¨¡å¼ä¸“å± CSS (Custom CSS)</label>
            <textarea id="offline-custom-css" rows="4" placeholder="/* ä»…åœ¨æ­¤æ¨¡å¼ç”Ÿæ•ˆçš„ CSS */&#10;.offline-entry { font-size: 16px; }" onchange="saveOfflineConfig()"></textarea>
        </div>
    </div>
</div>

    <!-- [æ–°å¢] ä¿®æ”¹æ¶ˆæ¯é¡µé¢ -->
    <div id="offline-modify-page" class="modify-modal-view">
        <div class="modify-header">
            <span onclick="closeModifyPage()" style="color:#999; cursor:pointer;">å–æ¶ˆ</span>
            <span>ä¿®æ”¹å†…å®¹</span>
            <span onclick="confirmModifyOffline()" style="color:#2b2b2b; cursor:pointer;">å®Œæˆ</span>
        </div>
        <div class="modify-body">
            <textarea id="modify-text-input" class="modify-textarea"></textarea>
        </div>
    </div>
</div>

<!-- === [æ–°å¢] çº¿ä¸‹æ¨¡å¼ï¼šé‡å›ç¡®è®¤å¼¹çª— === -->
<div id="offline-regen-modal" class="modal-overlay">
    <div class="modal-box" style="width: 280px; text-align: center;">
        <div class="modal-body" style="padding: 30px 20px; background: #fff;">
            <i class="fas fa-undo-alt" style="font-size: 32px; color: #333; margin-bottom: 15px;"></i>
            <div style="font-size: 16px; font-weight: 700; margin-bottom: 8px;">é‡æ–°ç”Ÿæˆï¼Ÿ</div>
            <div style="font-size: 13px; color: #888; line-height: 1.5;">
                è¿™å°†åˆ é™¤æ­¤æ¡åŠä¹‹åçš„æ‰€æœ‰å†…å®¹ï¼Œ<br>å¹¶è®© AI é‡æ–°å°è¯•å†™å…¥ã€‚
            </div>
        </div>
        <div class="modal-footer" style="border-top: 1px solid #f0f0f0;">
            <button class="btn-cancel" onclick="closeRegenModal()">å–æ¶ˆ</button>
            <button class="btn-confirm" onclick="confirmRegenAction()" style="background:#2b2b2b;">ç¡®å®šé‡å›</button>
        </div>
    </div>
</div>
<!-- === [æ–°å¢] å‘é€è¯­éŸ³æ¨¡å¼é€‰æ‹©å¼¹çª— === -->
<div id="voice-action-modal" class="modal-overlay">
    <style>
        #voice-action-modal .tab-btn { color: #888; font-weight: 500; transition: 0.2s; cursor: pointer; }
        #voice-action-modal .tab-btn.active { background: #fff; color: #333; font-weight: 700; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
    </style>
    <div class="modal-box" style="width: 320px; border-radius: 24px; padding: 20px; background: #fff; text-align: center;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 20px;">
            <span style="font-weight: 700; font-size: 16px;">å‘é€è¯­éŸ³</span>
            <i class="fas fa-times" onclick="closeVoiceActionModal()" style="cursor:pointer; color:#999; font-size:18px; padding:5px;"></i>
        </div>
        
        <div style="display:flex; gap: 10px; margin-bottom: 20px; background: #f5f5f5; padding: 4px; border-radius: 12px;">
            <div class="tab-btn active" id="tab-btn-fake-voice" onclick="switchVoiceTab('fake')" style="flex:1; text-align:center; padding: 8px 0; border-radius: 8px;">ä¼ªè¯­éŸ³</div>
            <div class="tab-btn" id="tab-btn-real-voice" onclick="switchVoiceTab('real')" style="flex:1; text-align:center; padding: 8px 0; border-radius: 8px;">é•¿æŒ‰å½•éŸ³</div>
        </div>

        <!-- ä¼ªè¯­éŸ³é¢æ¿ -->
        <div id="voice-panel-fake" style="display:block;">
            <textarea id="fake-voice-input" rows="3" placeholder="è¾“å…¥ä½ æƒ³è®©å®ƒè½¬æˆæ–‡å­—çš„å†…å®¹ (å¦‚ä¸å¡«åˆ™å‘é€æ— æ–‡å­—çš„å‡è¯­éŸ³)..." style="width:100%; border:1px solid #eee; border-radius:12px; padding:12px; font-size:13px; resize:none; outline:none; background:#fafafa; margin-bottom:15px;"></textarea>
            <button class="btn-confirm" onclick="sendFakeVoice()" style="width:100%; border-radius:12px; height:44px; background:#2b2b2b; color:#fff;">å‘é€</button>
        </div>

        <!-- çœŸå®å½•éŸ³é¢æ¿ -->
        <div id="voice-panel-real" style="display:none; padding: 20px 0; flex-direction: column; align-items: center;">
            <button id="modalHoldToTalkBtn" style="width:110px; height:110px; border-radius:50%; border:none; background:#f5f5f5; color:#333; font-size:14px; font-weight:600; box-shadow:0 8px 25px rgba(0,0,0,0.06); transition:all 0.2s; display:flex; justify-content:center; align-items:center; flex-direction:column; gap:8px; cursor:pointer; user-select:none;">
                <i class="fas fa-microphone" style="font-size:28px; color: #555;"></i>
                <span>æŒ‰ä½è¯´è¯</span>
            </button>
            <div style="font-size:11px; color:#999; margin-top:20px;">æ¾å¼€å‘é€ï¼Œå°†è‡ªåŠ¨è¯†åˆ«è½¬ä¸ºæ–‡å­—</div>
        </div>
    </div>
</div>
<!-- ========================================= -->
<!-- [å…¨é¢å‡çº§ç‰ˆ] å‰§æƒ…æ€»ç»“ä¸å…³ç³» å…¨å±é¡µé¢ -->
<!-- ========================================= -->
<div id="summaryPageView" class="chat-settings-page-view">
    <div class="chat-settings-page-header">
        <i class="fas fa-chevron-left" onclick="closeSummaryPage()"></i>
        <span>å‰§æƒ…æ€»ç»“ä¸å…³ç³»</span>
        <!-- é¡¶éƒ¨ç›´æ¥æ”¾ä¸€ä¸ªä¸€é”®æ¸…ç©ºæŒ‰é’®ï¼Œç”¨çº¢è‰²è­¦ç¤º -->
        <i class="fas fa-trash-alt" onclick="clearAllSummaries()" style="color:#ff4d4f; font-size: 16px;" title="ä¸€é”®æ¸…ç©ºè®°å¿†"></i>
    </div>
    
    <div class="chat-settings-page-content">
        
        <!-- 1. æ–°å¢ï¼šå½“å‰å¯¹è¯çŠ¶æ€ä¸æ‰‹åŠ¨æ€»ç»“æ§åˆ¶å° -->
        <div class="summary-settings-section" style="background: #fff; padding: 15px; border-radius: 16px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.03);">
            <div class="settings-section-title" style="margin-top:0; border-left-color: #07c160;">è¿›åº¦ç›‘æ§é¢æ¿</div>
            <div style="font-size:13px; color:#555; margin-bottom:15px; background: #f9f9f9; padding: 10px 15px; border-radius: 8px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                    <span>å½“å‰æ€»å¯¹è¯è½®æ•°ï¼š</span>
                    <span style="font-weight:800; color:#111;" id="current-total-turns">0</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>æœ€æ–°å·²æ€»ç»“è‡³ï¼š</span>
                    <span style="font-weight:800; color:#07c160;">ç¬¬ <span id="last-summarized-turn">0</span> è½®</span>
                </div>
            </div>

            <div class="settings-section-title" style="border-left-color: #ff7e67;">æ‰‹åŠ¨ç²¾å‡†æ€»ç»“</div>
            <div style="display:flex; align-items:center; gap:8px; margin-bottom:15px;">
                <span style="font-size:12px; color:#666;">ä»ç¬¬</span>
                <input type="number" id="manual-sum-start" placeholder="1" style="width:70px; height:36px; border-radius:8px; border:1px solid #ddd; text-align:center; font-family:inherit;">
                <span style="font-size:12px; color:#666;">è‡³</span>
                <input type="number" id="manual-sum-end" placeholder="20" style="width:70px; height:36px; border-radius:8px; border:1px solid #ddd; text-align:center; font-family:inherit;">
                <span style="font-size:12px; color:#666;">è½®</span>
            </div>
            
            <div style="display:flex; flex-direction: column; gap:10px;">
                <button id="btn-manual-range" class="btn-secondary" onclick="generateManualSummary()" style="height: 40px; background:#f0f0f0; border:none; color:#333; font-weight:600;">
                    <i class="fas fa-crosshairs"></i> æå–æŒ‡å®šåŒºé—´
                </button>
                <button id="btn-manual-latest" class="btn-confirm" onclick="generateSummarySinceLast()" style="height: 40px; border-radius: 10px;">
                    <i class="fas fa-bolt"></i> ä¸€é”®æ€»ç»“æœ€æ–°æœªæ€»ç»“éƒ¨åˆ†
                </button>
            </div>
        </div>

        <!-- 2. è‡ªåŠ¨æ€»ç»“è®¾ç½®åŒº -->
        <div class="summary-settings-section">
            <div class="settings-section-title">è‡ªåŠ¨è§¦å‘è®¾ç½®</div>
            <div class="input-group">
                <label>æ¯ N è½®å¯¹è¯è‡ªåŠ¨æ€»ç»“ (è®¾ä¸º0å…³é—­)</label>
                <input type="number" id="summary-turn-count" value="20" onchange="saveSummaryConfig()">
            </div>
            <div class="input-group">
                <label>è‡ªåŠ¨æ€»ç»“å­—æ•° (çº¦)</label>
                <input type="number" id="summary-word-count" value="200" onchange="saveSummaryConfig()">
            </div>
            <div class="input-group">
                <label>AI æ€»ç»“æç¤ºè¯ (Prompt)</label>
                <textarea id="summary-prompt" rows="2" onchange="saveSummaryConfig()" placeholder="ä¾‹å¦‚ï¼šè¯·ä»¥æˆ‘çš„å£å»ï¼Œç”¨äº²æ˜µçš„è¯­æ°”æ€»ç»“æˆ‘ä»¬æœ€è¿‘çš„è¿›å±•ã€‚"></textarea>
            </div>
        </div>

        <hr class="settings-divider" style="margin: 20px 0;">

        <!-- 3. å·²æœ‰æ€»ç»“åˆ—è¡¨ (æ”¾å¤§ç‰ˆ) -->
        <div>
            <div class="settings-section-title" style="display: flex; justify-content: space-between; align-items: center;">
                <span>å·²ç”Ÿæˆçš„è®°å¿†å­˜æ¡£</span>
                <button class="btn-secondary" onclick="addNewSummaryItem()" style="height: 28px; width:auto; padding: 0 12px; font-size: 11px; background:#fff; border:1px solid #ddd;">+ æ‰‹åŠ¨ç¼–å†™</button>
            </div>
            <div id="summary-list-container" class="summary-list-container">
                <!-- JS åŠ¨æ€å¡«å…… -->
                <div class="summary-empty-state">å¤§è„‘ç©ºç©ºï¼Œæš‚æ— è®°å¿†</div>
            </div>
            <button id="grand-summary-btn" class="btn-secondary" onclick="generateGrandSummary()" style="width: 100%; margin-top: 15px; height: 44px; border:1px solid #111; color:#111;">
                <i class="fas fa-brain"></i> å¯¹ä»¥ä¸Šæ‰€æœ‰è®°å¿†è¿›è¡Œã€å¤§èåˆã€‘
            </button>
        </div>

        <hr class="settings-divider" style="margin: 25px 0;">

        <!-- 4. å…³ç³»è¿›åº¦æ¡ -->
        <div>
            <div class="settings-section-title" style="display: flex; justify-content: space-between; align-items: center;">
                <span>å¥½æ„Ÿåº¦ä¸å…³ç³»äº‹ä»¶</span>
                <button class="btn-secondary" onclick="addRelationshipLog()" style="height: 28px; width:auto; padding: 0 12px; font-size: 11px; background:#fff; border:1px solid #ddd;">+ æ·»åŠ èŠ‚ç‚¹</button>
            </div>
            <div id="relationship-log-container" class="summary-list-container" style="max-height: 250px;">
                <!-- JS åŠ¨æ€å¡«å…… -->
                <div class="summary-empty-state">æš‚æ— å…³ç³»è·ƒå‡äº‹ä»¶</div>
            </div>
        </div>
        <div style="height: 60px;"></div> <!-- åº•éƒ¨ç•™ç™½é˜²é®æŒ¡ -->
    </div>
</div>
<!-- ============================================== -->
<!-- [éŸ©ç³»ç®€çº¦ç‰ˆ] é’±åŒ… APP (å…¨ä¸­æ–‡) -->
<!-- ============================================== -->
<div class="app-fullscreen-view" id="payApp" style="background: #fafafa;">
    
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <div class="k-header" style="background: transparent; padding-top: 50px; border:none;">
        <i class="fas fa-chevron-left" onclick="closePayApp()" style="font-size: 20px; cursor:pointer; color:#333;"></i>
        <span style="font-weight: 700; font-size: 16px; color:#333; letter-spacing: 1px;">æˆ‘çš„é’±åŒ…</span>
        <span onclick="openPaySubPage('bill')" style="font-size: 12px; color:#666; cursor:pointer;">è´¦å•</span>
    </div>

    <!-- ä¸»å†…å®¹ -->
    <div class="k-body-container" style="padding: 10px 24px 30px; display: flex; flex-direction: column; gap: 20px;">
        
        <!-- é¡¶éƒ¨æç¤º -->
        <div style="display:flex; justify-content: space-between; align-items: center;">
            <span style="font-size: 12px; color: #999;">èµ„äº§æ€»è§ˆ</span>
            <div onclick="generateInitialWealthByAI()" id="btn-ai-wealth" style="font-size: 11px; color: #555; cursor:pointer; background: #eee; padding: 6px 12px; border-radius: 15px;">
                <i class="fas fa-magic"></i> AI æµ‹ç®—èº«ä»·
            </div>
        </div>

        <!-- 1. é›¶é’±å¡ç‰‡ (å¥¶ç™½é£æ ¼) -->
        <div class="pay-korean-card">
            <div class="pay-label-sm">å½“å‰é›¶é’±</div>
            <div class="pay-num-lg">Â¥ <span id="pay-total-balance">0.00</span></div>
            
            <div style="margin-top: 25px; display:flex; justify-content: space-between; align-items: center;">
                <span style="font-size:10px; color:#ccc;">ç”¨äºæ—¥å¸¸æ”¯ä»˜</span>
                <!-- è¿™ä¸ªæŒ‰é’®è§¦å‘å¢åŠ ä½™é¢/å°æ¸¸æˆ -->
                <button class="pay-pill-btn" onclick="addBalancePrompt()">+ å……å€¼</button>
            </div>
        </div>

        <!-- 2. é“¶è¡Œå¡ (é«˜çº§é“¶ç°é£æ ¼) -->
        <div class="pay-silver-card">
            <div style="display:flex; justify-content:space-between;">
                <div class="pay-label-sm" style="color:#777;">é“¶è¡Œå‚¨è“„å¡</div>
                <i class="fab fa-cc-visa" style="font-size: 20px; opacity: 0.3;"></i>
            </div>
            <div class="pay-num-lg" style="font-size: 28px; color:#444;">Â¥ <span id="pay-bank-balance">0.00</span></div>
            
            <div style="margin-top: 20px; display:flex; gap:10px; justify-content:flex-end;">
                <button class="pay-pill-btn outline" onclick="payActionPrompt('withdraw')">æç°</button>
                <button class="pay-pill-btn outline" onclick="payActionPrompt('recharge')">è½¬å…¥é›¶é’±</button>
            </div>
        </div>

        <div style="font-size: 12px; color: #999; margin-top: 10px;">æ›´å¤šæœåŠ¡</div>

        <!-- 3. åŠŸèƒ½åˆ—è¡¨ (ç®€çº¦åˆ—è¡¨) -->
        <div class="pay-simple-list">
            <!-- ä½™é¢å® -->
            <div class="pay-simple-item" onclick="openPaySubPage('yuebao')">
                <div class="pay-item-left">
                    <div class="pay-icon-box"><i class="fas fa-piggy-bank"></i></div>
                    <div>
                        <div class="pay-item-title">å°é‡‘åº“ (ç†è´¢)</div>
                        <div class="pay-item-desc">æ˜¨æ—¥æ”¶ç›Š <span style="color:#d4a373;">+<span id="pay-yuebao-yesterday">0.00</span></span></div>
                    </div>
                </div>
                <i class="fas fa-chevron-right" style="font-size:12px; color:#ddd;"></i>
            </div>

            <!-- èŒä¸š -->
            <div class="pay-simple-item" onclick="openPaySubPage('career')">
                <div class="pay-item-left">
                    <div class="pay-icon-box"><i class="fas fa-user-tag"></i></div>
                    <div>
                        <div class="pay-item-title">æˆ‘çš„èº«ä»½</div>
                        <div class="pay-item-desc">è®¾å®šå·¥èµ„/ç”Ÿæ´»è´¹å‘æ”¾</div>
                    </div>
                </div>
                <i class="fas fa-chevron-right" style="font-size:12px; color:#ddd;"></i>
            </div>

            <!-- äº²å¯†ä»˜ -->
            <div class="pay-simple-item" onclick="openPaySubPage('intimate')">
                <div class="pay-item-left">
                    <div class="pay-icon-box"><i class="fas fa-heart"></i></div>
                    <div>
                        <div class="pay-item-title">äº²å¯†ä»˜</div>
                        <div class="pay-item-desc">ç»™ AI å¼€é€šé¢åº¦</div>
                    </div>
                </div>
                <i class="fas fa-chevron-right" style="font-size:12px; color:#ddd;"></i>
            </div>

            <!-- æ‰“å·¥ -->
            <div class="pay-simple-item" onclick="openPaySubPage('parttime')">
                <div class="pay-item-left">
                    <div class="pay-icon-box"><i class="fas fa-coffee"></i></div>
                    <div>
                        <div class="pay-item-title">å…¼èŒæ‰“å·¥</div>
                        <div class="pay-item-desc">èµšå–é›¶èŠ±é’±</div>
                    </div>
                </div>
                <i class="fas fa-chevron-right" style="font-size:12px; color:#ddd;"></i>
            </div>
        </div>
    </div>

    <!-- === å­é¡µé¢ï¼šè´¦å• (å…¨ä¸­æ–‡) === -->
    <div id="pay-page-bill" class="pay-sub-page">
        <div class="k-header" style="background:#fff; border-bottom:1px solid #f0f0f0;">
            <i class="fas fa-chevron-left" onclick="closePaySubPage('bill')" style="cursor:pointer; color:#333;"></i>
            <span style="font-weight:700; color:#333;">è´¦å•æ˜ç»†</span>
            <div style="width:20px;"></div>
        </div>
        <div class="k-body-container" id="pay-bill-list" style="background:#fafafa; padding:20px;"></div>
    </div>

    <!-- === å­é¡µé¢ï¼šå°é‡‘åº“/ä½™é¢å® === -->
    <div id="pay-page-yuebao" class="pay-sub-page" style="background:#fafafa;">
        <div class="k-header" style="background:transparent;">
            <i class="fas fa-chevron-left" onclick="closePaySubPage('yuebao')" style="cursor:pointer; color:#333;"></i>
            <span style="font-weight:700; color:#333;">å°é‡‘åº“</span><div style="width:20px;"></div>
        </div>
        <div class="k-body-container" style="padding:20px;">
            <div class="pay-korean-card" style="text-align:center; padding:40px 20px;">
                <div style="font-size:12px; color:#999;">æ€»èµ„äº§ (å…ƒ)</div>
                <div style="font-size:40px; font-weight:300; color:#333; margin:10px 0;" id="yb-detail-balance">0.00</div>
                <div style="font-size:12px; color:#d4a373;">ç´¯è®¡æ”¶ç›Š +<span id="yb-total-profit">0.00</span></div>
                
                <div style="display:flex; justify-content:center; gap:15px; margin-top:30px;">
                    <button class="pay-pill-btn" style="width:100px;" onclick="handleYuebao('in')">è½¬å…¥</button>
                    <button class="pay-pill-btn outline" style="width:100px;" onclick="handleYuebao('out')">è½¬å‡º</button>
                </div>
            </div>
            <div style="margin-top:30px; font-size:12px; color:#999; margin-bottom:10px;">æ”¶ç›Šè®°å½•</div>
            <div id="yb-profit-list" class="pay-simple-list"></div>
        </div>
    </div>

    <!-- === å­é¡µé¢ï¼šèº«ä»½è®¾ç½® === -->
    <div id="pay-page-career" class="pay-sub-page" style="background:#fafafa;">
        <div class="k-header" style="background:#fff;">
            <i class="fas fa-chevron-left" onclick="closePaySubPage('career')" style="cursor:pointer; color:#333;"></i>
            <span style="font-weight:700; color:#333;">èº«ä»½è®¾ç½®</span><div style="width:20px;"></div>
        </div>
        <div class="k-body-container" style="padding:20px;">
            <div class="pay-korean-card">
                <div class="form-group">
                    <label>å½“å‰èº«ä»½</label>
                    <select id="career-type-select" style="background:#f5f5f5; border:none;">
                        <option value="student">å­¦ç”Ÿ (é¢†ç”Ÿæ´»è´¹)</option>
                        <option value="rich">å¯ŒäºŒä»£ (é¢†é›¶èŠ±é’±)</option>
                        <option value="worker">æ‰“å·¥äºº (å‘å·¥èµ„)</option>
                        <option value="freelance">è‡ªç”±èŒä¸š (ç»“é¡¹ç›®æ¬¾)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>æ¯æœˆå‘é’±æ—¥æœŸ (1-28å·)</label>
                    <input type="number" id="career-day-input" placeholder="ä¾‹å¦‚ï¼š15" style="background:#f5f5f5; border:none;">
                </div>
                <div class="form-group">
                    <label>æ¯æœˆé‡‘é¢ (å…ƒ)</label>
                    <div style="display:flex; gap:10px;">
                        <input type="number" id="career-amount-input" style="background:#f5f5f5; border:none;">
                        <button class="pay-pill-btn outline" style="width:auto; white-space:nowrap;" onclick="generateCareerAmountByAI()" id="btn-gen-salary">AIæµ‹ç®—</button>
                    </div>
                </div>
                <button class="pay-pill-btn" style="width:100%; height:44px; margin-top:10px;" onclick="saveCareerConfig()">ä¿å­˜è®¾å®š</button>
            </div>
        </div>
    </div>

    <!-- === å­é¡µé¢ï¼šäº²å¯†ä»˜ === -->
    <div id="pay-page-intimate" class="pay-sub-page" style="background:#fafafa;">
        <div class="k-header" style="background:#fff;">
            <i class="fas fa-chevron-left" onclick="closePaySubPage('intimate')" style="cursor:pointer; color:#333;"></i>
            <span style="font-weight:700; color:#333;">äº²å¯†ä»˜</span>
            <i class="fas fa-plus" onclick="openBindIntimateModal()" style="cursor:pointer; color:#333;"></i>
        </div>
        <div class="k-body-container" style="padding:20px;">
            <div style="font-size:12px; color:#999; margin-bottom:15px; text-align:center;">å·²ç»‘å®šçš„ AI å¯ä»¥ä½¿ç”¨ä½ çš„ä½™é¢</div>
            <div id="intimate-list-container" style="display:flex; flex-direction:column; gap:10px;"></div>
        </div>
    </div>

    <!-- === å­é¡µé¢ï¼šå…¼èŒ === -->
    <div id="pay-page-parttime" class="pay-sub-page" style="background:#fff;">
        <div class="k-header" style="background:transparent;">
            <i class="fas fa-chevron-left" onclick="closePaySubPage('parttime')" style="cursor:pointer; color:#333;"></i>
            <span style="font-weight:700; color:#333;">å…¼èŒæ‰“å·¥</span><div style="width:20px;"></div>
        </div>
        <div class="k-body-container" style="padding:20px; display:flex; flex-direction:column; align-items:center; justify-content:center; height:80%;">
            <div style="width:100px; height:100px; background:#f5f5f5; border-radius:50%; display:flex; justify-content:center; align-items:center; font-size:40px; margin-bottom:20px;">â˜•ï¸</div>
            <div style="font-size:16px; font-weight:700; color:#333;">å’–å•¡åº—æ‰“æ‚</div>
            <div style="font-size:12px; color:#999; margin-top:5px; margin-bottom:40px;">ç‚¹å‡»æŒ‰é’®å¹²æ´»ï¼Œèµšå–å¾®è–„æ”¶å…¥</div>
            
            <button id="btn-work-hard" style="width:120px; height:120px; border-radius:50%; background:#333; color:#fff; border:none; font-size:16px; font-weight:700; box-shadow:0 10px 30px rgba(0,0,0,0.1); cursor:pointer;" onpointerdown="this.style.transform='scale(0.95)'" onpointerup="this.style.transform='scale(1)'; doPartTimeWork();">å¹²æ´»ï¼</button>
            <div id="work-feedback" style="margin-top:20px; font-size:16px; font-weight:700; color:#d4a373; opacity:0; transition:0.3s;">+ Â¥15.00</div>
        </div>
    </div>
</div>
<!-- Pay æ¨¡å—ç»“æŸ -->


<!-- ============================================== -->
<!-- [å…¨æ–°é‡åˆ¶ç‰ˆ] æŠ¢é‡‘å¸å°æ¸¸æˆå…¨å±é®ç½© (éŸ©ç³»å¥¶æ²¹ç£¨ç ‚é£) -->
<!-- ============================================== -->
<div id="coin-game-view" class="app-fullscreen-view" style="background: rgba(248, 249, 250, 0.85); z-index:4000; backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);">
    <div style="padding: 80px 24px 20px; text-align:center; display: flex; flex-direction: column; align-items: center;">
        <div style="font-family: 'Montserrat', sans-serif; font-size:26px; font-weight:900; color: #2b2b2b; letter-spacing: 1px;">COIN RUSH.</div>
        <div id="cg-target" style="font-size:12px; margin-top:12px; color:#b45309; background: rgba(245, 158, 11, 0.1); padding: 6px 16px; border-radius: 20px; font-weight: 600;">ç›®æ ‡ï¼šæ”¶é›† 10 ä¸ªé‡‘å¸</div>
        
        <div style="display: flex; justify-content: space-around; width: 100%; margin-top: 35px; background: #fff; border-radius: 24px; padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.03); border: 1px solid rgba(0,0,0,0.02);">
            <div style="display: flex; flex-direction: column;">
                <span style="font-size:10px; color:#999; font-weight: 600; letter-spacing: 1px;">TIME LEFT</span>
                <span id="cg-countdown" style="font-size:38px; font-weight:300; color:#2b2b2b; font-family:'Montserrat', sans-serif;">10.0</span>
            </div>
            <div style="width: 1px; background: #f0f0f0;"></div>
            <div style="display: flex; flex-direction: column;">
                <span style="font-size:10px; color:#999; font-weight: 600; letter-spacing: 1px;">COLLECTED</span>
                <span id="cg-score" style="font-size:38px; font-weight:700; color:#07c160; font-family:'Montserrat', sans-serif;">0</span>
            </div>
        </div>
    </div>
    
    <!-- é‡‘å¸ç”Ÿæˆèˆå° -->
    <div id="cg-play-area" style="flex:1; position:relative; overflow:hidden;"></div>
</div>

<!-- ============================================== -->
<!-- [æ–°å¢] é’±åŒ…ä¸“å±ï¼šéŸ©ç³»é«˜çº§å®šåˆ¶å¼¹çª— (æ›¿ä»£ç³»ç»Ÿ Alert/Prompt) -->
<!-- ============================================== -->
<div id="k-dialog-overlay" class="modal-overlay" style="z-index: 5000;">
    <div class="modal-box" style="width: 300px; padding: 0; border-radius: 24px; text-align: center; background: rgba(255,255,255,0.95); backdrop-filter: blur(20px);">
        <div style="padding: 30px 20px 20px;">
            <div id="k-dialog-title" style="font-size: 16px; font-weight: 700; color: #2b2b2b; margin-bottom: 10px;">æç¤º</div>
            <div id="k-dialog-desc" style="font-size: 13px; color: #666; line-height: 1.6; margin-bottom: 20px;">å†…å®¹</div>
            <!-- ä»…åœ¨ Prompt æ¨¡å¼ä¸‹æ˜¾ç¤ºçš„è¾“å…¥æ¡† -->
            <input type="number" id="k-dialog-input" style="display:none; width: 100%; border: 1px solid #eee; background: #f9f9f9; padding: 12px 15px; border-radius: 12px; font-size: 16px; text-align: center; outline: none; transition: 0.3s;">
        </div>
        <div style="display: flex; border-top: 1px solid #f0f0f0;">
            <div id="k-dialog-cancel" style="flex: 1; padding: 15px 0; font-size: 14px; color: #999; cursor: pointer; border-right: 1px solid #f0f0f0;">å–æ¶ˆ</div>
            <div id="k-dialog-confirm" style="flex: 1; padding: 15px 0; font-size: 14px; font-weight: 700; color: #2b2b2b; cursor: pointer;">ç¡®å®š</div>
        </div>
    </div>
</div>

<!-- === [æ›´æ–°ç‰ˆ] èº«ä»½ç®¡ç†å¼¹çª— === -->
<div id="identity-modal" class="modal-overlay">
  <div class="modal-box" style="width:340px;">
    <div class="modal-header">
      <span>èº«ä»½åˆ‡æ¢</span>
      <i class="fas fa-times" onclick="closeIdentityModal()"></i>
    </div>
    
    <div class="modal-body" style="padding:20px; max-height:450px; overflow-y:auto;">
      
      <!-- 1. é¡¶éƒ¨å¤´åƒé¢„è§ˆ (è‡ªåŠ¨å˜) -->
      <div class="id-avatar-preview-box">
          <img id="id-preview-img" src="https://api.dicebear.com/7.x/avataaars/svg?seed=new">
      </div>

      <div class="form-group">
        <label>é€‰æ‹©èº«ä»½</label>
        <select id="identity-select" onchange="onIdentitySelectChange(this.value)" style="width:100%; height:40px; border:1px solid #ddd; border-radius:8px; padding:0 10px;"></select>
      </div>

      <hr class="settings-divider" style="margin:15px 0;">

      <div class="form-group">
        <label>å§“å</label>
        <input id="id-name" type="text" placeholder="ä¾‹å¦‚ï¼šHannah">
      </div>

      <!-- æ€§åˆ«ï¼šé€‰è‡ªå®šä¹‰æ—¶æ˜¾ç¤ºè¾“å…¥æ¡† -->
      <div class="form-group">
        <label>æ€§åˆ«</label>
        <div style="display:flex; gap:10px;">
            <select id="id-gender-select" onchange="toggleIdGenderInput(this.value)" style="flex:1; height:40px; border:1px solid #ddd; border-radius:8px; padding:0 10px;">
              <option value="å¥³">å¥³</option>
              <option value="ç”·">ç”·</option>
              <option value="custom">è‡ªå®šä¹‰</option>
            </select>
            <!-- è‡ªå®šä¹‰æ€§åˆ«è¾“å…¥æ¡† (é»˜è®¤éšè—) -->
            <input id="id-gender-input" type="text" placeholder="è¾“å…¥æ€§åˆ«" style="flex:1; display:none;">
        </div>
      </div>

      <div class="form-group">
        <label>å¤´åƒè®¾ç½®</label>
        <div style="display:flex; gap:10px;">
            <input id="id-avatar-url" type="text" placeholder="å›¾ç‰‡ URL..." oninput="updateIdPreview(this.value)">
            <button class="btn-secondary" onclick="document.getElementById('id-avatar-file').click()" style="width:50px; padding:0;"><i class="fas fa-upload"></i></button>
            <input id="id-avatar-file" type="file" accept="image/*" style="display:none" onchange="handleIdAvatarFile(this)">
        </div>
      </div>

      <div class="form-group">
        <label>æœ‹å‹åœˆèƒŒæ™¯å›¾ (Moments Cover)</label>
        <input id="id-moments-bg" type="text" placeholder="ç•™ç©ºåˆ™ä½¿ç”¨é»˜è®¤èƒŒæ™¯">
      </div>

      <div class="form-group">
        <label>æˆ‘çš„äººè®¾</label>
        <textarea id="id-persona" rows="2" placeholder="è¿™ä¸ªèº«ä»½çš„è®¾å®š..."></textarea>
      </div>

    </div>
    <div class="modal-footer" style="padding:15px 20px;">
      <button class="btn-cancel" onclick="createNewIdentity()" style="font-size:12px;">æ–°å»º</button>
      <button class="btn-cancel" onclick="deleteCurrentIdentity()" style="font-size:12px; color:red;">åˆ é™¤</button>
      <button class="btn-confirm" onclick="saveAndSwitchIdentity()">ä¿å­˜å¹¶åˆ‡æ¢</button>
    </div>
  </div>
</div>



</body>
</html>
