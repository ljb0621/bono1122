<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>my Beeper</title>
    <!-- Â§ñÈÉ®Â≠ó‰ΩìÂíåÂõæÊ†á -->
    <link href="https://fonts.googleapis.com/css2?family=Alex+Brush&family=Montserrat:wght@200;300;400;500&family=Playfair+Display:ital,wght@0,400;0,500;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Êú¨Âú∞Ê†∑ÂºèË°® -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/animations.css">
    
    <!-- [Êñ∞Â¢û] ËøôÈáå‰∏ìÈó®Áî®Êù•Êîæ‰Ω†ËæìÂÖ•ÁöÑËá™ÂÆö‰πâCSS -->
    <style id="dynamic-custom-css"></style>
    
    <!-- PWA ÂõæÊ†áÂèäËãπÊûúËÆæÂ§áÊîØÊåÅ -->
    <link rel="icon" type="image/png" sizes="192x192" href="icon.png">
    <link rel="apple-touch-icon" sizes="192x192" href="icon.png">
</head>
<body>


    <div class="phone">
        <div class="ambient-bg"></div>
               <!-- === [Èü©Á≥ªÊ∞îÊ≥°ÂºπÂá∫Áâà] my beeper === -->
        <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
        <div id="boot-screen">
            <div class="boot-container">
                
                <!-- Á∫ØCSSÁªòÂà∂ÁöÑÈü©Á≥ªÁôΩËâ≤‰º†ÂëºÊú∫ -->
                <div class="white-pager">
                    
                    <!-- üåü Êñ∞Â¢ûÔºöË∂ÖÊòéÊòæÁöÑQÂºπÊ∞îÊ≥° -->
                    <div class="pager-bubble">
                        <i class="fas fa-comment-dots"></i> new message!
                    </div>

                    <div class="wp-antenna"></div>

                    <!-- Â±èÂπïÂå∫Âüü -->
                    <div class="wp-screen">
                        <!-- ‰∏§‰∏™Áä∂ÊÄÅÔºöÁ≠âÂæÖÊó∂ Âíå Êî∂Âà∞Ê∂àÊÅØÊó∂ -->
                        <span class="wp-text-wait">...</span>
                        <span class="wp-text-smile">( ‚Ä¢ ·¥ó ‚Ä¢ )</span>
                    </div>

                    <!-- Â∫ïÈÉ®Êâ¨Â£∞Âô®‰∏éÊåâÈîÆ -->
                    <div class="wp-bottom">
                        <div class="wp-speaker">
                            <span></span><span></span><span></span><span></span>
                        </div>
                        <div class="wp-buttons">
                            <div class="wp-btn"></div>
                            <div class="wp-btn"></div>
                            <div class="wp-btn wp-btn-pink"></div>
                        </div>
                    </div>
                </div>

                <!-- ÂêçÂ≠óÊéíÁâà (ÂÖ®Â∞èÂÜôÈü©Á≥ªÂúÜÊ∂¶‰Ωì) -->
                <div class="boot-text-group">
                    <div class="b-main-title">my beeper</div>
                    <div class="b-sub-title">designed by weiwei</div>
                </div>

            </div>
        </div>



        <div class="status-bar">
            <span id="sb-time-display" style="font-weight:600;"></span>
            <div style="display:flex; gap:6px; opacity:0.6;">
                <i class="fas fa-signal"></i>
                <i class="fas fa-battery-three-quarters"></i>
            </div>
        </div>
          <div class="screen-container" id="screen">
            
    <!-- === Á¨¨‰∏ÄÈ°µ (P1): ‰∏ªÈ°µ & Âü∫Á°ÄAPP === -->
    <div class="page" id="p1">
        <div class="unified-header-widget">
            <div class="greeting-text" id="greetingText"></div>
            <div class="clock-profile-combo">
                <div class="time-block">
                    <span id="h">14</span><span class="time-colon">:</span><span id="m">30</span>
                </div>
                <div class="vertical-divider"></div>
                <div class="profile-stack">
                    <div class="mini-profile-row">
                        <div class="editable-name" contenteditable="true">Hannah</div>
                        <div class="avatar-circle-sm" data-edit-key="avatar" onclick="triggerChangeImage(this, 'img')">
                            <img src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=200&auto=format&fit=crop">
                        </div>
                    </div>
                    <div class="date-pill" id="fullDate">Jan 30</div>
                </div>
            </div>
        </div>

        <div class="music-widget" id="home-music-widget" onclick="openMusicPlayer()">
    <div class="music-info">
        <div style="font-size:9px; color:#aaa; margin-bottom:5px; letter-spacing:1px;">NOW PLAYING</div>
        <!-- Â¢ûÂä†‰∫Ü contenteditable Âíå onblur Áî®‰∫é‰øùÂ≠òÊñáÂ≠ó -->
        <div class="music-title" id="home-music-title" contenteditable="true" onclick="event.stopPropagation()" onblur="saveHomeMusicText()">Lover</div>
        <div class="music-artist" id="home-music-artist" contenteditable="true" onclick="event.stopPropagation()" onblur="saveHomeMusicText()">Taylor Swift</div>
        <div class="wave-box"><div class="wave"></div><div class="wave"></div><div class="wave"></div><div class="wave"></div></div>
    </div>
    <div class="vinyl-record">
        <!-- ‰øùÁïô‰∫ÜÂéüÊù•ÁöÑÊç¢ÂõæÂäüËÉΩÔºåÂä†‰∫Ü stopPropagation Èò≤Ê≠¢ÁÇπÂáªÊç¢ÂõæÊó∂ÊâìÂºÄÊí≠ÊîæÂô® -->
        <div class="vinyl-inner" data-edit-key="music" onclick="event.stopPropagation(); triggerChangeImage(this, 'bg')"></div>
    </div>
</div>

        <div class="grid-apps">
            <div class="app-cell" data-app-id="wechat" onclick="openWeChatApp()"><div class="icon-box"><i class="fab fa-weixin" style="color:#07c160;"></i></div><span class="app-label">WeChat</span></div>
            <div class="app-cell" data-app-id="api" onclick="toggleSettings()"><div class="icon-box"><i class="fas fa-link"></i></div><span class="app-label">API</span></div>
            <div class="app-cell" data-app-id="theme" onclick="toggleSettings('theme')"><div class="icon-box"><i class="fas fa-magic"></i></div><span class="app-label">Theme</span></div>
            <div class="app-cell" data-app-id="lovespace"><div class="icon-box"><i class="fas fa-heart" style="color:#e91e63;"></i></div><span class="app-label">Love Space</span></div>
            <div class="app-cell" data-app-id="worldbook"><div class="icon-box"><i class="fas fa-globe-asia"></i></div><span class="app-label">WorldBook</span></div>
            <div class="app-cell" data-app-id="presets" onclick="openPresetsApp()"><div class="icon-box"><i class="fas fa-sliders-h"></i></div><span class="app-label">Presets</span></div>
            <div class="app-cell" data-app-id="game"><div class="icon-box"><i class="fas fa-gamepad"></i></div><span class="app-label">Game</span></div>
            <div class="app-cell" data-app-id="novel"><div class="icon-box"><i class="fas fa-book-open"></i></div><span class="app-label">Novel</span></div>
        </div>
    </div>

    <!-- === Á¨¨‰∫åÈ°µ (P2): Áõ∏ÂÜå & Áõ¥Êí≠ === -->
    <div class="page" id="p2">
        <div style="text-align:center; margin-bottom:10px;">
            <div class="app-label" style="font-family:'Alex Brush'; font-size:36px;" contenteditable="true">Our Memories</div>
            <div style="font-size:10px; color:#999; letter-spacing:2px; text-transform:uppercase;">Collect Moments</div>
        </div>

        <div class="photo-stack">
            <div class="stack-item"><img src="https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?q=80&w=200&auto=format&fit=crop" data-edit-key="photo1" onclick="triggerChangeImage(this, 'self')"></div>
            <div class="stack-item"><img src="https://images.unsplash.com/photo-1516975080664-ed2fc6a32937?q=80&w=200&auto=format&fit=crop" data-edit-key="photo2" onclick="triggerChangeImage(this, 'self')"></div>
            <div class="stack-item"><img src="https://images.unsplash.com/photo-1519681393784-d120267933ba?q=80&w=200&auto=format&fit=crop" data-edit-key="photo3" onclick="triggerChangeImage(this, 'self')"></div>
        </div>

        <div class="grid-apps">
            <div class="app-cell" data-app-id="pay" onclick="openPayApp()"><div class="icon-box"><i class="fas fa-qrcode"></i></div><span class="app-label">Pay</span></div>
            <div class="app-cell" data-app-id="map"><div class="icon-box"><i class="fas fa-map-marker-alt"></i></div><span class="app-label">Map</span></div>
            <div class="app-cell" data-app-id="live" onclick="openLiveApp()">
                <div class="icon-box" style="background: #111; border: 1px solid rgba(255,255,255,0.1);"><i class="fas fa-satellite-dish" style="color: #fff;"></i></div>
                <span class="app-label" style="font-weight:600; color:#333;">LIVE.</span>
            </div>
            <div class="app-cell" data-app-id="cam"><div class="icon-box"><i class="fas fa-camera"></i></div><span class="app-label">Cam</span></div>
        </div>
    </div>

    <!-- === Á¨¨‰∏âÈ°µ (P3): Èü©Á≥ªCDÊú∫ + ÂÆûÁî®APPÁΩëÊ†º === -->
    <div class="page" id="p3">
        <!-- CDÊú∫ÁªÑ‰ª∂ -->
        <div class="k-mood-board">
            <div class="k-cd-player">
                <div class="k-disc-wrap">
                    <div class="k-disc" data-edit-key="k_cd_cover" onclick="triggerChangeImage(this, 'bg')" style="background-image: url('https://images.unsplash.com/photo-1459749411177-d4a428c37ae5?q=80&w=200&auto=format&fit=crop');"><div class="k-disc-center"></div></div>
                </div>
                <div class="k-song-info">
                    <div class="k-play-btn"><i class="fas fa-play"></i></div>
                    <div style="flex:1;">
                        <div contenteditable="true" class="k-song-title" id="p3-song">Palette</div>
<div contenteditable="true" class="k-artist" id="p3-artist">IU (ÏïÑÏù¥Ïú†)</div>
                    </div>
                </div>
            </div>
            <div class="k-polaroid">
                <div class="k-tape"></div>
                <div class="k-photo-frame" data-edit-key="k_polaroid_img" onclick="triggerChangeImage(this, 'bg')" style="background-image: url('https://images.unsplash.com/photo-1516483638261-f4dbaf036963?q=80&w=300&auto=format&fit=crop');"></div>
                <div class="k-handwriting" contenteditable="true" id="p3-handwriting">Vibe ‚òÅÔ∏è</div>
            </div>
        </div>

        <!-- ËøôÈáåÁöÑAPPÂÖ®ÈÉΩÂú®ÔºÅGalgame, Pet, Fate... -->
        <div class="grid-apps">
            <div class="app-cell" data-app-id="galgame" onclick="alert('Galgame ÂäüËÉΩÂºÄÂèë‰∏≠...')"><div class="icon-box"><i class="fas fa-gamepad"></i></div><span class="app-label">Galgame</span></div>
            <div class="app-cell" data-app-id="pet" onclick="openPetApp()">
    <div class="icon-box"><i class="fas fa-paw"></i></div>
    <span class="app-label">Pet</span>
</div>
            <div class="app-cell" data-app-id="tracker" onclick="alert('ÊùÉÈôê‰∏çË∂≥')"><div class="icon-box"><i class="fas fa-user-secret"></i></div><span class="app-label">Tracker</span></div>
            <div class="app-cell" data-app-id="mihuashi" onclick="alert('ÁîªÂ∏àÂàóË°®...')"><div class="icon-box"><i class="fas fa-palette"></i></div><span class="app-label">Art</span></div>
            <div class="app-cell" data-app-id="divination" onclick="alert('‰ªäÊó•ËøêÂäøÔºöÂ§ßÂêâ')"><div class="icon-box"><i class="fas fa-star-half-alt"></i></div><span class="app-label">Fate</span></div>
            <div class="app-cell" data-app-id="myhome" onclick="alert('ËøõÂÖ•ÂÆ∂Âõ≠...')"><div class="icon-box"><i class="fas fa-home"></i></div><span class="app-label">Home</span></div>
            <div class="app-cell" data-app-id="calendar" onclick="alert('Êó•ÂéÜ')"><div class="icon-box"><i class="fas fa-calendar"></i></div><span class="app-label">Calendar</span></div>
            <div class="app-cell" data-app-id="bubble" onclick="openBubbleApp()"><div class="icon-box"><i class="far fa-comments"></i></div><span class="app-label">Bubble</span></div>
        </div>
    </div> 
                <!-- === Á¨¨ÂõõÈ°µ (P4): ÁîüÊ¥ªËÆ∞ÂΩï & ÁîµÂ≠êÂ∞èÁ•® (‰ºòÂåñÁâà) === -->
    <div class="page" id="p4">
        
        <!-- 1. Êî∂Ëóè‰ø°ÊÅØÊªöÂä®ÁªÑ‰ª∂ -->
        <div class="collection-ticker-widget">
            <div class="ticker-icon"><i class="fas fa-quote-left"></i></div>
            
            <!-- ÊªöÂä®ÊñáÂ≠óÂå∫ -->
            <div class="ticker-wrapper">
                <!-- Á¨¨‰∏ÄÁªÑÂÜÖÂÆπ -->
                <div class="ticker-content">
                    <span>ËÆ∞ÂæóÁªôÈò≥Âè∞ÁöÑËä±ÊµáÊ∞¥</span><span class="dot">‚Ä¢</span>
                    <span>‰∏ãÂë®‰∫îÂéªÁúãÂ±ï</span><span class="dot">‚Ä¢</span>
                    <span>ÂØÜÁ†Å 123456</span><span class="dot">‚Ä¢</span>
                    <span>Stay foolish</span><span class="dot">‚Ä¢</span>
                    <span>‰π∞Áå´Á≤Æ</span><span class="dot">‚Ä¢</span>
                </div>
                <!-- Á¨¨‰∫åÁªÑÂÜÖÂÆπ (Â§çÂà∂‰∏Ä‰ªΩÁî®‰∫éÊó†ÁºùËøûÊé•) -->
                <div class="ticker-content">
                    <span>ËÆ∞ÂæóÁªôÈò≥Âè∞ÁöÑËä±ÊµáÊ∞¥</span><span class="dot">‚Ä¢</span>
                    <span>‰∏ãÂë®‰∫îÂéªÁúãÂ±ï</span><span class="dot">‚Ä¢</span>
                    <span>ÂØÜÁ†Å 123456</span><span class="dot">‚Ä¢</span>
                    <span>Stay foolish</span><span class="dot">‚Ä¢</span>
                    <span>‰π∞Áå´Á≤Æ</span><span class="dot">‚Ä¢</span>
                </div>
            </div>

            <!-- Âè≥‰æßÂúÜÂΩ¢ÂõæÁâá (ÁÇπÂáªÂèØÊõ¥Êç¢) -->
            <div class="ticker-img-circle">
                <img src="https://images.unsplash.com/photo-1517841905240-472988babdf9?q=80&w=200&auto=format&fit=crop" 
                     data-edit-key="p4_ticker_img" 
                     onclick="triggerChangeImage(this, 'self')">
            </div>
        </div>

        <!-- 2. ÂèëÁ•®/Â∞èÁ•®ÈÄ†ÂûãÁªÑ‰ª∂ (ÂèòÁü≠Áâà) -->
        <div class="receipt-widget short-version">
            <!-- È°∂ÈÉ®ÊâìÂ≠î -->
            <div class="receipt-hole"></div>
            
            <div class="receipt-header">
                <div class="receipt-title">RECEIPT</div>
                <div class="receipt-date">NO.2026-02-22</div>
            </div>
            
            <div class="receipt-divider-dashed"></div>

            <!-- ÂàóË°®Âå∫Âüü -->
            <div class="receipt-list">
                <div class="receipt-item" onclick="openSimulatedApp('taobao')">
                    <div class="r-item-name">
                        <span class="r-qty">01</span>
                        <span>SHOPPING (Taobao)</span>
                    </div>
                    <div class="r-item-price">OPEN <i class="fas fa-chevron-right" style="font-size:8px;"></i></div>
                </div>
                
                <div class="receipt-item" onclick="openSimulatedApp('meituan')">
                    <div class="r-item-name">
                        <span class="r-qty">02</span>
                        <span>DELIVERY (Meituan)</span>
                    </div>
                    <div class="r-item-price">OPEN <i class="fas fa-chevron-right" style="font-size:8px;"></i></div>
                </div>
            </div>

            <div class="receipt-divider-line"></div>

            <div class="receipt-footer">
                <div class="receipt-total">
                    <span>TOTAL</span>
                    <span style="font-weight:700;">¬• 999.00</span>
                </div>
                <div class="receipt-barcode">
                    ||| || ||| | |||| || || | |||| |||
                </div>
            </div>
        </div>

        <!-- 3. APP ÁΩëÊ†º (Ê†∑Âºè‰∏éP3‰∏ÄËá¥Ôºå‰ΩçÁΩÆ‰∏ãÁßª) -->
        <div class="grid-apps p4-apps">
            <div class="app-cell" data-app-id="notes" onclick="alert('‰æøÁ≠æ')"><div class="icon-box"><i class="far fa-sticky-note"></i></div><span class="app-label">Notes</span></div>
            <div class="app-cell" data-app-id="files" onclick="alert('Êñá‰ª∂ÁÆ°ÁêÜ')"><div class="icon-box"><i class="far fa-folder"></i></div><span class="app-label">Files</span></div>
            <div class="app-cell" data-app-id="clock" onclick="alert('ÈóπÈíü')"><div class="icon-box"><i class="far fa-clock"></i></div><span class="app-label">Clock</span></div>
            <!-- Á©∫‰ΩçÂç†‰ΩçÁ¨¶ -->
            <div class="app-cell" style="opacity:0.3;"><div class="icon-box" style="border:1px dashed #ccc; box-shadow:none;"><i class="fas fa-plus"></i></div></div>
        </div>

    </div>


  

        <!-- Dock Bar -->
        <div class="dock-bar">
    <i class="fas fa-phone-alt" style="font-size:20px; color:#555;"></i>
    <div class="dock-icon-special" onclick="toggleChat()">
        <i class="fas fa-comment"></i>
        <div id="dock-dot" class="unread-dot"></div> <!-- ‚úÖ ÊîæÂÖ•ÂõæÊ†áÂÆπÂô®ÂÜÖÈÉ® -->
    </div>
    <i class="fas fa-comment-dots" style="font-size:20px; color:#555;"></i>
    <i class="fab fa-chrome" style="font-size:22px; color:#555;"></i>
</div>

<!-- === ÂæÆ‰ø°ÂÆåÊï¥Â∫îÁî® (ÂçáÁ∫ßÈü©Á≥ªËÉ∂ÂõäÁâà) === -->
<div class="app-fullscreen-view" id="wechatApp">
    
    <!-- È°∂ÈÉ®Ê†áÈ¢òÊ†è -->
   <!-- === ÊûÅÁÆÄÁâàÔºöÁõ¥Êé•ÁÇπÂáªÊ†áÈ¢òËøîÂõû === -->
    <div class="wc-header">
        <span id="wc-header-title" onclick="closeWeChatApp()" style="cursor: pointer; user-select: none;">
            Messages
        </span>

        <div class="wc-header-icons">
            <i class="fas fa-search"></i>
            
            <div style="position: relative;">
                <i class="fas fa-plus-circle" onclick="toggleWeChatMenu(event)" style="cursor: pointer;"></i>
                
                <!-- === ‰øÆÊîπÂºÄÂßãÔºöÊâæÂà∞Ëøô‰∏™ div Âπ∂ÊõøÊç¢ÈáåÈù¢ÁöÑ onclick ÂíåÊñáÂ≠ó === -->
<div id="wc-plus-menu" class="wc-plus-dropdown">
    <!-- Ê≥®ÊÑèÔºöËøôÈáåÊää onclick ÊîπÊàê‰∫Ü showAddFriendModal()ÔºåÊñáÂ≠óÊîπÊàê‰∫Ü Ê∑ªÂä†Â•ΩÂèã -->
    <div class="wc-menu-option" onclick="showAddFriendModal()">
        <i class="fas fa-user-plus"></i> Ê∑ªÂä†Â•ΩÂèã
    </div>
    <div class="wc-menu-option" onclick="featureCreateGroup()">
        <i class="fas fa-users"></i> ÁªÑÂª∫Áæ§ËÅä
    </div>
    <div class="wc-menu-option" onclick="featureImportCard()">
        <i class="fas fa-file-import"></i> ÂØºÂÖ•ËßíËâ≤Âç°
    </div>
</div>
<!-- === ‰øÆÊîπÁªìÊùü === -->

            </div>
        </div>
        <input type="file" id="tavern-card-input" accept=".png,.json,.webp" style="display: none;" onchange="handleCardFile(this)">
    </div>




    <!-- ‰∏≠Èó¥ÂÜÖÂÆπÂå∫Âüü -->
    <div class="wc-body-container">
        
        <!-- Tab 1: ËÅäÂ§©ÂàóË°® -->
        <div class="wc-tab-content active" id="tab-chats">
            <!-- Êñ∞Â¢ûÊêúÁ¥¢Ê°ÜËßÜËßâ -->
            <div class="wc-search-container">
                <div class="wc-search-bar">
                    <i class="fas fa-search" style="margin-right:10px; font-size:12px;"></i> Search messages...
                </div>
            </div>
            <!-- ËøôÈáåÂèØ‰ª•Êîæ‰Ω†ÁöÑËÅäÂ§©ÂàóË°®ÂÆπÂô®ÔºåÂ¶ÇÊûúÊúâÁöÑËØù -->
        </div> <!-- ‚òÖ‚òÖ‚òÖ ÈáçÁÇπÔºöÂú®ËøôÈáåÈó≠Âêà tab-chats ‚òÖ‚òÖ‚òÖ -->

            
        <!-- Tab 2: ÈÄöËÆØÂΩï -->
        <div class="wc-tab-content" id="tab-contacts" style="display:none;">
            <div class="wc-search-container">
                <div class="wc-search-bar" id="contacts-add-bar" onclick="openFriendRequestPage()" style="position:relative;">
                    <i class="fas fa-user-plus" style="margin-right:10px;"></i> Add new friends
                    <span id="contacts-request-dot" class="wc-request-dot" style="display:none;"></span>
                </div>
            </div>
            <!-- Êñ∞ÁöÑÔºöÈÄöËÆØÂΩïÂ•ΩÂèãÂàóË°®ÔºàÁî± JS Âä®ÊÄÅÂ°´ÂÖÖÔºâ -->
            <div id="contacts-list-container"></div>
        </div>


        <!-- Tab 3: ÊúãÂèãÂúà (Èü©Á≥ªÁîªÂªäÈ£é) -->
        <div class="wc-tab-content" id="tab-moments" style="display:none; padding-bottom: 20px;">
            <div id="moments-header-bg" class="moments-header-bg" 
                 style="background-image: url('https://images.unsplash.com/photo-1494859802809-d069c3b71a8a?q=80&w=400&auto=format&fit=crop'); cursor:pointer;"
                 onclick="triggerChangeMomentsBg()">
                <div class="user-name-overlay">Daily Moments</div>
                <div class="user-avatar-overlay"><img src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=200&auto=format&fit=crop"></div>
            </div>
            <div id="moments-feed-list"></div>
        </div>

        <!-- Tab 4: ‰∏™‰∫∫‰∏≠ÂøÉ -->
        <div class="wc-tab-content" id="tab-me" style="display:none;">
            <div class="wc-me-header">
<!-- === ‰øÆÊîπÔºöÁªôÂ§¥ÂÉèÂä†‰∏™ÂàáÊç¢Â∞èÊåâÈíÆ === -->
<div class="wc-avatar lg" id="me-avatar-switcher" style="position:relative;">
    <img src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=200&auto=format&fit=crop">
    <!-- ÁÇπÂáªËøô‰∏™Â∞èÂõæÊ†áÂàáÊç¢Ë∫´‰ªΩ -->
    <div onclick="openIdentityModal(event)" style="position:absolute; right:-5px; bottom:-5px; width:26px; height:26px; background:#333; color:#fff; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:12px; border:2px solid #fff; z-index:10; cursor:pointer;">
        <i class="fas fa-sync-alt"></i>
    </div>
</div>

                <div class="wc-me-info">
                    <div class="wc-me-name">Hannah</div>
                    <div class="wc-me-id">ID: cute_hannah</div>
                </div>
            </div>

            <!-- === Êñ∞Â¢ûÔºöÊàëÁöÑ‰∏ª‰∫∫ËÆæ === -->
            <div class="wc-menu-group" style="padding: 15px 20px;">
                <div style="font-size: 13px; font-weight: 700; color: #333; margin-bottom: 10px;">
                    <i class="fas fa-user-edit"></i> ÊàëÁöÑ‰∏ª‰∫∫ËÆæ (User Persona)
                </div>
                <textarea id="my-global-persona" rows="3" placeholder="‰æãÂ¶ÇÔºöÊàëÊòØ‰∏Ä‰∏™Ëã¶ÈÄºÁöÑ‰∫íËÅîÁΩëÊâìÂ∑•‰∫∫ÔºåÊàñËÄÖÊòØ‰∏Ä‰∏™ÊØèÊúàÊúâËä±‰∏çÂÆåÈõ∂Ëä±Èí±ÁöÑË¥¢ÈòÄÂ§ßÂ∞èÂßê..." style="width: 100%; border: none; background: #f9f9f9; border-radius: 12px; padding: 12px; font-size: 12px; font-family: inherit; resize: none; outline: none;" onblur="saveGlobalPersona()"></textarea>
                <div style="font-size: 10px; color: #999; margin-top: 5px;">* AI Â∞ÜËØªÂèñÊ≠§‰∫∫ËÆæ‰∏∫‰Ω†ÁîüÊàêÊØèÊúàÁöÑÂ∑•ËµÑÊàñÁîüÊ¥ªË¥π„ÄÇ</div>
            </div>

            <div class="wc-menu-group">
                <div class="wc-menu-item"><i class="fas fa-th-large menu-icon"></i> <span>Services</span> <i class="fas fa-chevron-right arrow" style="font-size:10px; color:#ccc"></i></div>
                <div class="wc-menu-item"><i class="fas fa-bookmark menu-icon"></i> <span>Collections</span> <i class="fas fa-chevron-right arrow" style="font-size:10px; color:#ccc"></i></div>
            </div>
            
            <div class="wc-menu-group">
                <div class="wc-menu-item" onclick="toggleSettings()">
                    <i class="fas fa-cog menu-icon"></i> <span>Settings</span> <i class="fas fa-chevron-right arrow" style="font-size:10px; color:#ccc"></i>
                </div>
            </div>
        </div>


    </div>


    <!-- Â∫ïÈÉ®ÂØºËà™Ê†è (ÊÇ¨ÊµÆËÉ∂Âõä) -->
    <div class="wc-tab-bar">
        <div class="wc-tab-item active" onclick="switchWcTab('chats', this)">
            <i class="fas fa-comment"></i>
            <span>Chat</span>
        </div>
        <div class="wc-tab-item" onclick="switchWcTab('contacts', this)">
            <i class="fas fa-address-book"></i>
            <span>Friends</span>
        </div>
        <div class="wc-tab-item" onclick="switchWcTab('moments', this)">
            <i class="fas fa-compass"></i>
         <div id="moments-dot" class="unread-dot"></div>
            <span>Feed</span>
        </div>
        <div class="wc-tab-item" onclick="switchWcTab('me', this)">
            <i class="fas fa-user"></i>
            <span>Me</span>
        </div>
    </div>
</div>



        <!-- Chat View -->
                <!-- Chat View (Êñ∞ÁâàÈü©Á≥ªÈ´òÂÆöÁïåÈù¢) -->
        <div class="chat-view" id="chatLayer">
            <!-- Â§¥ÈÉ®ÔºöÂä†‰∫ÜÂú®Á∫øÁä∂ÊÄÅÂíåÂ∏ÉÂ±Ä‰ºòÂåñ -->
        
<div class="chat-header">
    <!-- Â∑¶‰æßËøîÂõûÊåâÈíÆ (‰øùÊåÅ‰∏çÂèò) -->
    <i class="fas fa-chevron-left" onclick="toggleChat()" style="cursor:pointer; padding:10px; font-size:18px;"></i>
    
    <!-- „ÄêÊñ∞Â¢û„ÄëÂºπÂπïÂºÄÂÖ≥ÂõæÊ†á (ÊîæÂú®ËøîÂõûÈîÆÂè≥Ëæπ) -->
    <i class="fas fa-comment-alt" id="danmaku-toggle" onclick="toggleDanmaku()" title="ÂºÄÂêØ/ÂÖ≥Èó≠ÂÆûÊó∂ÂºπÂπï" style="cursor:pointer; padding:10px; font-size:16px; color:#bbb; transition:0.3s;"></i>

    <!-- ‰∏≠Èó¥Ê†áÈ¢ò (‰øùÊåÅ‰∏çÂèò) -->
    <span style="display:flex; flex-direction:column; align-items:center; line-height:1.2; flex:1;"> <!-- Âä† flex:1 ËÆ©ÂÆÉÂ±Ö‰∏≠ -->
        HANNAH AI
        <small style="font-size:9px; color:#aaa; font-weight:400; letter-spacing:1px; text-transform:uppercase;">Online</small>
    </span>
    
    <!-- Âè≥‰æßÊåâÈíÆÁªÑ (‰øùÊåÅ‰∏çÂèò) -->
    <div style="display:flex; align-items:center; gap: 0px;">
        <i class="fas fa-heart-pulse" onclick="toggleMindCard(event)" style="cursor:pointer; padding:10px 8px; font-size:19px; color:#ff7e67;" title="Êü•ÁúãÂøÉÂ£∞"></i>
        <i class="fas fa-cog" onclick="openChatSettingsPage()" style="cursor:pointer; padding:10px 8px; font-size:19px; color:#666;" title="ËÅäÂ§©ËÆæÁΩÆ"></i>
    </div>
</div>

<!-- „ÄêÊñ∞Â¢û„ÄëÂú® chat-view ÂÜÖÈÉ®Ê∑ªÂä†ÂºπÂπïÈÅÆÁΩ©Â±Ç -->
<!-- ËØ∑Á°Æ‰øùÂÆÉÂú® chat-header ‰∏ãÈù¢Ôºåchat-messages ‰∏äÈù¢ -->




                       <!-- ËÅäÂ§©ÂÜÖÂÆπÂå∫ -->
            <div class="chat-messages" id="chatMessages">
                <!-- Êó∂Èó¥Êà≥ -->
                <div style="text-align:center; margin: 10px 0;">
                    <span style="background:rgba(0,0,0,0.04); padding:4px 12px; border-radius:12px; font-size:10px; color:#999; font-weight:500;">Today 14:02</span>
                </div>

                <!-- Êé•Êî∂ÁöÑÊ∂àÊÅØ (Â∑¶‰æßÔºöÂ§¥ÂÉèÂú®ÂâçÔºåÊ∞îÊ≥°Âú®Âêé) -->
                <div class="chat-row received">
                    <img class="chat-avatar-img" src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=200&auto=format&fit=crop">
                    <div class="message-bubble received">
                        Good afternoon! ‚òïÔ∏è<br>Is there anything I can help you with?
                    </div>
                </div>

                <!-- ÂèëÈÄÅÁöÑÊ∂àÊÅØ (Âè≥‰æßÔºöÊ∞îÊ≥°Âú®ÂâçÔºåÂ§¥ÂÉèÂú®Âêé) -->
                <div class="chat-row sent">
                    <div class="message-bubble sent">
                        I love this new design! ‚ú®
                    </div>
                    <img class="chat-avatar-img" src="https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?q=80&w=200&auto=format&fit=crop">
                </div>
            </div>

<!-- === ‰øÆÊîπÂêéÁöÑËÅäÂ§©Â∫ïÈÉ®ËæìÂÖ•Âå∫ (index.html) === -->
<div class="chat-input-area">
    <form id="chatForm" class="chat-input-form" style="position:relative; z-index:10;">
        
        <!-- === Â∑¶‰æßÂå∫ÂüüÔºöÂä†Âè∑ & Ë°®ÊÉÖ === -->
        <div style="display:flex; align-items:center; gap: 12px; margin-right: 10px;">
            <i class="fas fa-plus-circle" onclick="toggleChatPanel('plus')" style="color:#333; font-size:22px; cursor:pointer;"></i>
            <i class="far fa-smile" onclick="toggleChatPanel('emoji')" style="color:#333; font-size:22px; cursor:pointer;"></i>
        </div>
        
        <!-- ‰∏≠Èó¥ÔºöËæìÂÖ•Ê°Ü -->
        <input type="text" id="chatInput" placeholder="Type a message..." autocomplete="off">
        
        <!-- === Âè≥‰æßÂå∫ÂüüÔºöAI ÂõûÂ§ç & ÂèëÈÄÅ === -->
      <div style="display:flex; align-items:center; gap: 8px; margin-left: 8px;">
    <i id="triggerAiReply" class="fas fa-star" title="ÁÇπ‰∫ÆÊòüÊòü (ËÆ©AIÂõûÂ§ç)" style="color:#bbb; font-size:20px; cursor:pointer; transition:all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);"></i>
    <button type="submit" title="ÂèëÈÄÅ (‰ªÖ‰∏äÂ±è)"><i class="fas fa-paper-plane"></i></button>
</div>

    </form>

    <!-- [Êñ∞Â¢û] Â∫ïÈÉ®Êâ©Â±ïÈù¢ÊùøÂÆπÂô® (‰øùÊåÅ‰∏çÂèò) -->
    <div id="chat-extra-panels" class="chat-panels-container">
        <!-- 1. Ë°®ÊÉÖÈù¢Êùø -->
        <div id="panel-emoji" class="chat-panel" style="display:none;">
            <div class="emoji-tabs">
                <span class="active">Emoji</span>
                <span>Stickers</span>
            </div>
            <div class="emoji-grid">
                <span onclick="insertEmoji('üòÇ')">üòÇ</span><span onclick="insertEmoji('‚ù§Ô∏è')">‚ù§Ô∏è</span>
                <span onclick="insertEmoji('üòç')">üòç</span><span onclick="insertEmoji('üò≠')">üò≠</span>
                <span onclick="insertEmoji('üëç')">üëç</span><span onclick="insertEmoji('ü§ù')">ü§ù</span>
                <span onclick="insertEmoji('üôè')">üôè</span><span onclick="insertEmoji('üéâ')">üéâ</span>
                <span onclick="insertEmoji('ü§î')">ü§î</span><span onclick="insertEmoji('üò°')">üò°</span>
            </div>
            <div class="sticker-grid">
                <img src="https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExcDdtY2Z4b3E4eHRqbnZ6Z3I5eXF6eXF6eXF6eXF6eXF6eXF6eSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9cw/MDJ9IbxxvDUQM/giphy.gif" onclick="sendSticker(this.src)">
                <img src="https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExbmZ6eXF6eXF6eXF6eXF6eXF6eXF6eXF6eXF6eXF6eSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9cw/13CoXDiaCcCzd2/giphy.gif" onclick="sendSticker(this.src)">
                <img src="https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExYnZ6eXF6eXF6eXF6eXF6eXF6eXF6eSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9cw/l0HlCqV35hdEg/giphy.gif" onclick="sendSticker(this.src)">
                <img src="https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExY3Z6eXF6eXF6eXF6eXF6eXF6eXF6eSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9cw/3o7TKs6AWsp1M6Jqne/giphy.gif" onclick="sendSticker(this.src)">
            </div>
        </div>

        <!-- 2. Âä†Âè∑ÂäüËÉΩÈù¢Êùø -->
        <div id="panel-plus" class="chat-panel" style="display:none;">
            <div class="plus-grid">
                <div class="plus-item" onclick="triggerImageUpload()">
                    <div class="plus-icon"><i class="fas fa-image"></i></div>
                    <span>ÁÖßÁâá</span>
                </div>
                <div class="plus-item" onclick="sendLocation()">
                    <div class="plus-icon"><i class="fas fa-map-marker-alt"></i></div>
                    <span>‰ΩçÁΩÆ</span>
                </div>
                <div class="plus-item" onclick="triggerNudge()">
                    <div class="plus-icon"><i class="fas fa-hand-point-right"></i></div>
                    <span>Êãç‰∏ÄÊãç</span>
                </div>
                <div class="plus-item" onclick="sendRedPacket()">
                    <div class="plus-icon"><i class="fas fa-yen-sign" style="color:#fa9d3b;"></i></div>
                    <span>ËΩ¨Ë¥¶</span>
                </div>
                <div class="plus-item" onclick="openVoiceActionModal()">
    <div class="plus-icon"><i class="fas fa-microphone"></i></div>
    <span>ËØ≠Èü≥</span>
</div>

                <div class="plus-item" onclick="sendMusicShare()">
                    <div class="plus-icon"><i class="fas fa-music"></i></div>
                    <span>‰∏ÄËµ∑Âê¨</span>
                </div>
                <div class="plus-item" onclick="openOfflineMode()">
    <div class="plus-icon" style="background:#2b2b2b; color:#fff; border:1px solid #2b2b2b;"><i class="fas fa-book-open"></i></div>
    <span>Á∫ø‰∏ãÊ®°Âºè</span>
</div>
<!-- === „ÄêÊñ∞Â¢û„ÄëÂâßÊÉÖÊÄªÁªìÂäüËÉΩÂÖ•Âè£ === -->
<div class="plus-item" onclick="openSummaryPage()">

    <div class="plus-icon"><i class="fas fa-clipboard-list"></i></div>
    <span>ÂâßÊÉÖÊÄªÁªì</span>
</div>



            </div>
        </div>
    </div>
    <input type="file" id="chat-image-input" accept="image/*" style="display:none;" onchange="handleChatImage(this)">
</div>



        </div>
        <div id="danmaku-layer" class="danmaku-container" style="z-index: 4500;"></div>
<!-- === [Êñ∞Â¢û] È¢ÑËÆæÁÆ°ÁêÜ APP === -->
<div class="app-fullscreen-view" id="presetsApp">
    <div class="wc-header" style="background:#fff;">
        <span onclick="closePresetsApp()"><i class="fas fa-chevron-down"></i> Presets</span>
        <div class="wc-header-icons">
            <!-- Êñ∞Â¢ûÂØºÂÖ•ÂØºÂá∫ÊåâÈíÆ -->
            <i class="fas fa-file-export" onclick="exportPresets()" title="ÂØºÂá∫È¢ÑËÆæ" style="font-size:16px;"></i>
            <i class="fas fa-file-import" onclick="triggerImportPresets()" title="ÂØºÂÖ•È¢ÑËÆæ" style="font-size:16px;"></i>
            <i class="fas fa-plus" onclick="createNewPreset()" title="Êñ∞Âª∫" style="margin-left:10px;"></i>
        </div>
        <input type="file" id="preset-import-file" accept=".json" style="display:none;" onchange="handleImportPresets(this)">
    </div>
    <!-- ‰∏ãÈù¢ÁöÑÂàóË°®ÂÆπÂô®‰∏çÂèò -->
    <div class="wc-body-container" style="background:#f7f7f7;">
        <div id="presets-list-container" class="presets-list"></div>
    </div>
    
    <!-- È¢ÑËÆæÁºñËæëÂô® -->
    <div id="preset-editor" class="preset-editor-overlay">
    <div class="wc-header" style="background:#fff;">
        <span onclick="closePresetEditor()"><i class="fas fa-chevron-left"></i> Back</span>
        <span onclick="savePresetEditor()">Save</span>
    </div>
    <div class="wc-body-container" style="padding:20px; background:#fff;">
        <!-- ÂéüÊúâÁöÑÂêçÁß∞ËæìÂÖ• -->
        <div class="form-group">
            <label>È¢ÑËÆæÂêçÁß∞</label>
            <input type="text" id="pe-name">
        </div>
        <!-- ÂéüÊúâÁöÑ Prompt ËæìÂÖ• -->
        <div class="form-group">
            <label>Á≥ªÁªüÊèêÁ§∫ËØç (System Prompt)</label>
            <textarea id="pe-sys-prompt" rows="6" placeholder="System instructions..."></textarea>
        </div>
        
        <!-- === Êñ∞Â¢ûÔºöÊ≠£ÂàôËÑöÊú¨Ê®°Âùó (Regex Scripts) === -->
        <div class="settings-section-title" style="margin-top:20px; display:flex; justify-content:space-between; align-items:center;">
            <span>Ê≠£ÂàôËÑöÊú¨ (Regex Scripts)</span>
            <button class="btn-secondary" style="height:24px; font-size:12px; padding:0 8px;" onclick="addRegexScriptItem()">+ Ê∑ªÂä†</button>
        </div>
        <div id="pe-regex-container" style="display:flex; flex-direction:column; gap:10px; margin-bottom:20px;">
            <!-- JS Âä®ÊÄÅÊèíÂÖ•ËÑöÊú¨È°π -->
        </div>

        <!-- ÂéüÊúâÁöÑË∂äÁã±ËæìÂÖ• -->
        <div class="form-group">
            <label>Ë∂äÁã±/ÂâçÁΩÆÊåá‰ª§ (Jailbreak)</label>
            <textarea id="pe-jailbreak" rows="3"></textarea>
        </div>
        
        <button class="btn-secondary" style="color:red; margin-top:20px;" onclick="deleteCurrentPreset()">Âà†Èô§Ê≠§È¢ÑËÆæ</button>
    </div>
</div>
</div>


        <!-- Settings View -->
        <div class="settings-view" id="settingsView">
            <div class="settings-header">
                <i class="fas fa-times" onclick="toggleSettings()" style="cursor:pointer;"></i>
                <span>Settings</span>
                <div class="settings-tabs-switch">
                    <span class="tab-btn active" onclick="switchSettingsTab('ai')">AI Chat</span>
                    <span class="tab-btn" onclick="switchSettingsTab('theme')">Theme</span>
                </div>
            </div>
            
            <div class="settings-content">
                
                <!-- Tab 1: AI ËÆæÁΩÆ -->
                <div id="tab-content-ai" class="tab-content active">
                    <div class="form-group">
                        <label>API ÊúçÂä°ÂïÜ</label>
                        <select id="api-provider-select">
                            <option value="custom">Ëá™ÂÆö‰πâ / NewAPI</option>
                            <option value="gemini">Google Gemini</option>
                            <option value="claude">Anthropic Claude</option>
                            <option value="deepseek">DeepSeek</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>API Key</label>
                        <input type="password" id="apiKeyInput" placeholder="ËØ∑ËæìÂÖ•‰Ω†ÁöÑ API Key">
                    </div>
                    <div class="form-group" id="api-endpoint-group">
                        <label>API Base URL</label>
                        <input type="text" id="apiEndpointInput" placeholder="https://api.example.com">
                    </div>
                    
                    <div class="form-group">
                        <label>Model</label>
                        <div class="input-with-button">
                            <select id="model-select"></select>
                            <button id="fetch-models-btn" type="button"><i class="fas fa-sync-alt"></i></button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Temperature: <span id="temperature-value">0.7</span></label>
                        <input type="range" id="temperature-slider" min="0" max="2" step="0.1" value="0.7">
                    </div>

                    <hr class="settings-divider">

                    <div class="form-group">
                        <label>Âä†ËΩΩÈ¢ÑËÆæ (Load Preset)</label>
                        <select id="preset-select">
                            <option value="">-- ÈÄâÊã©‰∏Ä‰∏™È¢ÑËÆæ --</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>‰øùÂ≠òÂΩìÂâç‰∏∫Êñ∞È¢ÑËÆæ</label>
                        <div class="input-with-button">
                            <input type="text" id="preset-name-input" placeholder="‰æãÂ¶Ç 'ÁøªËØëÂä©Êâã'">
                            <button id="save-preset-btn" type="button">Save</button>
                        </div>
                    </div>

                    <button id="save-settings-btn" class="btn-save">‰øùÂ≠òÊâÄÊúâËÆæÁΩÆ</button>
                </div>

                <!-- Tab 2: ‰∏ªÈ¢òÁæéÂåñ -->
                <div id="tab-content-theme" class="tab-content" style="display:none;">
                    
                    <div class="form-group" style="display:flex; justify-content:space-between; align-items:center;">
                        <label style="margin:0;">ÊòæÁ§∫Áä∂ÊÄÅÊ†è</label>
                        <label class="switch">
                            <input type="checkbox" id="show-statusbar-time-toggle" checked>
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="form-group" style="display:flex; justify-content:space-between; align-items:center; margin-top:15px;">
    <label style="margin:0;">ÂÖ®Èù¢Â±èÊ®°Âºè (Full Screen)</label>
    <label class="switch">
        <input type="checkbox" id="fullscreen-mode-toggle">
        <span class="slider round"></span>
    </label>
</div>

<hr class="settings-divider">

<!-- === [Êñ∞Â¢û] Âº∫Âà∂Âà∑Êñ∞ÊåâÈíÆ (ÊîæÂú®Â£ÅÁ∫∏ËÆæÁΩÆ‰∏äÈù¢ÊàñÊúÄ‰∏ãÈù¢ÈÉΩÂèØ‰ª•) === -->
<div class="form-group">
    <button onclick="forceSystemRefresh()" style="width:100%; height:44px; background:#ff7e67; color:#fff; border:none; border-radius:12px; font-weight:700;">
        <i class="fas fa-sync-alt"></i> Âº∫Âà∂Âà∑Êñ∞Á≥ªÁªü (Ê∏ÖÈô§ÁºìÂ≠ò)
    </button>
    <div class="form-text" style="text-align:center;">Â¶ÇÊûúÊõ¥Êñ∞ÂêéÊ≤°ÂèòÂåñÔºåËØ∑ÁÇπÊ≠§ÊåâÈíÆ</div>
</div>

<hr class="settings-divider">
                    
                    <hr class="settings-divider">

                    <div class="form-group">
                        <label>Â£ÅÁ∫∏ËÆæÁΩÆ</label>
                        <div class="input-with-button">
                            <input type="text" id="wallpaper-url-input" placeholder="ÂõæÁâá URL...">
                            <label class="file-upload-btn">
                                <i class="fas fa-image"></i>
                                <input type="file" id="wallpaper-file-input" accept="image/*" style="display:none;">
                            </label>
                        </div>
                        <button onclick="resetWallpaper()" style="margin-top:5px; width:100%; padding:8px; border:1px solid #ddd; background:#fff; border-radius:8px;">ÊÅ¢Â§çÈªòËÆ§Â£ÅÁ∫∏</button>
                    </div>

                    <hr class="settings-divider">

                    <!-- === Êñ∞Â¢ûÔºöÂÖ®Â±Ä CSS ‰ª£Á†ÅÁºñËæëÂô® === -->
                    <div class="form-group">
                        <label>ÂÖ®Â±ÄËá™ÂÆö‰πâ CSS (Custom CSS)</label>
                        <textarea id="custom-css-input" placeholder="/* Âú®ËøôÈáåËæìÂÖ• CSS ‰ª£Á†ÅÔºåÂÆûÊó∂ÁîüÊïà */&#10;‰æãÂ¶Ç: .icon-box { border-radius: 50%; }" spellcheck="false"></textarea>
                        <div class="form-text">ËæìÂÖ• CSS ‰ª£Á†ÅÂèØÊ∑±Â∫¶ÁæéÂåñÁïåÈù¢ (ÊîØÊåÅÂÆûÊó∂È¢ÑËßà)</div>
                    </div>

                    <hr class="settings-divider">

                    <!-- === Êñ∞Â¢ûÔºö‰∏ªÈ¢òÈ¢ÑËÆæ‰∏éÂØºÂÖ•ÂØºÂá∫ === -->
                    <div class="form-group">
                        <label>‰∏ªÈ¢òÈ¢ÑËÆæÁÆ°ÁêÜ (Theme Presets)</label>
                        <select id="theme-preset-select">
                            <option value="">-- ÈÄâÊã©Â∑≤‰øùÂ≠òÁöÑ‰∏ªÈ¢ò --</option>
                        </select>
                        <div class="input-with-button" style="margin-top:10px;">
                            <input type="text" id="theme-preset-name" placeholder="È¢ÑËÆæÂêçÁß∞ (Â¶Ç: ÊöóÈªëÊ®°Âºè)">
                            <button id="save-theme-preset-btn" title="‰øùÂ≠òÂΩìÂâç‰∏ªÈ¢ò"><i class="fas fa-save"></i></button>
                            <button id="delete-theme-preset-btn" title="Âà†Èô§ÈÄâ‰∏≠" style="color:#ff4d4f;"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Â§á‰ªΩ‰∏éÂàÜ‰∫´</label>
                        <div style="display:flex; gap:10px;">
                            <button class="btn-secondary" id="export-theme-btn"><i class="fas fa-file-export"></i> ÂØºÂá∫ (JSON)</button>
                            <label class="btn-secondary file-btn" style="margin:0;">
                                <i class="fas fa-file-import"></i> ÂØºÂÖ•
                                <input type="file" id="import-theme-file" accept=".json" style="display:none;">
                            </label>
                        </div>
                    </div>
                    
                    <hr class="settings-divider">

                    <div class="form-group">
                        <label>Â≠ó‰ΩìÊù•Ê∫ê</label>
                        <select id="font-source-select" onchange="toggleFontInput(this.value)">
                            <option value="preset">È¢ÑËÆæÂ≠ó‰Ωì</option>
                            <option value="custom">ÂØºÂÖ• URL</option>
                        </select>
                    </div>

                    <div class="form-group" id="group-font-preset">
                        <label>ÈÄâÊã©È¢ÑËÆæ</label>
                        <select id="font-family-select">
                            <option value="'Montserrat', sans-serif">Montserrat (Default)</option>
                            <option value="'Playfair Display', serif">Playfair Display (Serif)</option>
                            <option value="'Alex Brush', cursive">Alex Brush (Handwriting)</option>
                            <option value="'Courier New', monospace">Courier New (Retro)</option>
                            <option value="system-ui, sans-serif">System Default</option>
                        </select>
                    </div>

                    <div class="form-group" id="group-font-custom" style="display:none;">
                        <label>Â≠ó‰ΩìÊñá‰ª∂ URL (woff2/ttf)</label>
                        <input type="text" id="custom-font-url" placeholder="https://example.com/font.woff2">
                    </div>

                    <div class="form-group">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                            <label style="margin:0;">‰∏ªÈ¢òÊñáÂ≠óÈ¢úËâ≤</label>
                            <input type="color" id="theme-color-picker" value="#222222" style="width:40px; height:30px; border:none; padding:0; background:none;">
                        </div>
                        
                        <div class="font-preview-box" id="font-preview-box">
                            <div style="font-size:24px; line-height:1.2;">12:30</div>
                            <div style="font-size:14px;">Good Morning</div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Â≠ó‰ΩìÂ§ßÂ∞è: <span id="font-scale-value">100%</span></label>
                        <input type="range" id="font-scale-slider" min="0.8" max="1.3" step="0.05" value="1">
                    </div>

                    <hr class="settings-divider">

                    <div class="form-group">
                        <label>Ëá™ÂÆö‰πâ APP ÂõæÊ†á</label>
                        <select id="app-icon-select">
                            <option value="">-- ÈÄâÊã© APP --</option>
                        </select>
                        <div style="margin-top:10px; display:flex; align-items:center; gap:10px;">
                            <div id="icon-preview-area" style="width:48px; height:48px; border-radius:12px; background:#eee; display:flex; justify-content:center; align-items:center; overflow:hidden;">
                                <span style="font-size:10px; color:#999;">È¢ÑËßà</span>
                            </div>
                            <label class="btn-save" style="width:auto; padding:0 15px; display:flex; align-items:center; margin:0; font-size:12px; height:36px;">
                                ‰∏ä‰º†ÂõæÊ†á <i class="fas fa-upload" style="margin-left:5px;"></i>
                                <input type="file" id="app-icon-file" accept="image/*" style="display:none;">
                            </label>
                        </div>
                        <button id="reset-icon-btn" style="margin-top:10px; width:100%; padding:8px; border:1px solid #ddd; background:#fff; border-radius:8px; display:none;">ÈáçÁΩÆÊ≠§ÂõæÊ†á</button>
                    </div>

                    <button id="save-theme-btn" class="btn-save" style="margin-top:30px;">‰øùÂ≠òÊâÄÊúâ‰∏ªÈ¢òÈÖçÁΩÆ</button>
                </div>

            </div>
        </div><!-- === [Êñ∞Â¢û] ËÅäÂ§©ËØ¶ÁªÜËÆæÁΩÆÁã¨Á´ãÈ°µÈù¢ === -->
<div class="chat-settings-page-view" id="chatSettingsPage">
    <div class="chat-settings-page-header">
        <!-- ËøîÂõûÊåâÈíÆÔºåÁÇπÂáªÂÖ≥Èó≠È°µÈù¢ -->
        <i class="fas fa-chevron-left" onclick="closeChatSettingsPage()"></i>
        <span>ËÅäÂ§©ËÆæÁΩÆ</span>
        <!-- Âè≥‰æßÂç†‰ΩçÔºå‰øùÊåÅÊ†áÈ¢òÂ±Ö‰∏≠ -->
        <div style="width: 24px;"></div>
    </div>
    
    <div class="chat-settings-page-content">
             <!-- 1. ËßíËâ≤‰ø°ÊÅØ (ÈáçÊûÑÁâàÔºöÂ§¥ÂÉè‰∏ä‰º†„ÄÅÁúüÂêç„ÄÅ‰∏ñÁïå‰π¶Â§öÈÄâ) -->
        <div class="settings-section-title" style="margin-top: 0;">ËßíËâ≤Ê°£Ê°à (Profile)</div>
        
        <!-- Â§¥ÂÉè‰øÆÊîπ (Êîπ‰∏∫ÁÇπÂáª‰∏ä‰º†Âºè) -->
        <div class="form-group">
            <label>Â§¥ÂÉè (Avatar)</label>
            <div style="display:flex; align-items:center; gap:15px;">
                <!-- Â§¥ÂÉèÈ¢ÑËßàÂå∫Âüü -->
                <div id="cs-avatar-preview" style="width:64px; height:64px; border-radius:16px; background:#eee; border:2px solid #fff; box-shadow: 0 5px 15px rgba(0,0,0,0.08); overflow:hidden; flex-shrink:0;">
                    <img src="" style="width:100%; height:100%; object-fit:cover; display:none;">
                </div>
                <!-- ÈöêËóèÁöÑÊñá‰ª∂ËæìÂÖ•Ê°ÜÂíåÊåâÈíÆ -->
                <div>
                    <input type="file" id="cs-avatar-upload" accept="image/*" style="display:none;">
                    <button class="btn-secondary" onclick="document.getElementById('cs-avatar-upload').click()" style="padding: 8px 15px; height:auto; width:auto;">
                        <i class="fas fa-camera"></i> Êõ¥Êç¢Â§¥ÂÉè
                    </button>
                    <!-- ÈöêËóèÂüüÔºåÁî®‰∫éÂ≠òÂÇ®ÂÆûÈôÖÁöÑÂõæÁâáÊï∞ÊçÆ -->
                    <input type="hidden" id="cs-avatar-hidden-val">
                </div>
            </div>
        </div>

        <div style="display: flex; gap: 15px;">
            <div class="form-group" style="flex:1;">
                <label>Â§áÊ≥®Âêç (Nickname)</label>
                <input type="text" id="cs-remark" placeholder="ËÅäÂ§©Á™óÂè£ÊòæÁ§∫ÁöÑÂêçÁß∞">
            </div>
            <div class="form-group" style="flex:1;">
                <label>ÁúüÂÆûÂßìÂêç (Real Name) <span style="color:red">*</span></label>
                <input type="text" id="cs-realname" placeholder="ËßíËâ≤ÁöÑÁúüÂêç">
            </div>
        </div>

        <div class="form-group">
            <!-- ÂºÄÂú∫ÁôΩËÆæÁΩÆ -->
<div class="form-group">
    <label>ÂºÄÂú∫ÁôΩÊù•Ê∫ê (Greeting Source)</label>
    <select id="cs-greeting-mode" onchange="toggleGreetingEditor()">
        <option value="none">‰∏çÂºÄÂú∫ÁôΩ</option>
        <option value="custom">Ëá™ÂÆö‰πâÂºÄÂú∫ÁôΩ</option>
        <option value="tavern">ËØªÂèñÈÖíÈ¶ÜÂç°ÂºÄÂú∫ÁôΩ</option>
        <!-- === „ÄêÊñ∞Â¢û„ÄëÊõ¥Êç¢ÂºÄÂú∫ÁôΩÁöÑÊèêÁ§∫ === -->
<div class="form-text" style="color: #ff7e67; font-weight: bold; margin-top: -5px; margin-bottom: 10px;">
    <i class="fas fa-info-circle"></i> Ê≥®ÊÑèÔºöÊõ¥Êç¢ÂºÄÂú∫ÁôΩÂêéÔºå‰∏∫‰øùËØÅÂâßÊÉÖËøûË¥ØÔºåËØ∑ÈÄâÊã©Ê∏ÖÁ©∫ËßíËâ≤ËÅäÂ§©ËÆ∞ÂΩï„ÄÇ
</div>

    </select>
</div>

<div class="form-group" id="cs-greeting-custom-box">
    <label>Ëá™ÂÆö‰πâÂºÄÂú∫ÁôΩ</label>
    <textarea id="cs-greeting-custom" rows="3" placeholder="‰Ω†Ëá™Â∑±ÂÜôÁ¨¨‰∏ÄÂè•..."></textarea>
</div>

<div class="form-group" id="cs-greeting-tavern-box">
    <label>ÈÖíÈ¶ÜÂç°ÂºÄÂú∫ÁôΩÂàóË°®</label>
    <div id="cs-greeting-list" class="worldbook-checklist-container"></div>
    <textarea id="cs-greeting-tavern" rows="3" readonly placeholder="ÈÄâÊã©ÂêéÂú®ËøôÈáåÈ¢ÑËßà"></textarea>
</div>


            <label>‰∫∫ËÆæ (Persona) <span style="color:red">*</span></label>
            <textarea id="cs-persona" rows="6" placeholder="ËßíËâ≤ÁöÑÊ†∏ÂøÉÊÄßÊ†º„ÄÅË∫´‰ªΩËÆæÂÆö..." style="height:auto; font-size:13px;"></textarea>
            
        </div>


        <!-- ‰∏ñÁïå‰π¶ (Êîπ‰∏∫Â§öÈÄâÊ°ÜÂÆπÂô®ÔºåJSÂä®ÊÄÅÂä†ËΩΩ) -->
        <div class="form-group">
            <label>‰∏ñÁïå‰π¶ËÆæÂÆö (Worldbooks) - Â§öÈÄâ</label>
            <div id="cs-worldbook-container" class="worldbook-checklist-container">
                <!-- JS Â∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàêÂ§çÈÄâÊ°Ü -->
                <div style="color:#999; font-size:12px; padding:10px;">Ê≠£Âú®Âä†ËΩΩ‰∏ñÁïå‰π¶ÂàóË°®...</div>
            </div>
        </div>

        <hr class="settings-divider">

        <!-- 2. È´òÁ∫ßÂäüËÉΩ (ÈáçÊûÑÁâàÔºöÁøªËØë‰∏ãÊãâ„ÄÅ‰∏ªÂä®ÂèëË®ÄÊó∂Èó¥) -->
        <div class="settings-section-title">È´òÁ∫ßÂäüËÉΩ (Advanced)</div>
            
        <!-- ËÆ∞ÂøÜ -->
        <div class="form-group" style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <label style="margin:0; display:block;">‰∏ä‰∏ãÊñáËÆ∞ÂøÜËΩÆÊï∞</label>
                <span class="form-text" style="margin:0;">‰ªÖÂèëÈÄÅÊúÄËøë N ËΩÆÂØπËØù„ÄÇ</span>
            </div>
            <input type="number" id="cs-memory-limit" placeholder="20" style="width: 80px; text-align:center;" min="5">
        </div>

        <!-- ÁøªËØëËÆæÁΩÆ (ÊîπÈÄ†Êàê‰∏ãÊãâÊ°Ü + ËæìÂÖ•Ê°Ü) -->
        <div class="form-group" style="margin-top: 25px;">
            <label>ÁøªËØëÊ®°Âºè (Translation Mode)</label>
            <select id="cs-translation-mode">
                <option value="off">ÂÖ≥Èó≠ (Off)</option>
                <option value="ai_to_zh">ÁøªËØëAIËæìÂá∫Âà∞‰∏≠Êñá (Translate AI output to ZH)</option>
                <option value="ai_to_en">ÁøªËØëAIËæìÂá∫Âà∞Ëã±Êñá (Translate AI output to EN)</option>
            </select>
            
            <div style="margin-top: 10px;">
                <label style="font-size: 11px; color: #888;">Âº∫Âà∂ËæìÂá∫ËØ≠Ë®Ä (Target Language)</label>
                <input type="text" id="cs-target-lang" placeholder="‰æãÂ¶Ç: English, Japanese (ÁïôÁ©∫ÂàôÈªòËÆ§)">
                <span class="form-text" style="display:block; margin-top:4px;">Âº∫Âà∂ AI ‰ΩøÁî®ËØ•ËØ≠Ë®ÄÂõûÂ§çÔºå‰ºòÂÖàÁ∫ßÈ´ò‰∫éÁøªËØëÊ®°Âºè„ÄÇ</span>
            </div>
        </div>

        <!-- ‰∏ªÂä®ÂèëË®Ä (Â¢ûÂä†Êó∂Èó¥ÈÄâÈ°πÔºåÈªòËÆ§ÈöêËóè) -->
        <div class="form-group" style="margin-top: 25px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <label style="margin:0; font-weight:500;">Êó†Êìç‰Ωú‰∏ªÂä®ÂèëË®Ä</label>
                <label class="switch">
                    <input type="checkbox" id="cs-inactivity-toggle">
                    <span class="slider round"></span>
                </label>
            </div>
            <!-- ÈöêËóèÁöÑÊó∂Èó¥ËæìÂÖ•Âå∫ÂüüÔºåJSÊéßÂà∂ÊòæÁ§∫ -->
            <div id="cs-inactivity-time-box" style="display:none; background:#f5f5f7; padding:15px; border-radius:12px;">
                <label style="margin-bottom:5px;">Ëß¶ÂèëÊó∂Èó¥Èó¥Èöî (Áßí)</label>
                <input type="number" id="cs-inactivity-time" placeholder="300" value="300" min="60" style="background:#fff;">
                <span class="form-text" style="display:block; margin-top:4px;">Â¶ÇÊûúË∂ÖËøáÊ≠§Êó∂Èó¥Êó†ÂØπËØùÔºåAI Â∞ÜÂ∞ùËØï‰∏ªÂä®ÂèëËµ∑ËØùÈ¢ò„ÄÇ</span>
            </div>
        </div>

        <hr class="settings-divider">

        <!-- 3. Áä∂ÊÄÅÊ†èÊ≠£ÂàôËÆæÁΩÆ (ÈÖíÈ¶ÜÈ£éÊ†ºÈáçÊûÑÔºåÈªòËÆ§ÈöêËóè) -->
        <div class="settings-section-title" style="display:flex; justify-content:space-between; align-items:center;">
            <span>Áä∂ÊÄÅÊ†èÊäìÂèñ (Regex)</span>
            <label class="switch" style="transform:scale(0.8);">
                <input type="checkbox" id="cs-status-regex-toggle">
                <span class="slider round"></span>
            </label>
        </div>
        
        <div id="cs-status-regex-box" style="display:none; flex-direction:column; gap:15px; background:#f9f9f9; padding:15px; border-radius:16px; border:1px solid #eee;">
            
            <div class="form-group" style="margin:0;">
                <label>1. Áä∂ÊÄÅÊ†èÊ†ºÂºèË¶ÅÊ±Ç (Prompt Instruction)</label>
                <span class="form-text" style="margin-bottom:5px; display:block;">ÊèêÁ§∫ AI ÊåâÁÖß‰ªÄ‰πàÊ†ºÂºèËæìÂá∫Áä∂ÊÄÅÊï∞ÊçÆ„ÄÇ</span>
                <textarea id="cs-status-format-req" rows="4" placeholder="‰æãÂ¶ÇÔºöËØ∑Âú®ÂõûÂ§çÊúÄÂêéÈôÑÂ∏¶Áä∂ÊÄÅÊ†èÔºåÊ†ºÂºè‰∏∫Ôºö&#10;[STATUS]&#10;ÂøÉÊÉÖ:ÂºÄÂøÉ&#10;Âú∞ÁÇπ:ÂÆ∂&#10;[/STATUS]" style="font-family:monospace; font-size:11px; height:auto;"></textarea>
            </div>

            <div class="form-group" style="margin:0;">
                <label>2. ÊèêÂèñÊ≠£Âàô (Extraction Regex)</label>
                <span class="form-text" style="margin-bottom:5px; display:block;">Áî®‰∫é‰ªéÂõûÂ§ç‰∏≠ÊèêÂèñÂá∫Áä∂ÊÄÅÊ†èÂÜÖÂÆπÂùó„ÄÇ</span>
                <textarea id="cs-status-extract-regex" rows="2" placeholder="‰æãÂ¶ÇÔºö/\[STATUS\]([\s\S]*?)\[\/STATUS\]/i" style="font-family:monospace; font-size:11px; color:#d63384; background:#fff; height:auto;"></textarea>
            </div>

            <div class="form-group" style="margin:0;">
                <label>3. Ê≠£ÂàôÊõøÊç¢ (Regex Replacement)</label>
                <span class="form-text" style="margin-bottom:5px; display:block;">Â∞ÜÊèêÂèñÂà∞ÁöÑÂÜÖÂÆπ‰ªéÊúÄÁªàÊ∞îÊ≥°‰∏≠ÁßªÈô§ (ÁïôÁ©∫Âàô‰∏çÁßªÈô§)„ÄÇ</span>
                <textarea id="cs-status-replace-regex" rows="2" placeholder="‰æãÂ¶ÇÔºö(ÁïôÁ©∫)" style="font-family:monospace; font-size:11px; background:#fff; height:auto;"></textarea>
            </div>
        </div>


        <!-- ‰øùÂ≠òÊåâÈíÆÔºåÊîæÂú®ÊúÄÂ∫ïÈÉ® -->
        <button class="btn-save" onclick="saveChatSettings()" style="margin-top: 30px; margin-bottom: 30px;">‰øùÂ≠òÈÖçÁΩÆ</button>
       <button class="btn-secondary" onclick="clearCurrentChatHistory()" style="color:#ff4d4f; border-color:#ff4d4f; margin-top:10px; margin-bottom: 30px;">
    <i class="fas fa-exclamation-triangle"></i> Ê∏ÖÁ©∫ËÅäÂ§©ËÆ∞ÂΩï
</button>
    </div>
</div>
<!-- Â•ΩÂèãËµÑÊñôÈ°µÔºàÂ§çÁî® chat-settings-page ÁöÑÊ†∑ÂºèÔºâ -->
<div class="chat-settings-page-view" id="contactProfilePage">
    <div class="chat-settings-page-header">
        <i class="fas fa-chevron-left" onclick="closeContactProfile()"></i>
        <span>Â•ΩÂèãËµÑÊñô</span>
        <div style="width:24px;"></div>
    </div>

    <div class="chat-settings-page-content" style="padding: 20px 0;"> <!-- ÂéªÊéâÂÜÖËæπË∑ùÔºåÈù†Âç°ÁâáËá™ÂÆöÂÆΩÂ∫¶ -->
        <!-- Á¨¨‰∏ÄÈÉ®ÂàÜÔºöÂ§¥ÂÉèÂíåÂêçÂ≠óÂç°Áâá -->
        <div class="wc-me-header">
            <div class="wc-avatar lg">
                <img id="cp-avatar" src="">
            </div>
            <div class="wc-me-info">
                <div class="wc-me-name" id="cp-name"></div>
                <div class="wc-me-id" id="cp-realname"></div>
            </div>
        </div>

        <!-- Á¨¨‰∫åÈÉ®ÂàÜÔºö‰∫∫ËÆæÁÆÄ‰ªãÂç°ÁâáÔºàÊú¨È°µÁõ¥Êé•ÂèØÁºñËæëÔºâ -->
<div class="wc-menu-group">
    <div class="wc-menu-item" style="border-bottom:none; padding-bottom:5px;">
        <i class="fas fa-id-card menu-icon"></i>
        <span>‰∫∫ËÆæÁÆÄ‰ªã</span>
    </div>

    <!-- ËøôÈáåÊîπÊàê‰∏Ä‰∏™ÂèØÁºñËæëÁöÑÊ°Ü -->
    <div style="padding: 0 20px 15px;">
        <textarea id="cp-persona-input"
                  class="cp-persona-box"
                  placeholder="Áõ¥Êé•Âú®ËøôÈáåÁºñËæëËøô‰∏™Â•ΩÂèãÁöÑ‰∫∫ËÆæ‚Ä¶"></textarea>
    </div>

    <div style="padding: 0 20px 20px;">
        <!-- ÁÇπÂáªÂè™Âú®ÂΩìÂâçËµÑÊñôÈ°µ‰øùÂ≠ò‰∫∫ËÆæÔºå‰∏çË∑≥È°µ -->
        <button class="btn-secondary"
                style="width:100%; border-radius: 12px; height: 38px; background: #f9f9f9;"
                onclick="savePersonaFromProfile()">
            <i class="fas fa-save"></i> ‰øùÂ≠ò‰∫∫ËÆæ
        </button>
    </div>
</div>
        <!-- Á¨¨‰∏âÈÉ®ÂàÜÔºöÊúãÂèãÂúàÂÖ•Âè£ÔºàÂéªÊéâÂõæÁâáÔºåÂèòÊàêÁ∫ØÊñáÂ≠óÊù°ÁõÆÔºâ -->
        <div class="wc-menu-group" id="cp-moment-preview" onclick="openContactMoments()" style="cursor:pointer;">
            <div class="wc-menu-item">
                <i class="fas fa-compass menu-icon"></i>
                <span>ÊúãÂèãÂúà</span>
                <div id="cp-moment-text" style="font-size: 12px; color: #999; margin-right: 10px;">ÁÇπÂáªÊü•Áúã</div>
                <i class="fas fa-chevron-right arrow" style="font-size:10px; color:#ccc"></i>
            </div>
        </div>

        <!-- Â∫ïÈÉ®ÊåâÈíÆÂå∫ÂüüÔºöÂéöÂ∫¶‰∏ÄËá¥ -->
        <div style="margin-top:30px; padding: 0 24px; display:flex; flex-direction:column; gap:12px;">
            <button class="btn-save profile-main-btn" onclick="contactProfileSendMsg()">ÂèëÊ∂àÊÅØ</button>
            
            <div style="display: flex; gap: 10px;">
                <button class="btn-cancel profile-main-btn" 
                        style="background:#f5f5f5; color:#555; flex: 1;" 
                        onclick="blockFriendFromProfile()">ÊãâÈªë</button>
                <button class="btn-cancel profile-main-btn" 
                        style="background:#ffecec; color:#e53935; flex: 1;" 
                        onclick="deleteFriendFromProfile()">Âà†Èô§Â•ΩÂèã</button>
            </div>
        </div>
    </div>
</div>

<!-- [ÁîµÂ≠êÂÆ†Áâ© APP 2.0] -->
<div class="app-fullscreen-view" id="petApp" style="background:#fff;">
    
    <!-- È°∂ÈÉ® -->
    <div class="wc-header" style="background:transparent; height:60px; padding-top:20px; position:absolute; z-index:50; width:100%;">
        <i class="fas fa-arrow-left" onclick="closePetApp()" style="cursor:pointer; font-size:20px; color:#333; margin-left:20px;"></i>
        <div style="flex:1;"></div>
        <!-- ËÆæÁΩÆÂÖ•Âè£ -->
        <i class="fas fa-sliders-h" onclick="openPetSettings()" style="cursor:pointer; font-size:20px; color:#333; margin-right:20px;" title="ËÆæÁΩÆ/Ë£ÖÊâÆ"></i>
    </div>

    <!-- ËàûÂè∞ -->
    <div id="pet-room-stage" class="pet-room-stage">
        <div class="pet-window"></div> <!-- Á™óÊà∑ -->
        <div id="pet-floor-layer" class="pet-floor"></div>
        
        <!-- ÂÆ†Áâ© -->
        <div id="pet-entity" class="pet-entity">
            <!-- Ê∞îÊ≥° -->
            <div class="pet-bubble-pretty" id="pet-bubble">...</div>
            <!-- ÂõæÁâáÂÆπÂô® -->
            <div class="pet-img-wrapper" id="pet-img-wrap">
                <img id="pet-img" src="">
            </div>
            <!-- ÊóÖË°åÊó∂ÁöÑËÉåÂåÖ (ÈöêËóè) -->
            <i class="fas fa-shopping-bag" id="pet-backpack" style="position:absolute; bottom:5px; right:-10px; font-size:20px; color:#333; display:none;"></i>
        </div>
        
        <!-- ÂÆ∂ÂÖ∑Â±Ç -->
        <div id="furniture-layer"></div>
    </div>

    <!-- Â∫ïÈÉ®Èù¢Êùø -->
    <div class="pet-ui-container">
        <!-- Áä∂ÊÄÅÊù° -->
                <!-- Áä∂ÊÄÅÊù° -->
        <div class="pet-stats-bar" style="flex-wrap: wrap; gap: 8px;">
            <div class="pet-stat" style="color:#555;">Èò∂ÊÆµ <span id="pet-stat-stage" style="color:#333; font-weight:800;">ÂπºÂπ¥</span></div>
            <div class="pet-stat" style="color:#555;">ÊàêÈïø <span id="pet-stat-exp" style="color:#07c160;">0</span></div>
            <div class="pet-stat" style="color:#555;">È•±È£ü <span id="pet-stat-hunger" style="color:#ff4d4f;">80%</span></div>
            <div class="pet-stat" style="color:#555;">ÂøÉÊÉÖ <span id="pet-stat-mood" style="color:#ff7e67;">100%</span></div>
            <div class="pet-stat" style="color:#555;">ÊòüÂ∞ò <span id="pet-stat-money" style="color:#f59e0b;">200</span></div>
            <div class="pet-stat"><button id="pet-daily-btn" onclick="petDailyCheckIn()" style="background:#111; color:#fff; border:none; padding:4px 8px; border-radius:10px; font-size:10px; cursor:pointer;">Á≠æÂà∞</button></div>
        </div>


        <!-- ÊåâÈíÆÁΩëÊ†º -->
        <div class="pet-actions-grid">
            <div class="pet-action-btn" onclick="petFeed()">
                <div class="pet-btn-icon"><i class="fas fa-cookie-bite"></i></div>
                <span class="pet-btn-label">ÊäïÂñÇ</span>
            </div>
            <div class="pet-action-btn" onclick="petPlay()">
                <div class="pet-btn-icon"><i class="fas fa-gamepad"></i></div>
                <span class="pet-btn-label">Áé©ËÄç</span>
            </div>
            <!-- Âéü„ÄêËÅäÂ§©„ÄëÊîπ‰∏∫„ÄêÊúãÂèãÂúà„Äë -->
            <div class="pet-action-btn" onclick="openPetMoments()">
                <div class="pet-btn-icon"><i class="fas fa-camera-retro"></i></div>
                <span class="pet-btn-label">ÊúãÂèãÂúà</span>
            </div>
            <div class="pet-action-btn" onclick="petClean()">
                <div class="pet-btn-icon"><i class="fas fa-broom"></i></div>
                <span class="pet-btn-label">ÊâìÊâ´</span>
            </div>
            <div class="pet-action-btn" onclick="petOpenShop()">
                <div class="pet-btn-icon"><i class="fas fa-store"></i></div>
                <span class="pet-btn-label">ÂïÜÂ∫ó</span>
            </div>
            <div class="pet-action-btn" onclick="petTravel()">
                <div class="pet-btn-icon"><i class="fas fa-plane-departure"></i></div>
                <span class="pet-btn-label">ÊóÖË°å</span>
            </div>
            <div class="pet-action-btn" onclick="openPetAlbum()">
                <div class="pet-btn-icon"><i class="far fa-images"></i></div>
                <span class="pet-btn-label">Áõ∏ÂÜå</span>
            </div>
        </div>
    </div>

    <!-- === [Êñ∞Â¢û] ÂÆ†Áâ©ÊúãÂèãÂúàËßÜÂõæ (Ë¶ÜÁõñÂú®‰∏äÊñπ) === -->
    <div id="pet-moments-view" class="pet-moments-view">
        <div class="wc-header" style="background:#fff; border-bottom:1px solid #f0f0f0;">
            <i class="fas fa-chevron-down" onclick="closePetMoments()" style="cursor:pointer; color:#333;"></i>
            <span style="font-weight:700; color:#333;">ÂÆ†Áâ©ÂøÉÂ£∞</span>
            <!-- Ëß¶ÂèëÁîüÊàêÊåâÈíÆ -->
            <i class="fas fa-magic" onclick="generatePetMoment()" style="cursor:pointer; color:#ff7e67;" title="ÁîüÊàêÊñ∞Âä®ÊÄÅ"></i>
        </div>
        <div class="wc-body-container" id="pet-moments-list" style="padding:0; overflow-y:auto; background:#f9f9f9;">
            <!-- JS Â°´ÂÖÖ -->
        </div>
    </div>

        <!-- === [Êñ∞Â¢û] È¢ÜÂÖª/ÂàùÂßãÂåñÂºπÁ™ó === -->
    <div id="pet-adoption-modal" class="modal-overlay" style="z-index:2000;">

        <div class="modal-box" style="width:320px;">
            <div class="modal-header">
                <span>È¢ÜÂÖª‰∏≠ÂøÉ</span>
                <!-- Êñ∞Â¢ûÔºöÈÄÄÂá∫È¢ÜÂÖªÁöÑÊåâÈíÆ -->
                <i class="fas fa-times" onclick="cancelAdoption()" style="cursor:pointer; color:#999;"></i>
            </div>
            <div class="modal-body">
                <!-- Ê≠•È™§1: ÂÖ≥Á≥ªÁªëÂÆö -->
                <div id="adopt-step-1" class="pet-setup-step active">
                    <div style="text-align:center; margin-bottom:15px; font-size:12px; color:#666;">
                        Âú®È¢ÜÂÖªÂâçÔºåËØ∑ÂëäËØâÊàë‰ª¨Ëøô‰∏™ÂÆ∂ÁöÑÊÉÖÂÜµ...
                    </div>
                    <div class="form-group">
                        <label>ÊàëÊòØË∞Å (ÂΩìÂâç‰∫∫ËÆæ)</label>
                        <input type="text" id="adopt-owner-name" placeholder="‰æãÂ¶Ç: Â¶àÂ¶à / ‰∏ª‰∫∫ / ÂßêÂßê" readonly style="background:#f0f0f0;">
                    </div>
                    <div class="form-group">
                        <label>ÂÆ∂‰∏≠Âè¶‰∏Ä‰∏™ÈáçË¶ÅÁöÑ‰∫∫ (AI)</label>
                        <select id="adopt-target-ai" style="width:100%; height:40px; border-radius:8px; border:1px solid #ddd;"></select>
                        <div class="form-text">ÂÆ†Áâ©ÂèëÊúãÂèãÂúàÊó∂‰ºöÁªèÂ∏∏ÊèêÂà∞ TA Âì¶</div>
                    </div>
                    <button class="btn-confirm" onclick="switchAdoptStep(2)" style="width:100%; margin-top:10px;">‰∏ã‰∏ÄÊ≠•</button>
                </div>

                <!-- Ê≠•È™§2: ÂÆ†Áâ©Ê°£Ê°à -->
                <div id="adopt-step-2" class="pet-setup-step">
                    <div class="form-group">
                        <label>ÂÆ†Áâ©ÂêçÂ≠ó</label>
                        <input type="text" id="adopt-pet-name" placeholder="‰æãÂ¶Ç: ÁÖ§ÁêÉ">
                    </div>
                    
                    <!-- Êñ∞Â¢ûÔºöËá™ÂÆö‰πâÁâ©Áßç -->
                    <div class="form-group">
                        <label>Áâ©Áßç/Á±ªÂûã</label>
                        <div style="display:flex; gap:10px;">
                            <select id="adopt-pet-type" style="flex:1; height:40px; border-radius:8px; border:1px solid #ddd;" onchange="toggleCustomInput('type')">
                                <option value="Â∞èÁãó">Â∞èÁãó (Dog)</option>
                                <option value="Â∞èÁå´">Â∞èÁå´ (Cat)</option>
                                <option value="ÂÖîÂ≠ê">ÂÖîÂ≠ê (Bunny)</option>
                                <option value="Â§ñÊòüÁîüÁâ©">Â§ñÊòüÁîüÁâ© (Alien)</option>
                                <option value="custom" style="color:#07c160; font-weight:bold;">Ëá™ÂÆö‰πâÁ±ªÂûã...</option>
                            </select>
                        </div>
                        <input type="text" id="adopt-pet-type-custom" placeholder="ËæìÂÖ•Ëá™ÂÆö‰πâÁâ©Áßç..." style="display:none; width:100%; margin-top:10px;">
                    </div>

                    <!-- Êñ∞Â¢ûÔºöËá™ÂÆö‰πâÊÄßÊ†º -->
                    <div class="form-group">
                        <label>ÊÄßÊ†º (ÂÜ≥ÂÆöÊúãÂèãÂúàÊñáÈ£é)</label>
                        <div style="display:flex; gap:10px;">
                            <select id="adopt-pet-personality" style="flex:1; height:40px; border-radius:8px; border:1px solid #ddd;" onchange="toggleCustomInput('personality')">
                                <option value="ÂÇ≤Â®á">ÂÇ≤Â®á (Tsundere)</option>
                                <option value="Á≤ò‰∫∫">Á≤ò‰∫∫ (Clingy)</option>
                                <option value="ÊÜ®ÊÜ®">ÊÜ®ÊÜ® (Silly)</option>
                                <option value="È´òÂÜ∑">È´òÂÜ∑ (Cool)</option>
                                <option value="custom" style="color:#07c160; font-weight:bold;">Ëá™ÂÆö‰πâÊÄßÊ†º...</option>
                            </select>
                        </div>
                        <input type="text" id="adopt-pet-personality-custom" placeholder="ËæìÂÖ•Ëá™ÂÆö‰πâÊÄßÊ†º..." style="display:none; width:100%; margin-top:10px;">
                    </div>
                    
                    <div style="display:flex; gap:10px; margin-top:15px;">
                        <button class="btn-cancel" onclick="switchAdoptStep(1)">‰∏ä‰∏ÄÊ≠•</button>
                        <button class="btn-confirm" onclick="confirmAdoption()">ÂÆåÊàêÈ¢ÜÂÖª</button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- === [‰øÆÊîπ] ÂçáÁ∫ßÁâàËÆæÁΩÆÂºπÁ™ó (ÂåÖÂê´‰∏â‰∏™Èò∂ÊÆµÂõæÁâá) === -->
    <div id="pet-settings-modal" class="modal-overlay" style="z-index:2000;">
        <div class="modal-box" style="width:340px; max-height:85vh; display:flex; flex-direction:column;">
            <div class="modal-header">
                <span>ÂÆ†Áâ©ËÆæÁΩÆ</span>
                <i class="fas fa-times" onclick="document.getElementById('pet-settings-modal').classList.remove('active')"></i>
            </div>
            
            <div class="modal-body" style="padding:15px; overflow-y:auto; flex:1;">
                <div class="pet-settings-tabs">
                    <div class="pet-setting-tab active" onclick="switchPetSettingTab('appearance')">Â§ñËßÇÊàêÈïø</div>
                    <div class="pet-setting-tab" onclick="switchPetSettingTab('room')">ÊàøÈó¥Ë£ÖÊΩ¢</div>
                </div>

                <!-- Tab 1: Â§ñËßÇÊàêÈïø -->
                <div id="pset-tab-appearance">
                    <div style="font-size:11px; color:#999; margin-bottom:10px;">ËÆæÁΩÆ‰∏â‰∏™ÊàêÈïøÈò∂ÊÆµÁöÑÊ†∑Â≠ê (ÂõæÁâáURLÊàñ‰∏ä‰º†)</div>
                    
                    <!-- Èò∂ÊÆµ1 -->
                    <div class="pet-stage-box">
                        <img src="" id="prev-stage-1" class="pet-stage-img">
                        <div class="pet-stage-info">
                            <div class="pet-stage-title">Èò∂ÊÆµ‰∏ÄÔºöÂπºÂπ¥Êúü</div>
                            <div class="pet-stage-desc">0 - 100 ÊàêÈïøÂÄº</div>
                            <button class="btn-secondary" onclick="triggerPetImgUpload(1)" style="padding:2px 8px; font-size:10px; height:24px; margin-top:5px;">Êõ¥Êç¢ÂõæÁâá</button>
                        </div>
                    </div>
                    <!-- Èò∂ÊÆµ2 -->
                    <div class="pet-stage-box">
                        <img src="" id="prev-stage-2" class="pet-stage-img">
                        <div class="pet-stage-info">
                            <div class="pet-stage-title">Èò∂ÊÆµ‰∫åÔºöÊàêÈïøÊúü</div>
                            <div class="pet-stage-desc">101 - 300 ÊàêÈïøÂÄº</div>
                            <button class="btn-secondary" onclick="triggerPetImgUpload(2)" style="padding:2px 8px; font-size:10px; height:24px; margin-top:5px;">Êõ¥Êç¢ÂõæÁâá</button>
                        </div>
                    </div>
                    <!-- Èò∂ÊÆµ3 -->
                    <div class="pet-stage-box">
                        <img src="" id="prev-stage-3" class="pet-stage-img">
                        <div class="pet-stage-info">
                            <div class="pet-stage-title">Èò∂ÊÆµ‰∏âÔºöÂÆåÂÖ®‰Ωì</div>
                            <div class="pet-stage-desc">300+ ÊàêÈïøÂÄº</div>
                            <button class="btn-secondary" onclick="triggerPetImgUpload(3)" style="padding:2px 8px; font-size:10px; height:24px; margin-top:5px;">Êõ¥Êç¢ÂõæÁâá</button>
                        </div>
                    </div>
                    
                    <input type="file" id="pet-stage-file" accept="image/*" style="display:none;" onchange="handlePetStageUpload(this)">
                </div>

                <!-- Tab 2: ÊàøÈó¥Ë£ÖÊΩ¢ -->
                <div id="pset-tab-room" style="display:none;">
                    <!-- Á™óÊà∑ËÆæÁΩÆ -->
                    <div class="settings-section-title" style="margin-top:0;">Á™óÊà∑ËÆæËÆ°</div>
                    <div class="form-group">
                        <label>Á™óÊ°ÜÈ¢úËâ≤</label>
                        <div style="display:flex; gap:5px;">
                            <div class="color-circle-picker" style="background:#333;" onclick="setWindowFrame('#333')"></div>
                            <div class="color-circle-picker" style="background:#fff;" onclick="setWindowFrame('#fff')"></div>
                            <div class="color-circle-picker" style="background:#8b4513;" onclick="setWindowFrame('#8b4513')"></div>
                            <div class="color-circle-picker" style="background:#ff7e67;" onclick="setWindowFrame('#ff7e67')"></div>
                            <input type="color" onchange="setWindowFrame(this.value)" style="width:24px; height:24px; border:none; padding:0; background:none;">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Á™óÊà∑ÁéªÁíÉ/È£éÊôØÈ¢úËâ≤</label>
                        <input type="color" id="win-bg-color" onchange="setWindowBg(this.value)" style="width:100%; height:30px;">
                    </div>
                    <div class="form-group">
                        <label>Á™óÂ§ñÈ£éÊôØÂõæ</label>
                        <input type="file" accept="image/*" onchange="handlePetSettingImage(this, 'window')">
                    </div>

                    <!-- Â¢ôÂ£ÅÂú∞Êùø (Â§çÁî®‰πãÂâçÁöÑ) -->
                    <div class="settings-section-title">Â¢ôÂ£Å & Âú∞Êùø</div>
                    <div class="form-group">
                        <label>Â¢ôÁ∫∏ÂõæÁâá</label>
                        <input type="file" accept="image/*" onchange="handlePetSettingImage(this, 'wall')">
                    </div>
                    <div class="form-group">
                        <label>Âú∞ÊùøÂõæÁâá</label>
                        <input type="file" accept="image/*" onchange="handlePetSettingImage(this, 'floor')">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ÂïÜÂ∫óÂºπÁ™ó (‰øùÊåÅÂéüÊ†∑) -->
   <div id="pet-shop-modal" class="modal-overlay" style="z-index:2000;">
        <div class="modal-box" style="width:320px; background:#fff; border-radius:20px;">
            <div class="modal-header">
                <span style="font-weight:700;">ÊùÇË¥ßÈì∫</span>
                <i class="fas fa-times" onclick="closePetShop()"></i>
            </div>
            <div class="modal-body" style="padding:15px;">
               <div class="shop-tabs">
    <div class="shop-tab active" onclick="switchShopTab('goods')" id="tab-btn-goods">Âá∫Ë°åÁî®ÂìÅ</div>
    <div class="shop-tab" onclick="switchShopTab('furniture')" id="tab-btn-furniture">ÂÆ∂ÂÖ∑</div>
    <div class="shop-tab" onclick="switchShopTab('toy')" id="tab-btn-toy">Áé©ÂÖ∑</div>
</div>

                <div id="pet-shop-list"></div>
            </div>
        </div>
    </div>

    <!-- Áõ∏ÂÜåÂºπÁ™ó (‰øùÊåÅÂéüÊ†∑) -->
    <div id="pet-album-modal" class="modal-overlay" style="z-index:2000;">

        <div class="modal-box" style="width:340px; background:#f7f7f7;">
            <div class="modal-header">
                <span>ÊóÖË°åÂõûÂøÜ (Memories)</span>
                <i class="fas fa-times" onclick="document.getElementById('pet-album-modal').classList.remove('active')"></i>
            </div>
            <div class="modal-body" style="padding:10px;">
                <div id="album-grid" class="album-grid"></div>
            </div>
        </div>
    </div>

    <!-- ÈÄöÁî®ÂèØÁà±ÂØπËØùÊ°Ü -->
    <div id="pet-custom-dialog" class="pet-dialog-overlay">
        <div class="pet-dialog-box">
            <div id="pet-dialog-icon" style="font-size:40px; margin-bottom:10px;">‚ú®</div>
            <div id="pet-dialog-content" class="pet-dialog-content">...</div>
            <button class="pet-dialog-btn" onclick="closePetDialog()">Áü•ÈÅìÂï¶</button>
        </div>
    </div>

</div>

<!-- ============================================== -->
<!-- [Êñ∞Â¢û] ‰∏ñÁïå‰π¶ÁÆ°ÁêÜÂ∫îÁî® (WorldBook App) -->
<!-- ============================================== -->
<div class="app-fullscreen-view" id="worldBookApp">
    
    <!-- È°∂ÈÉ®Ê†áÈ¢òÊ†è -->
    <div class="wc-header" style="background: rgba(255,255,255,0.95);">
        <span id="wb-header-title" onclick="closeWorldBookApp()" style="cursor: pointer;">
            <i class="fas fa-chevron-down" style="font-size: 18px; margin-right: 10px;"></i> WorldBook
        </span>
        <div class="wc-header-icons">
            <!-- ÂØºÂÖ•ÊåâÈíÆ -->
            <i class="fas fa-file-import" onclick="triggerWorldBookImport()" title="ÂØºÂÖ• (JSON/TXT)"></i>
            <!-- Êñ∞Âª∫ÊåâÈíÆ -->
            <i class="fas fa-plus" onclick="createNewWorldBook()" title="Êñ∞Âª∫‰∏ñÁïå‰π¶"></i>
        </div>
        <!-- ÈöêËóèÁöÑÊñá‰ª∂ËæìÂÖ•Ê°Ü -->
        <input type="file" id="wb-import-input" accept=".json,.txt,.docx" style="display: none;" onchange="handleWorldBookImport(this)">
    </div>

    <!-- ‰∏ªÂÜÖÂÆπÂå∫ -->
    <div class="wc-body-container" style="padding: 20px;">
        
        <!-- 1. ‰π¶Êû∂ÂàóË°®ËßÜÂõæ -->
        <div id="wb-shelf-view">
            <div class="wb-search-bar">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="Search Lorebooks..." oninput="filterWorldBooks(this.value)">
            </div>
            <div id="wb-list-container" class="wb-grid">
                <!-- JS Âä®ÊÄÅÁîüÊàê‰π¶Á±çÂç°Áâá -->
            </div>
        </div>

        <!-- 2. ‰π¶Á±çËØ¶ÊÉÖ/ÁºñËæëËßÜÂõæ (ÈªòËÆ§ÈöêËóè) -->
        <div id="wb-detail-view" style="display: none;">
            <!-- ‰π¶Á±çÂÖÉÊï∞ÊçÆË°®Âçï -->
            <div class="wb-edit-card">
                <div class="wb-form-row">
                    <div class="wb-input-group" style="flex: 2;">
                        <label>‰π¶Âêç (Title)</label>
                        <input type="text" id="wb-edit-title">
                    </div>
                    <div class="wb-input-group" style="flex: 1;">
                        <label>ÂàÜÁ±ª (Tag)</label>
                        <input type="text" id="wb-edit-category" placeholder="General">
                    </div>
                </div>
                
                <div class="wb-form-row">
                    <div class="wb-toggle-group">
                        <label>ÂÖ®Â±ÄÂêØÁî® (Global)</label>
                        <label class="switch">
                            <input type="checkbox" id="wb-edit-global">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="wb-input-group" style="flex: 1;">
                        <label>Ê≥®ÂÖ•Á≠ñÁï• (Strategy)</label>
                        <select id="wb-edit-strategy">
                            <option value="depth">Ê∑±Â∫¶Ê≥®ÂÖ• (Depth)</option>
                            <option value="top">È°∂ÈÉ® (Top)</option>
                            <option value="bottom">Â∫ïÈÉ® (Bottom)</option>
                        </select>
                    </div>
                </div>

                <div class="wb-action-bar">
                    <button class="btn-secondary" onclick="exportCurrentWorldBook()"><i class="fas fa-download"></i> ÂØºÂá∫JSON</button>
                    <button class="btn-secondary" style="color: #ff4d4f; border-color: #ff4d4f;" onclick="deleteCurrentWorldBook()"><i class="fas fa-trash"></i> Âà†Èô§Ê≠§‰π¶</button>
                </div>
            </div>

            <!-- Êù°ÁõÆÂàóË°®Âå∫Âüü -->
            <div class="wb-entries-header">
                <span>ÂÜÖÂÆπÊù°ÁõÆ (Entries)</span>
                <button class="btn-mini-add" onclick="addNewEntry()"><i class="fas fa-plus"></i></button>
            </div>
            
            <div id="wb-entries-list" class="wb-entries-container">
                <!-- JS Âä®ÊÄÅÁîüÊàêÊù°ÁõÆ -->
            </div>

            <button class="btn-save" onclick="saveCurrentWorldBook()" style="margin-top: 20px;">‰øùÂ≠òÊâÄÊúâÊõ¥Êîπ</button>
            <button class="btn-secondary" onclick="backToShelf()" style="margin-top: 10px;">ËøîÂõû‰π¶Êû∂</button>
        </div>

    </div>
</div>

<!-- === [Êñ∞Â¢û] Êù°ÁõÆÁºñËæëÂºπÁ™ó === -->
<div id="wb-entry-modal" class="modal-overlay">
    <div class="modal-box" style="width: 340px;">
        <div class="modal-header">
            <span>ÁºñËæëÊù°ÁõÆ</span>
            <i class="fas fa-times" onclick="closeEntryModal()"></i>
        </div>
        <div class="modal-body">
            <div class="input-group">
                <label>Ëß¶ÂèëÂÖ≥ÈîÆËØç (Keywords) <span style="color:#aaa; font-weight:400;">(ÈÄóÂè∑ÂàÜÈöî)</span></label>
                <input type="text" id="entry-keys" placeholder="‰æãÂ¶Ç: Â∏ùÂõΩ, ÁöáÂ∏ù, È¶ñÈÉΩ">
            </div>
            <div class="input-group">
                <label>ÂÜÖÂÆπ (Content) <span style="color:red">*</span></label>
                <textarea id="entry-content" rows="6" placeholder="ÂΩìÂÖ≥ÈîÆËØçÂá∫Áé∞Êó∂ÔºåAI‰ºöÁúãÂà∞ËøôÊÆµËÆæÂÆö..."></textarea>
            </div>
            <div class="input-group">
                <label>Â§áÊ≥® (Comment)</label>
                <input type="text" id="entry-comment" placeholder="‰ªÖÁî®‰∫éËá™Â∑±Áúã">
            </div>
            <div class="wb-form-row">
                 <div class="wb-toggle-group">
                    <label>ÂêØÁî® (Enabled)</label>
                    <label class="switch" style="transform: scale(0.8);">
                        <input type="checkbox" id="entry-enabled" checked>
                        <span class="slider round"></span>
                    </label>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-cancel" onclick="deleteCurrentEntry()" style="color:red;">Âà†Èô§</button>
            <button class="btn-confirm" onclick="saveEntryToMemory()">Á°ÆÂÆö</button>
        </div>
    </div>
</div>
<!-- === Èü©Á≥ªÈ´òÂÆöÈªëÁôΩÁõ¥Êí≠ APP === -->
<div class="app-fullscreen-view" id="liveApp">
    
    <!-- È°∂ÈÉ®ÂØºËà™ÔºöÈÄèÊòéËÉåÊôØÔºåÊûÅÁÆÄÊñáÂ≠ó -->
    <div class="k-header">
        <div class="k-header-left">
            <i class="fas fa-arrow-left" onclick="closeLiveApp()"></i>
        </div>
        <div class="k-tabs-top">
            <span class="active">Êé®Ëçê</span>
            <span>ÈôÑËøë</span>
        </div>
        <div class="k-header-right">
            <i class="fas fa-search"></i>
        </div>
    </div>

    <!-- ÂÜÖÂÆπÊªöÂä®Âå∫ -->
    <div class="k-body-container">
        
        <!-- Tab 1: È¶ñÈ°µÊé®Ëçê (ÊùÇÂøóÊéíÁâàÊµÅ) -->
        <div class="k-tab-content active" id="lv-tab-recommend">
            <!-- È°∂ÈÉ®Â§ßÂõæ Banner -->
            <div class="k-hero-banner">
    <div class="k-hero-tag">FEATURED</div>
    <div class="k-hero-title">Late Night<br>Talks.</div>
    <div class="k-hero-subtitle">‰∏ªÊí≠ÔºöHannah AI</div>
</div>
            
            <!-- ÁÄëÂ∏ÉÊµÅÂÜÖÂÆπ -->
            <div class="k-masonry-grid" id="lv-feed-container">
                <!-- JS Ëá™Âä®Â°´ÂÖÖ -->
            </div>
            
            <!-- Â∫ïÈÉ®ÁïôÁôΩÔºåÈò≤Ê≠¢Ë¢´ Dock ÈÅÆÊå° -->
            <div style="height: 100px;"></div>
        </div>

        <!-- Tab 2: ÊàëË¶ÅÂºÄÊí≠ (ÊûÅÁÆÄÈªëÁôΩÁïåÈù¢) -->
        <div class="k-tab-content" id="lv-tab-broadcast" style="display:none;">
            <div class="k-broadcast-wrap">
               <div class="k-cam-preview">
    <i class="fas fa-circle-notch fa-spin"></i>
    <p>INITIALIZING CAMERA...</p>
</div>
<div class="k-broadcast-ui">
    <!-- Ê≥®ÊÑèÔºöËøôÈáå placeholder ÊîπÊàê‰∫Ü‰∏≠Êñá -->
    <input type="text" class="k-live-input" placeholder="ËæìÂÖ•Áõ¥Êí≠Ê†áÈ¢ò...">
    <button class="k-start-btn">GO LIVE</button>
</div>

            </div>
        </div>

        <!-- Tab 3: ÁßÅ‰ø° (ÊûÅÁÆÄÂàóË°®) -->
        <div class="k-tab-content" id="lv-tab-messages" style="display:none;">
            <div class="k-page-title">INBOX.</div>
            <div class="k-msg-list" id="lv-msg-list">
                <!-- ÈùôÊÄÅÊ®°Êãü -->
                <div class="k-msg-item">
                    <div class="k-avatar-sq">H</div>
                    <div class="k-msg-text">
                        <div class="top"><span>Hannah AI</span> <span class="time">12:00</span></div>
                        <div class="btm">Are you ready for the stream?</div>
                    </div>
                </div>
            </div>
        </div>

               <!-- Tab 4: ‰∏™‰∫∫‰∏ªÈ°µ (ÊûÅÁÆÄÂ§ßÂõæÈ£é) -->
        <div class="k-tab-content" id="lv-tab-profile" style="display:none;">
            <div class="k-profile-cover">
                <img src="https://images.unsplash.com/photo-1534528741775-53994a69daeb?q=80&w=400&auto=format&fit=crop">
                <div class="k-profile-overlay">
                    <div class="k-p-name">USER.001</div>
                    <div class="k-p-bio">Digital Nomad / AI Streamer</div>
                </div>
            </div>
            
            <div class="k-stats-bar">
                <div><b>12.5k</b><span>Followers</span></div>
                <div><b>89</b><span>Following</span></div>
                <div><b>1.2M</b><span>Likes</span></div>
            </div>

            <!-- Êñ∞Â¢ûÔºöÂèëÂ∏ÉÊåâÈíÆ -->
            <div class="k-profile-actions">
                <button class="k-btn-publish" onclick="openLivePublishModal()">
                    <i class="fas fa-plus"></i> ÂèëÂ∏É‰ΩúÂìÅ (Post)
                </button>
            </div>

            <!-- Êñ∞Â¢ûÔºöÊàëÁöÑ‰ΩúÂìÅÂå∫Âüü -->
            <div class="k-section-header">ÊàëÁöÑ‰ΩúÂìÅ (Works)</div>
            <div class="k-archive-grid" id="k-my-works-grid">
                <!-- JS ‰ºöÂú®ËøôÈáåÊèíÂÖ•Êñ∞ÂèëÂ∏ÉÁöÑ‰ΩúÂìÅ -->
            </div>
            
            <!-- ÂéüÊúâÔºöÂæÄÊúüÂõûÊîæ (ÊîæÂú®‰ΩúÂìÅ‰∏ãÈù¢) -->
            <div class="k-section-header" style="margin-top:20px;">ÂæÄÊúüÂõûÊîæ (Replays)</div>
            <div class="k-archive-grid">
                <div class="k-archive-item" style="background:#eee;"></div>
                <div class="k-archive-item" style="background:#ddd;"></div>
                <div class="k-archive-item" style="background:#ccc;"></div>
            </div>
            
            <div style="height: 100px;"></div> <!-- Â∫ïÈÉ®Âû´È´ò -->
        </div>
            <!-- === Êñ∞Â¢ûÔºöÂèëÂ∏É‰ΩúÂìÅÂºπÁ™ó === -->
    <div class="k-full-modal" id="livePublishModal">
        <div class="k-modal-header">
            <i class="fas fa-times" onclick="closeLivePublishModal()" style="cursor:pointer; font-size:18px;"></i>
            <span>ÂèëÂ∏É‰ΩúÂìÅ</span>
            <span onclick="confirmPublishWork()" style="color:#2b2b2b; cursor:pointer;">ÂèëÂ∏É</span>
        </div>
        <div class="k-publish-body">
            <!-- ÂõæÁâá/ËßÜÈ¢ë‰∏ä‰º† -->
            <div class="k-upload-box" onclick="document.getElementById('live-file-input').click()">
                <img id="live-preview-img" style="display:none;">
                <i id="live-upload-icon" class="fas fa-camera"></i>
            </div>
            <input type="file" id="live-file-input" accept="image/*" style="display:none;" onchange="handleLiveFilePreview(this)">
            
            <!-- ÊñáÊ°à -->
            <div class="k-input-group">
                <textarea class="k-input-textarea" id="live-desc" rows="4" placeholder="ÂÜôÁÇπ‰ªÄ‰πà... (Add a caption)"></textarea>
            </div>

            <!-- Ê†áÁ≠æ -->
            <div class="k-input-group">
                <label>ÈÄâÊã©Ê†áÁ≠æ (Tags)</label>
                <select id="live-tag" class="k-tag-select">
                    <option value="#Daily">#Êó•Â∏∏ (Daily)</option>
                    <option value="#OOTD">#Á©øÊê≠ (OOTD)</option>
                    <option value="#Food">#ÁæéÈ£ü (Food)</option>
                    <option value="#Travel">#ÊóÖË°å (Travel)</option>
                </select>
            </div>

            <!-- Ë∞ÅÂèØ‰ª•Áúã -->
            <div class="k-input-group">
                <label>Ë∞ÅÂèØ‰ª•Áúã (Visibility)</label>
                <select id="live-visibility" class="k-visibility-select">
                    <option value="public">ÂÖ¨ÂºÄ (Public)</option>
                    <option value="friends">‰ªÖÂ•ΩÂèã (Friends)</option>
                    <option value="private">ÁßÅÂØÜ (Private)</option>
                </select>
            </div>
        </div>
    </div>

    <!-- === Êñ∞Â¢ûÔºö‰ΩúÂìÅËØ¶ÊÉÖÂºπÁ™ó (‰ªøÊäñÈü≥) === -->
    <div class="k-full-modal" id="liveWorkDetailModal" style="background:#000;">
        <!-- È°∂ÈÉ®ÈÄèÊòéÂØºËà™ -->
        <div style="position:absolute; top:40px; left:20px; z-index:10; color:#fff;">
            <i class="fas fa-chevron-left" onclick="closeWorkDetailModal()" style="font-size:24px; cursor:pointer; text-shadow:0 1px 3px rgba(0,0,0,0.5);"></i>
        </div>

        <div class="k-detail-media">
            <img id="work-detail-img" src="">
            
            <!-- ‰æßËæπ‰∫íÂä®Ê†è -->
            <div class="k-interaction-sidebar">
                <div class="k-action-btn">
                    <div class="k-avatar-sq" style="width:40px; height:40px; border-radius:50%; border:2px solid #fff; margin-bottom:10px;">
                        <img src="https://images.unsplash.com/photo-1534528741775-53994a69daeb?q=80&w=100&auto=format&fit=crop" style="width:100%; height:100%; border-radius:50%;">
                    </div>
                </div>
                <div class="k-action-btn">
                    <div class="k-action-icon"><i class="fas fa-heart"></i></div>
                    <span class="k-action-num" id="work-detail-likes">0</span>
                </div>
                <div class="k-action-btn">
                    <div class="k-action-icon"><i class="fas fa-comment-dots"></i></div>
                    <span class="k-action-num" id="work-detail-comments">0</span>
                </div>
                <div class="k-action-btn">
                    <div class="k-action-icon"><i class="fas fa-share"></i></div>
                    <span class="k-action-num" id="work-detail-shares">0</span>
                </div>
            </div>

            <!-- Â∫ïÈÉ®‰ø°ÊÅØ -->
            <div class="k-detail-overlay">
                <div class="k-detail-title">@USER.001</div>
                <div class="k-detail-tags" id="work-detail-desc"></div>
                <div style="font-size:12px; opacity:0.8;">
                    <i class="fas fa-music"></i> ÂéüÂ£∞ - USER.001 ÁöÑÂàõ‰Ωú
                </div>
            </div>
        </div>
    </div>



    </div>

    <!-- Â∫ïÈÉ® Dock (ÈªëËâ≤ÊÇ¨ÊµÆËÉ∂Âõä) -->
    <div class="k-dock-wrapper">
        <div class="k-dock">
            <div class="k-dock-item active" onclick="switchLiveTab('recommend', this)">
                <i class="fas fa-compass"></i>
            </div>
            <div class="k-dock-item" onclick="switchLiveTab('broadcast', this)">
                <!-- ‰∏≠Èó¥ÁöÑÂºÄÊí≠ÊåâÈíÆÊòØ‰∏™ÂÆûÂøÉÂúÜ -->
                <div class="k-btn-center"><i class="fas fa-plus"></i></div>
            </div>
            <div class="k-dock-item" onclick="switchLiveTab('messages', this)">
                <i class="far fa-comment-dots"></i> <!-- Á©∫ÂøÉÂõæÊ†áÊõ¥È´òÁ∫ß -->
            </div>
            <div class="k-dock-item" onclick="switchLiveTab('profile', this)">
                   <i class="far fa-user"></i>
            </div>
        </div>
    </div>
    
    </div> 
        <!-- ============================================== -->
    <!-- [Êñ∞Â¢û] Bubble App (Èü©Á≥ªÈªëÁôΩÂèåÊ®°ÂºèÁâà) -->
    <!-- ============================================== -->
    <div class="app-fullscreen-view" id="bubbleApp">
        
        <!-- 1. Ê®°ÂºèÈÄâÊã©È°µ (ÂêØÂä®ÁîªÈù¢) -->
        <div id="bb-landing-view" class="bb-landing">
            <div class="bb-logo">bubble</div>
            <div class="bb-subtitle">CONNECT WITH YOUR ARTIST</div>
            
            <div class="bb-mode-select">
                <div class="bb-mode-card" onclick="enterBubbleMode('idol')">
                    <div class="bb-mode-icon"><i class="fas fa-microphone-alt"></i></div>
                    <div class="bb-mode-title">ÊàëÊòØÁà±Ë±Ü (ARTIST)</div>
                    <div class="bb-mode-desc">ÂèëÂ∏ÉÂä®ÊÄÅ ‚Ä¢ Êü•ÁúãÂõûÂ§ç</div>
                </div>
                <div class="bb-mode-card" onclick="enterBubbleMode('fan')">
                    <div class="bb-mode-icon"><i class="fas fa-heart"></i></div>
                    <div class="bb-mode-title">ÊàëÊòØÁ≤â‰∏ù (FAN)</div>
                    <div class="bb-mode-desc">Êé•Êî∂Ê∂àÊÅØ ‚Ä¢ Á∫™ÂøµÊó• 365Â§©</div>
                </div>
            </div>
            <div class="bb-close-btn" onclick="closeBubbleApp()">CLOSE APP</div>
        </div>

                <!-- 2. === Ê®°Âºè A: Áà±Ë±ÜÂπøÊí≠Á´Ø === -->
        <div id="bb-idol-view" class="bb-view" style="display:none; position:relative;">
            <div class="bb-header">
                <i class="fas fa-chevron-left" onclick="exitBubbleMode()"></i>
                <span>ARTIST DASHBOARD</span>
                <!-- ÁÇπÂáªÂè≥‰æßÂõæÊ†á‰πüÂèØ‰ª•ÊâìÂºÄËØÑËÆ∫ÂàóË°® -->
                <i class="fas fa-list-ul" onclick="openBubbleComments()" style="cursor:pointer;"></i>
            </div>
            
            <div class="bb-idol-content">
                <!-- Á≤â‰∏ùÂõûÂ§çÂÆûÊó∂ÊµÅ (ÁÇπÂáªÂèØÊâìÂºÄËØ¶ÊÉÖ) -->
                <div class="bb-reply-stream-box" onclick="openBubbleComments()" title="ÁÇπÂáªÊü•ÁúãÊâÄÊúâÂõûÂ§ç">
                    <div class="bb-section-title" style="display:flex; justify-content:space-between;">
                        <span>LIVE REPLIES</span>
                        <span style="font-size:9px; background:#333; color:#fff; padding:2px 6px; border-radius:4px;">CLICK TO VIEW</span>
                    </div>
                    <!-- ÊªöÂä®Â≠óÂπï -->
                    <div class="bb-reply-ticker" id="bb-reply-ticker">
                        <!-- JS Â°´ÂÖÖ -->
                    </div>
                </div>

                <!-- ÂèëÂ∏ÉÂå∫Âüü -->
                <div class="bb-compose-area">
                    <div class="bb-input-wrapper">
                        <textarea id="bb-idol-input" placeholder="To Fans: ÂàÜ‰∫´Ëøô‰∏ÄÂàªÁöÑÂøÉÊÉÖ... "></textarea>
                    </div>
                    <div class="bb-tools-row">
                        <div class="bb-tool-icon"><i class="far fa-image"></i></div>
                        <div class="bb-tool-icon"><i class="fas fa-microphone"></i></div>
                        <div class="bb-char-count" id="bb-idol-char-count">0/1000</div>
                    </div>
                    <button class="bb-send-btn" onclick="idolSendBroadcast()">SEND TO ALL</button>
                </div>

                <!-- ÂéÜÂè≤ÂèëÈÄÅËÆ∞ÂΩï -->
                <div class="bb-history-list">
                    <div class="bb-section-title">SENT HISTORY</div>
                    <div id="bb-sent-history"></div>
                </div>
            </div>

            <!-- [Êñ∞Â¢û] ËØÑËÆ∫ÂàóË°®ÂÖ®Â±èÂºπÁ™ó -->
            <div id="bb-comment-modal" class="bb-comment-modal">
                <div class="bb-comment-header">
                    <span>Replies (<span id="bb-total-replies">0</span>)</span>
                    <i class="fas fa-times" onclick="closeBubbleComments()" style="cursor:pointer; font-size:18px;"></i>
                </div>
                <div class="bb-comment-list" id="bb-comment-list-container">
                    <!-- JS Âä®ÊÄÅÂ°´ÂÖ•ËØÑËÆ∫ -->
                </div>
            </div>
        </div>


                <!-- 3. === Ê®°Âºè B: Á≤â‰∏ùËÅäÂ§©Á´Ø (ÊàëÊòØÁ≤â‰∏ùÔºåÁúãÁà±Ë±ÜÂèëÊ∂àÊÅØ) === -->
        <div id="bb-fan-view" class="bb-view" style="display:none; position:relative;">
            <!-- Â§¥ÈÉ® -->
            <div class="bb-header fan-mode">
                <i class="fas fa-chevron-left" onclick="exitBubbleMode()"></i>
                <div class="bb-header-info">
                    <!-- ËøôÈáåÂêçÂ≠ó‰ºöÂä®ÊÄÅÂèò -->
                    <span class="bb-artist-name" id="bb-active-idol-name">Artist</span> 
                    <span class="bb-days-counter">with you 365 days</span>
                </div>
                <!-- Ê®°ÊãüËß¶ÂèëÊåâÈíÆÔºöÁÇπÂáªËøôÈáåÂèØ‰ª•ËÆ©Áà±Ë±ÜÂèëÊñ∞Ê∂àÊÅØ (ÊµãËØïÁî®) -->
                <i class="fas fa-bell" onclick="triggerIdolBroadcast()" title="[ÊµãËØï] ËÆ©Áà±Ë±ÜÂèë‰∏ÄÊù°Ê∂àÊÅØ" style="color:#ff7e67;"></i>
            </div>

            <!-- È°∂ÈÉ®ÊªöÂä®Êù° (ÊòæÁ§∫Ë∑Ø‰∫∫ÂõûÂ§ç) -->
            <div class="bb-fan-ticker-box" onclick="openMobReplies()">
                <div class="bb-ticker-icon"><i class="far fa-comment-dots"></i></div>
                <div class="bb-ticker-content">
                    <span id="bb-ticker-text" class="bb-ticker-text-anim">Waiting for new post...</span>
                </div>
                <i class="fas fa-chevron-right" style="font-size:10px; color:#ccc; margin-left:10px;"></i>
            </div>

            <!-- ËÅäÂ§©‰∏ªÂå∫Âüü -->
            <div class="bb-chat-container" id="bb-chat-container">
                <!-- ËøôÈáåÁöÑÊ∂àÊÅØÁî± JS ÁîüÊàê -->
            </div>

            <!-- Â∫ïÈÉ®ÔºöÊàëÁöÑÂõûÂ§çÊ°Ü -->
            <div class="bb-input-area">
                <div class="bb-reply-limit">Reply to Artist (3/3)</div>
                <div class="bb-input-box">
                    <input type="text" id="bb-fan-input" placeholder="ÂõûÂ§çÁà±Ë±Ü..." maxlength="30">
                    <button onclick="fanSendReply()"><i class="fas fa-arrow-up"></i></button>
                </div>
            </div>

            <!-- Ë∑Ø‰∫∫ËØÑËÆ∫ÂàóË°®ÂÖ®Â±èÂºπÁ™ó -->
            <div id="bb-mob-modal" class="bb-mob-modal">
                <div class="bb-mob-header">
                    <span>Replies (<span id="bb-mob-count">0</span>)</span>
                    <i class="fas fa-times" onclick="closeMobReplies()" style="cursor:pointer;"></i>
                </div>
                <div class="bb-mob-list" id="bb-mob-list">
                    <!-- JS Â°´ÂÖÖ -->
                </div>
            </div>
        </div>


    </div>

</div>


    <script src="js/core.js"></script>
    <script src="js/apps.js"></script>

<div id="add-friend-modal" class="modal-overlay">
    <div class="modal-box">
        <div class="modal-header">
            <span>Ê∑ªÂä†Â•ΩÂèã</span>
            <!-- ÁÇπÂáª X ÂÖ≥Èó≠ -->
            <i class="fas fa-times" onclick="closeAddFriendModal()"></i>
        </div>
        <div class="modal-body">
            <div class="input-group">
                <label>ÁúüÂÆûÂßìÂêç <span style="color:red">*</span></label>
                <input type="text" id="af-realname" placeholder="ÂøÖÂ°´ÔºåÂ¶ÇÔºöÊûóËêß">
            </div>
            <div class="input-group">
                <label>Â§áÊ≥® (ÊòµÁß∞)</label>
                <input type="text" id="af-remark" placeholder="ËÅäÂ§©ÂàóË°®‰∏≠ÊòæÁ§∫ÁöÑÂêçÂ≠óÔºå‰∏çÂ°´ÂàôÊòæÁ§∫ÁúüÂêç">
            </div>
            <div class="input-group">
                <label>ËßíËâ≤‰∫∫ËÆæ (ÊúÄÈáçË¶ÅÁöÑÈÉ®ÂàÜ)</label>
                <textarea id="af-persona" rows="3" placeholder="AIÂ∞ÜÊâÆÊºîËøô‰∏™ËÆæÂÆö„ÄÇ‰æãÔºöÈ´òÂÜ∑Â≠¶Èú∏ÔºåËØ¥ËØùÁÆÄÁü≠Ôºå‰ªé‰∏çÂèëË°®ÊÉÖÂåÖ„ÄÇ"></textarea>
            </div>
            <div class="input-group">
                <label>ÂÖ≥ËÅî‰∏ñÁïå‰π¶</label>
                <input type="text" id="af-worldbook" placeholder="ËÉåÊôØËÆæÂÆöÔºåÂèØÈÄâ">
            </div>
            <div class="input-group">
                <label>ÂºÄÂú∫ÁôΩ</label>
                <textarea id="af-greeting" rows="2" placeholder="Ê∑ªÂä†ÂêéÔºåÂØπÊñπÂèëÁöÑÁ¨¨‰∏ÄÂè•ËØù"></textarea>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-cancel" onclick="closeAddFriendModal()">ÂèñÊ∂à</button>
            <button class="btn-confirm" onclick="confirmAddFriend()">ÂÆåÊàê</button>
        </div>
    </div>
</div>
<!-- === [Êñ∞Â¢û] ÂàõÂª∫Áæ§ËÅäÂºπÁ™ó === -->
<div id="create-group-modal" class="modal-overlay">
    <div class="modal-box">
        <div class="modal-header">
            <span>ÂèëËµ∑Áæ§ËÅä</span>
            <i class="fas fa-times" onclick="closeCreateGroupModal()"></i>
        </div>
        <div class="modal-body">
            <div class="input-group">
                <label>Áæ§ËÅäÂêçÁß∞</label>
                <input type="text" id="cg-groupname" placeholder="‰æãÂ¶ÇÔºöÂë®Êú´ÂºÄÈªëÁæ§">
            </div>
            <div class="input-group">
                <label>ÈÄâÊã©Áæ§ÊàêÂëò (‰ªéÂ∑≤Ê∑ªÂä†ÁöÑÂ•ΩÂèã‰∏≠ÈÄâ)</label>
                <!-- ËøôÈáåÂ∞ÜÁî± JS Âä®ÊÄÅÂ°´ÂÖÖÂ•ΩÂèãÂàóË°® -->
                <div id="cg-friend-list" class="friend-checklist">
                    <div style="text-align:center; color:#999; font-size:12px; padding:20px;">
                        ÊöÇÊó†Â•ΩÂèãÔºåËØ∑ÂÖàÂéªÊ∑ªÂä†Â•ΩÂèã
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-cancel" onclick="closeCreateGroupModal()">ÂèñÊ∂à</button>
            <button class="btn-confirm" onclick="confirmCreateGroup()">ÂàõÂª∫ (0)</button>
        </div>
    </div>
</div>
<!-- === [‰øÆÊîπÁâà] ËßíËâ≤ÂøÉÂ£∞Âç°Áâá (V6 - ÁÅ∞Ëâ≤Á≥ª + ÂΩìÂâçÂä®‰Ωú) === -->
<div id="mind-card-overlay" class="mind-overlay" onclick="toggleMindCard(event)">
    <div class="mind-card-box" onclick="event.stopPropagation()">
        
        <!-- 1. È°∂ÈÉ®ÔºöÂ§¥ÂÉè„ÄÅÂêçÂ≠ó„ÄÅÂ•ΩÊÑüÂ∫¶ -->
        <div class="mind-header-v5">
            <div class="mind-avatar-area">
                <img src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=200&auto=format&fit=crop" class="mind-big-avatar">
            </div>
            <div class="mind-header-info">
                <div class="mind-name">Hannah AI</div>
                <!-- Â•ΩÊÑüÂ∫¶ -->
                <div class="affection-bar-container">
                    <div class="affection-bar-label">
                        <span>Â•ΩÊÑüÂ∫¶</span>
                        <span id="affection-percent-text">75%</span>
                    </div>
                    <div class="affection-progress-bar">
                        <div id="affection-fill"></div>
                    </div>
                </div>
            </div>
            <!-- È¢úÊñáÂ≠ó (Áé∞Âú®ÊòØÁÅ∞Ëâ≤Â∫ï) -->
            <div class="mind-kaomoji" id="mind-kaomoji-display">(ÔΩ°‚Ä¢-‚Ä¢ÔΩ°)</div>
        </div>

                <!-- 2. ‰∏≠Èó¥ÔºöÁä∂ÊÄÅÁΩëÊ†º -->
        <div class="mind-status-tags">
            
            <!-- Á¨¨‰∏ÄÊéíÂ∑¶ËæπÔºöÂú∞ÁÇπ -->
            <div class="status-tag">
                <i class="fas fa-map-marker-alt"></i>
                <span>Loc:</span>
                <b id="mind-location-val">Âõæ‰π¶È¶Ü</b>
            </div>

            <!-- Á¨¨‰∏ÄÊéíÂè≥ËæπÔºöÂ§©Ê∞î -->
            <div class="status-tag">
                <i class="fas fa-cloud-sun"></i>
                <b id="mind-weather-val">Êô¥</b>
            </div>

            <!-- Á¨¨‰∫åÊéíÔºöÂä®‰Ωú (Âä†‰∫Ü full-row Ê†∑ÂºèÔºåËÆ©ÂÆÉÁã¨Âç†‰∏ÄË°å) -->
            <div class="status-tag full-row">
                <i class="fas fa-user-clock"></i>
                <span>Action:</span>
                <b id="mind-action-val">Ê≠£Âú®Êï¥ÁêÜ‰π¶Êû∂</b>
            </div>

            <!-- Á¨¨‰∏âÊéíÔºöBGM (Êú¨Êù•Â∞±ÊòØÁã¨Âç†‰∏ÄË°å) -->
            <div class="status-tag now-playing-tag">
                <i class="fas fa-music"></i>
                <div class="marquee-container">
                    <b id="now-playing-bgm">Lover - Taylor Swift</b>
                </div>
            </div>
        </div>

        
        <!-- 3. Â∫ïÈÉ®ÔºöÂèåÈáçÂøÉÂ£∞ (Â∞èÂøÉÊÄùÂèòÁÅ∞‰∫Ü) -->
        <div class="mind-thoughts-container">
            <div class="thought-bubble murmur">
                <div class="bubble-label">üí≠ Á¢éÁ¢éÂøµ</div>
                <div class="bubble-content" id="mind-murmur-text">...</div>
            </div>
            <div class="thought-bubble hidden-thought">
                <div class="bubble-label">üîí Â∞èÂøÉÊÄù (Secret)</div>
                <div class="bubble-content" id="mind-hidden-text">...</div>
            </div>
        </div>

    </div>
</div>
<input type="file" id="global-img-changer" accept="image/*" style="display:none" onchange="handleImageFileChange(this)">
<!-- === [Êñ∞Â¢û] ÂèëÂ∏ÉÊúãÂèãÂúàÂºπÁ™ó === -->
<div id="post-moment-modal" class="modal-overlay">
    <div class="modal-box" style="width: 340px; max-height: 80vh; display:flex; flex-direction:column;">
        <div class="modal-header">
            <span>ÂèëÂ∏ÉÊúãÂèãÂúà</span>
            <i class="fas fa-times" onclick="closePostMomentModal()"></i>
        </div>
        <div class="modal-body" style="flex:1; overflow-y:auto;">
            <!-- Ê≠£ÊñáËæìÂÖ• -->
            <div class="input-group">
                <textarea id="pm-text" rows="4" placeholder="Ëøô‰∏ÄÂàªÁöÑÊÉ≥Ê≥ï..." style="border:none; background:transparent; font-size:14px; padding:0; resize:none; min-height:80px;"></textarea>
            </div>
            
            <!-- ÂõæÁâáÂ§ÑÁêÜÂå∫Âüü -->
            <div class="input-group" style="border-top:1px solid #f0f0f0; padding-top:10px;">
                <label>ÈÖçÂõæ (Image)</label>
                <!-- ÈÄâÈ°πÂç°ÔºöÁúüÂÆûÂõæÁâá vs AIÊèèËø∞ -->
                <div style="display:flex; gap:10px; margin-bottom:10px;">
                    <label style="font-size:12px; display:flex; align-items:center; gap:5px;">
                        <input type="radio" name="pm-img-type" value="real" checked onchange="togglePmImgInput('real')"> ÁúüÂÆûÁÖßÁâá
                    </label>
                    <label style="font-size:12px; display:flex; align-items:center; gap:5px;">
                        <input type="radio" name="pm-img-type" value="desc" onchange="togglePmImgInput('desc')"> ËôöÊãü/AIÊèèËø∞
                    </label>
                </div>

                <!-- ÁúüÂÆûÂõæÁâá‰∏ä‰º†Ê°Ü -->
                <div id="pm-img-real-box">
                    <div style="width:80px; height:80px; background:#f0f0f0; border-radius:8px; display:flex; justify-content:center; align-items:center; cursor:pointer;" onclick="document.getElementById('pm-file-input').click()">
                        <img id="pm-preview-img" style="width:100%; height:100%; object-fit:cover; border-radius:8px; display:none;">
                        <i id="pm-plus-icon" class="fas fa-plus" style="color:#ccc; font-size:20px;"></i>
                    </div>
                    <input type="file" id="pm-file-input" accept="image/*" style="display:none;" onchange="handlePmFilePreview(this)">
                </div>

                <!-- ËôöÊãüÊèèËø∞ËæìÂÖ•Ê°Ü -->
                <div id="pm-img-desc-box" style="display:none;">
                    <input type="text" id="pm-img-desc" placeholder="‰æãÂ¶ÇÔºöÂú®Êµ∑ËæπÁúãÊó•ËêΩ..." style="width:100%;">
                    <div style="font-size:10px; color:#999; margin-top:4px;">* ËæìÂÖ•ÊèèËø∞ÂêéÔºåÂ∞ÜÊòæÁ§∫‰∏∫‰∏ÄÂº†ÁÅ∞Ëâ≤ÁöÑÊÑèÂ¢ÉÂç°Áâá„ÄÇ</div>
                </div>
            </div>

            <!-- ÂèØËßÅËåÉÂõ¥ÈÄâÊã© -->
            <div class="input-group" style="margin-top:15px;">
                <label>Ë∞ÅÂèØ‰ª•Áúã (Who can see)</label>
                <div style="border:1px solid #e0e0e0; border-radius:8px; max-height:150px; overflow-y:auto; padding:5px;" id="pm-visibility-list">
                    <!-- JS Âä®ÊÄÅÂ°´ÂÖÖÂ•ΩÂèãÂàóË°® -->
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-cancel" onclick="closePostMomentModal()">ÂèñÊ∂à</button>
            <button class="btn-confirm" onclick="confirmPostMoment()">ÂèëË°®</button>
        </div>
    </div>
</div>


<!-- === [Êñ∞Â¢û] Ê∞îÊ≥°Âè≥ÈîÆËèúÂçï === -->
<div id="wc-bubble-menu" class="wc-bubble-menu">
    <div class="wc-menu-item" onclick="handleMenuAction('copy')">
        <i class="far fa-copy"></i> Â§çÂà∂
    </div>
    <div class="wc-menu-item" onclick="handleMenuAction('quote')">
        <i class="fas fa-quote-right"></i> ÂºïÁî®
    </div>
    <div class="wc-menu-item" onclick="handleMenuAction('forward')">
        <i class="fas fa-share"></i> Â§öÈÄâËΩ¨Âèë
    </div>
    <div class="wc-menu-item" onclick="handleMenuAction('delete')" style="color:#ff4d4f;">
        <i class="far fa-trash-alt"></i> Âà†Èô§
    </div>
    <div id="menu-btn-revoke" class="wc-menu-item" onclick="handleMenuAction('revoke')">
        <i class="fas fa-undo"></i> Êí§Âõû
    </div>
    <div id="menu-btn-regen" class="wc-menu-item" onclick="handleMenuAction('regen')">
    <i class="fas fa-rotate-left"></i> ÈáçÂõû
</div>

</div>

<!-- === [‰øÆÊîπ] Â§öÈÄâÊìç‰ΩúÂ∫ïÈÉ®Ê†è (Â¢ûÂä†Âà†Èô§ÊåâÈíÆ) === -->
<div id="wc-multi-select-bar" class="wc-multi-select-bar">
    <!-- ËΩ¨ÂèëÊåâÈíÆ -->
    <div onclick="executeMultiForward()">
        <i class="fas fa-share-square"></i>
        <span>ËΩ¨Âèë</span>
    </div>
    <!-- Âà†Èô§ÊåâÈíÆ -->
    <div onclick="executeMultiDelete()" style="color: #ff4d4f;">
        <i class="far fa-trash-alt" style="background:#ffecec; color:#ff4d4f;"></i>
        <span>Âà†Èô§</span>
    </div>
    <!-- ÂèñÊ∂àÊåâÈíÆ -->
    <div onclick="exitMultiSelectMode()">
        <i class="fas fa-times"></i>
        <span>ÂèñÊ∂à</span>
    </div>
</div>


<!-- === [Êñ∞Â¢û] ËΩ¨ÂèëÂ•ΩÂèãÈÄâÊã©ÂºπÁ™ó === -->
<div id="forward-target-modal" class="modal-overlay">
    <div class="modal-box">
        <div class="modal-header">
            <span>ÈÄâÊã©ËΩ¨ÂèëÂØπË±°</span>
            <i class="fas fa-times" onclick="closeForwardModal()"></i>
        </div>
        <div class="modal-body">
            <div id="forward-friend-list" class="friend-checklist">
                <!-- JS Â°´ÂÖÖ -->
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-cancel" onclick="closeForwardModal()">ÂèñÊ∂à</button>
            <button class="btn-confirm" onclick="confirmForward()">ÂèëÈÄÅ</button>
        </div>
    </div>
</div>
<!-- === [Êñ∞Â¢û] ËÅäÂ§©ËÆ∞ÂΩïËØ¶ÊÉÖÂÖ®Â±èÂºπÁ™ó === -->
<div id="history-detail-modal" class="k-full-modal" style="background: #f7f7f7; z-index: 2500;">
    <div class="k-modal-header" style="background: #fff;">
        <i class="fas fa-chevron-left" onclick="closeHistoryDetail()" style="cursor:pointer; font-size:18px;"></i>
        <span id="history-detail-title" style="font-size: 15px; font-weight: 600;">ËÅäÂ§©ËÆ∞ÂΩï</span>
        <div style="width:20px;"></div> <!-- Âç†‰Ωç -->
    </div>
    <div id="history-detail-content" class="wc-body-container" style="padding: 0;">
        <!-- JS ‰ºöÂú®ËøôÈáåÂ°´ÂÖÖÂÖ∑‰ΩìÊ∂àÊÅØ -->
    </div>
</div>
<!-- ÂÖ®Â±ÄÈü≥È¢ëÊ†áÁ≠æ -->
<audio id="global-audio-player"></audio>

<!-- Èü≥‰πêÊí≠ÊîæÂô®ÁïåÈù¢ -->
<div class="app-fullscreen-view music-player-view" id="musicPlayerView">
    <div class="wc-header">
        <i class="fas fa-chevron-down" onclick="closeMusicPlayer()" style="cursor:pointer; padding:10px;"></i>
        <span>Music Player</span>
        <i class="fas fa-plus" onclick="triggerImportMusic()" style="cursor:pointer; padding:10px;"></i>
    </div>
    
    <div class="mp-cover-area">
        <img id="mp-cover-display" class="mp-cover-img" src="https://images.unsplash.com/photo-1459749411177-d4a428c37ae5?q=80&w=300&auto=format&fit=crop">
    </div>

    <div class="mp-controls">
        <div style="font-size:20px; font-weight:700;" id="mp-title-display">Select a Song</div>
        <div style="font-size:12px; color:#888; margin-top:5px;" id="mp-artist-display">...</div>
        
        <div class="mp-btn-row">
            <i class="fas fa-step-backward mp-btn" onclick="playPrevSong()"></i>
            <i class="fas fa-play-circle mp-btn-lg" id="mp-play-btn" onclick="toggleMusicPlay()"></i>
            <i class="fas fa-step-forward mp-btn" onclick="playNextSong()"></i>
        </div>
    </div>

    <div class="mp-playlist" id="mp-playlist-container">
        <!-- ÂàóË°®Áî± JS ÁîüÊàê -->
    </div>
    
    <!-- ÈöêËóèÁöÑÊñá‰ª∂ËæìÂÖ•Ê°Ü -->
    <input type="file" id="music-file-input" accept="audio/*" style="display:none;" onchange="handleMusicFile(this)">
</div>
<!-- === [Êñ∞Â¢û] Á∫ø‰∏ãÊ®°Âºè (Offline / Tavern Mode) === -->
<div id="offlineModeView" class="offline-mode-view">
    <div id="offline-bg-layer"></div>

    <!-- È°∂ÈÉ®ÂØºËà™ -->
    <div class="offline-header">
        <div class="oh-left" onclick="closeOfflineMode()">
            <i class="fas fa-times" style="font-size: 20px;"></i>
        </div>
        <div class="oh-center">
            <span id="offline-char-name">HANNAH</span>
            <div class="oh-status-dot"></div>
        </div>
        <div class="oh-right" style="display:flex; gap:15px;">
            <!-- ËÆæÁΩÆÊåâÈíÆ -->
            <i class="fas fa-sliders-h" onclick="toggleOfflineSettings()" style="font-size: 18px;"></i>
            <i class="fas fa-heart-pulse" onclick="toggleMindCard(event)" style="font-size: 18px;"></i>
        </div>
    </div>

    <!-- ÂÜÖÂÆπÂå∫Âüü -->
    <div id="offline-log-container" class="offline-content"></div>

    <!-- Â∫ïÈÉ®ËæìÂÖ•Âå∫ -->
    <div class="offline-input-area">
        <div class="offline-tools">
            <span onclick="insertOfflineAction('*')">*Âä®‰Ωú*</span>
            <span onclick="insertOfflineAction('„Äå')">„ÄåËØ¥ËØù„Äç</span>
            <!-- ÂéüÊúâÁöÑÂºπÂπïÂºÄÂÖ≥ -->
            <span id="offline-danmaku-btn" onclick="toggleDanmaku()">ÂºπÂπïÂºÄÂÖ≥</span>
            <!-- [Êñ∞Â¢û] ÂâßÊÉÖÈÄâÈ°πÂºÄÂÖ≥ -->
            <span id="offline-options-btn" onclick="toggleOfflineOptions()">ÈÄâÈ°πÂàÜÊîØ: OFF</span>
        </div>
        <div class="offline-textarea-wrap">
            <textarea id="offline-input" placeholder="ÊèèËø∞‰Ω†ÁöÑÂä®‰ΩúÊàñËØ≠Ë®Ä... (Enter ÂèëÈÄÅ)" onkeydown="if(event.key==='Enter' && !event.shiftKey){event.preventDefault(); sendOfflineMessage();}"></textarea>
            <button class="offline-send-btn" onclick="sendOfflineMessage()"><i class="fas fa-arrow-up"></i></button>
        </div>
    </div>

    <!-- [Êñ∞Â¢û] Á∫ø‰∏ãËÆæÁΩÆÈù¢Êùø -->
   <div id="offline-settings-panel" class="offline-settings-modal">
    <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
        <span style="font-weight:700;">Á∫ø‰∏ãÊ®°ÂºèËÆæÁΩÆ</span>
        <i class="fas fa-chevron-down" onclick="toggleOfflineSettings()"></i>
    </div>
    
    <div class="offline-settings-scroll" style="max-height: 400px; overflow-y: auto; padding-right: 5px;">
        <div class="form-group">
            <label>ÈÄâÊã©È¢ÑËÆæ (Preset)</label>
            <select id="offline-active-preset" onchange="saveOfflineConfig()">
                <!-- JS Â°´ÂÖÖ -->
            </select>
        </div>

        <div class="form-group">
            <label>ÂõûÂ§çÊúÄÂ§ßÂ≠óÊï∞ (Target Length): <span id="off-len-val">200</span></label>
            <input type="range" id="offline-max-len" min="50" max="5000" step="50" oninput="document.getElementById('off-len-val').innerText=this.value; saveOfflineConfig();">
            <div class="form-text">Ê≥®ÊÑèÔºöËøôÂè™ÊòØÁªô AI ÁöÑÂª∫ËÆÆÈïøÂ∫¶ÔºåÂπ∂ÈùûÁªùÂØπÊà™Êñ≠„ÄÇ</div>
        </div>

        <hr class="settings-divider">

        <!-- Êñ∞Â¢ûÔºöËÉåÊôØÂõæËÆæÁΩÆ -->
        <div class="form-group">
            <label>Ëá™ÂÆö‰πâËÉåÊôØÂõæ (Background)</label>
            <div style="display:flex; gap:10px;">
                <input type="text" id="offline-bg-input" placeholder="ËæìÂÖ•ÂõæÁâá URL" onchange="saveOfflineConfig()">
                <button class="btn-secondary" onclick="document.getElementById('global-img-changer').click(); window.tempImgTarget='offline';" style="width:40px;"><i class="fas fa-upload"></i></button>
            </div>
        </div>

        <!-- Êñ∞Â¢ûÔºöËá™ÂÆö‰πâ CSS -->
        <div class="form-group">
            <label>Ê®°Âºè‰∏ìÂ±û CSS (Custom CSS)</label>
            <textarea id="offline-custom-css" rows="4" placeholder="/* ‰ªÖÂú®Ê≠§Ê®°ÂºèÁîüÊïàÁöÑ CSS */&#10;.offline-entry { font-size: 16px; }" onchange="saveOfflineConfig()"></textarea>
        </div>
    </div>
</div>

    <!-- [Êñ∞Â¢û] ‰øÆÊîπÊ∂àÊÅØÈ°µÈù¢ -->
    <div id="offline-modify-page" class="modify-modal-view">
        <div class="modify-header">
            <span onclick="closeModifyPage()" style="color:#999; cursor:pointer;">ÂèñÊ∂à</span>
            <span>‰øÆÊîπÂÜÖÂÆπ</span>
            <span onclick="confirmModifyOffline()" style="color:#2b2b2b; cursor:pointer;">ÂÆåÊàê</span>
        </div>
        <div class="modify-body">
            <textarea id="modify-text-input" class="modify-textarea"></textarea>
        </div>
    </div>
</div>

<!-- === [Êñ∞Â¢û] Á∫ø‰∏ãÊ®°ÂºèÔºöÈáçÂõûÁ°ÆËÆ§ÂºπÁ™ó === -->
<div id="offline-regen-modal" class="modal-overlay">
    <div class="modal-box" style="width: 280px; text-align: center;">
        <div class="modal-body" style="padding: 30px 20px; background: #fff;">
            <i class="fas fa-undo-alt" style="font-size: 32px; color: #333; margin-bottom: 15px;"></i>
            <div style="font-size: 16px; font-weight: 700; margin-bottom: 8px;">ÈáçÊñ∞ÁîüÊàêÔºü</div>
            <div style="font-size: 13px; color: #888; line-height: 1.5;">
                ËøôÂ∞ÜÂà†Èô§Ê≠§Êù°Âèä‰πãÂêéÁöÑÊâÄÊúâÂÜÖÂÆπÔºå<br>Âπ∂ËÆ© AI ÈáçÊñ∞Â∞ùËØïÂÜôÂÖ•„ÄÇ
            </div>
        </div>
        <div class="modal-footer" style="border-top: 1px solid #f0f0f0;">
            <button class="btn-cancel" onclick="closeRegenModal()">ÂèñÊ∂à</button>
            <button class="btn-confirm" onclick="confirmRegenAction()" style="background:#2b2b2b;">Á°ÆÂÆöÈáçÂõû</button>
        </div>
    </div>
</div>
<!-- === [Êñ∞Â¢û] ÂèëÈÄÅËØ≠Èü≥Ê®°ÂºèÈÄâÊã©ÂºπÁ™ó === -->
<div id="voice-action-modal" class="modal-overlay">
    <style>
        #voice-action-modal .tab-btn { color: #888; font-weight: 500; transition: 0.2s; cursor: pointer; }
        #voice-action-modal .tab-btn.active { background: #fff; color: #333; font-weight: 700; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
    </style>
    <div class="modal-box" style="width: 320px; border-radius: 24px; padding: 20px; background: #fff; text-align: center;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 20px;">
            <span style="font-weight: 700; font-size: 16px;">ÂèëÈÄÅËØ≠Èü≥</span>
            <i class="fas fa-times" onclick="closeVoiceActionModal()" style="cursor:pointer; color:#999; font-size:18px; padding:5px;"></i>
        </div>
        
        <div style="display:flex; gap: 10px; margin-bottom: 20px; background: #f5f5f5; padding: 4px; border-radius: 12px;">
            <div class="tab-btn active" id="tab-btn-fake-voice" onclick="switchVoiceTab('fake')" style="flex:1; text-align:center; padding: 8px 0; border-radius: 8px;">‰º™ËØ≠Èü≥</div>
            <div class="tab-btn" id="tab-btn-real-voice" onclick="switchVoiceTab('real')" style="flex:1; text-align:center; padding: 8px 0; border-radius: 8px;">ÈïøÊåâÂΩïÈü≥</div>
        </div>

        <!-- ‰º™ËØ≠Èü≥Èù¢Êùø -->
        <div id="voice-panel-fake" style="display:block;">
            <textarea id="fake-voice-input" rows="3" placeholder="ËæìÂÖ•‰Ω†ÊÉ≥ËÆ©ÂÆÉËΩ¨ÊàêÊñáÂ≠óÁöÑÂÜÖÂÆπ (Â¶Ç‰∏çÂ°´ÂàôÂèëÈÄÅÊó†ÊñáÂ≠óÁöÑÂÅáËØ≠Èü≥)..." style="width:100%; border:1px solid #eee; border-radius:12px; padding:12px; font-size:13px; resize:none; outline:none; background:#fafafa; margin-bottom:15px;"></textarea>
            <button class="btn-confirm" onclick="sendFakeVoice()" style="width:100%; border-radius:12px; height:44px; background:#2b2b2b; color:#fff;">ÂèëÈÄÅ</button>
        </div>

        <!-- ÁúüÂÆûÂΩïÈü≥Èù¢Êùø -->
        <div id="voice-panel-real" style="display:none; padding: 20px 0; flex-direction: column; align-items: center;">
            <button id="modalHoldToTalkBtn" style="width:110px; height:110px; border-radius:50%; border:none; background:#f5f5f5; color:#333; font-size:14px; font-weight:600; box-shadow:0 8px 25px rgba(0,0,0,0.06); transition:all 0.2s; display:flex; justify-content:center; align-items:center; flex-direction:column; gap:8px; cursor:pointer; user-select:none;">
                <i class="fas fa-microphone" style="font-size:28px; color: #555;"></i>
                <span>Êåâ‰ΩèËØ¥ËØù</span>
            </button>
            <div style="font-size:11px; color:#999; margin-top:20px;">ÊùæÂºÄÂèëÈÄÅÔºåÂ∞ÜËá™Âä®ËØÜÂà´ËΩ¨‰∏∫ÊñáÂ≠ó</div>
        </div>
    </div>
</div>
<!-- ========================================= -->
<!-- [ÂÖ®Èù¢ÂçáÁ∫ßÁâà] ÂâßÊÉÖÊÄªÁªì‰∏éÂÖ≥Á≥ª ÂÖ®Â±èÈ°µÈù¢ -->
<!-- ========================================= -->
<div id="summaryPageView" class="chat-settings-page-view">
    <div class="chat-settings-page-header">
        <i class="fas fa-chevron-left" onclick="closeSummaryPage()"></i>
        <span>ÂâßÊÉÖÊÄªÁªì‰∏éÂÖ≥Á≥ª</span>
        <!-- È°∂ÈÉ®Áõ¥Êé•Êîæ‰∏Ä‰∏™‰∏ÄÈîÆÊ∏ÖÁ©∫ÊåâÈíÆÔºåÁî®Á∫¢Ëâ≤Ë≠¶Á§∫ -->
        <i class="fas fa-trash-alt" onclick="clearAllSummaries()" style="color:#ff4d4f; font-size: 16px;" title="‰∏ÄÈîÆÊ∏ÖÁ©∫ËÆ∞ÂøÜ"></i>
    </div>
    
    <div class="chat-settings-page-content">
        
        <!-- 1. Êñ∞Â¢ûÔºöÂΩìÂâçÂØπËØùÁä∂ÊÄÅ‰∏éÊâãÂä®ÊÄªÁªìÊéßÂà∂Âè∞ -->
        <div class="summary-settings-section" style="background: #fff; padding: 15px; border-radius: 16px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.03);">
            <div class="settings-section-title" style="margin-top:0; border-left-color: #07c160;">ËøõÂ∫¶ÁõëÊéßÈù¢Êùø</div>
            <div style="font-size:13px; color:#555; margin-bottom:15px; background: #f9f9f9; padding: 10px 15px; border-radius: 8px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                    <span>ÂΩìÂâçÊÄªÂØπËØùËΩÆÊï∞Ôºö</span>
                    <span style="font-weight:800; color:#111;" id="current-total-turns">0</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>ÊúÄÊñ∞Â∑≤ÊÄªÁªìËá≥Ôºö</span>
                    <span style="font-weight:800; color:#07c160;">Á¨¨ <span id="last-summarized-turn">0</span> ËΩÆ</span>
                </div>
            </div>

            <div class="settings-section-title" style="border-left-color: #ff7e67;">ÊâãÂä®Á≤æÂáÜÊÄªÁªì</div>
            <div style="display:flex; align-items:center; gap:8px; margin-bottom:15px;">
                <span style="font-size:12px; color:#666;">‰ªéÁ¨¨</span>
                <input type="number" id="manual-sum-start" placeholder="1" style="width:70px; height:36px; border-radius:8px; border:1px solid #ddd; text-align:center; font-family:inherit;">
                <span style="font-size:12px; color:#666;">Ëá≥</span>
                <input type="number" id="manual-sum-end" placeholder="20" style="width:70px; height:36px; border-radius:8px; border:1px solid #ddd; text-align:center; font-family:inherit;">
                <span style="font-size:12px; color:#666;">ËΩÆ</span>
            </div>
            
            <div style="display:flex; flex-direction: column; gap:10px;">
                <button id="btn-manual-range" class="btn-secondary" onclick="generateManualSummary()" style="height: 40px; background:#f0f0f0; border:none; color:#333; font-weight:600;">
                    <i class="fas fa-crosshairs"></i> ÊèêÂèñÊåáÂÆöÂå∫Èó¥
                </button>
                <button id="btn-manual-latest" class="btn-confirm" onclick="generateSummarySinceLast()" style="height: 40px; border-radius: 10px;">
                    <i class="fas fa-bolt"></i> ‰∏ÄÈîÆÊÄªÁªìÊúÄÊñ∞Êú™ÊÄªÁªìÈÉ®ÂàÜ
                </button>
            </div>
        </div>

        <!-- 2. Ëá™Âä®ÊÄªÁªìËÆæÁΩÆÂå∫ -->
        <div class="summary-settings-section">
            <div class="settings-section-title">Ëá™Âä®Ëß¶ÂèëËÆæÁΩÆ</div>
            <div class="input-group">
                <label>ÊØè N ËΩÆÂØπËØùËá™Âä®ÊÄªÁªì (ËÆæ‰∏∫0ÂÖ≥Èó≠)</label>
                <input type="number" id="summary-turn-count" value="20" onchange="saveSummaryConfig()">
            </div>
            <div class="input-group">
                <label>Ëá™Âä®ÊÄªÁªìÂ≠óÊï∞ (Á∫¶)</label>
                <input type="number" id="summary-word-count" value="200" onchange="saveSummaryConfig()">
            </div>
            <div class="input-group">
                <label>AI ÊÄªÁªìÊèêÁ§∫ËØç (Prompt)</label>
                <textarea id="summary-prompt" rows="2" onchange="saveSummaryConfig()" placeholder="‰æãÂ¶ÇÔºöËØ∑‰ª•ÊàëÁöÑÂè£ÂêªÔºåÁî®‰∫≤ÊòµÁöÑËØ≠Ê∞îÊÄªÁªìÊàë‰ª¨ÊúÄËøëÁöÑËøõÂ±ï„ÄÇ"></textarea>
            </div>
        </div>

        <hr class="settings-divider" style="margin: 20px 0;">

        <!-- 3. Â∑≤ÊúâÊÄªÁªìÂàóË°® (ÊîæÂ§ßÁâà) -->
        <div>
            <div class="settings-section-title" style="display: flex; justify-content: space-between; align-items: center;">
                <span>Â∑≤ÁîüÊàêÁöÑËÆ∞ÂøÜÂ≠òÊ°£</span>
                <button class="btn-secondary" onclick="addNewSummaryItem()" style="height: 28px; width:auto; padding: 0 12px; font-size: 11px; background:#fff; border:1px solid #ddd;">+ ÊâãÂä®ÁºñÂÜô</button>
            </div>
            <div id="summary-list-container" class="summary-list-container">
                <!-- JS Âä®ÊÄÅÂ°´ÂÖÖ -->
                <div class="summary-empty-state">Â§ßËÑëÁ©∫Á©∫ÔºåÊöÇÊó†ËÆ∞ÂøÜ</div>
            </div>
            <button id="grand-summary-btn" class="btn-secondary" onclick="generateGrandSummary()" style="width: 100%; margin-top: 15px; height: 44px; border:1px solid #111; color:#111;">
                <i class="fas fa-brain"></i> ÂØπ‰ª•‰∏äÊâÄÊúâËÆ∞ÂøÜËøõË°å„ÄêÂ§ßËûçÂêà„Äë
            </button>
        </div>

        <hr class="settings-divider" style="margin: 25px 0;">

        <!-- 4. ÂÖ≥Á≥ªËøõÂ∫¶Êù° -->
        <div>
            <div class="settings-section-title" style="display: flex; justify-content: space-between; align-items: center;">
                <span>Â•ΩÊÑüÂ∫¶‰∏éÂÖ≥Á≥ª‰∫ã‰ª∂</span>
                <button class="btn-secondary" onclick="addRelationshipLog()" style="height: 28px; width:auto; padding: 0 12px; font-size: 11px; background:#fff; border:1px solid #ddd;">+ Ê∑ªÂä†ËäÇÁÇπ</button>
            </div>
            <div id="relationship-log-container" class="summary-list-container" style="max-height: 250px;">
                <!-- JS Âä®ÊÄÅÂ°´ÂÖÖ -->
                <div class="summary-empty-state">ÊöÇÊó†ÂÖ≥Á≥ªË∑ÉÂçá‰∫ã‰ª∂</div>
            </div>
        </div>
        <div style="height: 60px;"></div> <!-- Â∫ïÈÉ®ÁïôÁôΩÈò≤ÈÅÆÊå° -->
    </div>
</div>
<!-- ============================================== -->
<!-- [Èü©Á≥ªÁÆÄÁ∫¶Áâà] Èí±ÂåÖ APP (ÂÖ®‰∏≠Êñá) -->
<!-- ============================================== -->
<div class="app-fullscreen-view" id="payApp" style="background: #fafafa;">
    
    <!-- È°∂ÈÉ®ÂØºËà™ -->
    <div class="k-header" style="background: transparent; padding-top: 50px; border:none;">
        <i class="fas fa-chevron-left" onclick="closePayApp()" style="font-size: 20px; cursor:pointer; color:#333;"></i>
        <span style="font-weight: 700; font-size: 16px; color:#333; letter-spacing: 1px;">ÊàëÁöÑÈí±ÂåÖ</span>
        <span onclick="openPaySubPage('bill')" style="font-size: 12px; color:#666; cursor:pointer;">Ë¥¶Âçï</span>
    </div>

    <!-- ‰∏ªÂÜÖÂÆπ -->
    <div class="k-body-container" style="padding: 10px 24px 30px; display: flex; flex-direction: column; gap: 20px;">
        
       <!-- È°∂ÈÉ®ÂäüËÉΩÂå∫Ôºö‰∫∫ËÆæÂàáÊç¢ + AIÊµãÁÆó -->
<div style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
    <!-- ‰∫∫ËÆæÂàáÊç¢ÊåâÈíÆ (Â§çÁî®Áé∞ÊúâÁöÑÂºπÁ™ó) -->
    <div onclick="openIdentityModal(event)" style="display:flex; align-items:center; gap:8px; background:#fff; padding:6px 12px; border-radius:20px; box-shadow:0 2px 8px rgba(0,0,0,0.03); cursor:pointer;">
        <img id="pay-persona-avatar" src="" style="width:24px; height:24px; border-radius:50%; object-fit:cover;">
        <span id="pay-persona-name" style="font-size:12px; font-weight:600; color:#333;">Me</span>
        <i class="fas fa-caret-down" style="font-size:10px; color:#999;"></i>
    </div>
    
    <!-- AI ÊµãÁÆóÊåâÈíÆ -->
    <div onclick="generateInitialWealthByAI()" id="btn-ai-wealth" style="font-size: 11px; color: #555; cursor:pointer; background: #eee; padding: 6px 12px; border-radius: 15px;">
        <i class="fas fa-magic"></i> AI ÊµãÁÆóË∫´‰ª∑
    </div>
</div>


        <!-- 1. Èõ∂Èí±Âç°Áâá (Â•∂ÁôΩÈ£éÊ†º) -->
        <div class="pay-korean-card">
            <div class="pay-label-sm">ÂΩìÂâçÈõ∂Èí±</div>
            <div class="pay-num-lg">¬• <span id="pay-total-balance">0.00</span></div>
            
            <div style="margin-top: 25px; display:flex; justify-content: space-between; align-items: center;">
                <span style="font-size:10px; color:#ccc;">Áî®‰∫éÊó•Â∏∏ÊîØ‰ªò</span>
                <!-- Ëøô‰∏™ÊåâÈíÆËß¶ÂèëÂ¢ûÂä†‰ΩôÈ¢ù/Â∞èÊ∏∏Êàè -->
                <button class="pay-pill-btn" onclick="addBalancePrompt()">+ ÂÖÖÂÄº</button>
            </div>
        </div>

        <!-- 2. Èì∂Ë°åÂç° (È´òÁ∫ßÈì∂ÁÅ∞È£éÊ†º) -->
        <div class="pay-silver-card">
            <div style="display:flex; justify-content:space-between;">
                <div class="pay-label-sm" style="color:#777;">Èì∂Ë°åÂÇ®ËìÑÂç°</div>
                <i class="fab fa-cc-visa" style="font-size: 20px; opacity: 0.3;"></i>
            </div>
            <div class="pay-num-lg" style="font-size: 28px; color:#444;">¬• <span id="pay-bank-balance">0.00</span></div>
            
            <div style="margin-top: 20px; display:flex; gap:10px; justify-content:flex-end;">
                <button class="pay-pill-btn outline" onclick="payActionPrompt('withdraw')">ÊèêÁé∞</button>
                <button class="pay-pill-btn outline" onclick="payActionPrompt('recharge')">ËΩ¨ÂÖ•Èõ∂Èí±</button>
            </div>
        </div>

        <div style="font-size: 12px; color: #999; margin-top: 10px;">Êõ¥Â§öÊúçÂä°</div>

        <!-- 3. ÂäüËÉΩÂàóË°® (ÁÆÄÁ∫¶ÂàóË°®) -->
        <div class="pay-simple-list">
            <!-- ‰ΩôÈ¢ùÂÆù -->
            <div class="pay-simple-item" onclick="openPaySubPage('yuebao')">
                <div class="pay-item-left">
                    <div class="pay-icon-box"><i class="fas fa-piggy-bank"></i></div>
                    <div>
                        <div class="pay-item-title">Â∞èÈáëÂ∫ì (ÁêÜË¥¢)</div>
                        <div class="pay-item-desc">Êò®Êó•Êî∂Áõä <span style="color:#d4a373;">+<span id="pay-yuebao-yesterday">0.00</span></span></div>
                    </div>
                </div>
                <i class="fas fa-chevron-right" style="font-size:12px; color:#ddd;"></i>
            </div>

                        <!-- ÊØèÊúàÊî∂ÂÖ• -->
            <div class="pay-simple-item" onclick="openPaySubPage('career')">
                <div class="pay-item-left">
                    <div class="pay-icon-box"><i class="fas fa-wallet"></i></div>
                    <div>
                        <div class="pay-item-title">ÊØèÊúàÊî∂ÂÖ•</div>
                        <div class="pay-item-desc">ËÆæÂÆöÂõ∫ÂÆöÊî∂ÂÖ•‰∏éÂèëÊîæÊó•</div>
                    </div>
                </div>
                <i class="fas fa-chevron-right" style="font-size:12px; color:#ddd;"></i>
            </div>


            <!-- ‰∫≤ÂØÜ‰ªò -->
            <div class="pay-simple-item" onclick="openPaySubPage('intimate')">
                <div class="pay-item-left">
                    <div class="pay-icon-box"><i class="fas fa-heart"></i></div>
                    <div>
                        <div class="pay-item-title">‰∫≤ÂØÜ‰ªò</div>
                        <div class="pay-item-desc">Áªô AI ÂºÄÈÄöÈ¢ùÂ∫¶</div>
                    </div>
                </div>
                <i class="fas fa-chevron-right" style="font-size:12px; color:#ddd;"></i>
            </div>

            <!-- ÊâìÂ∑• -->
            <div class="pay-simple-item" onclick="openPaySubPage('parttime')">
                <div class="pay-item-left">
                    <div class="pay-icon-box"><i class="fas fa-coffee"></i></div>
                    <div>
                        <div class="pay-item-title">ÂÖºËÅåÊâìÂ∑•</div>
                        <div class="pay-item-desc">ËµöÂèñÈõ∂Ëä±Èí±</div>
                    </div>
                </div>
                <i class="fas fa-chevron-right" style="font-size:12px; color:#ddd;"></i>
            </div>
                        <!-- Ê®°ÊãüËÇ°Â∏Ç -->
            <div class="pay-simple-item" onclick="openPaySubPage('stock')">
                <div class="pay-item-left">
                    <div class="pay-icon-box" style="background:#111; color:#fff;"><i class="fas fa-chart-line"></i></div>
                    <div>
                        <div class="pay-item-title">Ê®°ÊãüËÇ°Â∏Ç</div>
                        <div class="pay-item-desc">ÂçïËΩ¶ÂèòÊë©ÊâòÔºåÂà´Â¢ÖÈù†Â§ßÊµ∑</div>
                    </div>
                </div>
                <i class="fas fa-chevron-right" style="font-size:12px; color:#ddd;"></i>
            </div>
                               <!-- === Êñ∞Â¢ûÔºöÈ°∂ÊµÅÈÄ†Êòü‰ºÅÂàí (È´òÈ£éÈô©È£éÊäï) === -->
            <div class="pay-simple-item" onclick="openPaySubPage('idol_invest')">
                <div class="pay-item-left">
                    <div class="pay-icon-box" style="background:#111; color:#fff;"><i class="fas fa-user-astronaut"></i></div>
                    <div>
                        <div class="pay-item-title" style="font-weight: 800;">PROJECT: IDOL</div>
                        <div class="pay-item-desc">ÊäïËµÑÂú∞‰∏ãÁªÉ‰π†ÁîüÔºåÊçßÂá∫‰∏ã‰∏Ä‰∏™‰∏ñÁïåÁ∫ßÈ°∂ÊµÅ</div>
                    </div>
                </div>
                <i class="fas fa-chevron-right" style="font-size:12px; color:#ddd;"></i>
            </div>


        </div>
        <button class="pay-pill-btn" style="width:100%; height:44px; background:#ff4d4f; margin-top:20px; box-shadow:0 5px 15px rgba(255,77,79,0.3);" onclick="resetPayData()">‰∏ÄÈîÆÈáçÁΩÆÂΩìÂâç‰∫∫ËÆæÈí±ÂåÖ</button>
    </div>

    <!-- === Â≠êÈ°µÈù¢ÔºöË¥¶Âçï (ÂÖ®‰∏≠Êñá) === -->
    <div id="pay-page-bill" class="pay-sub-page">
        <div class="k-header" style="background:#fff; border-bottom:1px solid #f0f0f0;">
            <i class="fas fa-chevron-left" onclick="closePaySubPage('bill')" style="cursor:pointer; color:#333;"></i>
            <span style="font-weight:700; color:#333;">Ë¥¶ÂçïÊòéÁªÜ</span>
            <div style="width:20px;"></div>
        </div>
        <div class="k-body-container" id="pay-bill-list" style="background:#fafafa; padding:20px;"></div>
    </div>

    <!-- === Â≠êÈ°µÈù¢ÔºöÂ∞èÈáëÂ∫ì/‰ΩôÈ¢ùÂÆù === -->
    <div id="pay-page-yuebao" class="pay-sub-page" style="background:#fafafa;">
        <div class="k-header" style="background:transparent;">
            <i class="fas fa-chevron-left" onclick="closePaySubPage('yuebao')" style="cursor:pointer; color:#333;"></i>
            <span style="font-weight:700; color:#333;">Â∞èÈáëÂ∫ì</span><div style="width:20px;"></div>
        </div>
        <div class="k-body-container" style="padding:20px;">
            <div class="pay-korean-card" style="text-align:center; padding:40px 20px;">
                <div style="font-size:12px; color:#999;">ÊÄªËµÑ‰∫ß (ÂÖÉ)</div>
                <div style="font-size:40px; font-weight:300; color:#333; margin:10px 0;" id="yb-detail-balance">0.00</div>
                <div style="margin-bottom: 15px;">
        <span style="font-size:11px; color:#07c160; background:rgba(7,193,96,0.08); padding:3px 8px; border-radius:4px; font-weight:600;">‰∏ÉÊó•Âπ¥Âåñ 2.15%</span>
    </div>

                <div style="font-size:12px; color:#d4a373;">Á¥ØËÆ°Êî∂Áõä +<span id="yb-total-profit">0.00</span></div>
                
                <div style="display:flex; justify-content:center; gap:15px; margin-top:30px;">
                    <button class="pay-pill-btn" style="width:100px;" onclick="handleYuebao('in')">ËΩ¨ÂÖ•</button>
                    <button class="pay-pill-btn outline" style="width:100px;" onclick="handleYuebao('out')">ËΩ¨Âá∫</button>
                </div>
            </div>
            <div style="margin-top:30px; font-size:12px; color:#999; margin-bottom:10px;">Êî∂ÁõäËÆ∞ÂΩï</div>
            <div id="yb-profit-list" class="pay-simple-list"></div>
        </div>
    </div>

        <!-- === Â≠êÈ°µÈù¢ÔºöÊØèÊúàÊî∂ÂÖ• === -->
    <div id="pay-page-career" class="pay-sub-page" style="background:#fafafa;">
        <div class="k-header" style="background:#fff;">
            <i class="fas fa-chevron-left" onclick="closePaySubPage('career')" style="cursor:pointer; color:#333;"></i>
            <span style="font-weight:700; color:#333;">ÊØèÊúàÊî∂ÂÖ•</span><div style="width:20px;"></div>
        </div>
        <div class="k-body-container" style="padding:20px;">
            <div class="pay-korean-card">
                <div class="form-group">
                    <label>Êî∂ÂÖ•Êù•Ê∫ê / ÁêÜÁî±</label>
                    <input type="text" id="career-source-input" placeholder="‰æãÂ¶ÇÔºöÁîüÊ¥ªË¥π/Â∑•ËµÑ/ÈõÜÂõ¢ÂàÜÁ∫¢" style="background:#f5f5f5; border:none;">
                </div>
                <div class="form-group">
                    <label>ÊØèÊúàÂèëÈí±Êó•Êúü (1-28Âè∑)</label>
                    <input type="number" id="career-day-input" placeholder="‰æãÂ¶ÇÔºö15" style="background:#f5f5f5; border:none;">
                </div>
                <div class="form-group">
                    <label>ÊØèÊúàÈáëÈ¢ù (ÂÖÉ)</label>
                    <div style="display:flex; gap:10px;">
                        <input type="number" id="career-amount-input" placeholder="‰æãÂ¶ÇÔºö8000" style="background:#f5f5f5; border:none;">
                        <button class="pay-pill-btn outline" style="width:auto; white-space:nowrap;" onclick="generateCareerAmountByAI()" id="btn-gen-salary">AIÊµãÁÆó</button>
                    </div>
                </div>
                <div style="font-size:10px; color:#999; margin-bottom: 15px;">*ÁÇπÂáª AIÊµãÁÆóÔºåÂ∞ÜÊ†πÊçÆ‰Ω†ÁöÑ‰∫∫ËÆæËá™Âä®Êé®Êñ≠Êî∂ÂÖ•‰∏éÊù•Ê∫ê„ÄÇ</div>
                <button class="pay-pill-btn" style="width:100%; height:44px;" onclick="saveCareerConfig()">‰øùÂ≠òËÆæÂÆö</button>
            </div>
        </div>
    </div>


    <!-- === Â≠êÈ°µÈù¢Ôºö‰∫≤ÂØÜ‰ªò === -->
    <div id="pay-page-intimate" class="pay-sub-page" style="background:#fafafa;">
        <div class="k-header" style="background:#fff;">
            <i class="fas fa-chevron-left" onclick="closePaySubPage('intimate')" style="cursor:pointer; color:#333;"></i>
            <span style="font-weight:700; color:#333;">‰∫≤ÂØÜ‰ªò</span>
            <i class="fas fa-plus" onclick="openBindIntimateModal()" style="cursor:pointer; color:#333;"></i>
        </div>
        <div class="k-body-container" style="padding:20px;">
            <div style="font-size:12px; color:#999; margin-bottom:15px; text-align:center;">Â∑≤ÁªëÂÆöÁöÑ AI ÂèØ‰ª•‰ΩøÁî®‰Ω†ÁöÑ‰ΩôÈ¢ù</div>
            <div id="intimate-list-container" style="display:flex; flex-direction:column; gap:10px;"></div>
        </div>
    </div>

       <!-- === Â≠êÈ°µÈù¢ÔºöÂÖºËÅå‰∏≠ÂøÉ (Job Center) === -->
    <div id="pay-page-parttime" class="pay-sub-page" style="background:#fcfcfc;">
        <!-- È°∂ÈÉ®ÂØºËà™ -->
        <div class="k-header" style="background:transparent; flex-shrink:0;">
            <i class="fas fa-chevron-left" onclick="closePaySubPage('parttime')" style="cursor:pointer; color:#111;"></i>
            <span style="font-weight:700; color:#111; font-size:16px;">ÂÖºËÅåÊâìÂ∑•</span>
            <div style="width:20px;"></div>
        </div>

        <!-- ËÅå‰∏öÈÄâÊã©ÂàóË°® (Job Board) -->
        <div id="pt-job-board" class="k-body-container" style="padding:20px; display:block;">
            <div style="margin-bottom:25px;">
                <div style="font-size:22px; font-weight:800; color:#111; margin-bottom:4px;">ÊâìÂ∑•‰∫∫ÔºåÊâìÂ∑•È≠ÇÔºÅ</div>
                <div style="font-size:11px; color:#888;">ÈÄâ‰∏™È°∫ÁúºÁöÑÊ¥ªÂÑøÔºåËµöÁÇπÈõ∂Ëä±Èí±Âêß~</div>
            </div>

            <!-- Â∑•‰Ωú 1: Êî∂Èì∂Âëò (Èü©Á≥ªÊûÅÁÆÄÁôΩ) -->
            <div class="job-card-korean" onclick="startJob(1)">
                <div class="job-k-icon" style="background:#f5f5f5; color:#111;"><i class="fas fa-barcode"></i></div>
                <div class="job-k-info">
                    <div class="title">‰æøÂà©Â∫óÊî∂Èì∂Âëò</div>
                    <div class="desc">ÈöæÂ∫¶: ‚≠ê | ÊãºÊâãÈÄüÁÇπÊéâÂïÜÂìÅ</div>
                </div>
                <div class="job-k-pay">¬•200</div>
            </div>

            <!-- Â∑•‰Ωú 2: ÂíñÂï°Â∏à (Èü©Á≥ªÊûÅÁÆÄÁÅ∞) -->
            <div class="job-card-korean" onclick="startJob(2)" style="background:#f9f9f9;">
                <div class="job-k-icon" style="background:#e0e0e0; color:#111;"><i class="fas fa-coffee"></i></div>
                <div class="job-k-info">
                    <div class="title">ÊòüÁ∫ßÂíñÂï°Â∏à</div>
                    <div class="desc">ÈöæÂ∫¶: ‚≠ê‚≠ê‚≠ê | ËÆ∞ÈÖçÊñπÂÅöÈ•ÆÊñô</div>
                </div>
                <div class="job-k-pay">¬•2,000</div>
            </div>

            <!-- Â∑•‰Ωú 3: ÈªëÂÆ¢ (Èü©Á≥ªÊûÅÁÆÄÈªë) -->
            <div class="job-card-korean" onclick="startJob(3)" style="background:#111; color:#fff;">
                <div class="job-k-icon" style="background:#333; color:#fff;"><i class="fas fa-terminal"></i></div>
                <div class="job-k-info">
                    <div class="title" style="color:#fff;">ÁΩëÁªúÂÆâÂÖ®‰∏ìÂÆ∂</div>
                    <div class="desc" style="color:#aaa;">ÈöæÂ∫¶: ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | Á≤æÂáÜÈîÅ‰ø°Âè∑</div>
                </div>
                <div class="job-k-pay" style="color:#fff;">¬•8,000</div>
            </div>
        </div>

        <!-- Ê∏∏ÊàèÂå∫ÂüüÂÆπÂô® (ÈªòËÆ§ÈöêËóè) -->
        <div id="pt-game-stage" style="display:none; flex:1; flex-direction:column; position:relative; overflow:hidden;">
            
            <!-- ÈÄöÁî®Ê∏∏ÊàèÂ§¥ÈÉ® -->
            <div class="game-k-header">
                <div class="timer-box">
                    <i class="far fa-clock"></i> <span id="game-timer">00:30</span>
                </div>
                <div class="score-box">
                    ÊàêÁª©: <span id="game-score" style="font-weight:700;">0</span>
                </div>
                <button class="btn-quit-game" onclick="quitJob()">Ê∫ú‰∫ÜÊ∫ú‰∫Ü</button>
            </div>

            <!-- Ê∏∏Êàè 1: Êî∂Èì∂Âëò (ÊéâËêΩÁâ©ÂìÅ) -->
            <div id="game-view-1" class="game-view-box">
                <div style="position:absolute; top:20px; width:100%; text-align:center; color:#888; font-size:12px; z-index:5;">Âø´ÁÇπÔºÅÂÆ¢‰∫∫Á≠âÊÄ•‰∫ÜÔºÅ(ÁÇπÂáªÊéâËêΩÁâ©)</div>
                <div id="g1-belt"></div> <!-- ‰º†ÈÄÅÂ∏¶/ÊéâËêΩÂå∫ -->
                <div class="g1-scanner-line"></div>
            </div>

            <!-- Ê∏∏Êàè 2: ÂíñÂï°Â∏à (ÈÖçÊñπÂà∂‰Ωú) -->
            <div id="game-view-2" class="game-view-box" style="display:flex; flex-direction:column; align-items:center; justify-content:center; padding:20px;">
                <div class="g2-customer-bubble" id="g2-order-text">"ÊàëË¶Å‰∏ÄÊùØÂÜ∞ÁæéÂºèÔºÅ(üßä + üíß + ‚òïÔ∏è)"</div>
                
                <div class="g2-cup-area">
                    <div id="g2-cup">
                        <div id="g2-liquid"></div>
                    </div>
                </div>
                
                <!-- ÂèØÁà± Emoji ÊåâÈíÆ -->
                <div class="g2-controls">
                    <button onclick="g2Add('Espresso', '‚òïÔ∏è')">‚òïÔ∏è<br><span>ÊµìÁº©</span></button>
                    <button onclick="g2Add('Milk', 'ü•õ')">ü•õ<br><span>ÁâõÂ•∂</span></button>
                    <button onclick="g2Add('Water', 'üíß')">üíß<br><span>Ê∞¥</span></button>
                    <button onclick="g2Add('Ice', 'üßä')">üßä<br><span>ÂÜ∞Âùó</span></button>
                    <button onclick="g2Add('Syrup', 'üçØ')">üçØ<br><span>Á≥ñÊµÜ</span></button>
                </div>
                
                <button class="g2-serve-btn" onclick="g2Serve()">ÂÅöÂ•Ω‰∫ÜÔºÅÂá∫È§ê üõéÔ∏è</button>
            </div>

            <!-- Ê∏∏Êàè 3: ÈªëÂÆ¢ (‰ø°Âè∑Ê†°ÂáÜ) -->
            <div id="game-view-3" class="game-view-box" style="background:#111; display:flex; flex-direction:column; justify-content:center; align-items:center;">
                <div style="color:#fff; font-family:monospace; margin-bottom:20px; font-size:13px; letter-spacing:1px;">
                    > Ê≠£Âú®ÂÖ•‰æµÈò≤ÁÅ´Â¢ô... <span id="g3-level" style="font-weight:700;">Â±ÇÁ∫ß 1/3</span>
                </div>
                <div style="color:#888; font-size:11px; margin-bottom:40px;">Âú®Á∫¢Á∫øÈáçÂêàÁôΩÊ°ÜÊó∂Êåâ‰∏ãÈîÅÂÆö</div>
                
                <div class="g3-bar-container">
                    <div class="g3-target-zone" id="g3-target"></div>
                    <div class="g3-cursor" id="g3-cursor"></div>
                </div>

                <button class="g3-lock-btn" onpointerdown="g3Lock()">ÈîÅÂÆö‰ø°Âè∑</button>
                <div id="g3-msg" style="height:20px; font-size:12px; margin-top:20px; font-family:monospace; font-weight:700;"></div>
            </div>

        </div>
    </div>
    <!-- === Â≠êÈ°µÈù¢ÔºöÊ®°ÊãüËÇ°Â∏Ç (Èü©Á≥ªÈªëÁôΩÁÅ∞) === -->
    <div id="pay-page-stock" class="pay-sub-page" style="background:#fcfcfc;">
        <div class="k-header" style="background:transparent; border-bottom:1px solid #f0f0f0;">
            <i class="fas fa-chevron-left" onclick="closePaySubPage('stock')" style="cursor:pointer; color:#111;"></i>
            <span style="font-weight:700; color:#111; font-size:16px;">Ê®°ÊãüËÇ°Â∏Ç</span>
            <div style="width:20px;"></div>
        </div>
        <div class="k-body-container" style="padding:20px; display:flex; flex-direction:column; gap:15px;" id="stock-main-container">
            <!-- ËµÑ‰∫ßÂç°Áâá (ÊûÅËá¥ÈªëÁôΩ) -->
            <div class="pay-korean-card" style="background:#111; color:#fff; border:none; padding:25px 20px;">
                <div style="font-size:11px; color:#aaa; letter-spacing:1px;">ÊåÅ‰ªìÊÄªÂ∏ÇÂÄº (¬•)</div>
                <div id="stock-total-value" style="font-size:32px; font-weight:300; font-family:'Montserrat', sans-serif; margin:10px 0; color:#fff;">0.00</div>
                <div style="display:flex; justify-content:space-between; font-size:12px; color:#ccc;">
                    <span>ÂèØÁî®Èõ∂Èí±: ¬•<span id="stock-available-balance">0.00</span></span>
                    <span id="stock-total-profit" style="color:#fff;">ÊµÆÂä®Áõà‰∫è: +0.00</span>
                </div>
            </div>
            
            <div style="font-size:12px; font-weight:700; color:#333; margin-top:10px; display:flex; justify-content:space-between; align-items:center;">
                <span>Â∏ÇÂú∫Ë°åÊÉÖ (Market)</span>
                <span style="font-size:10px; color:#999; font-weight:400; cursor:pointer;" onclick="refreshStockMarket()"><i class="fas fa-sync-alt"></i> Âà∑Êñ∞Ë°åÊÉÖ</span>
            </div>
            
            <!-- ËÇ°Á•®ÂàóË°® -->
            <div id="stock-market-list" style="display:flex; flex-direction:column; gap:12px;">
                <!-- JS Âä®ÊÄÅÂ°´ÂÖÖ -->
            </div>
        </div>
    </div>

    <!-- ËÇ°Á•®‰∫§ÊòìËØ¶ÊÉÖ‰∏éÊñ∞ÈóªÂºπÁ™ó -->
    <div id="stock-trade-modal" class="modal-overlay" style="z-index: 5000;">
        <div class="modal-box" style="width:320px; border-radius:24px; padding:0; overflow:hidden;">
            <div style="padding:20px; background:#fff; border-bottom:1px solid #f0f0f0;">
                <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                    <div>
                        <div id="stm-name" style="font-size:18px; font-weight:800; color:#111;">ÂÖ¨Âè∏ÂêçÁß∞</div>
                        <div id="stm-code" style="font-size:10px; color:#999; font-family:'Montserrat'; letter-spacing:1px;">CODE</div>
                    </div>
                    <div style="text-align:right;">
                        <div id="stm-price" style="font-size:24px; font-weight:700; font-family:'Montserrat';">0.00</div>
                        <div id="stm-percent" style="font-size:12px; font-weight:600;">0.00%</div>
                    </div>
                </div>
                <!-- ÂπΩÈªòÊñ∞ÈóªÂºÇÂä®Âå∫Âùó -->
                <div style="margin-top:15px; padding:12px; background:#f9f9f9; border-radius:12px; border-left:3px solid #111;">
                    <div style="font-size:10px; color:#888; margin-bottom:4px; font-weight:700;">[Â∏ÇÂú∫Âø´ËÆØ / ÂºÇÂä®ÂéüÂõ†]</div>
                    <div id="stm-news" style="font-size:12px; color:#444; line-height:1.5;">ÊöÇÊó†Ê∂àÊÅØ</div>
                </div>
            </div>
            <div style="padding:20px; background:#fafafa;">
                <div style="display:flex; justify-content:space-between; font-size:12px; margin-bottom:15px; color:#666;">
                    <span>ÊàëÁöÑÊåÅ‰ªì: <b id="stm-holdings" style="color:#111;">0</b> ËÇ°</span>
                    <span>ÊåÅ‰ªìÊàêÊú¨: <b id="stm-cost" style="color:#111;">0.00</b></span>
                </div>
                <div style="display:flex; gap:10px; margin-bottom:15px;">
                    <input type="number" id="stm-amount-input" placeholder="ËæìÂÖ•‰π∞ÂçñËÇ°Êï∞..." style="flex:1; border:1px solid #ddd; border-radius:12px; padding:10px; text-align:center; outline:none; font-family:inherit;">
                </div>
                <div style="display:flex; gap:10px;">
                    <button onclick="executeStockTrade('sell')" style="flex:1; padding:12px 0; border-radius:16px; border:1px solid #111; background:#fff; color:#111; font-weight:700; cursor:pointer;">ÂçñÂá∫ (Sell)</button>
                    <button onclick="executeStockTrade('buy')" style="flex:1; padding:12px 0; border-radius:16px; border:none; background:#111; color:#fff; font-weight:700; cursor:pointer;">‰π∞ÂÖ• (Buy)</button>
                </div>
                <div style="text-align:center; margin-top:15px;">
                    <span onclick="document.getElementById('stock-trade-modal').classList.remove('active')" style="font-size:12px; color:#999; cursor:pointer; text-decoration:underline;">ÂèñÊ∂à‰∫§Êòì</span>
                </div>
            </div>
        </div>
    </div>
          <!-- === Â≠êÈ°µÈù¢ÔºöPROJECT: IDOL (È´òÈ£éÈô©È£éÊäï) === -->
    <div id="pay-page-idol_invest" class="pay-sub-page" style="background:#fcfcfc;">
        <div class="k-header" style="background:transparent; border-bottom:1px solid #f0f0f0;">
            <i class="fas fa-chevron-left" onclick="closePaySubPage('idol_invest')" style="cursor:pointer; color:#111;"></i>
            <span style="font-weight:800; font-family:'Montserrat', sans-serif; color:#111; font-size:14px; letter-spacing:1px;">PROJECT: IDOL</span>
            <div style="width:20px;"></div>
        </div>
        
        <div class="k-body-container" style="padding:20px; display:flex; flex-direction:column; gap:15px; overflow-y:auto;">
            
            <!-- È°∂ÈÉ®ÈªëÁôΩÊ¶ÇÂøµÂç°Áâá -->
            <div style="background:#111; border-radius:24px; padding:35px 25px; text-align:center; color:#fff; position:relative; overflow:hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                <div style="position:absolute; top:-20px; left:-20px; font-size:120px; color:rgba(255,255,255,0.03); font-weight:900; font-family:'Montserrat'; pointer-events:none;">TOP</div>
                
                <i class="fas fa-gem" style="font-size:32px; margin-bottom:15px;"></i>
                <div style="font-size:18px; font-weight:800; letter-spacing:2px; margin-bottom:10px;">ÂØªÊâæÂ§©ÈôçÁ¥´ÂæÆÊòü</div>
                <div style="font-size:11px; color:#aaa; line-height:1.6; font-weight:300;">
                    Ê≥®ËµÑÂèëÊéòÁ¥†‰∫∫ÁªÉ‰π†Áîü„ÄÇ<br>
                    <b style="color:#fff;">90%</b> Ê¶ÇÁéáÁªÉ‰π†ÁîüÂ•áËë©‰ΩúÂ¶ñÔºåËµÑÈáëÊâìÊ∞¥ÊºÇ„ÄÇ<br>
                    <b style="color:#fff;">10%</b> Ê¶ÇÁéáÂÖ®ÁΩëÁàÜÁ∫¢ÔºåËøûÊú¨Â∏¶Âà©Â•âËøò 10~50 ÂÄç„ÄÇ
                </div>

                <div style="background:rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); font-size:9px; padding:8px; border-radius:8px; margin-top:20px; text-align:left;">
                    <i class="fas fa-info-circle"></i> ÂïÜ‰∏öÈ£éÊäïÊúâÊûÅÂ§ß‰∫èÊçüÈ£éÈô©„ÄÇÊãíÁªùÈªÑËµåÊØíÔºåÊú¨È°µÈù¢‰ªÖ‰∏∫Ë¥¢ÈòÄÂØåÂ©ÜÁöÑËµõÂçöÊ®°ÊãüÁªèËê•„ÄÇ
                </div>
            </div>

            <!-- Êìç‰ΩúÂè∞ -->
            <div style="background:#fff; border-radius:24px; padding:25px 20px; box-shadow:0 4px 15px rgba(0,0,0,0.02); border:1px solid #f0f0f0;">
                <div style="display:flex; justify-content:space-between; font-size:11px; margin-bottom:10px; color:#666; font-weight:600;">
                    <span>Ë¥¢Âõ¢ÂèØÁî®ËµÑÈáëÔºö</span>
                    <span style="color:#111;">¬• <span id="idol-available-balance">0.00</span></span>
                </div>

                <input type="number" id="idol-amount-input" placeholder="ËæìÂÖ•‰Ω†ÊÉ≥ÊäïËµÑÁöÑÈáëÈ¢ù..." style="width:100%; border:none; border-bottom:2px solid #eee; padding:15px 5px; outline:none; font-family:'Montserrat', sans-serif; font-size:18px; font-weight:700; margin-bottom:20px; transition:0.3s; background:transparent;" onfocus="this.style.borderBottomColor='#111';" onblur="this.style.borderBottomColor='#eee';">

                <button id="idol-start-btn" class="pay-pill-btn" style="width:100%; height:48px; font-size:13px; font-weight:700; letter-spacing:1px; border-radius:12px;" onclick="prepareIdolProject()">Á°ÆËÆ§Ê≥®ËµÑ</button>
                
                <!-- ÈöêËóèÁöÑ 3 ‰∏™Êú∫ÂØÜÊ°£Ê°àË¢ãÔºàÁî®‰∫éÁõ≤ÈÄâ‰∫íÂä®Ôºâ -->
                <div id="idol-files-area" style="display:none; margin-top:20px;">
                    <div style="font-size:11px; color:#111; font-weight:700; text-align:center; margin-bottom:15px;">ÁåéÂ§¥Â∑≤ÂèëÊù•‰∏â‰ªΩÊú∫ÂØÜÊ°£Ê°àÔºåËØ∑Âá≠ÂÄüÁõ¥ËßâÁõ≤ÈÄâ‰∏Ä‰ΩçÔºö</div>
                    <div style="display:flex; justify-content:space-between; gap:10px;">
                        <div class="idol-file" onclick="openIdolFile(this)" style="flex:1; background:#f9f9f9; border:1px solid #ddd; border-radius:12px; padding:25px 0; text-align:center; cursor:pointer; transition:0.2s;">
                            <i class="fas fa-folder-open" style="font-size:24px; color:#555; margin-bottom:8px;"></i><br><span style="font-size:10px; font-weight:700; color:#333;">FILE 01</span>
                        </div>
                        <div class="idol-file" onclick="openIdolFile(this)" style="flex:1; background:#f9f9f9; border:1px solid #ddd; border-radius:12px; padding:25px 0; text-align:center; cursor:pointer; transition:0.2s;">
                            <i class="fas fa-folder-open" style="font-size:24px; color:#555; margin-bottom:8px;"></i><br><span style="font-size:10px; font-weight:700; color:#333;">FILE 02</span>
                        </div>
                        <div class="idol-file" onclick="openIdolFile(this)" style="flex:1; background:#f9f9f9; border:1px solid #ddd; border-radius:12px; padding:25px 0; text-align:center; cursor:pointer; transition:0.2s;">
                            <i class="fas fa-folder-open" style="font-size:24px; color:#555; margin-bottom:8px;"></i><br><span style="font-size:10px; font-weight:700; color:#333;">FILE 03</span>
                        </div>
                    </div>
                </div>
            </div>

            <div style="font-size:12px; font-weight:700; color:#111; margin-top:10px; letter-spacing:1px;">ÂÖ¨Âè∏ÊäïËµÑË¥¢Êä•</div>
            <div id="idol-history-list" style="display:flex; flex-direction:column; gap:10px;">
                <div style="text-align:center; font-size:11px; color:#aaa; padding:20px;">Â∞öÊó†ÈÄ†ÊòüËÆ∞ÂΩï</div>
            </div>
            
            <div style="height: 60px;"></div>
        </div>
    </div>



</div>
<!-- Pay Ê®°ÂùóÁªìÊùü -->


<!-- ============================================== -->
<!-- [ÂÖ®Êñ∞ÈáçÂà∂Áâà] Êä¢ÈáëÂ∏ÅÂ∞èÊ∏∏ÊàèÂÖ®Â±èÈÅÆÁΩ© (Èü©Á≥ªÂ•∂Ê≤πÁ£®Á†ÇÈ£é) -->
<!-- ============================================== -->
<div id="coin-game-view" class="app-fullscreen-view" style="background: rgba(248, 249, 250, 0.85); z-index:4000; backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);">
    <div style="padding: 80px 24px 20px; text-align:center; display: flex; flex-direction: column; align-items: center;">
        <div style="font-family: 'Montserrat', sans-serif; font-size:26px; font-weight:900; color: #2b2b2b; letter-spacing: 1px;">COIN RUSH.</div>
        <div id="cg-target" style="font-size:12px; margin-top:12px; color:#b45309; background: rgba(245, 158, 11, 0.1); padding: 6px 16px; border-radius: 20px; font-weight: 600;">ÁõÆÊ†áÔºöÊî∂ÈõÜ 10 ‰∏™ÈáëÂ∏Å</div>
        
        <div style="display: flex; justify-content: space-around; width: 100%; margin-top: 35px; background: #fff; border-radius: 24px; padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.03); border: 1px solid rgba(0,0,0,0.02);">
            <div style="display: flex; flex-direction: column;">
                <span style="font-size:10px; color:#999; font-weight: 600; letter-spacing: 1px;">TIME LEFT</span>
                <span id="cg-countdown" style="font-size:38px; font-weight:300; color:#2b2b2b; font-family:'Montserrat', sans-serif;">10.0</span>
            </div>
            <div style="width: 1px; background: #f0f0f0;"></div>
            <div style="display: flex; flex-direction: column;">
                <span style="font-size:10px; color:#999; font-weight: 600; letter-spacing: 1px;">COLLECTED</span>
                <span id="cg-score" style="font-size:38px; font-weight:700; color:#07c160; font-family:'Montserrat', sans-serif;">0</span>
            </div>
        </div>
    </div>
    
    <!-- ÈáëÂ∏ÅÁîüÊàêËàûÂè∞ -->
    <div id="cg-play-area" style="flex:1; position:relative; overflow:hidden;"></div>
</div>

<!-- ============================================== -->
<!-- [Êñ∞Â¢û] Èí±ÂåÖ‰∏ìÂ±ûÔºöÈü©Á≥ªÈ´òÁ∫ßÂÆöÂà∂ÂºπÁ™ó (Êõø‰ª£Á≥ªÁªü Alert/Prompt) -->
<!-- ============================================== -->
<div id="k-dialog-overlay" class="modal-overlay" style="z-index: 5000;">
    <div class="modal-box" style="width: 300px; padding: 0; border-radius: 24px; text-align: center; background: rgba(255,255,255,0.95); backdrop-filter: blur(20px);">
        <div style="padding: 30px 20px 20px;">
            <div id="k-dialog-title" style="font-size: 16px; font-weight: 700; color: #2b2b2b; margin-bottom: 10px;">ÊèêÁ§∫</div>
            <div id="k-dialog-desc" style="font-size: 13px; color: #666; line-height: 1.6; margin-bottom: 20px;">ÂÜÖÂÆπ</div>
            <!-- ‰ªÖÂú® Prompt Ê®°Âºè‰∏ãÊòæÁ§∫ÁöÑËæìÂÖ•Ê°Ü -->
            <input type="number" id="k-dialog-input" style="display:none; width: 100%; border: 1px solid #eee; background: #f9f9f9; padding: 12px 15px; border-radius: 12px; font-size: 16px; text-align: center; outline: none; transition: 0.3s;">
        </div>
        <div style="display: flex; border-top: 1px solid #f0f0f0;">
            <div id="k-dialog-cancel" style="flex: 1; padding: 15px 0; font-size: 14px; color: #999; cursor: pointer; border-right: 1px solid #f0f0f0;">ÂèñÊ∂à</div>
            <div id="k-dialog-confirm" style="flex: 1; padding: 15px 0; font-size: 14px; font-weight: 700; color: #2b2b2b; cursor: pointer;">Á°ÆÂÆö</div>
        </div>
    </div>
</div>

<!-- === [Êõ¥Êñ∞Áâà] Ë∫´‰ªΩÁÆ°ÁêÜÂºπÁ™ó === -->
<div id="identity-modal" class="modal-overlay">
  <div class="modal-box" style="width:340px;">
    <div class="modal-header">
      <span>Ë∫´‰ªΩÂàáÊç¢</span>
      <i class="fas fa-times" onclick="closeIdentityModal()"></i>
    </div>
    
    <div class="modal-body" style="padding:20px; max-height:450px; overflow-y:auto;">
      
      <!-- 1. È°∂ÈÉ®Â§¥ÂÉèÈ¢ÑËßà (Ëá™Âä®Âèò) -->
      <div class="id-avatar-preview-box">
          <img id="id-preview-img" src="https://api.dicebear.com/7.x/avataaars/svg?seed=new">
      </div>

      <div class="form-group">
        <label>ÈÄâÊã©Ë∫´‰ªΩ</label>
        <select id="identity-select" onchange="onIdentitySelectChange(this.value)" style="width:100%; height:40px; border:1px solid #ddd; border-radius:8px; padding:0 10px;"></select>
      </div>

      <hr class="settings-divider" style="margin:15px 0;">

      <div class="form-group">
        <label>ÂßìÂêç</label>
        <input id="id-name" type="text" placeholder="‰æãÂ¶ÇÔºöHannah">
      </div>

      <!-- ÊÄßÂà´ÔºöÈÄâËá™ÂÆö‰πâÊó∂ÊòæÁ§∫ËæìÂÖ•Ê°Ü -->
      <div class="form-group">
        <label>ÊÄßÂà´</label>
        <div style="display:flex; gap:10px;">
            <select id="id-gender-select" onchange="toggleIdGenderInput(this.value)" style="flex:1; height:40px; border:1px solid #ddd; border-radius:8px; padding:0 10px;">
              <option value="Â•≥">Â•≥</option>
              <option value="Áî∑">Áî∑</option>
              <option value="custom">Ëá™ÂÆö‰πâ</option>
            </select>
            <!-- Ëá™ÂÆö‰πâÊÄßÂà´ËæìÂÖ•Ê°Ü (ÈªòËÆ§ÈöêËóè) -->
            <input id="id-gender-input" type="text" placeholder="ËæìÂÖ•ÊÄßÂà´" style="flex:1; display:none;">
        </div>
      </div>

      <div class="form-group">
        <label>Â§¥ÂÉèËÆæÁΩÆ</label>
        <div style="display:flex; gap:10px;">
            <input id="id-avatar-url" type="text" placeholder="ÂõæÁâá URL..." oninput="updateIdPreview(this.value)">
            <button class="btn-secondary" onclick="document.getElementById('id-avatar-file').click()" style="width:50px; padding:0;"><i class="fas fa-upload"></i></button>
            <input id="id-avatar-file" type="file" accept="image/*" style="display:none" onchange="handleIdAvatarFile(this)">
        </div>
      </div>

      <div class="form-group">
        <label>ÊúãÂèãÂúàËÉåÊôØÂõæ (Moments Cover)</label>
        <input id="id-moments-bg" type="text" placeholder="ÁïôÁ©∫Âàô‰ΩøÁî®ÈªòËÆ§ËÉåÊôØ">
      </div>

      <div class="form-group">
        <label>ÊàëÁöÑ‰∫∫ËÆæ</label>
        <textarea id="id-persona" rows="2" placeholder="Ëøô‰∏™Ë∫´‰ªΩÁöÑËÆæÂÆö..."></textarea>
      </div>

    </div>
    <div class="modal-footer" style="padding:15px 20px;">
      <button class="btn-cancel" onclick="createNewIdentity()" style="font-size:12px;">Êñ∞Âª∫</button>
      <button class="btn-cancel" onclick="deleteCurrentIdentity()" style="font-size:12px; color:red;">Âà†Èô§</button>
      <button class="btn-confirm" onclick="saveAndSwitchIdentity()">‰øùÂ≠òÂπ∂ÂàáÊç¢</button>
    </div>
  </div>
</div>
<!-- === [Êñ∞Â¢û] Èí±ÂåÖ-ÂºÄÈÄö‰∫≤ÂØÜ‰ªòÂºπÁ™ó === -->
<div id="modal-bind-intimate" class="modal-overlay">
    <div class="modal-box" style="width:320px;">
        <div class="modal-header">
            <span>ÂºÄÈÄö‰∫≤ÂØÜ‰ªò</span>
            <i class="fas fa-times" onclick="document.getElementById('modal-bind-intimate').classList.remove('active')"></i>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>ÈÄâÊã©ÂΩìÂâç‰∫∫ËÆæÁöÑAIÂ•ΩÂèã</label>
                <select id="intimate-ai-select" style="width:100%; height: 40px; border:1px solid #eee; border-radius:8px; padding:0 10px; background: #fff;"></select>
            </div>
            <div class="form-group">
                <label>ËÆæÁΩÆÊØèÊúàÈ¢ùÂ∫¶ (ÂÖÉ)</label>
                <div style="display:flex; gap:10px; margin-bottom: 10px;">
                    <button class="btn-secondary" onclick="document.getElementById('intimate-limit-input').value='520'">520</button>
                    <button class="btn-secondary" onclick="document.getElementById('intimate-limit-input').value='5200'">5200</button>
                    <button class="btn-secondary" onclick="document.getElementById('intimate-limit-input').value='Êó†Èôê'">Êó†ÈôêÈ¢ù</button>
                </div>
                <input type="text" id="intimate-limit-input" placeholder="ËæìÂÖ•Ëá™ÂÆö‰πâÊï∞Â≠óÊàñÂ°´ÂÜô 'Êó†Èôê'" style="width:100%; height: 40px; border:1px solid #eee; border-radius:8px; padding:0 15px; font-size:14px; box-sizing:border-box;">
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-cancel" onclick="document.getElementById('modal-bind-intimate').classList.remove('active')">ÂèñÊ∂à</button>
            <button class="btn-confirm" onclick="confirmBindIntimate()">Á°ÆÂÆöÂºÄÈÄö</button>
        </div>
    </div>
</div>



</body>
</html>
