
/* =========================================
   [极致美化] 线下模式沉浸式排版与剧情选项
   ========================================= */


.vn-option-btn:hover {
    background: #000;
    transform: translateY(-2px);
    box-shadow: 0 12px 25px rgba(0,0,0,0.2);
    border-color: #fff;
}

.vn-option-btn:active {
    transform: scale(0.98);
}

textarea#custom-css-input {
    width: 100%;
    height: 120px;
    padding: 10px;
    background: #282c34; /* 代码编辑器风格深色背景 */
    color: #abb2bf;
    border: 1px solid #e0e0e0;
    border-radius: 12px;
    font-family: 'Consolas', 'Monaco', monospace; /* 代码字体 */
    font-size: 11px;
    resize: vertical;
    line-height: 1.4;
    outline: none;
    transition: box-shadow 0.3s;
}

textarea#custom-css-input:focus {
    box-shadow: 0 0 0 2px rgba(0,0,0,0.1);
    border-color: #333;
}

/* 辅助按钮（灰色按钮）样式 */
.btn-secondary {
    flex: 1;
    height: 40px;
    border-radius: 10px;
    background: #fff;
    border: 1px solid #ddd;
    color: #333;
    font-size: 12px;
    font-weight: 500;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 8px;
    transition: all 0.2s;
}

.btn-secondary:hover {
    background: #f5f5f5;
    border-color: #999;
}

/* 修正 label 作为按钮时的默认边距 */
.file-btn {
    margin: 0; 
}

/* =========================================
   全局变量修正 (韩系高定配色系统 - 纯净版)
   ========================================= */
:root {
    /* 基础变量 */
    --bg-color: #f7f7f7;
    --phone-bg-image: none;
    --global-font: 'Montserrat', sans-serif;
    --font-scale: 1;
    --theme-text-color: #222222;
    
    /* === 韩系纯净风格变量 === */
    --k-bg: #fcfcfc;                /* 极亮奶白背景 (无波点) */
    --k-card: #ffffff;              /* 纯白卡片 */
    --k-text-dark: #2b2b2b;         /* 深炭灰 */
    --k-text-sub: #999999;          /* 浅灰文字 */
    --k-accent-grey: #f5f5f7;       /* 装饰性浅灰 */
    --k-border: 1px solid rgba(0,0,0,0.04); /* 极细边框 */
    --k-shadow: 0 8px 25px rgba(0,0,0,0.03); /* 更柔和的投影 */
    --k-radius-lg: 32px;            /* 大圆角 */
}

/* =========================================
   1. 聊天窗口与设置窗口 (纯净美化版)
   ========================================= */
.chat-view, .settings-view {
    position: absolute; inset: 0;
    /* 改为纯色背景，去掉波点 */
    background: #fafafa;
    z-index: 200;
    transform: translateY(100%) scale(0.96);
    opacity: 0;
    transition: all 0.5s cubic-bezier(0.16, 1, 0.3, 1);
    display: flex; flex-direction: column;
    border-radius: 40px;
    overflow: hidden;
}
.settings-view { z-index: 210; background: #fff; } 
.chat-view.show, .settings-view.show { transform: translateY(0) scale(1); opacity: 1; }

/* 头部统一美化 */
.chat-header, .settings-header {
    padding: 55px 24px 15px;
    display: flex; justify-content: space-between; align-items: center;
    font-weight: 700; font-size: 16px; color: var(--k-text-dark);
    background: rgba(255,255,255,0.95); /* 更不透明一点，保持干净 */
    backdrop-filter: blur(15px);
    border-bottom: var(--k-border);
    flex-shrink: 0;
}
.chat-header i, .settings-header i { font-size: 18px; color: #444; cursor: pointer; padding: 5px; }




.message-bubble.sent { 
    background: #333; color: #fff; 
    border-bottom-right-radius: 4px;
    align-self: flex-end; 
}
.message-bubble.received { 
    background: #fff; color: #333; 
    border: var(--k-border);
    border-bottom-left-radius: 4px;
    align-self: flex-start; 
}

/* 输入框区域 */
.chat-input-area { 
    padding: 15px 20px 35px;
    background: #fff;
    border-top: var(--k-border);
}

.chat-input-form:focus-within { background: #fff; border-color: #ddd; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
.chat-input-form input { font-size: 14px; color: #333; }
.chat-input-form button {
    width: 38px; height: 38px;
    background: #222; border-radius: 50%;
    color: #fff; display: flex; justify-content: center; align-items: center;
    font-size: 13px;
}

/* =========================================
   2. 微信全屏应用 (纯净修复版)
   ========================================= */

/* 主容器 */
.app-fullscreen-view {
    position: absolute; inset: 0;
    /* 核心修改：使用纯色背景变量，移除 gradients */
    background-color: var(--k-bg); 
    z-index: 150;
    transform: translateY(100%);
    transition: transform 0.5s cubic-bezier(0.2, 0.8, 0.2, 1);
    display: flex; flex-direction: column;
    border-radius: 40px;
    overflow: hidden;
}
.app-fullscreen-view.open { transform: translateY(0); }

/* 微信顶部 */
.wc-header {
    height: 110px;
    padding: 60px 24px 10px;
    display: flex; justify-content: space-between; align-items: center;
    background: transparent;
    flex-shrink: 0; z-index: 50;
}
#wc-header-title { 
    font-weight: 800; font-size: 28px; color: var(--k-text-dark); letter-spacing: -1px;
}
.wc-header-icons { display: flex; gap: 15px; }
.wc-header-icons i { 
    width: 36px; height: 36px; background: #fff; 
    border-radius: 50%; display: flex; align-items: center; justify-content: center;
    font-size: 14px; color: #333; box-shadow: var(--k-shadow);
}

/* 内容滚动区 */
.wc-body-container { 
    flex: 1; overflow-y: auto; 
    padding-bottom: 120px; 
    padding-top: 10px;
    width: 100%;
}
.wc-body-container::-webkit-scrollbar { display: none; }
.wc-tab-content { animation: fadeIn 0.4s ease; }

/* --- 搜索框组件 --- */
.wc-search-container { padding: 0 24px 15px; }
.wc-search-bar {
    background: #fff; height: 48px; border-radius: 18px;
    display: flex; align-items: center; padding: 0 20px;
    color: var(--k-text-sub); font-size: 13px; font-weight: 500;
    box-shadow: var(--k-shadow);
    border: var(--k-border);
}

/* --- 列表项 (聊天 & 通讯录) --- */
.wc-chat-item, .wc-contact-row {
    background: #fff; /* 纯白背景 */
    margin: 0 24px 14px;
    padding: 16px;
    border-radius: 24px;
    display: flex; align-items: center; gap: 16px;
    box-shadow: var(--k-shadow); /* 奶油投影 */
    border: 1px solid rgba(255,255,255,0.5);
    transition: 0.2s;
    cursor: pointer;
}
.wc-chat-item:active, .wc-contact-row:active { transform: scale(0.98); }

/* 头像 */
.wc-avatar {
    width: 52px; height: 52px; flex-shrink: 0;
    border-radius: 18px;
    overflow: hidden; position: relative;
    background: #eee;
    border: 2px solid #fff;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}
.wc-avatar.system { 
    display: flex; justify-content: center; align-items: center; 
    background: #f0f2f5; 
}
.wc-avatar img { width: 100%; height: 100%; object-fit: cover; }
.wc-badge { 
    position: absolute; top: -2px; right: -2px; width: 12px; height: 12px; 
    background: #ff5e5e; border-radius: 50%; border: 2px solid #fff; 
}

/* 文字排版 */
.wc-info { flex: 1; display: flex; flex-direction: column; justify-content: center; overflow: hidden; }
.wc-top-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
.wc-name { font-weight: 700; font-size: 15px; color: var(--k-text-dark); }
.wc-time { font-size: 10px; color: #bbb; background: #f8f8f8; padding: 2px 6px; border-radius: 6px; }
.wc-msg-preview { 
    font-size: 12px; color: #888; 
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis; 
}

/* --- 朋友圈 (Moments) --- */
.moments-header-bg {
    height: 220px;
    margin: -80px -24px 20px -24px; 
    border-radius: 0 0 40px 40px;
    position: relative;
    background-size: cover; background-position: center;
}
.user-avatar-overlay {
    position: absolute; bottom: -25px; right: 30px;
    width: 80px; height: 80px; border-radius: 24px;
    border: 4px solid var(--k-bg); /* 纯色边框 */
    box-shadow: var(--k-shadow);
    z-index: 2;
}
.user-avatar-overlay img { width: 100%; height: 100%; object-fit: cover; border-radius: 20px; }
.user-name-overlay { 
    position: absolute; right: 125px; bottom: 10px;
    font-weight: 800; color: #fff; font-size: 18px;
    text-shadow: 0 2px 5px rgba(0,0,0,0.3);
}

.moment-card {
    background: #fff;
    margin: 40px 24px 20px;
    padding: 20px;
    border-radius: 28px;
    box-shadow: var(--k-shadow);
    display: flex; gap: 15px;
}
.moment-avatar { width: 40px; height: 40px; border-radius: 12px; overflow: hidden; flex-shrink: 0; }
.moment-avatar img { width: 100%; height: 100%; object-fit: cover; }
.moment-content { flex: 1; }
.moment-name { font-weight: 700; color: #333; margin-bottom: 8px; font-size: 14px; }
.moment-text { font-size: 13px; color: #555; line-height: 1.5; margin-bottom: 10px; }
.moment-meta { display: flex; justify-content: space-between; align-items: center; margin-top: 12px; }
.moment-meta span { font-size: 11px; color: #ccc; }
/* === 动态朋友圈扩展 === */
.moment-name-row {
    display:flex;
    justify-content:space-between;
    align-items:center;
}

.moment-card-actions i {
    font-size:12px;
    color:#bbb;
    margin-left:8px;
    cursor:pointer;
}
.moment-card-actions i:hover {
    color:#666;
}

/* 点赞胶囊 */
.moment-like-pill {
    background:#f1f2f6;
    padding:4px 10px;
    border-radius:15px;
    font-size:10px;
    color:#555;
    cursor:pointer;
    display:flex;
    align-items:center;
    gap:4px;
}
.moment-like-pill.liked {
    background:#ffe9e9;
    color:#ff5e5e;
}

/* 评论列表 */
.moment-comments {
    margin-top:6px;
    border-top:1px solid #f3f3f3;
    padding-top:4px;
}
.moment-comment {
    font-size:11px;
    color:#555;
    margin-bottom:3px;
}
.moment-comment-author {
    font-weight:600;
    margin-right:4px;
}
.moment-comment-ai .moment-comment-author {
    color: #333333; /* 改成深灰黑色 */
    font-weight: 700; /* 加粗一点表示是AI/好友 */
}

/* 评论输入行 */
.moment-comment-input-row {
    margin-top:6px;
    display:flex;
    gap:6px;
}
.moment-comment-input-row input {
    flex:1;
    border-radius:12px;
    border:1px solid #e0e0e0;
    padding:4px 8px;
    font-size:11px;
    background:#fafafa;
}
.moment-comment-input-row button {
    border:none;
    border-radius:12px;
    padding:0 10px;
    font-size:11px;
    background:#2b2b2b;
    color:#fff;
    cursor:pointer;
}

/* AI 图片灰色占位 - 仅保留灰色爱心 */
.moment-image-ai {
    width: 100%;
    height: 120px;
    border-radius: 15px;
    background: #e5e5e5;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.4s ease;
    position: relative;
    overflow: hidden;
    color: transparent; /* 默认隐藏文字 */
    font-size: 13px;
    padding: 15px;
    text-align: center;
    box-sizing: border-box;
}

/* 初始状态的灰色爱心 */
.moment-image-ai::before {
    content: "\f004"; /* FontAwesome 爱心图标 */
    font-family: "Font Awesome 6 Free";
    font-weight: 900;
    font-size: 30px;
    color: #bbbbbb;
    position: absolute;
    transition: opacity 0.3s;
}

/* 点击后变白并显示文字的状态 */
.moment-image-ai.revealed {
    background: #ffffff !important;
    color: #333333 !important;
    border: 1px solid #eeeeee;
}

.moment-image-ai.revealed::before {
    opacity: 0; /* 变白后隐藏爱心 */
}


/* --- 个人中心 (Me) --- */
.wc-me-header {
    background: #fff; margin: 0 24px 20px; padding: 25px;
    border-radius: 30px;
    display: flex; align-items: center; gap: 20px;
    box-shadow: var(--k-shadow);
}
.wc-avatar.lg { width: 70px; height: 70px; border-radius: 22px; }
.wc-me-info { display: flex; flex-direction: column; }
.wc-me-name { font-size: 20px; font-weight: 800; color: #222; }
.wc-me-id { font-size: 11px; color: #999; margin-top: 5px; letter-spacing: 0.5px; }

.wc-menu-group {
    background: #fff; margin: 0 24px 15px;
    border-radius: 24px; overflow: hidden;
    box-shadow: var(--k-shadow);
}
.wc-menu-item {
    display: flex; align-items: center;
    padding: 18px 20px;
    border-bottom: 1px solid #f9f9f9;
    cursor: pointer; transition: 0.2s;
}
.wc-menu-item:last-child { border-bottom: none; }
.wc-menu-item:active { background: #fafafa; }
.menu-icon { width: 24px; font-size: 16px; color: #333; margin-right: 12px; display: flex; justify-content: center; }
.wc-menu-item span { flex: 1; font-size: 14px; font-weight: 600; color: #444; }
.arrow { color: #ddd !important; }

/* =========================================
   3. 底部导航栏 (胶囊悬浮岛风格)
   ========================================= */
.wc-tab-bar {
    position: absolute;
    bottom: 30px; left: 40px; right: 40px;
    height: 70px;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(20px);
    border-radius: 35px;
    display: flex; justify-content: space-evenly; align-items: center;
    box-shadow: 0 15px 40px rgba(0,0,0,0.08);
    border: 1px solid rgba(255,255,255,0.6);
    z-index: 100;
}

.wc-tab-item {
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    color: #c0c0c0;
    cursor: pointer; transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    width: 44px; height: 44px; border-radius: 50%;
}
.wc-tab-item i { font-size: 20px; margin: 0; }
.wc-tab-item span { display: none; }

.wc-tab-item.active {
    background: #2b2b2b; /* 深色激活背景 */
    color: #fff;
    transform: translateY(-5px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}
.wc-tab-item.active i { font-size: 18px; }

/* =========================================
   新增：聊天头像布局 (追加到 style.css 最底部)
   ========================================= */

/* 1. 每一行聊天的容器 (用来包住头像和气泡) */
.chat-row {
    display: flex;
    align-items: flex-start; /* 头像和气泡顶部对齐 */
    gap: 12px; /* 头像和气泡之间的距离 */
    width: 100%;
    margin-bottom: 24px; /* 每条消息上下的间距 */
}

/* 2. 接收方 (左边：头像 -> 气泡) */
.chat-row.received {
    flex-direction: row;
    justify-content: flex-start;
}

/* 3. 发送方 (右边：气泡 -> 头像) */
.chat-row.sent {
    flex-direction: row; /* 保持顺序，我们在HTML里调整元素顺序 */
    justify-content: flex-end;
}

/* 4. 头像通用样式 */
.chat-avatar-img {
    width: 42px;
    height: 42px;
    border-radius: 50%; /* 圆形 */
    object-fit: cover;
    flex-shrink: 0; /* 防止被挤扁 */
    box-shadow: 0 4px 10px rgba(0,0,0,0.1); /* 给头像一点立体感 */
    border: 2px solid #fff; /* 给头像加个白边，更精致 */
}

/* 5. 调整气泡样式，去掉之前的绝对定位装饰，防止错位 */
.message-bubble {
    max-width: 70% !important; /* 因为加了头像，气泡最大宽度稍微减小 */
    margin: 0 !important; /* 去掉默认边距，由 chat-row 控制 */
    position: relative;
    top: 10px; /* 稍微往下一点，跟头像视觉中心对齐更好看 */
}

/* 修正：把之前气泡的小装饰点去掉，保持干净 */
.message-bubble.received::before {
    display: none !important;
}
/* =========================================
   新增：微信右上角下拉菜单样式
   ========================================= */

/* 菜单容器：默认隐藏，绝对定位 */
.wc-plus-dropdown {
    position: absolute;
    top: 40px;
    right: -10px;
    width: 160px;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px); /* 磨砂玻璃效果 */
    border-radius: 12px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.15); /* 漂亮的阴影 */
    border: 1px solid rgba(0,0,0,0.05);
    
    padding: 8px 0;
    z-index: 1000;
    
    /* 动画初始状态 */
    opacity: 0;
    transform: translateY(-10px) scale(0.95);
    pointer-events: none; /* 看不见时不能点 */
    transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    transform-origin: top right;
}

/* 菜单激活显示状态 */
.wc-plus-dropdown.active {
    opacity: 1;
    transform: translateY(0) scale(1);
    pointer-events: auto;
}

/* 菜单里的小选项 */
.wc-menu-option {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 20px;
    font-size: 13px;
    color: #333;
    cursor: pointer;
    transition: background 0.2s;
}

.wc-menu-option:hover {
    background: #f5f5f5; /* 鼠标悬停变灰 */
}

.wc-menu-option i {
    width: 24px;
    text-align: center;
    font-size: 16px;
    color: #333;
    
    /* === 强制去掉继承的白色背景和椭圆样式 === */
    background: transparent !important; 
    box-shadow: none !important;
    height: auto !important;
    border-radius: 0 !important;
    display: inline-block !important;
    padding: 0 !important;
    border: none !important;
}


/* 加上一个小三角形指向图标，显得更精致 */
.wc-plus-dropdown::before {
    content: '';
    position: absolute;
    top: -6px;
    right: 15px;
    width: 12px;
    height: 12px;
    background: rgba(255, 255, 255, 0.95);
    transform: rotate(45deg);
    border-top: 1px solid rgba(0,0,0,0.05);
    border-left: 1px solid rgba(0,0,0,0.05);
    border-radius: 2px;
}
/* =========================================
   新增：添加好友弹窗样式 (复制到 style.css 最底部)
   ========================================= */

/* 1. 遮罩层：全屏变暗 */
.modal-overlay {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.4); /* 半透明黑背景 */
    backdrop-filter: blur(5px); /* 背景模糊 */
    z-index: 2000; /* 保证在最上层 */
    display: flex;
    justify-content: center;
    align-items: center;
    opacity: 0;
    pointer-events: none; /* 看不见时不能点 */
    transition: opacity 0.3s ease;
}

/* 激活状态 */
.modal-overlay.active {
    opacity: 1;
    pointer-events: auto;
}

/* 2. 弹窗主体：白色圆角盒子 */
.modal-box {
    width: 320px;
    background: #fff;
    border-radius: 24px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.15);
    transform: scale(0.9); /* 初始稍微缩小 */
    transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); /* 弹性动画 */
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.modal-overlay.active .modal-box {
    transform: scale(1); /* 激活时放大回正常 */
}

/* 3. 弹窗标题 */
.modal-header {
    padding: 20px 24px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-weight: 700;
    font-size: 16px;
    color: #333;
    border-bottom: 1px solid #f0f0f0;
    background: #fff;
}

.modal-header i {
    color: #999;
    cursor: pointer;
    padding: 5px;
}

/* 4. 输入区域 */
.modal-body {
    padding: 20px 24px;
    max-height: 450px; /* 防止太高超出屏幕 */
    overflow-y: auto;
    background: #fafafa;
}

.modal-body .input-group {
    margin-bottom: 15px;
}

.modal-body label {
    display: block;
    font-size: 12px;
    color: #666;
    margin-bottom: 6px;
    font-weight: 600;
}

.modal-body input, .modal-body textarea {
    width: 100%;
    padding: 12px 14px;
    border: 1px solid #e0e0e0;
    background: #fff;
    border-radius: 12px;
    font-family: inherit;
    font-size: 13px;
    outline: none;
    /* 修改了动画效果，让拉动时更跟手 */
    transition: border-color 0.2s, box-shadow 0.2s;
    color: #333;
}

/* 这是专门加给多行输入框的限制 */
.modal-body textarea {
    resize: vertical; /* 关键：这句代码让它只能上下拉，不能左右拉 */
    min-height: 60px; /* 防止拉得太小 */
    max-height: 250px; /* 防止拉得太大 */
}


.modal-body input:focus, .modal-body textarea:focus {
    border-color: #333;
    box-shadow: 0 0 0 3px rgba(0,0,0,0.05);
}

/* 5. 底部按钮 */
.modal-footer {
    padding: 15px 24px 20px;
    display: flex;
    gap: 12px;
    background: #fff;
    border-top: 1px solid #f0f0f0;
}

.btn-cancel, .btn-confirm {
    flex: 1;
    height: 44px;
    border-radius: 12px;
    border: none;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: 0.2s;
}

.btn-cancel {
    background: #f5f5f5;
    color: #666;
}
.btn-cancel:hover { background: #e0e0e0; }

.btn-confirm {
    background: #222;
    color: #fff;
}
.btn-confirm:hover { background: #000; }
/* === [新增] 群聊相关样式 === */

/* 好友勾选列表 */
.friend-checklist {
    max-height: 250px;
    overflow-y: auto;
    border: 1px solid #e0e0e0;
    border-radius: 12px;
    background: #fff;
}

.checklist-item {
    display: flex;
    align-items: center;
    padding: 12px 15px;
    border-bottom: 1px solid #f5f5f5;
    cursor: pointer;
    transition: background 0.2s;
}
.checklist-item:last-child { border-bottom: none; }
.checklist-item:hover { background: #fcfcfc; }

/* 隐藏原生 checkbox，用自定义样式（可选，这里用简单的） */
.checklist-item input[type="checkbox"] {
    width: 18px; height: 18px;
    margin-right: 12px;
    accent-color: #07c160; /* 微信绿 */
    cursor: pointer;
}

.checklist-avatar {
    width: 36px; height: 36px;
    border-radius: 6px;
    margin-right: 10px;
    object-fit: cover;
}

.checklist-name {
    font-size: 14px;
    font-weight: 600;
    color: #333;
}

/* 群聊中：在气泡上方显示发送者名字 */
.chat-sender-name {
    font-size: 11px;
    color: #999;
    margin-bottom: 4px;
    margin-left: 4px; /* 对齐气泡 */
    line-height: 1;
}

/* 调整群聊时的接收消息布局，使其适应名字显示 */
.chat-row.received .message-content-wrapper {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
}
/* =========================================
   [最终修改版] 角色心声卡片 (宽版 + 灰色系)
   ========================================= */

/* 1. 遮罩层 */
.mind-overlay {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.4); 
    backdrop-filter: blur(5px);
    z-index: 3000;
    opacity: 0;
    pointer-events: none;
    transition: all 0.3s ease;
    display: flex;
    justify-content: center;
    align-items: center; 
}
.mind-overlay.active {
    opacity: 1;
    pointer-events: auto;
}

/* 2. 卡片主体：变宽了！ */
.mind-card-box {
    width: 360px; /* <--- 修改：宽度增加到 360px */
    background: rgba(255, 255, 255, 0.96);
    border-radius: 24px;
    padding: 24px; /* 内边距也稍微大一点 */
    
    box-shadow: 
        0 20px 50px rgba(0,0,0,0.2),
        0 0 0 1px rgba(255,255,255,1) inset;
        
    transform: translateY(20px) scale(0.95);
    transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    
    display: flex;
    flex-direction: column;
    gap: 18px; 
}
.mind-overlay.active .mind-card-box {
    transform: translateY(0) scale(1);
}

/* --- 头部 --- */
.mind-header-v5 {
    display: flex; align-items: center; gap: 16px; position: relative;
}
.mind-avatar-area { flex-shrink: 0; }
.mind-big-avatar {
    width: 64px; height: 64px;
    border-radius: 50%; object-fit: cover;
    border: 3px solid #fff;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}
.mind-header-info { flex: 1; display: flex; flex-direction: column; justify-content: center; }
.mind-name { font-size: 19px; font-weight: 800; color: #222; margin-bottom: 6px; }

/* 颜文字：修改为灰色背景 */
#mind-kaomoji-display {
    position: absolute;
    top: 0px; right: 0px;
    font-size: 13px;
    color: #555;          /* <--- 修改：深灰文字 */
    font-weight: 600;
    background: #f0f0f0;  /* <--- 修改：浅灰背景 */
    padding: 5px 10px;
    border-radius: 12px;
    transform: rotate(3deg);
    border: 1px solid #e0e0e0; /* <--- 新增：灰色边框 */
}

/* 好感度条 (保持原来的粉色渐变，比较好看) */
.affection-bar-container { width: 100%; }
.affection-bar-label { display: flex; justify-content: space-between; font-size: 10px; color: #999; margin-bottom: 4px; font-weight: 600; }
.affection-progress-bar { height: 8px; background: #f0f0f0; border-radius: 4px; overflow: hidden; }
#affection-fill {
    height: 100%;
    background: linear-gradient(90deg, #ffdde1 0%, #ee9ca7 100%);
    border-radius: 4px;
    transition: width 0.5s ease;
}

/* --- 中间状态网格 (修改版) --- */
.mind-status-tags {
    display: grid; 
    /* 1. 这里改成了两列：左边占2份(地点)，右边占1份(天气) */
    grid-template-columns: 2fr 1fr; 
    gap: 8px;
}

.status-tag {
    background: #f7f8fa;
    padding: 10px 12px;
    border-radius: 14px;
    font-size: 11px;
    color: #666;
    display: flex; align-items: center; gap: 6px;
    border: 1px solid rgba(0,0,0,0.03);
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.status-tag i { color: #aaa; font-size: 12px; }
.status-tag b { color: #333; font-weight: 600; }

/* 2. 新增规则：只要加上 full-row 这个名字，或者 BGM 标签，就让它占满整行 */
.status-tag.full-row, 
.status-tag.now-playing-tag {
    grid-column: 1 / -1; /* 强制跨越整行 */
    background: #fff;    /* 背景改白一点，显眼 */
    border: 1px solid #eee;
}

/* BGM 的转圈动画保留 */
.status-tag.now-playing-tag i { color: #ff7e67; animation: spin 4s linear infinite; }
.marquee-container { flex: 1; overflow: hidden; white-space: nowrap; position: relative; mask-image: linear-gradient(90deg, transparent 0%, #000 5%, #000 95%, transparent 100%); }
.marquee-container b { display: inline-block; animation: marquee 8s linear infinite; padding-left: 100%; }

/* --- 底部心声 --- */
.mind-thoughts-container { display: flex; flex-direction: column; gap: 12px; }
.thought-bubble { position: relative; padding: 14px 16px; border-radius: 18px; font-size: 13px; line-height: 1.5; }

/* 碎碎念 */
.thought-bubble.murmur {
    background: #f5f5f5; color: #444; border-bottom-left-radius: 4px;
}
.thought-bubble.murmur .bubble-label { font-size: 9px; color: #aaa; margin-bottom: 3px; font-weight: 700; }

/* 小心思：修改为灰色背景 + 虚线框 */
.thought-bubble.hidden-thought {
    background: #fcfcfc;      /* <--- 修改：极淡的灰白 */
    border: 1px dashed #ccc;  /* <--- 修改：灰色虚线 */
    color: #333;              /* <--- 修改：深黑文字 */
    border-bottom-right-radius: 4px;
}
.thought-bubble.hidden-thought .bubble-label {
    font-size: 9px; 
    color: #888;              /* <--- 修改：灰色标签 */
    margin-bottom: 3px; 
    font-weight: 700;
}
/* 字体动态内容 */
.bubble-content { font-weight: 500; min-height: 19px; }

/* === 新增：弹窗内的小标题样式 === */
.settings-section-title {
    font-size: 14px;
    font-weight: 700;
    color: #333;
    margin-bottom: 15px;
    padding-left: 10px;
    border-left: 4px solid #2b2b2b; /* 左侧加一个深色竖条 */
    line-height: 1.2;
    letter-spacing: 0.5px;
}
/* =========================================
   新增：聊天设置独立页面样式
   ========================================= */
.chat-settings-page-view {
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    background-color: var(--k-bg); /* 使用全局背景色变量 */
    z-index: 300; /* 层级比聊天窗口更高 */
    display: flex;
    flex-direction: column;
    /* 默认状态：位移到屏幕右侧之外 */
    transform: translateX(100%); 
    transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1); /* 顺滑的滑入动画 */
    border-radius: 40px; /* 保持圆角一致性 */
    overflow: hidden;
}

/* 激活状态：滑入屏幕 */
.chat-settings-page-view.show {
    transform: translateX(0);
}

/* 页面头部 */
.chat-settings-page-header {
    height: 100px; /* 与其他 header 高度保持一致 */
    padding: 50px 24px 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(15px);
    border-bottom: 1px solid rgba(0,0,0,0.05);
    font-size: 18px;
    font-weight: 600;
    color: var(--k-text-dark);
    flex-shrink: 0;
}

.chat-settings-page-header i {
    cursor: pointer;
    padding: 10px;
    font-size: 20px;
    color: #555;
    transition: color 0.2s;
}
.chat-settings-page-header i:hover {
    color: #111;
}

/* 页面内容滚动区 */
.chat-settings-page-content {
    flex: 1;
    overflow-y: auto;
    padding: 24px 30px;
    background-color: var(--k-bg); 
}


/* =========================================
   [新增] 聊天设置页面新样式 (V2 重构补丁)
   ========================================= */

/* 世界书多选框容器 */
.worldbook-checklist-container {
    max-height: 180px;
    overflow-y: auto;
    border: 1px solid #e0e0e0;
    border-radius: 12px;
    background: #fff;
    padding: 5px;
}

/* 世界书列表项 */
.wb-checklist-item {
    display: flex;
    align-items: center;
    padding: 10px 12px;
    border-radius: 8px;
    cursor: pointer;
    transition: background 0.2s;
}
.wb-checklist-item:hover { background: #f5f5f7; }

/* 列表项里的复选框 */
.wb-checklist-item input[type="checkbox"] {
    width: 18px; height: 18px;
    margin-right: 12px;
    accent-color: #2b2b2b; /* 深色勾选框 */
    flex-shrink: 0;
}
/* 列表项里的文字 */
.wb-checklist-name {
    font-size: 13px; color: #333; font-weight: 500;
}

/* 调整设置页面里的文本域样式，使其更紧凑 */
.chat-settings-page-content textarea {
    padding: 12px;
    line-height: 1.5;
    min-height: 60px;
}

/* 正则输入框特殊样式：不换行，可横向滚动 */
#cs-status-extract-regex, #cs-status-replace-regex {
    white-space: pre; 
    overflow-x: auto;
}
/* === 新增：消息内容包装器样式 (修复竖排问题) === */
.message-content-wrapper {
    display: flex;
    flex-direction: column;
    flex: 1; /* 关键：让它能占满剩余空间 */
    min-width: 0; /* 关键：允许弹性收缩 */
    max-width: calc(100% - 60px); /* 减去头像和间距的宽度 */
}


/* === 专人专用补丁：只修聊天设置里“人设”那个框 === */
#cs-persona {
    width: 100% !important;        /* 强制宽度填满 */
    border-radius: 12px !important; /* 加圆角 */
    border: 1px solid #e0e0e0 !important; /* 加边框 */
    background: #fff !important;   /* 纯白背景 */
    padding: 15px !important;      /* 内部留空隙 */
    box-sizing: border-box !important; /* 关键：防止加了padding后撑爆屏幕 */
    font-family: inherit;          /* 字体跟随系统 */
    outline: none;                 /* 去掉点击时的蓝框 */
    transition: border-color 0.3s; /* 点击时的变色过渡 */
}

/* 鼠标点进去变色 */
#cs-persona:focus {
    border-color: #333 !important;
}
/* =========================================
   [新增] 世界书 App 样式
   ========================================= */

/* 书架网格 */
.wb-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
    padding-bottom: 40px;
}

/* 书籍卡片 */
.wb-book-card {
    background: #fff;
    border-radius: 20px;
    padding: 15px;
    box-shadow: var(--k-shadow);
    border: var(--k-border);
    display: flex;
    flex-direction: column;
    gap: 8px;
    transition: transform 0.2s;
    cursor: pointer;
    position: relative;
    overflow: hidden;
}
.wb-book-card:active { transform: scale(0.96); }

/* 卡片左侧装饰条 (随机色) */
.wb-book-card::before {
    content: '';
    position: absolute; left: 0; top: 0; bottom: 0;
    width: 6px;
    background: #2b2b2b;
}

.wb-card-title { font-weight: 700; font-size: 14px; color: #333; line-height: 1.3; margin-bottom: 5px; }
.wb-card-meta { font-size: 10px; color: #999; display: flex; justify-content: space-between; }
.wb-tag-badge { background: #f0f0f0; padding: 2px 6px; border-radius: 6px; font-size: 9px; color: #666; }

/* 搜索框 */
.wb-search-bar {
    position: relative;
    margin-bottom: 20px;
}
.wb-search-bar input {
    width: 100%; height: 44px;
    border-radius: 22px;
    border: none; background: #fff;
    padding-left: 40px; font-size: 13px;
    box-shadow: var(--k-shadow);
}
.wb-search-bar i {
    position: absolute; left: 15px; top: 14px; color: #999; font-size: 14px;
}

/* 编辑视图 */
.wb-edit-card {
    background: #fff; border-radius: 24px; padding: 20px;
    box-shadow: var(--k-shadow); margin-bottom: 20px;
}

.wb-form-row { display: flex; gap: 15px; margin-bottom: 15px; align-items: center; }
.wb-input-group label { display: block; font-size: 10px; color: #999; margin-bottom: 5px; font-weight: 600; }
.wb-input-group input, .wb-input-group select {
    width: 100%; height: 40px; border: 1px solid #eee; border-radius: 10px;
    padding: 0 10px; font-size: 13px; background: #fafafa;
}

.wb-toggle-group {
    display: flex; flex-direction: column; gap: 5px;
}

/* 条目列表 */
.wb-entries-header {
    display: flex; justify-content: space-between; align-items: center;
    margin-bottom: 10px; font-size: 14px; font-weight: 700; color: #444; padding: 0 5px;
}
.btn-mini-add {
    width: 28px; height: 28px; border-radius: 50%;
    background: #2b2b2b; color: #fff; border: none; cursor: pointer;
    display: flex; justify-content: center; align-items: center; font-size: 12px;
}

.wb-entries-container {
    display: flex; flex-direction: column; gap: 10px;
}

.wb-entry-item {
    background: #fff; padding: 12px 15px; border-radius: 16px;
    border: 1px solid #f5f5f5;
    display: flex; justify-content: space-between; align-items: center;
    cursor: pointer;
}
.wb-entry-info { display: flex; flex-direction: column; gap: 3px; overflow: hidden; }
.wb-entry-keys { font-size: 12px; font-weight: 600; color: #333; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.wb-entry-preview { font-size: 10px; color: #999; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

.wb-action-bar { display: flex; gap: 10px; margin-top: 15px; }
/* =========================================
   [新增] 聊天底部面板 & 富媒体气泡样式
   ========================================= */

/* 1. 面板容器 */
.chat-panels-container {
    background: #f7f7f7;
    height: 0;
    overflow: hidden;
    transition: height 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
    border-top: 1px solid rgba(0,0,0,0.05);
}
.chat-panels-container.open {
    height: 220px; /* 面板展开高度 */
    padding-bottom: 20px;
}
.chat-panel {
    height: 100%;
    padding: 20px;
    overflow-y: auto;
}

/* 2. 加号面板网格 */
.plus-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
}
.plus-item {
    display: flex; flex-direction: column; align-items: center; gap: 8px;
    cursor: pointer;
}
.plus-icon {
    width: 50px; height: 50px;
    background: #fff;
    border-radius: 16px;
    display: flex; justify-content: center; align-items: center;
    font-size: 20px; color: #555;
    box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    transition: 0.2s;
}
.plus-item:active .plus-icon { transform: scale(0.95); background: #e5e5e5; }
.plus-item span { font-size: 11px; color: #888; }

/* 3. 表情面板 */
.emoji-tabs { display: flex; gap: 15px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px;}
.emoji-tabs span { font-size: 12px; color: #999; cursor: pointer; padding: 5px; }
.emoji-tabs span.active { color: #333; font-weight: 700; border-bottom: 2px solid #333; }

.emoji-grid {
    display: grid; grid-template-columns: repeat(8, 1fr); gap: 10px; font-size: 20px; cursor: pointer;
}
.sticker-grid {
    display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 15px;
}
.sticker-grid img { width: 60px; height: 60px; object-fit: contain; cursor: pointer; transition: 0.2s; }
.sticker-grid img:hover { transform: scale(1.1); }


/* =========================================
   [核心] 特殊消息气泡样式
   ========================================= */

/* 通用：富媒体气泡去除默认padding，由内部控制 */
.message-bubble.rich-bubble {
    padding: 0 !important;
    overflow: hidden;
    background: transparent !important;
    box-shadow: none !important;
}

/* 1. 图片消息 */
.msg-image-content {
    border-radius: 12px;
    overflow: hidden;
    max-width: 200px;
}
.msg-image-content img { width: 100%; display: block; }

/* 2. 语音条 */

/* 长按录音中 */
#holdToTalkBtn.recording {
  background: #ff4d4f !important;
  transform: scale(0.98);
}

/* 3. 转账卡片 */
.msg-transfer-card {
    width: 220px;
    background: #fa9d3b;
    border-radius: 12px;
    overflow: hidden;
    color: #fff;
    cursor: pointer;
}
.transfer-top { padding: 15px; display: flex; align-items: center; gap: 12px; }
.transfer-icon { 
    width: 36px; height: 36px; border-radius: 50%; border: 2px solid #fff; 
    display: flex; justify-content: center; align-items: center; font-size: 18px;
}
.transfer-info { display: flex; flex-direction: column; }
.transfer-amount { font-size: 15px; font-weight: 600; }
.transfer-desc { font-size: 11px; opacity: 0.9; }
.transfer-bottom { background: rgba(255,255,255,0.15); padding: 5px 15px; font-size: 10px; color: rgba(255,255,255,0.9); }

/* 4. 位置分享 */
.msg-location-card {
    width: 220px; background: #fff; border-radius: 12px; overflow: hidden;
    border: 1px solid rgba(0,0,0,0.05);
}
.loc-info { padding: 10px 12px; }
.loc-title { font-size: 13px; font-weight: 700; color: #333; display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; overflow: hidden;}
.loc-addr { font-size: 10px; color: #999; margin-top: 2px; }
.loc-map { height: 80px; background: #eee; background-image: url('https://images.unsplash.com/photo-1524661135-423995f22d0b?q=80&w=300&auto=format&fit=crop'); background-size: cover; background-position: center; }

/* 5. 拍一拍提示 */
.msg-nudge-system {
    align-self: center !important;
    background: rgba(0,0,0,0.05) !important;
    color: #888 !important;
    font-size: 11px !important;
    padding: 4px 12px !important;
    border-radius: 10px !important;
    margin: 10px 0;
    box-shadow: none !important;
}

/* 6. 音乐分享 */
.msg-music-card {
    width: 220px; padding: 10px; background: #fff; border-radius: 12px;
    display: flex; align-items: center; gap: 10px;
    border: 1px solid rgba(0,0,0,0.05);
}
.music-cover { width: 48px; height: 48px; border-radius: 8px; background: #333; object-fit: cover;}
.music-text { display: flex; flex-direction: column; justify-content: center; }
.music-name { font-size: 13px; font-weight: 600; color: #333; }
.music-author { font-size: 11px; color: #999; margin-top: 3px; }
.music-icon { margin-left: auto; color: #07c160; font-size: 20px; }

/* 7. 表情包 */
.msg-sticker-img {
    width: 100px; height: 100px; object-fit: contain;
}
/* === 输入框布局调整 === */
.chat-input-form {
    padding: 0 8px 0 12px !important; /* 调整内边距 */
    display: flex;
    justify-content: space-between;
}

/* 输入框本体 */
.chat-input-form input {
    flex: 1;
    min-width: 0; /* 防止溢出 */
    margin: 0 5px;
}

/* [修改] AI 星星图标悬停效果 */
#triggerAiReply:hover {
    transform: scale(1.2) rotate(20deg); /* 稍微放大并旋转 */
    color: #ffd700 !important; /* 悬停时变成金色星星，或者用 #555 变成深灰 */
    text-shadow: 0 0 5px rgba(255, 215, 0, 0.5); /* 加一点发光效果 */
}

/* 发送按钮样式调整 */
.chat-input-form button {
    width: 36px !important;
    height: 36px !important;
    margin-left: 0 !important;
    background: #2b2b2b !important;
    box-shadow: none !important;
}
.chat-input-form button:active {
    transform: scale(0.9);
}
/* =========================================
   [升级版] 实时弹幕功能样式 (Clean Danmaku)
   ========================================= */

/* 1. 弹幕容器 */
.danmaku-container {
    position: absolute;
    top: 110px;           /* 避开顶部名字 */
    left: 0;
    width: 100%;
    height: 240px;        
    pointer-events: none;
    z-index: 999;
    overflow: hidden;
    mask-image: none;
    -webkit-mask-image: none;
}

/* 2. 单条弹幕基础样式 (纯文字胶囊风格) */
.danmaku-item {
    position: absolute;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 6px 14px; /*稍微减小一点内边距*/
    border-radius: 20px;
    background: rgba(0, 0, 0, 0.368); 
    backdrop-filter: blur(4px);
    font-family: 'PingFang SC', system-ui, sans-serif;
    font-size: 14px; 
    color: #fff;
    font-weight: 500;
    letter-spacing: 1px;
    white-space: nowrap; /* 强制不换行 */
    left: 100%; 
    opacity: 0.95;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    will-change: transform, left;
    text-shadow: 0 1px 1px rgba(0, 0, 0, 0.544);
}

/* 【修改】头像样式直接隐藏 (虽然JS里我也删了，双重保险) */
.danmaku-avatar {
    display: none !important;
}

/* 4. 特殊高亮样式 */
.danmaku-item.highlight-gold {
    background: rgba(255, 162, 0, 0.716); /* 金色不透明度高一点 */
    color: #fff;
    border: 1px solid rgba(255,255,255,0.3);
}
.danmaku-item.highlight-pink {
    background: rgba(255, 105, 180, 0.759);
}
.danmaku-item.highlight-blue {
    background: rgba(64, 160, 255, 0.749);
}

/* 5. 弹幕飞行关键帧 */
@keyframes fly-left {
    from { transform: translateX(0); }
    to { transform: translateX(-600px); } /* 飞得更远一点确保完全离开 */
}

/* 6. 开关按钮激活态 */
#danmaku-toggle.active {
    color: #2b2b2b !important;
    background: #e0e0e0;
    border-radius: 8px;
}
/* 通讯录顶部“添加新朋友”红点提示 */
.wc-request-dot {
    position: absolute;
    top: 10px;
    right: 16px;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: #ff4d4f;
}
#contacts-add-bar {
    position: relative;
}
/* --- 好友资料页专项美化 --- */

/* 1. 强制卡片宽度和边距，与外面主页一致 */
#contactProfilePage .wc-me-header, 
#contactProfilePage .wc-menu-group {
    margin: 0 24px 16px !important; 
    width: auto !important; /* 确保不被撑破 */
}

/* 2. 统一按钮厚度：发消息、拉黑、删除全部一样厚 */
.profile-main-btn {
    height: 52px !important;    /* 统一 52px 高度 */
    border-radius: 26px !important; /* 圆角一致 */
    font-size: 15px !important;
    font-weight: 700 !important;
    border: none !important;
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: 0 4px 12px rgba(0,0,0,0.05); /* 淡淡的阴影 */
    margin: 0 !important; /* 清除默认间距 */
}

/* 3. 修正人设显示区域 */
#cp-persona {
    white-space: pre-wrap; /* 允许换行 */
    word-break: break-all;
}
/* 资料页人设编辑框 */
.cp-persona-box {
    width: 100%;
    min-height: 100px;
    border-radius: 16px;
    border: 1px solid #e0e0e0;
    padding: 10px 12px;
    font-size: 13px;
    line-height: 1.5;
    resize: vertical;
    background: #fafafa;
    box-sizing: border-box;
    color: #333;
}
.cp-persona-box:focus {
    outline: none;
    border-color: #333;
    background: #ffffff;
}

/* 强制确保翻译框显示 */
.bubble-translation {
    display: block !important;
    margin-top: 8px;
    padding-top: 8px;
    border-top: 1px dashed rgba(0,0,0,0.15);
    font-size: 12px !important;
    line-height: 1.4;
    color: #666;
    width: 100%;
}
/* 深色模式气泡的翻译字色 */
.message-bubble.sent .bubble-translation {
    border-top-color: rgba(255,255,255,0.2);
    color: #ccc;
}
/* === 朋友圈图片宫格布局 (修正版：大图 + 完整显示内容) === */

/* 容器通用设置：撑满宽度 */
.moment-images {
    margin-top: 12px;
    width: 100%; /* 撑满屏幕宽度，解决“太小”的问题 */
    box-sizing: border-box;
}

/* --- 布局模式 1：单张大图 --- */
.moment-images.grid-1 img,
.moment-images.grid-1 .moment-image-ai {
    width: 100%;       /* 宽度撑满 */
    height: auto;      /* 高度自动，保持原图比例 */
    max-height: 350px; /* 限制最大高度，防止长图霸屏 */
    border-radius: 8px;
    object-fit: contain; /* 完整显示，不裁剪 */
    background-color: #f2f2f2; /* 给个背景色，防止透明图很难看 */
    display: block;
}
.moment-images.grid-1 .moment-image-ai {
    height: 180px; /* AI 占位图固定高度 */
}

/* --- 布局模式 2：两列网格 (适用于 2张、3张、4张) --- */
/* 这里的逻辑：两列布局会自动让第3张掉到第二行，形成“上2下1” */
.moment-images.grid-2 {
    display: grid;
    grid-template-columns: repeat(2, 1fr); /* 两列，每列 50% */
    gap: 8px; /* 间距稍微大一点 */
}

/* --- 布局模式 3：三列网格 (适用于 5张及以上) --- */
.moment-images.grid-3 {
    display: grid;
    grid-template-columns: repeat(3, 1fr); /* 三列，每列 33.3% */
    gap: 5px;
}

/* --- 图片单元格通用样式 --- */
/* 2列模式下的图片：变大、不强制正方形 */
.moment-images.grid-2 .moment-img-wrap,
.moment-images.grid-2 .moment-image-ai {
    width: 100%;
    height: 140px; 
    border-radius: 6px;
    overflow: hidden;
    background-color: #f0f0f0; /* 浅灰背景，像相册一样 */
}

/* 3列模式下的图片 */
.moment-images.grid-3 .moment-img-wrap,
.moment-images.grid-3 .moment-image-ai {
    width: 100%;
    height: 120px; /* 3列时稍微矮一点 */
    border-radius: 4px;
    overflow: hidden;
    background-color: #f0f0f0;
}

/* --- 核心：图片如何显示 --- */
.moment-images.grid-2 img,
.moment-images.grid-3 img {
    width: 100%;
    height: 100%;
    /* 【重点修改】改成 contain：
       这意味着图片会完整缩放显示在框里，绝不会切掉任何一个字！
       虽然上下左右可能会有灰边，但能保证内容全看清。
    */
    object-fit: contain; 
    display: block;
}
/* === [新增/修改] 发布朋友圈弹窗样式 (黑色适配版) === */

/* 1. 弹窗容器 */
#post-moment-modal .modal-box {
    background: #fff;
    border-radius: 16px; 
    overflow: hidden; /* 防止圆角被直角遮住 */
}

/* 2. 头部 */
#post-moment-modal .modal-header {
    border-bottom: 1px solid #f5f5f5;
    font-size: 15px;
    padding: 18px 24px;
    background: #fff;
}

/* 3. 确认发布按钮 - 现在的样式 (黑色/深灰) */
#post-moment-modal .btn-confirm {
    background: #2b2b2b !important; /* === 这里改成了黑色 === */
    color: #fff !important;
    width: auto;
    padding: 0 24px;
    border-radius: 8px;
    height: 36px;
    font-size: 13px;
    letter-spacing: 0.5px;
    transition: 0.2s;
}
#post-moment-modal .btn-confirm:hover {
    background: #000 !important; /* 悬停变纯黑 */
    transform: translateY(-1px);
}

/* 4. 取消按钮 */
#post-moment-modal .btn-cancel {
    background: #f5f5f5 !important;
    color: #666 !important;
    width: auto;
    padding: 0 18px;
    height: 36px;
    font-size: 13px;
    border-radius: 8px;
}
#post-moment-modal .btn-cancel:hover {
    background: #e0e0e0 !important;
}

/* 5. 底部布局 */
#post-moment-modal .modal-footer {
    justify-content: flex-end; /* 按钮靠右 */
    padding: 15px 24px;
    border-top: none;
    background: #fff;
}

/* 6. 输入框去边框，像微信原生体验 */
#pm-text:focus {
    box-shadow: none !important;
    border-color: transparent !important;
}

/* 7. 可见范围列表 */
#pm-visibility-list {
    border: 1px solid #f0f0f0 !important;
    background: #fafafa;
    border-radius: 10px;
}
/* 确保父级容器可以定位 */
.dock-icon-special, .wc-tab-item { position: relative !important; }

/* 红点绝对定位在图标右上角 */
.unread-dot {
    position: absolute !important;
    top: 0px !important;
    right: 0px !important;
    width: 10px;
    height: 10px;
    background: #ff4d4f;
    border-radius: 50%;
    border: 1.5px solid #fff;
    display: none; 
    z-index: 100;
    pointer-events: none;
}
/* =========================================
   [NEW] K-Style Black & White Live App
   ========================================= */

/* 1. 容器：极简白底，带一点点噪点纹理（高级感） */
#liveApp {
    background-color: #ffffff;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.03'/%3E%3C/svg%3E");
    z-index: 180;
    color: #111;
    font-family: 'Montserrat', sans-serif; /* 必须用无衬线体 */
}

/* 2. 顶部导航 */
.k-header {
    height: 60px; padding: 40px 24px 0;
    display: flex; justify-content: space-between; align-items: flex-end;
    background: #fff;
    position: sticky; top: 0; z-index: 10;
}
.k-header i { font-size: 20px; color: #111; }
.k-tabs-top { display: flex; gap: 20px; font-weight: 700; letter-spacing: 1px; font-size: 13px; }
.k-tabs-top span { color: #ccc; transition: 0.3s; cursor: pointer; }
.k-tabs-top span.active { color: #111; border-bottom: 2px solid #111; padding-bottom: 2px; }

/* 3. 内容区 */
.k-body-container {
    padding: 20px 24px 100px; /* 底部留够空间给 Dock */
    overflow-y: auto; height: calc(100% - 60px);
}
.k-body-container::-webkit-scrollbar { display: none; }

/* 4. Tab 1: 杂志风排版 */
.k-hero-banner {
    height: 280px; width: 100%;
    background: #111; /* 纯黑背景块 */
    color: #fff;
    padding: 30px;
    display: flex; flex-direction: column; justify-content: flex-end;
    margin-bottom: 30px;
    position: relative;
}
/* 装饰性图片，黑白滤镜 */
.k-hero-banner::before {
    content: ''; position: absolute; top:0; right:0; width: 60%; height: 100%;
    background: url('https://images.unsplash.com/photo-1485230946387-dd33314715fa?q=80&w=400&auto=format&fit=crop') center/cover;
    filter: grayscale(100%) contrast(1.2);
    opacity: 0.5;
    mask-image: linear-gradient(to right, transparent, black);
    -webkit-mask-image: linear-gradient(to right, transparent, black);
}
.k-hero-tag { font-size: 10px; letter-spacing: 2px; border: 1px solid #fff; display: inline-block; padding: 4px 8px; width: fit-content; margin-bottom: 10px; }
.k-hero-title { font-family: 'Playfair Display', serif; font-size: 36px; line-height: 1; z-index: 2; }
.k-hero-subtitle { font-size: 10px; color: #999; margin-top: 10px; letter-spacing: 1px; z-index: 2; }

/* 瀑布流卡片 */
.k-masonry-grid {
    display: grid; grid-template-columns: 1fr 1fr; gap: 15px;
}
.k-card {
    background: #fff;
    /* 去掉边框，改用投影会更高级，或者保留边框 */
    border: none; 
    padding-bottom: 10px;
    cursor: pointer;
    transition: transform 0.3s;
    
    /* ★ 新增：圆角设置 */
    border-radius: 16px; 
    /* ★ 新增：溢出隐藏 (这句很重要，否则图片直角会盖住卡片的圆角) */
    overflow: hidden;
    /* ★ 可选：加一点淡淡的投影让它浮起来 */
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
}
.k-card:hover { transform: translateY(-3px); }
.k-card-img {
    width: 100%; height: 200px; object-fit: cover;
    filter: grayscale(20%); /* 稍微去色，显高级 */
}
/* 状态标签：黑底白字 */
.k-live-tag {
    position: absolute; top: 10px; left: 10px;
    background: #000; color: #fff;
    font-size: 9px; font-weight: 700;
    padding: 3px 6px; letter-spacing: 1px;
}
.k-blink-dot {
    display: inline-block; width: 6px; height: 6px; background: red; border-radius: 50%; margin-right: 4px;
    animation: blink 1s infinite;
}
.k-card-info { padding: 12px 10px 0; }
.k-card-title { font-size: 12px; font-weight: 700; line-height: 1.4; margin-bottom: 6px; }
.k-card-user { font-size: 10px; color: #888; display: flex; align-items: center; gap: 5px; text-transform: uppercase; }

/* 5. Tab 2: 开播界面 */
.k-broadcast-wrap { height: 100%; display: flex; flex-direction: column; background: #000; margin: -20px -24px; }
.k-cam-preview { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; color: #666; font-size: 10px; letter-spacing: 2px; }
.k-broadcast-ui { padding: 40px; background: #fff; border-radius: 30px 30px 0 0; }
.k-live-input {
    width: 100%; 
    /* 改成全包围的边框 */
    border: 1px solid #eee; 
    background: #f9f9f9;
    font-size: 16px; 
    /* 增加内边距 */
    padding: 15px 20px; 
    font-family: 'Playfair Display', serif;
    margin-bottom: 30px; 
    outline: none; 
    
    /* ★ 新增：大圆角 */
    border-radius: 20px; 
}

.k-start-btn {
    width: 100%; height: 50px; background: #111; color: #fff;
    border: none; font-size: 14px; letter-spacing: 2px; font-weight: 700;
    cursor: pointer; transition: 0.3s;
}
.k-start-btn:hover { background: #333; letter-spacing: 4px; }

/* 6. Tab 3: 私信 */
.k-page-title { font-family: 'Playfair Display', serif; font-size: 32px; margin-bottom: 30px; }
.k-msg-item { display: flex; gap: 15px; margin-bottom: 25px; align-items: center; }
.k-avatar-sq {
    width: 50px; height: 50px; background: #f0f0f0;
    display: flex; justify-content: center; align-items: center;
    font-weight: 700; font-size: 18px; border: 1px solid #111;
}
.k-msg-text { flex: 1; border-bottom: 1px solid #f5f5f5; padding-bottom: 15px; }
.k-msg-text .top { display: flex; justify-content: space-between; font-size: 13px; font-weight: 700; margin-bottom: 4px; }
.k-msg-text .top .time { font-weight: 400; color: #ccc; font-size: 10px; }
.k-msg-text .btm { font-size: 11px; color: #888; }

/* 7. Tab 4: 个人主页 */
.k-profile-cover { position: relative; height: 350px; margin: -20px -24px 20px; overflow: hidden; }
.k-profile-cover img { width: 100%; height: 100%; object-fit: cover; filter: grayscale(100%); }
.k-profile-overlay {
    position: absolute; bottom: 0; left: 0; width: 100%;
    padding: 30px;
    background: linear-gradient(to top, #fff 10%, transparent);
}
.k-p-name { font-family: 'Playfair Display', serif; font-size: 36px; line-height: 1; }
.k-p-bio { font-size: 10px; letter-spacing: 1px; margin-top: 5px; color: #555; }
.k-stats-bar { display: flex; gap: 30px; margin-bottom: 30px; }
.k-stats-bar div { display: flex; flex-direction: column; }
.k-stats-bar b { font-size: 18px; font-weight: 400; }
.k-stats-bar span { font-size: 9px; color: #aaa; letter-spacing: 1px; }
.k-section-header { font-size: 10px; font-weight: 700; border-bottom: 2px solid #111; padding-bottom: 5px; margin-bottom: 15px; display: inline-block; }
.k-archive-grid { 
    display: grid; 
    grid-template-columns: repeat(3, 1fr); 
    gap: 8px; /* 间距变大 */
}.k-archive-item { 
    padding-top: 100%; 
    background: #eee;
    
    /* ★ 新增：圆角 */
    border-radius: 12px; 
}


/* 8. 底部悬浮 Dock (黑色胶囊) */
.k-dock-wrapper {
    position: absolute; bottom: 30px; left: 0; right: 0;
    display: flex; justify-content: center; z-index: 100;
}
.k-dock {
    height: 60px; width: 260px;
    background: #111; /* 纯黑 */
    border-radius: 30px;
    display: flex; justify-content: space-evenly; align-items: center;
    box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    padding: 0 10px;
}
.k-dock-item {
    color: #555; font-size: 20px; width: 40px; height: 40px;
    display: flex; justify-content: center; align-items: center;
    cursor: pointer; transition: 0.3s;
}
.k-dock-item.active { color: #fff; }

/* 特殊的开播按钮 (白色圆点) */
.k-btn-center {
    width: 36px; height: 36px; background: #fff; color: #111;
    border-radius: 50%; display: flex; justify-content: center; align-items: center;
    font-size: 16px; transition: 0.3s;
}
.k-dock-item:hover .k-btn-center { transform: scale(1.1); }
/* =========================================
   [新增] 直播APP - 发布作品与详情页样式
   ========================================= */

/* 1. 个人主页发布按钮 */
.k-profile-actions {
    padding: 0 24px;
    margin-bottom: 25px;
}
.k-btn-publish {
    width: 100%;
    height: 44px;
    background: #111;
    color: #fff;
    border: none;
    border-radius: 22px;
    font-size: 14px;
    font-weight: 600;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    transition: 0.2s;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}
.k-btn-publish:active { transform: scale(0.98); }

/* 2. 通用全屏弹窗 (用于发布页和详情页) */
.k-full-modal {
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    background: #fff;
    z-index: 200; /* 比底栏高 */
    display: flex;
    flex-direction: column;
    transform: translateY(100%);
    transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
}
.k-full-modal.show { transform: translateY(0); }

/* 弹窗头部 */
.k-modal-header {
    height: 50px;
    padding: 0 20px;
    display: flex; justify-content: space-between; align-items: center;
    border-bottom: 1px solid #f5f5f5;
    font-weight: 700;
    font-size: 16px;
    flex-shrink: 0;
}

/* 3. 发布页内容 */
.k-publish-body {
    flex: 1; padding: 20px; overflow-y: auto;
}
.k-upload-box {
    width: 100px; height: 100px;
    background: #f0f0f0;
    border-radius: 12px;
    display: flex; justify-content: center; align-items: center;
    color: #999; font-size: 24px;
    cursor: pointer;
    margin-bottom: 20px;
    overflow: hidden;
    position: relative;
}
.k-upload-box img { width: 100%; height: 100%; object-fit: cover; }

.k-input-group { margin-bottom: 20px; }
.k-input-group label { display: block; font-size: 12px; color: #666; margin-bottom: 8px; font-weight: 600; }
.k-input-textarea {
    width: 100%; border: none; background: #f9f9f9;
    padding: 15px; border-radius: 12px; font-family: inherit;
    resize: none; font-size: 14px; outline: none;
}
.k-tag-select, .k-visibility-select {
    width: 100%; height: 40px; border: 1px solid #eee;
    border-radius: 8px; padding: 0 10px; background: #fff;
}

/* 4. 作品详情页 (仿抖音风格) */
.k-detail-media {
    flex: 1;
    background: #000;
    display: flex; justify-content: center; align-items: center;
    position: relative;
    overflow: hidden;
}
.k-detail-media img { width: 100%; height: 100%; object-fit: contain; }

.k-detail-overlay {
    position: absolute; bottom: 0; left: 0; width: 100%;
    padding: 20px;
    background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
    color: #fff;
}
.k-detail-title { font-size: 16px; font-weight: 700; margin-bottom: 8px; }
.k-detail-tags { font-size: 12px; color: #ddd; margin-bottom: 15px; }

/* 侧边互动栏 */
.k-interaction-sidebar {
    position: absolute; right: 10px; bottom: 100px;
    display: flex; flex-direction: column; gap: 20px;
    align-items: center;
}
.k-action-btn {
    display: flex; flex-direction: column; align-items: center; gap: 5px;
}
.k-action-icon {
    width: 40px; height: 40px; background: rgba(255,255,255,0.2);
    border-radius: 50%; display: flex; justify-content: center; align-items: center;
    font-size: 20px; color: #fff; backdrop-filter: blur(5px); transition: 0.2s;
}
.k-action-btn:active .k-action-icon { transform: scale(1.2); background: rgba(255,40,40,0.8); }
.k-action-num { font-size: 10px; color: #fff; text-shadow: 0 1px 2px rgba(0,0,0,0.5); }

/* 作品列表的封面 */
.k-work-item {
    position: relative;
    padding-top: 130%; /* 竖屏比例 */
    background: #eee;
    border-radius: 8px;
    overflow: hidden;
    cursor: pointer;
}
.k-work-item img {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover;
}
.k-work-stats {
    position: absolute; bottom: 5px; left: 5px;
    color: #fff; font-size: 10px; display: flex; align-items: center; gap: 3px;
    text-shadow: 0 1px 2px rgba(0,0,0,0.5);
}
/* =========================================
   [覆盖更新] 第三页极简黑白风样式
   ========================================= */

/* 1. 强制图标颜色为纯黑 */
.page#p3 .icon-box i {
    color: #333 !important; /* 强制深灰色/黑色 */
    text-shadow: none !important; /* 去掉发光 */
    background: none !important; /* 去掉渐变背景 */
    -webkit-text-fill-color: #333 !important;
}

/* 2. 极简小组件容器 */
.life-dashboard-widget.minimal-style {
    background: #fff !important; /* 纯白背景 */
    border-radius: 20px !important;
    padding: 25px !important;
    box-shadow: 0 10px 30px rgba(0,0,0,0.04) !important; /* 极淡的影子 */
    border: 1px solid rgba(0,0,0,0.03) !important;
    display: flex;
    flex-direction: column;
    gap: 15px;
    position: relative;
    overflow: hidden;
}

/* 去掉之前的彩色光斑 */
.life-dashboard-widget.minimal-style::before {
    display: none !important;
}

/* 上半部分布局 */
.widget-row-top {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

/* 天气块 */
.weather-box {
    display: flex;
    align-items: center;
    gap: 12px;
}
.weather-box i {
    font-size: 28px;
    color: #333 !important; /* 黑色太阳 */
}
.temp-big {
    font-size: 36px;
    font-weight: 300; /* 细字体显得高级 */
    color: #333;
    font-family: 'Montserrat', sans-serif;
    letter-spacing: -2px;
}

/* 地点日期块 */
.location-box {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
}
.city-name {
    font-size: 12px;
    font-weight: 700;
    letter-spacing: 2px;
    color: #333;
}
.date-small {
    font-size: 10px;
    color: #999;
    margin-top: 4px;
}

/* 分割线 */
.widget-divider {
    width: 100%;
    height: 1px;
    background: #f0f0f0;
}

/* 底部语录 */
.daily-quote-minimal {
    font-family: 'Playfair Display', serif; /* 衬线体 */
    font-size: 14px;
    font-style: italic;
    color: #555;
    text-align: center;
    margin-top: 5px;
}
/* === [新增] 韩系Ins风拼贴组件样式 === */

/* 容器：相对定位，为了让里面的元素可以重叠 */
.k-mood-board {
    position: relative;
    width: 100%;
    height: 260px; /* 高度给足，让元素错落 */
    margin-bottom: 10px;
    margin-top: 10px;
}

/* --- 1. CD播放器卡片 --- */
.k-cd-player {
    position: absolute;
    top: 0; left: 0;
    width: 200px;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    padding: 15px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.05);
    border: 1px solid rgba(255,255,255,0.8);
    z-index: 2; /* 在上层 */
}

/* CD 碟片 */
.k-disc-wrap {
    width: 100%; height: 170px;
    display: flex; justify-content: center; align-items: center;
    margin-bottom: 10px;
}
.k-disc {
    width: 140px; height: 140px;
    border-radius: 50%;
    background-size: cover; background-position: center;
    position: relative;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    animation: spin 8s linear infinite; /* 让它转起来！ */
    cursor: pointer;
    border: 4px solid #fff;
}
.k-disc-center {
    position: absolute; top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    width: 30px; height: 30px;
    background: #fff; border-radius: 50%;
    border: 1px solid #eee;
}

/* 歌曲信息 */
.k-song-info {
    display: flex; align-items: center; gap: 10px;
}
.k-play-btn {
    width: 32px; height: 32px;
    background: #2b2b2b; color: #fff;
    border-radius: 50%;
    display: flex; justify-content: center; align-items: center;
    font-size: 10px;
}
.k-song-title {
    font-size: 12px; font-weight: 700; color: #333;
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    font-family: 'Montserrat', sans-serif;
    outline: none; max-width: 120px;
}
.k-artist {
    font-size: 10px; color: #999; margin-top: 2px;
    outline: none; max-width: 120px;
}

/* --- 2. 拍立得照片卡片 --- */
.k-polaroid {
    position: absolute;
    top: 30px; right: 0; /* 靠右放 */
    width: 160px;
    background: #fff;
    padding: 10px 10px 30px 10px; /* 底部留白给文字 */
    box-shadow: 0 15px 35px rgba(0,0,0,0.08);
    transform: rotate(5deg); /* 微微倾斜，显得随性 */
    z-index: 1; /* 在下层 */
    transition: transform 0.3s;
}
.k-polaroid:hover {
    transform: rotate(0deg) scale(1.05); /* 悬停扶正 */
    z-index: 3; /* 悬停时浮到最上面 */
}

/* 胶带效果 */
.k-tape {
    position: absolute;
    top: -10px; left: 50%; transform: translateX(-50%);
    width: 60px; height: 20px;
    background: rgba(255, 255, 255, 0.4);
    backdrop-filter: blur(2px);
    border: 1px solid rgba(255,255,255,0.6);
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}

/* 照片区域 */
.k-photo-frame {
    width: 100%; height: 160px;
    background-color: #f0f0f0;
    background-size: cover; background-position: center;
    cursor: pointer;
    filter: sepia(0.2); /* 加一点复古滤镜 */
}

/* 手写字 */
.k-handwriting {
    font-family: 'Alex Brush', cursive; /* 这种手写体 */
    font-size: 18px; color: #555;
    text-align: center;
    margin-top: 15px;
    outline: none;
    line-height: 1;
}

/* =========================================
   Page 4: 修复版样式 (滚动修复 + App样式统一)
   ========================================= */

/* 1. 滚动组件优化 */
.collection-ticker-widget {
    background: #fff;
    border-radius: 40px;
    height: 56px;
    display: flex;
    align-items: center;
    padding: 0 6px 0 20px;
    box-shadow: var(--k-shadow);
    border: var(--k-border);
    overflow: hidden;
    position: relative;
    margin-bottom: 20px; /* 增加与下方发票的距离 */
}

/* 核心修复：滚动容器设置 */
.ticker-wrapper {
    flex: 1;
    display: flex;
    align-items: center;
    overflow: hidden; /* 裁剪超出部分 */
    mask-image: linear-gradient(to right, transparent, black 5%, black 95%, transparent);
    -webkit-mask-image: linear-gradient(to right, transparent, black 5%, black 95%, transparent);
}

/* 核心修复：滚动内容动画 */
.ticker-content {
    display: flex; /* 确保横向排列 */
    align-items: center;
    flex-shrink: 0; /* 【关键】防止内容被压缩，导致不滚动 */
    animation: marquee-scroll 15s linear infinite; /* 确保引用了下面的动画 */
    white-space: nowrap;
    padding-right: 20px; /* 两个组之间的间距 */
}

.ticker-content span {
    font-size: 12px;
    color: #666;
    margin-right: 10px;
    letter-spacing: 0.5px;
    font-weight: 500;
}
.ticker-content .dot {
    color: #ddd;
    font-size: 12px; 
    margin-right: 10px;
}

/* 定义动画 (如果之前 animations.css 里有同名，这里会覆盖) */
@keyframes marquee-scroll {
    0% { transform: translateX(0); }
    100% { transform: translateX(-100%); }
}

/* 右侧图片容器 */
.ticker-img-circle {
    width: 44px; height: 44px;
    border-radius: 50%;
    overflow: hidden;
    flex-shrink: 0;
    margin-left: 10px;
    border: 2px solid #f5f5f5;
    cursor: pointer;
    z-index: 5;
    background: #eee;
}
.ticker-img-circle img {
    width: 100%; height: 100%;
    object-fit: cover;
    display: block;
}

/* 2. 发票组件 (样式微调) */
.receipt-widget.short-version {
    background: #fdfdfd;
    width: 100%;
    border-radius: 12px 12px 0 0;
    padding: 20px 20px 30px 20px;
    position: relative;
    box-shadow: 0 10px 30px rgba(0,0,0,0.06);
    font-family: 'Courier New', Courier, monospace;
    display: flex;
    flex-direction: column;
    gap: 8px;
    
    /* 锯齿边缘 */
    mask-image: radial-gradient(circle at bottom, transparent 6px, black 6.5px);
    mask-size: 20px 100%;
    mask-position: bottom;
    mask-repeat: repeat-x;
    -webkit-mask-image: radial-gradient(circle at bottom, transparent 6px, black 6.5px);
    -webkit-mask-size: 20px 100%;
    -webkit-mask-position: bottom;
    -webkit-mask-repeat: repeat-x;
    
    padding-bottom: 25px;
    z-index: 2;
    margin-bottom: 0; /* 贴紧下方 */
}

/* 3. App 网格样式统一与布局调整 */
.grid-apps.p4-apps {
    margin-top: 10px; /* 【修改】正边距，往下移，不再拥挤 */
    padding-top: 10px;
    position: relative;
    z-index: 1;
}

/* 【关键】强制统一 Page 4 的图标风格为深黑色 */
.page#p4 .icon-box i {
    color: #333 !important; /* 纯黑/深灰 */
    text-shadow: none !important; /* 去掉发光特效 */
    background: none !important; /* 去掉渐变背景 */
    -webkit-text-fill-color: #333 !important;
    font-weight: 400; /* 线条细一点更像前面的风格 */
}

/* 如果 Page 3 用的是实心图标，Page 4 这里也可以微调 */
.page#p4 .icon-box {
    background: rgba(255,255,255,0.9); /* 保持白色底块 */
    border: 1px solid rgba(0,0,0,0.05);
    box-shadow: 0 10px 25px rgba(0,0,0,0.03);
}

/* 复用发票内部样式 */
.receipt-hole {
    position: absolute;
    top: 12px; left: 50%; transform: translateX(-50%);
    width: 10px; height: 10px;
    background: #e0e0e0; border-radius: 50%;
    box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
}
.receipt-header { text-align: center; margin-top: 5px; }
.receipt-title { font-size: 16px; font-weight: 900; letter-spacing: 2px; color: #222; }
.receipt-date { font-size: 9px; color: #999; margin-top: 2px; }
.receipt-divider-dashed { border-top: 1px dashed #ccc; width: 100%; height: 1px; }
.receipt-divider-line { border-top: 2px solid #222; width: 100%; height: 2px; }

.receipt-item {
    display: flex; justify-content: space-between; align-items: center;
    font-size: 11px; color: #444; cursor: pointer; padding: 6px 0;
    transition: background 0.2s;
}
.receipt-item:hover { background: rgba(0,0,0,0.02); }
.r-item-name { display: flex; gap: 8px; }
.r-qty { color: #aaa; }
.r-item-price { font-weight: 700; display: flex; align-items: center; gap: 4px; }
.receipt-footer { text-align: center; display: flex; flex-direction: column; gap: 5px; }
.receipt-total { display: flex; justify-content: space-between; font-size: 13px; color: #222; margin-bottom: 2px; }
.receipt-barcode { 
    font-size: 20px; letter-spacing: -2px; user-select: none; 
    transform: scaleY(0.6); opacity: 0.5; margin: 0;
}
/* =========================================
   [韩系气泡弹出版 - 灰粉克制配色] 
   ========================================= */

#boot-screen {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background-color: #fcfcfc; 
    z-index: 9999;
    display: flex;
    justify-content: center;
    align-items: center;
    border-radius: 40px;
    transition: opacity 0.8s ease-in-out, transform 0.8s ease-in-out;
}

#boot-screen.fade-out {
    opacity: 0;
    transform: scale(1.05);
    pointer-events: none;
}

.boot-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 38px;
    margin-top: 20px;
}

/* --- 白色传呼机主体 --- */
.white-pager {
    width: 120px;
    height: 75px;
    background: #ffffff;
    border-radius: 18px; 
    position: relative;
    display: flex;
    flex-direction: column;
    padding: 12px 14px;
    border: 1px solid rgba(0,0,0,0.02);
    box-shadow: 0 12px 30px rgba(0,0,0,0.04), inset 0 -3px 8px rgba(0,0,0,0.01);
    
    opacity: 0;
    animation: 
        soft-float-in 1s cubic-bezier(0.25, 1, 0.5, 1) forwards,
        hover-bob 4s ease-in-out 1s infinite;
}

/* 🌟 优化：极简高级灰的气泡 */
.pager-bubble {
    position: absolute;
    top: -55px;
    left: 40px; 
    background: #ffffff;
    padding: 10px 16px;
    border-radius: 20px 20px 20px 0; 
    
    /* 去掉粉色光晕，换成极干净的浅灰阴影和细边框 */
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05); 
    border: 1px solid #f2f2f2; 
    
    font-family: 'Quicksand', sans-serif;
    font-weight: 700;
    font-size: 13px;
    color: #777777; /* 温柔的高级灰文字 */
    display: flex;
    align-items: center;
    gap: 6px;
    z-index: 10;
    
    transform-origin: bottom left; 
    opacity: 0;
    transform: scale(0);
    animation: 
        bubble-spring-pop 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards 1.2s,
        bubble-float 3s ease-in-out infinite 1.8s;
}
.pager-bubble i { font-size: 12px; color: #a5a5a5; }

.wp-antenna {
    position: absolute;
    top: -5px;
    right: 22px;
    width: 14px;
    height: 6px;
    background: #f0f0f0;
    border-radius: 4px 4px 0 0;
    z-index: -1;
}

/* 屏幕区域 */
.wp-screen {
    width: 100%;
    height: 28px;
    background: #f0f2f4;
    border-radius: 8px;
    box-shadow: inset 1px 2px 4px rgba(0,0,0,0.03);
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}

/* 屏幕里的字：等待和开心 */
.wp-text-wait, .wp-text-smile {
    position: absolute;
    font-family: 'Quicksand', sans-serif;
    font-weight: 700;
}
.wp-text-wait {
    font-size: 14px;
    color: #b0b0b0;
    letter-spacing: 2px;
    animation: text-hide 0.1s forwards 1.2s;
}
/* 🌟 亮点：保留颜文字为粉色 (傲娇脸红感) */
.wp-text-smile {
    font-size: 13px;
    color: #ff8fab; /* 柔和的樱花粉 */
    opacity: 0;
    transform: scale(0.5);
    animation: smile-pop 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards 1.2s;
}

/* 底部区域 */
.wp-bottom { display: flex; justify-content: space-between; align-items: flex-end; margin-top: auto; }
.wp-speaker { display: flex; gap: 4px; }
.wp-speaker span { display: block; width: 3px; height: 10px; background: #eaeaea; border-radius: 2px; }
.wp-buttons { display: flex; gap: 6px; }
.wp-btn { width: 14px; height: 6px; background: #f0f0f0; border-radius: 3px; box-shadow: 0 1px 2px rgba(0,0,0,0.03); }
.wp-btn-pink { background: #ffcce0; }

/* --- 名字排版 --- */
.boot-text-group { text-align: center; }

.b-main-title {
    font-family: 'Quicksand', sans-serif; 
    font-weight: 700;
    font-size: 32px;
    color: #4a4a4a;
    letter-spacing: -0.5px;
    line-height: 1;
    margin-bottom: 12px;
    
    opacity: 0;
    transform: translateY(15px);
    animation: text-gentle-fade 1s cubic-bezier(0.25, 1, 0.5, 1) forwards 1.5s;
}

.b-sub-title {
    font-family: 'Quicksand', sans-serif;
    font-weight: 500;
    font-size: 10px;
    color: #c0c0c0;
    letter-spacing: 2px; 
    
    opacity: 0;
    transform: translateY(10px);
    animation: text-gentle-fade 1s cubic-bezier(0.25, 1, 0.5, 1) forwards 1.7s;
}

/* === 关键帧动画 === */

@keyframes soft-float-in {
    0% { opacity: 0; transform: translateY(30px); }
    100% { opacity: 1; transform: translateY(0); }
}

@keyframes bubble-spring-pop {
    0% { opacity: 0; transform: scale(0) rotate(-15deg); }
    60% { opacity: 1; transform: scale(1.15) rotate(5deg); } 
    100% { opacity: 1; transform: scale(1) rotate(0deg); }
}

@keyframes text-hide {
    to { opacity: 0; visibility: hidden; }
}
@keyframes smile-pop {
    0% { opacity: 0; transform: scale(0.5); }
    100% { opacity: 1; transform: scale(1); }
}

@keyframes hover-bob {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-5px); }
}
@keyframes bubble-float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-3px); }
}

@keyframes text-gentle-fade {
    to { opacity: 1; transform: translateY(0); }
}

/* =========================================
   [NEW] Bubble App Styles (韩系黑白风)
   ========================================= */

/* 1. 启动页 (Landing) */
#bubbleApp {
    background-color: #fff;
    font-family: 'Montserrat', sans-serif;
    color: #111;
}

.bb-landing {
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    background: #fff;
    padding: 30px;
}

.bb-logo {
    font-family: 'Alex Brush', cursive; /* 使用手写体模拟 Logo */
    font-size: 60px;
    margin-bottom: 5px;
    color: #000;
}
.bb-subtitle {
    font-size: 10px;
    letter-spacing: 3px;
    color: #999;
    margin-bottom: 50px;
}

.bb-mode-select {
    display: flex;
    flex-direction: column;
    gap: 20px;
    width: 100%;
}

.bb-mode-card {
    border: 1px solid #eee;
    padding: 25px;
    border-radius: 20px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s;
    background: #fafafa;
}
.bb-mode-card:hover {
    background: #111;
    color: #fff;
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.1);
}
/* hover 时改变内部图标颜色 */
.bb-mode-card:hover .bb-mode-desc { color: #888; } 

.bb-mode-icon { font-size: 24px; margin-bottom: 10px; }
.bb-mode-title { font-weight: 700; font-size: 14px; letter-spacing: 1px; margin-bottom: 5px; }
.bb-mode-desc { font-size: 10px; color: #aaa; text-transform: uppercase; }

.bb-close-btn {
    position: absolute; bottom: 40px;
    font-size: 11px; font-weight: 600; letter-spacing: 1px;
    border-bottom: 1px solid #111; cursor: pointer;
}

/* 2. 通用头部 */
.bb-view {
    height: 100%;
    display: flex;
    flex-direction: column;
    background: #fcfcfc; /* 极淡的灰白背景 */
}

.bb-header {
    height: 60px; padding: 0 20px;
    display: flex; justify-content: space-between; align-items: center;
    background: #fff;
    border-bottom: 1px solid #f5f5f5;
    font-size: 14px; font-weight: 700; letter-spacing: 1px;
    padding-top: 10px;
}
.bb-header i { cursor: pointer; padding: 10px; font-size: 18px; }

/* 3. 爱豆广播端 (Artist Mode) */
.bb-idol-content {
    flex: 1; padding: 20px; overflow-y: auto;
    display: flex; flex-direction: column; gap: 20px;
}

/* 粉丝回复流 */
.bb-reply-stream-box {
    background: #f0f0f0;
    border-radius: 16px;
    padding: 15px;
    height: 120px;
    overflow: hidden;
    display: flex; flex-direction: column;
}
.bb-section-title {
    font-size: 10px; font-weight: 800; color: #bbb; letter-spacing: 1px; margin-bottom: 10px;
}
.bb-reply-ticker {
    flex: 1; overflow-y: hidden;
    mask-image: linear-gradient(to bottom, transparent, black 10%, black 90%, transparent);
    -webkit-mask-image: linear-gradient(to bottom, transparent, black 10%, black 90%, transparent);
}
.bb-reply-item {
    font-size: 12px; margin-bottom: 6px; color: #555;
    animation: fadeUp 0.5s ease;
}
.bb-reply-item span { font-weight: 700; color: #333; margin-right: 5px; }

/* 发送框 */
.bb-compose-area {
    background: #fff;
    border-radius: 24px;
    padding: 20px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.05);
    border: 1px solid #eee;
}
.bb-input-wrapper textarea {
    width: 100%; border: none; outline: none;
    font-family: inherit; font-size: 14px; resize: none;
    height: 80px; margin-bottom: 10px;
    color: #333;
}
.bb-tools-row {
    display: flex; align-items: center; gap: 15px; border-top: 1px solid #f9f9f9; padding-top: 10px;
}
.bb-tool-icon {
    font-size: 18px; color: #999; cursor: pointer; transition: 0.2s;
}
.bb-tool-icon:hover { color: #111; }
.bb-char-count { margin-left: auto; font-size: 10px; color: #ccc; }

.bb-send-btn {
    margin-top: 15px; width: 100%; height: 44px;
    background: #111; color: #fff; border: none; border-radius: 12px;
    font-weight: 700; letter-spacing: 1px; font-size: 12px;
    cursor: pointer; transition: 0.2s;
}
.bb-send-btn:active { transform: scale(0.98); }

/* 历史记录 */
.bb-history-item {
    background: #fff; padding: 12px; border-radius: 12px; margin-bottom: 8px;
    font-size: 12px; border: 1px solid #f5f5f5; color: #444;
}
.bb-history-time { font-size: 9px; color: #ccc; margin-bottom: 4px; display:block;}

/* 4. 粉丝聊天端 (Fan Mode) */
.bb-header.fan-mode {
    justify-content: flex-start; gap: 10px;
}
.bb-header-info {
    display: flex; flex-direction: column; flex: 1;
}
.bb-artist-name { font-size: 14px; color: #111; }
.bb-days-counter { font-size: 9px; color: #aaa; font-weight: 400; letter-spacing: 0.5px; }

.bb-chat-container {
    flex: 1; 
    background-color: #bbd3e3; /* 经典 Bubble 蓝色背景，或换成 #f0f0f0 纯灰 */
    background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0IiBoZWlnaHQ9IjQiPgo8cmVjdCB3aWR0aD0iNCIgaGVpZ2h0PSI0IiBmaWxsPSIjZmZmIiAvPgo8cmVjdCB3aWR0aD0iMSIgaGVpZ2h0PSIxIiBmaWxsPSIjZTllOWU5IiAvPgo8L3N2Zz4='); /* 微弱的纹理 */
    padding: 20px 15px;
    overflow-y: auto;
    display: flex; flex-direction: column; gap: 15px;
}

.bb-time-stamp {
    text-align: center; font-size: 10px; 
    background: rgba(0,0,0,0.1); color: #fff;
    padding: 3px 8px; border-radius: 10px;
    align-self: center; margin-bottom: 10px;
}

/* 气泡样式 */
.bb-msg-row { display: flex; gap: 10px; max-width: 85%; }
.bb-msg-row.received { align-self: flex-start; }
.bb-msg-row.sent { align-self: flex-end; flex-direction: row-reverse; }

.bb-avatar {
    width: 38px; height: 38px; border-radius: 50%; 
    overflow: hidden; flex-shrink: 0; border: 2px solid #fff;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}
.bb-avatar img { width: 100%; height: 100%; object-fit: cover; }

.bb-bubble {
    padding: 10px 14px;
    font-size: 13px; line-height: 1.5;
    border-radius: 18px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    max-width: 100%; word-wrap: break-word;
}

/* 粉丝气泡：白底黄字 或 纯白 */
.bb-msg-row.sent .bb-bubble {
    background: #ffe04b; /* 经典的 Kakao/Bubble 黄，或者用 #111 黑色 */
    color: #333;
    border-top-right-radius: 4px;
}
/* 艺人气泡：白底黑字 */
.bb-msg-row.received .bb-bubble {
    background: #fff;
    color: #111;
    border-top-left-radius: 4px;
}

/* 底部回复栏 */
.bb-input-area {
    background: #fff; padding: 10px 15px 30px 15px;
    border-top: 1px solid #f0f0f0;
}
.bb-reply-limit {
    font-size: 10px; color: #ccc; text-align: right; margin-bottom: 5px;
}
.bb-input-box {
    display: flex; background: #f5f5f5; border-radius: 20px;
    padding: 5px 5px 5px 15px;
    align-items: center;
}
.bb-input-box input {
    flex: 1; background: transparent; border: none; font-size: 13px;
}
.bb-input-box button {
    width: 32px; height: 32px; background: #ddd; color: #fff;
    border: none; border-radius: 50%; cursor: pointer; transition:0.2s;
}
/* 输入内容后变亮 */
.bb-input-box input:not(:placeholder-shown) + button {
    background: #111;
}
/* =========================================
   [新增] Bubble App 爱豆模式增强样式
   ========================================= */

/* 1. 滚动条可点击效果 */
.bb-reply-ticker {
    cursor: pointer;
    transition: background 0.2s;
}
.bb-reply-ticker:hover {
    background: rgba(0,0,0,0.03);
}

/* 2. 评论列表弹窗 (点击滚动条后显示) */
.bb-comment-modal {
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    background: #fff;
    z-index: 50;
    display: flex;
    flex-direction: column;
    transform: translateY(100%);
    transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
}
.bb-comment-modal.show {
    transform: translateY(0);
}

.bb-comment-header {
    height: 60px;
    padding: 0 20px;
    display: flex; align-items: center; justify-content: space-between;
    border-bottom: 1px solid #f0f0f0;
    font-weight: 700;
}

.bb-comment-list {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    background: #f9f9f9;
}

/* 3. 单条评论样式 */
.bb-comment-row {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
    opacity: 0;
    animation: fadeUp 0.3s forwards;
}

/* 路人粉丝 (假数据) */
.bb-comment-row.fake .bb-c-avatar {
    width: 32px; height: 32px;
    border-radius: 50%;
    background: #ddd;
    flex-shrink: 0;
}
.bb-comment-row.fake .bb-c-content {
    background: #fff;
    padding: 8px 12px;
    border-radius: 0 12px 12px 12px;
    font-size: 12px;
    color: #666;
    border: 1px solid #eee;
}

/* === VIP粉丝 (你的AI好友) === */
.bb-comment-row.vip {
    margin-bottom: 20px;
}
.bb-comment-row.vip .bb-c-avatar {
    width: 42px; height: 42px;
    border-radius: 50%;
    border: 2px solid #ff7e67; /* 醒目的边框 */
    box-shadow: 0 4px 10px rgba(255, 126, 103, 0.2);
    flex-shrink: 0;
    position: relative;
}
/* 给AI头像加个小皇冠或标识 */
.bb-comment-row.vip .bb-c-avatar::after {
    content: '👑'; 
    position: absolute; top: -8px; right: -5px; font-size: 14px;
}

.bb-comment-row.vip .bb-c-content {
    background: #fff5f5; /* 淡淡的粉色背景 */
    border: 1px solid #ffdecb;
    padding: 12px 16px;
    border-radius: 0 16px 16px 16px;
    color: #333;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    position: relative;
    min-width: 180px;
}
.bb-c-name {
    font-size: 11px;
    font-weight: 700;
    color: #ff7e67; /* 名字颜色 */
    margin-bottom: 4px;
    display: block;
}
.bb-c-text {
    font-size: 13px;
    line-height: 1.4;
}
/* =========================================
   [修正版] Bubble App - 粉丝视角 (User = Fan)
   ========================================= */

/* 1. 顶部滚动条 (路人粉丝评论流) */
.bb-fan-ticker-box {
    background: rgba(0, 0, 0, 0.03);
    height: 36px;
    display: flex;
    align-items: center;
    padding: 0 15px;
    cursor: pointer; /* 可点击 */
    border-bottom: 1px solid rgba(0,0,0,0.05);
    overflow: hidden;
    position: relative;
    z-index: 10;
}
.bb-fan-ticker-box:active { background: rgba(0,0,0,0.08); }

.bb-ticker-icon {
    font-size: 12px; color: #999; margin-right: 10px; flex-shrink: 0;
}
.bb-ticker-content {
    font-size: 11px; color: #666; 
    white-space: nowrap; 
    overflow: hidden;
    flex: 1;
}
/* 简单的滚动动画 */
.bb-ticker-text-anim {
    display: inline-block;
    animation: marquee-left 10s linear infinite;
    padding-left: 100%;
}
@keyframes marquee-left {
    0% { transform: translateX(0); }
    100% { transform: translateX(-100%); }
}

/* 2. 聊天区域背景优化 */
.bb-chat-container {
    background-color: #f2f4f5; /* 类似 Bubble 的淡灰底色 */
    padding: 15px;
}

/* 3. 爱豆的气泡 (VIP样式) */
.bb-msg-row.idol {
    align-self: flex-start;
    margin-bottom: 15px;
    max-width: 90%;
}

.bb-idol-container {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
}

/* 爱豆名字标签 */
.bb-idol-name-tag {
    font-size: 11px;
    color: #333;
    font-weight: 800;
    margin-bottom: 4px;
    margin-left: 4px;
    display: flex; align-items: center; gap: 4px;
}
.bb-idol-badge {
    background: #ff7e67; color: #fff;
    font-size: 9px; padding: 1px 4px;
    border-radius: 4px; font-weight: 700;
}

.bb-idol-bubble-wrap {
    display: flex; gap: 10px;
}

.bb-idol-avatar {
    width: 44px; height: 44px;
    border-radius: 50%;
    border: 2px solid #ff7e67; /* 醒目的边框 */
    box-shadow: 0 4px 10px rgba(255, 126, 103, 0.2);
    overflow: hidden; flex-shrink: 0;
}
.bb-idol-avatar img { width: 100%; height: 100%; object-fit: cover; }

/* 爱豆气泡本体 */
.bb-bubble.idol-style {
    background: #fff;
    color: #333;
    border-top-left-radius: 4px;
    border-radius: 4px 18px 18px 18px; /* 特殊圆角 */
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    line-height: 1.6;
    padding: 12px 16px;
    font-size: 14px;
}

/* 4. 粉丝(我)的气泡 */
.bb-msg-row.fan {
    align-self: flex-end;
    margin-bottom: 15px;
}
.bb-bubble.fan-style {
    background: #ffe04b; /* 黄色气泡 */
    color: #333;
    border-radius: 18px 4px 18px 18px;
    padding: 10px 14px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
}

/* 5. 路人评论列表弹窗 */
.bb-mob-modal {
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    background: #fff;
    z-index: 200;
    transform: translateY(100%);
    transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
    display: flex; flex-direction: column;
}
.bb-mob-modal.show { transform: translateY(0); }

.bb-mob-header {
    height: 50px; padding: 0 20px;
    display: flex; justify-content: space-between; align-items: center;
    border-bottom: 1px solid #eee; font-weight: 700;
}
.bb-mob-list {
    flex: 1; overflow-y: auto; padding: 0 20px;
}
.bb-mob-item {
    padding: 12px 0;
    border-bottom: 1px solid #f9f9f9;
    display: flex; gap: 10px;
}
.bb-mob-avatar {
    width: 32px; height: 32px; background: #eee; border-radius: 50%;
}
.bb-mob-content { flex: 1; font-size: 13px; color: #555; }
.bb-mob-user { font-size: 11px; color: #999; margin-bottom: 2px; }
/* =========================================
   新增：气泡右键菜单样式
   ========================================= */
.wc-bubble-menu {
    position: fixed; /* 使用 fixed 定位，防止被容器遮挡 */
    z-index: 9999;   /* 最高层级 */
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 12px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.15);
    border: 1px solid rgba(0,0,0,0.05);
    padding: 6px 0;
    width: 140px;
    display: none; /* 默认隐藏 */
    flex-direction: column;
    overflow: hidden;
    animation: menuFadeIn 0.2s ease;
}

/* 显示状态 */
.wc-bubble-menu.show {
    display: flex;
}

@keyframes menuFadeIn {
    from { opacity: 0; transform: scale(0.95); }
    to { opacity: 1; transform: scale(1); }
}

.wc-bubble-menu .wc-menu-item {
    padding: 10px 16px;
    font-size: 13px;
    color: #333;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 10px;
    transition: background 0.2s;
    border-bottom: none; /* 覆盖旧样式 */
}

.wc-bubble-menu .wc-menu-item:hover {
    background: #f0f0f0;
}

.wc-bubble-menu .wc-menu-item i {
    width: 16px;
    text-align: center;
    color: #666;
}

/* =========================================
   新增：多选模式与底部栏
   ========================================= */

/* 多选模式下，给气泡腾出左边空间放勾选框 */
.chat-messages.selection-mode .chat-row {
    padding-left: 10px;
    transition: all 0.3s;
}

/* 勾选框样式 */
.chat-row-checkbox {
    display: none; /* 默认隐藏 */
    align-items: center;
    margin-right: 10px;
}

/* 进入多选模式时显示勾选框 */
.chat-messages.selection-mode .chat-row-checkbox {
    display: flex;
}

.wc-msg-checkbox {
    width: 22px;
    height: 22px;
    border-radius: 50%;
    border: 2px solid #ddd;
    cursor: pointer;
    position: relative;
    transition: 0.2s;
}

.wc-msg-checkbox.checked {
    background: #07c160;
    border-color: #07c160;
}

.wc-msg-checkbox.checked::after {
    content: '✓';
    color: #fff;
    font-size: 14px;
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
}

/* 底部操作栏 */
.wc-multi-select-bar {
    position: absolute;
    bottom: 0; left: 0; right: 0;
    height: 80px;
    background: #fff;
    box-shadow: 0 -5px 20px rgba(0,0,0,0.05);
    z-index: 300;
    display: flex;
    justify-content: space-around;
    align-items: center;
    transform: translateY(100%);
    transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
}

.wc-multi-select-bar.show {
    transform: translateY(0);
}

.wc-multi-select-bar div {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 5px;
    color: #555;
    font-size: 12px;
    cursor: pointer;
}

.wc-multi-select-bar i {
    font-size: 24px;
    background: #f5f5f5;
    width: 48px; height: 48px;
    border-radius: 12px;
    display: flex; justify-content: center; align-items: center;
    margin-bottom: 2px;
}

/* 撤回消息的系统提示样式 */
.msg-system-revoke {
    width: 100%;
    text-align: center;
    margin: 10px 0;
}
.msg-system-revoke span {
    font-size: 11px;
    color: #999;
    background: rgba(0,0,0,0.04);
    padding: 4px 10px;
    border-radius: 4px;
}
/* =========================================
   新增：聊天记录转发卡片样式 (合并转发)
   ========================================= */
.msg-history-card {
    width: 240px;
    background: #fff;
    border-radius: 12px;
    padding: 12px 15px;
    overflow: hidden;
    /* 简单的边框，不像普通气泡那样有尖角，看起来像文件 */
    border: 1px solid rgba(0,0,0,0.05);
    display: flex;
    flex-direction: column;
    gap: 6px;
    text-align: left;
}

.history-card-title {
    font-size: 14px;
    font-weight: 600;
    color: #333;
    margin-bottom: 4px;
    /* 限制一行，超长省略 */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.history-card-content {
    font-size: 11px;
    color: #888;
    line-height: 1.5;
    /* 限制显示最多 4 行 */
    display: -webkit-box;
    -webkit-line-clamp: 4;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.history-card-footer {
    border-top: 1px solid #f5f5f5;
    margin-top: 6px;
    padding-top: 6px;
    font-size: 10px;
    color: #aaa;
}

/* 覆盖一下富媒体气泡的默认样式，让卡片不要带背景色 */
.message-bubble.rich-bubble .msg-history-card {
    background: #fff;
    color: #333; /* 强制字体深色 */
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}
/* 聊天记录详情页样式 */
.history-detail-item {
    background: #fff;
    padding: 15px 20px;
    border-bottom: 1px solid #f0f0f0;
    display: flex;
    gap: 12px;
}

.history-detail-avatar {
    width: 36px;
    height: 36px;
    border-radius: 6px;
    background: #eee;
    flex-shrink: 0;
    object-fit: cover;
}

.history-detail-info {
    flex: 1;
    overflow: hidden; /* 防止文字撑破 */
}

.history-detail-name {
    font-size: 11px;
    color: #999;
    margin-bottom: 4px;
    display: flex;
    justify-content: space-between;
}

.history-detail-text {
    font-size: 14px;
    color: #333;
    line-height: 1.6;
    word-wrap: break-word;
}

/* 覆盖一下卡片在输入框里的样式（防止太宽） */
.msg-history-card {
    cursor: pointer; /* 加上小手图标 */
    transition: background 0.2s;
}
.msg-history-card:active {
    background: #f5f5f5; /* 点击反馈 */
}
/* 新增：音乐播放器全屏界面样式 (粘贴在 style.css 末尾即可) */
.music-player-view {
    position: absolute; inset: 0;
    background: #fff;
    z-index: 200;
    transform: translateY(100%);
    transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
    display: flex; flex-direction: column;
}
.music-player-view.show { transform: translateY(0); }

.mp-cover-area {
    height: 350px; background: #f5f5f5;
    display: flex; align-items: center; justify-content: center;
    position: relative;
}
.mp-cover-img {
    width: 220px; height: 220px; border-radius: 50%;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    border: 8px solid #111;
    animation: spin 8s linear infinite;
    animation-play-state: paused;
}
.music-player-view.playing .mp-cover-img { animation-play-state: running; }

.mp-controls { padding: 30px; text-align: center; }
.mp-btn-row { display: flex; justify-content: center; align-items: center; gap: 30px; margin-top: 20px; }
.mp-btn { font-size: 24px; color: #333; cursor: pointer; }
.mp-btn-lg { font-size: 48px; color: #111; }

.mp-playlist { flex: 1; overflow-y: auto; padding: 20px; border-top: 1px solid #eee; }
.mp-item { 
    display: flex; justify-content: space-between; align-items: center; 
    padding: 12px 0; border-bottom: 1px solid #f9f9f9; 
}
.mp-item.active { color: #ff7e67; font-weight: bold; }
.mp-item-info { flex: 1; }
/* =========================================
   [新增] 线下模式 (Offline / Tavern Mode) - 韩系黑白风
   ========================================= */

/* 1. 主容器：全屏 Flex 列布局 */
.offline-mode-view {
    position: absolute; 
    inset: 0;
    background: #fff;
    z-index: 400; 
    transform: translateY(100%);
    transition: transform 0.5s cubic-bezier(0.16, 1, 0.3, 1);
    
    /* === 核心布局设定 === */
    display: flex;
    flex-direction: column; /* 垂直排列：头 -> 内容 -> 脚 */
    overflow: hidden;       /* 禁止整个页面滚动，只让中间滚 */
    height: 100%;           /* 确保撑满父容器 */
}
.offline-mode-view.show { transform: translateY(0); }

/* 背景层：模糊的角色图，营造氛围 */
#offline-bg-layer {
    position: absolute; inset: 0;
    background-size: cover; background-position: center;
    filter: grayscale(100%) blur(30px) opacity(0.1); /* 极淡的黑白背景 */
    z-index: -1;
    pointer-events: none;
}

/* 顶部设计 */
/* 2. 顶部导航：固定高度，不许收缩 */
.offline-header {
    height: 100px; 
    padding: 50px 24px 10px;
    display: flex; 
    justify-content: space-between; 
    align-items: center;
    background: rgba(255,255,255,0.9);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(0,0,0,0.05);
    
    /* === 核心修复 === */
    flex-shrink: 0; /* 禁止被压缩 */
    z-index: 10;
}
.oh-left, .oh-right { color: #111; cursor: pointer; opacity: 0.6; transition: 0.3s; width: 40px; text-align: center;}
.oh-left:hover, .oh-right:hover { opacity: 1; }

.oh-center { display: flex; flex-direction: column; align-items: center; }
#offline-char-name {
    font-family: 'Montserrat', sans-serif;
    font-weight: 700; font-size: 16px; letter-spacing: 3px; text-transform: uppercase;
    color: #111;
}
.oh-status-dot {
    width: 4px; height: 4px; background: #111; border-radius: 50%;
    margin-top: 6px; opacity: 0.4;
}


/* 隐藏滚动条 */
.offline-content::-webkit-scrollbar { display: none; }



/* 名字标记 */
.oe-name {
    font-size: 10px; color: #aaa; font-weight: 600; 
    letter-spacing: 1px; text-transform: uppercase;
    margin-left: 2px;
}
.offline-entry.user .oe-name { text-align: right; margin-right: 2px; color: #111; }


/* AI 回复用衬线体，更有文学感 */
.offline-entry.ai .oe-text {
    font-family: 'Playfair Display', 'Songti SC', serif; 
    font-size: 16px;
    color: #111;
    border-left: 2px solid #eee; /* 左侧装饰线 */
    padding-left: 15px;
}

/* 用户回复用无衬线体，现代感 */
.offline-entry.user .oe-text {
    font-family: 'Montserrat', sans-serif;
    color: #555; text-align: right;
    border-right: 2px solid #111; /* 右侧强装饰线 */
    padding-right: 15px;
}

/* 描写动作的斜体 (Markdown *text* 渲染后) */
.oe-text i, .oe-text em {
    color: #888; font-family: 'Montserrat', sans-serif; font-size: 14px; font-style: italic;
}
.oe-text b, .oe-text strong {
    font-weight: 700; color: #000;
}

/* 4. 底部输入区：固定底部，不许收缩 */
.offline-input-area {
    background: #fff;
    padding: 15px 24px 40px;
    border-top: 1px solid rgba(0,0,0,0.05);
    
    /* === 核心修复 === */
    flex-shrink: 0;  /* 禁止被压缩，确保输入框永远完整显示 */
    position: relative;
    z-index: 20;     /* 层级高于内容，防止内容穿透 */
}

.offline-tools {
    display: flex; gap: 15px; margin-bottom: 15px;
}
.offline-tools span {
    font-size: 10px; color: #999; border: 1px solid #eee;
    padding: 6px 12px; border-radius: 20px; cursor: pointer; transition: 0.2s;
    background: #fafafa;
}
.offline-tools span:hover { background: #111; color: #fff; border-color: #111; }

.offline-textarea-wrap {
    position: relative;
    border: 1px solid #e0e0e0;
    background: #fdfdfd;
    border-radius: 4px; /* 方形圆角，像笔记本 */
    padding: 5px;
    transition: 0.3s;
}
.offline-textarea-wrap:focus-within { border-color: #111; background: #fff; }

#offline-input {
    width: 100%; height: 80px;
    border: none; outline: none; resize: none;
    padding: 12px; font-family: 'Montserrat', sans-serif; font-size: 14px;
    background: transparent; color: #111; line-height: 1.5;
}

.offline-send-btn {
    position: absolute; bottom: 10px; right: 10px;
    width: 36px; height: 36px;
    background: #111; color: #fff;
    border: none; border-radius: 2px;
    cursor: pointer; display: flex; justify-content: center; align-items: center;
    transition: 0.2s;
}
.offline-send-btn:hover { background: #333; }
.offline-send-btn:active { transform: scale(0.95); }

@keyframes fadeUp {
    from { opacity: 0; transform: translateY(15px); }
    to { opacity: 1; transform: translateY(0); }
}
/* =========================================
   [新增] 线下模式操作栏与设置 (Offline Enhancements)
   ========================================= */

/* 1. 消息下方的操作栏 */
.oe-actions {
    display: flex;
    justify-content: flex-end;
    gap: 8px;
    margin-top: 6px;
    opacity: 0; /* 默认隐藏，悬停显示 */
    transition: opacity 0.2s;
}
/* 鼠标悬停或点击时显示 */
.offline-entry:hover .oe-actions,
.offline-entry:active .oe-actions {
    opacity: 1;
}

.oe-btn {
    font-size: 10px;
    padding: 4px 8px;
    border-radius: 6px;
    border: 1px solid #eee;
    background: #fff;
    color: #666;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 4px;
}
.oe-btn:hover {
    background: #2b2b2b;
    color: #fff;
    border-color: #2b2b2b;
}
.oe-btn.delete:hover {
    background: #ffecec;
    color: #ff4d4f;
    border-color: #ff4d4f;
}

/* 2. 线下模式设置弹窗 */
.offline-settings-modal {
    position: absolute;
    bottom: 0; left: 0; width: 100%;
    background: #fff;
    border-radius: 24px 24px 0 0;
    padding: 25px;
    box-shadow: 0 -10px 40px rgba(0,0,0,0.1);
    transform: translateY(100%);
    transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
    z-index: 500;
}
.offline-settings-modal.active {
    transform: translateY(0);
}

/* 3. 修改消息的独立弹窗 */
.modify-modal-view {
    position: absolute; inset: 0;
    background: rgba(255,255,255,0.98);
    z-index: 600;
    display: flex; flex-direction: column;
    transform: translateY(100%);
    transition: transform 0.3s ease;
}
.modify-modal-view.active { transform: translateY(0); }

.modify-header {
    height: 60px; display: flex; justify-content: space-between; align-items: center;
    padding: 0 20px; border-bottom: 1px solid #eee; font-weight: 700;
}
.modify-body { flex: 1; padding: 20px; }
.modify-textarea {
    width: 100%; height: 300px;
    border: 1px solid #eee; border-radius: 12px;
    padding: 15px; font-family: inherit; font-size: 14px;
    resize: none; outline: none; background: #fafafa;
}
.modify-textarea:focus { background: #fff; border-color: #333; }

/* =========================================
   [新增] 预设 (Presets) APP 样式
   ========================================= */
.presets-list {
    display: flex; flex-direction: column; gap: 15px; padding: 20px;
}
.preset-card {
    background: #fff; padding: 15px; border-radius: 16px;
    border: 1px solid #f0f0f0;
    display: flex; justify-content: space-between; align-items: center;
    box-shadow: 0 4px 10px rgba(0,0,0,0.03);
    cursor: pointer; transition: 0.2s;
}
.preset-card.active { border: 2px solid #2b2b2b; background: #fafafa; }
.preset-info h4 { margin: 0 0 5px 0; font-size: 14px; }
.preset-info p { margin: 0; font-size: 11px; color: #999; }

.preset-editor-overlay {
    position: absolute; inset: 0; background: #fff; z-index: 200;
    transform: translateX(100%); transition: transform 0.3s ease;
    display: flex; flex-direction: column;
}
.preset-editor-overlay.show { transform: translateX(0); }

/* 线下模式底部工具栏按钮的激活状态 */
.offline-tools span.active {
    background: #2b2b2b !important; /* 变成黑色背景 */
    color: #fff !important;         /* 变成白色字 */
    border-color: #2b2b2b !important;
    font-weight: bold;
}
/* === 预设 APP 美化 === */
/* 卡片样式优化 */
.preset-card {
    background: #fff;
    padding: 18px;
    border-radius: 16px;
    border: 1px solid rgba(0,0,0,0.05);
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 4px 12px rgba(0,0,0,0.03); /* 更柔和的阴影 */
    cursor: pointer;
    transition: all 0.2s ease;
    margin-bottom: 0; /* 让gap控制间距 */
}
.preset-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.06);
}
.preset-card.active {
    border: 2px solid #2b2b2b;
    background: #fff;
}
.preset-info h4 {
    margin: 0 0 6px 0;
    font-size: 15px;
    font-weight: 700;
    color: #333;
}
.preset-info p {
    margin: 0;
    font-size: 12px;
    color: #888;
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

/* 正则脚本项样式 */
.regex-script-item {
    background: #f9f9f9;
    border: 1px solid #eee;
    border-radius: 8px;
    padding: 10px;
    display: flex;
    flex-direction: column;
    gap: 8px;
    position: relative;
}
.regex-row {
    display: flex;
    gap: 8px;
    align-items: center;
}
.regex-input {
    flex: 1;
    border: 1px solid #ddd;
    border-radius: 6px;
    padding: 6px 8px;
    font-size: 12px;
    font-family: monospace;
}
.regex-flags {
    width: 50px;
    border: 1px solid #ddd;
    border-radius: 6px;
    padding: 6px;
    font-size: 12px;
    text-align: center;
}
.btn-del-regex {
    color: #ff4d4f;
    cursor: pointer;
    padding: 5px;
}
/* =========================================
   [CSS美化] 线下模式深度优化补丁
   ========================================= */


/* 7. 操作栏美化 */
.oe-actions {
    margin-top: 10px;
    opacity: 0.2; /* 平时不完全隐藏，保留一点点痕迹 */
    transition: 0.3s;
}
.offline-entry:hover .oe-actions {
    opacity: 1;
}
/* =========================================
   [新增] 线下模式交互优化补丁
   ========================================= */

/* 1. API 运行时：发送按钮的动画 */
@keyframes pulse-rotate {
    0% { transform: scale(1) rotate(0deg); box-shadow: 0 0 0 0 rgba(0,0,0,0.2); }
    50% { transform: scale(1.1) rotate(180deg); box-shadow: 0 0 10px 0 rgba(0,0,0,0.1); }
    100% { transform: scale(1) rotate(360deg); box-shadow: 0 0 0 0 rgba(0,0,0,0); }
}

/* 当 API 运行时，给发送按钮添加这个类 */
.offline-send-btn.sending {
    pointer-events: none; /* 防止重复点击 */
    background: #333;
    color: #fff;
    animation: pulse-rotate 1.2s infinite ease-in-out;
}
.offline-send-btn.sending i {
    /* 图标变成加载圈圈，或者保持箭头旋转 */
    animation: none; 
}

/* 2. 重回弹窗的美化微调 */
#offline-regen-modal .modal-box {
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 20px 50px rgba(0,0,0,0.15);
}

/* 2. [重制版] 玻璃拟态剧情选项 UI */
.vn-options-container {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-top: 25px;
    padding: 10px; /* 给容器一点内边距，防止按钮贴边 */
    animation: fadeUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
}

.vn-option-btn {
    background: rgba(255, 255, 255, 0.7); /* 半透明白色背景 */
    backdrop-filter: blur(12px) saturate(180%); /* 核心：磨砂玻璃效果 */
    color: #333; /* 深灰色文字，保证可读性 */
    padding: 16px 20px;
    border-radius: 16px; /* 更大的圆角 */
    font-size: 14px;
    font-family: 'Montserrat', 'PingFang SC', sans-serif;
    text-align: left; /* 文字靠左，像真正的选项列表 */
    cursor: pointer;
    box-shadow: 0 8px 25px rgba(0,0,0,0.05); /* 柔和的阴影 */
    border: 1px solid rgba(255, 255, 255, 0.9);
    transition: all 0.3s ease;
    letter-spacing: 0.5px;
}

.vn-option-btn:hover {
    background: rgba(255, 255, 255, 1); /* 悬停变实白 */
    transform: translateY(-3px) scale(1.02);
    box-shadow: 0 12px 30px rgba(0,0,0,0.1);
    color: #000;
}

.vn-option-btn:active {
    transform: scale(0.99);
    transition-duration: 0.1s;
}
/* =========================================
   [更新] 统一风格的语音气泡样式
   ========================================= */
/* 语音气泡里的转文字区 */
.msg-voice-transcript {
    display: none;
    margin-top: 8px;
    padding-top: 8px;
    font-size: 12px;
    line-height: 1.4;
    word-break: break-word;
}
.msg-voice-transcript.show {
    display: block;
}

/* 适配深色气泡 (发送方) */
.message-bubble.sent .msg-voice-transcript {
    border-top: 1px dashed rgba(255,255,255,0.2);
    color: #ddd;
}
/* 适配浅色气泡 (接收方) */
.message-bubble.received .msg-voice-transcript {
    border-top: 1px dashed rgba(0,0,0,0.15);
    color: #666;
}

/* 语音播放条的基础样式 */
.msg-voice-bar {
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    min-width: 60px;
}
/* 发送方 (自己) 的语音条靠右，时长在最左边 */
.message-bubble.sent .msg-voice-bar {
    flex-direction: row-reverse;
    justify-content: flex-start;
}

.msg-voice-icon {
    font-size: 16px;
}
.msg-voice-duration {
    font-size: 14px;
    font-weight: 500;
}

/* 弹窗里真实录音时的按钮发光特效 */
#modalHoldToTalkBtn.recording {
    background: #ff4d4f !important;
    color: #fff !important;
    transform: scale(0.95);
    box-shadow: 0 0 20px rgba(255, 77, 79, 0.4);
}
#modalHoldToTalkBtn.recording i {
    color: #fff !important;
}
/* 开场白模块美化 */
#cs-greeting-custom,
#cs-greeting-tavern {
    width: 100%;
    min-height: 88px;
    border-radius: 14px;
    border: 1px solid #e8e8e8;
    background: linear-gradient(180deg, #ffffff 0%, #fafafa 100%);
    padding: 12px 14px;
    font-size: 13px;
    line-height: 1.6;
    box-sizing: border-box;
    resize: vertical;
    transition: all .25s ease;
}

#cs-greeting-custom:focus {
    border-color: #333;
    box-shadow: 0 0 0 3px rgba(0,0,0,.06);
    background: #fff;
}

#cs-greeting-list {
    margin-bottom: 10px;
    max-height: 140px;
}
/* =========================================
   [修复] 聊天设置中开场白列表单选按钮样式
   ========================================= */
.wb-checklist-item input[type="radio"] {
    width: 18px;    /* 强制宽度为 18px */
    height: 18px;   /* 强制高度为 18px */
    padding: 0;     /* 移除内边距 */
    margin-right: 12px;
    accent-color: #2b2b2b; /* 统一勾选颜色 */
    flex-shrink: 0;
}

#cs-greeting-list {
    max-height: 180px; /* 稍微调高一点，防止显示不全 */
}

/* =========================================
   [终极美化版] 剧情总结与记录界面样式
   ========================================= */

/* 1. 总结列表外部大容器：解除高度限制，让它能容纳巨大的文本框 */
.summary-list-container {
    max-height: none; /* 去掉之前的 200px 限制 */
    min-height: 250px;
    background: transparent;
    display: flex;
    flex-direction: column;
    gap: 15px;
    padding: 5px 0;
    border: none;
}

/* 暂无内容时的提示 */
.summary-empty-state {
    text-align: center;
    color: #bbb;
    font-size: 13px;
    padding: 40px 20px;
    background: #fdfdfd;
    border: 1px dashed #e0e0e0;
    border-radius: 16px;
    letter-spacing: 1px;
}

/* 2. 单条记忆卡片（大号卡片设计） */
.summary-item {
    background: #ffffff;
    border: 1px solid rgba(0,0,0,0.06);
    border-radius: 16px;
    padding: 25px 20px 15px 20px; /* 顶部留足空间给轮数标签 */
    position: relative;
    box-shadow: 0 8px 25px rgba(0,0,0,0.04);
    transition: transform 0.2s, box-shadow 0.2s;
}
.summary-item:hover {
    box-shadow: 0 12px 35px rgba(0,0,0,0.08);
    transform: translateY(-2px);
}

/* 3. ★ 核心：可编辑文本区域 ★ */
.summary-item-text {
    width: 100%;
    min-height: 120px; /* 初始高度大幅增加，原本是40px */
    border: none;
    outline: none;
    resize: vertical; /* 允许垂直拉伸，无限变大 */
    background: transparent;
    font-family: 'Montserrat', 'PingFang SC', sans-serif;
    font-size: 14.5px; /* 字号放大 */
    line-height: 1.8; /* 行高增大，阅读更舒服 */
    color: #333;
    letter-spacing: 0.5px;
    text-align: justify;
}
/* 获得焦点时，边框周围不要有突兀的黑框 */
.summary-item-text:focus {
    box-shadow: none !important;
}

/* 4. 底部操作按钮区域 */
.summary-item-actions {
    display: flex;
    justify-content: flex-end;
    gap: 12px;
    margin-top: 15px;
    border-top: 1px dashed #f0f0f0;
    padding-top: 12px;
}
.summary-item-actions i {
    cursor: pointer;
    color: #aaa;
    font-size: 16px; /* 图标放大 */
    padding: 6px;
    transition: all 0.2s;
    background: #f9f9f9;
    border-radius: 8px;
}
.summary-item-actions i.fa-trash:hover {
    color: #fff;
    background: #ff4d4f;
}
.summary-item-actions i.fa-save:hover {
    color: #fff;
    background: #07c160;
}

/* 5. 顶部的设置输入框统一美化 */
#summaryPageView .input-group input,
#summaryPageView .input-group textarea {
    width: 100%;
    padding: 14px 16px;
    border: 1px solid #e5e5e5;
    background: #fdfdfd;
    border-radius: 12px;
    font-family: inherit;
    font-size: 13.5px;
    outline: none;
    transition: all 0.3s;
    box-sizing: border-box;
}
#summaryPageView .input-group input:focus,
#summaryPageView .input-group textarea:focus {
    border-color: #2b2b2b;
    background: #fff;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
}
#summaryPageView .input-group textarea {
    resize: vertical;
    min-height: 90px;
    line-height: 1.6;
}
/* =========================================
   [韩系简约灰] Pay (钱包) 专属样式 (全中文版)
   ========================================= */

/* 修复小游戏层级问题：强制提升层级，确保它能盖住弹窗 */
#coin-game-view {
    z-index: 9999 !important; /* 最高层级 */
}

/* 1. 核心卡片：极简奶白/高级灰 */
.pay-korean-card {
    background: #ffffff;
    border-radius: 28px;
    padding: 25px;
    /* 韩系核心：极柔和的投影，像浮在纸上 */
    box-shadow: 0 10px 40px rgba(0,0,0,0.03);
    position: relative;
    overflow: hidden;
    border: 1px solid rgba(0,0,0,0.02);
}

/* 2. 银灰卡片 (银行卡) */
.pay-silver-card {
    /* 银色哑光渐变 */
    background: linear-gradient(135deg, #f5f5f7 0%, #e8e8ea 100%);
    border-radius: 28px;
    padding: 25px;
    position: relative;
    overflow: hidden;
    color: #555;
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.8);
}
/* 装饰性光泽 */
.pay-silver-card::after {
    content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
    background: linear-gradient(to bottom right, rgba(255,255,255,0.8) 0%, transparent 60%);
    opacity: 0.5; pointer-events: none;
}

/* 3. 数字排版 */
.pay-num-lg {
    font-family: 'Montserrat', sans-serif;
    font-size: 36px;
    font-weight: 300; /* 极细字体，显高级 */
    color: #2b2b2b;   /* 深炭灰，不是纯黑 */
    letter-spacing: -1px;
    margin: 8px 0;
}

.pay-label-sm {
    font-size: 11px;
    color: #999;
    letter-spacing: 1px;
    font-weight: 500;
}

/* 4. 按钮：韩系圆润药丸形 */
.pay-pill-btn {
    background: #2b2b2b; /* 深色按钮 */
    color: #fff;
    border: none;
    padding: 8px 20px;
    border-radius: 20px;
    font-size: 12px;
    cursor: pointer;
    transition: 0.2s;
    box-shadow: 0 4px 12px rgba(43,43,43,0.15);
}
.pay-pill-btn:active { transform: scale(0.95); }

.pay-pill-btn.outline {
    background: transparent;
    border: 1px solid #ccc;
    color: #666;
    box-shadow: none;
}
.pay-pill-btn.outline:active { background: #f0f0f0; }

/* 5. 列表项：纯净风格 */
.pay-simple-list {
    background: #fff;
    border-radius: 24px;
    padding: 5px 20px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.02);
}
.pay-simple-item {
    display: flex; justify-content: space-between; align-items: center;
    padding: 18px 0;
    border-bottom: 1px solid #f9f9f9;
    cursor: pointer;
}
.pay-simple-item:last-child { border-bottom: none; }
.pay-item-left { display: flex; align-items: center; gap: 15px; }
.pay-icon-box {
    width: 36px; height: 36px;
    border-radius: 12px;
    display: flex; justify-content: center; align-items: center;
    font-size: 15px;
    background: #f7f7f7; color: #555; /* 统一灰色调图标 */
}
.pay-item-title { font-size: 14px; color: #333; font-weight: 600; }
.pay-item-desc { font-size: 10px; color: #aaa; margin-top: 3px; }

/* =========================================
   [极致美化] 抢金币小游戏 & 韩系弹窗
   ========================================= */

/* 1. 金币样式 (高级光泽质感) */
.gold-coin {
    position: absolute;
    width: 50px; height: 50px;
    background: linear-gradient(135deg, #fef08a 0%, #f59e0b 100%);
    border-radius: 50%;
    box-shadow: 
        0 8px 20px rgba(245, 158, 11, 0.3), 
        inset 0 2px 5px rgba(255, 255, 255, 0.8),
        inset 0 -3px 5px rgba(0, 0, 0, 0.1);
    display: flex; justify-content: center; align-items: center;
    color: #fff; font-weight: 900; font-size: 22px; font-family: 'Montserrat', sans-serif;
    cursor: pointer;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
    animation: coinPopIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    border: 2px solid #fde68a;
    transition: transform 0.1s;
}
.gold-coin:active { 
    transform: scale(0.85); 
    filter: brightness(1.1); 
    box-shadow: 0 2px 10px rgba(245, 158, 11, 0.4);
}

@keyframes coinPopIn {
    from { transform: scale(0) rotate(-45deg); opacity: 0;}
    to { transform: scale(1) rotate(0deg); opacity: 1;}
}

/* 2. 加分飘字动画 */
@keyframes floatUpFade {
    0% { transform: translateY(0) scale(1); opacity: 1; }
    100% { transform: translateY(-50px) scale(1.3); opacity: 0; }
}

/* 3. 倒计时警告 (变红跳动) */
.cg-time-warning { 
    color: #ff4d4f !important; 
    animation: pulseWarning 0.8s infinite alternate !important; 
}
@keyframes pulseWarning {
    from { transform: scale(1); }
    to { transform: scale(1.1); }
}

/* 4. 输入框焦点美化 */
#k-dialog-input:focus {
    border-color: #2b2b2b !important;
    background: #fff !important;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
}
/* === Pay 钱包子页面样式修复 === */
.pay-sub-page {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #fafafa;
    z-index: 20; /* 保证盖在主页上面 */
    transform: translateX(100%); /* 默认移出屏幕 */
    transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
    display: flex;
    flex-direction: column;
-webkit-backface-visibility: hidden;
    backface-visibility: hidden;
    will-change: transform;
}

.pay-sub-page.show {
    transform: translateX(0); /* 激活时滑入 */
}
/* ===== Pay 专用布局修复 ===== */
#payApp {
  display: flex;
  flex-direction: column;
}

#payApp > .k-header {
  height: 96px;
  padding: 50px 24px 12px;
  flex-shrink: 0;
}

#payApp > .k-body-container {
  flex: 1;
  height: auto !important;   /* 覆盖直播页的 calc 高度 */
  overflow-y: auto;
  padding: 10px 24px 24px;
}

/* 避免数字/按钮被裁切 */
#payApp .pay-korean-card,
#payApp .pay-silver-card {
  overflow: visible;
}

#payApp .pay-num-lg {
  line-height: 1.2;
}
/* === [修复] 身份切换按钮显示问题 === */
/* 强制让容器允许子元素溢出，这样小按钮才能挂在外面 */
#me-avatar-switcher {
    overflow: visible !important; 
    position: relative;
}
/* 保证里面的头像图片依然是圆角 */
#me-avatar-switcher img {
    border-radius: 22px; 
    width: 100%; 
    height: 100%; 
    display: block;
}

/* 小按钮样式微调 */
.identity-switch-mini-btn {
    position: absolute;
    right: -6px; 
    bottom: -6px;
    width: 28px; 
    height: 28px;
    border-radius: 50%;
    background: #2b2b2b;
    color: #fff;
    display: flex; 
    align-items: center; 
    justify-content: center;
    font-size: 12px;
    border: 3px solid #fff; /* 加粗白边，看起来更分明 */
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    z-index: 20;
    cursor: pointer;
}

/* === [新增] 身份弹窗里的头像预览 === */
.id-avatar-preview-box {
    width: 80px; 
    height: 80px; 
    border-radius: 50%; 
    border: 3px solid #eee;
    margin: 0 auto 20px auto; /* 居中 + 底部留空 */
    overflow: hidden;
    background: #f9f9f9;
    position: relative;
}
.id-avatar-preview-box img {
    width: 100%; height: 100%; object-fit: cover;
}
/* =========================================
   [新增] Pay 钱包账单明细高级美化
   ========================================= */

.bill-card-modern {
    background: #ffffff;
    padding: 16px 20px;
    border-radius: 20px;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.02);
    border: 1px solid rgba(0,0,0,0.03);
    transition: transform 0.2s ease;
}

.bill-card-modern:active {
    transform: scale(0.98);
    background: #fdfdfd;
}

/* 左侧小图标圆圈 */
.bill-icon-wrap {
    width: 42px;
    height: 42px;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-shrink: 0;
    font-size: 14px;
}

/* 收入图标（浅绿底绿字） */
.bill-icon-in {
    background: rgba(7, 193, 96, 0.1);
    color: #07c160;
}

/* 支出图标（浅灰底黑字） */
.bill-icon-out {
    background: #f5f5f5;
    color: #333;
}

/* 标题与时间 */
.bill-info-wrap {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    overflow: hidden;
}

.bill-title {
    font-size: 14px;
    font-weight: 600;
    color: #333;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    margin-bottom: 4px;
}

.bill-time {
    font-size: 11px;
    color: #aaa;
    font-family: 'Montserrat', sans-serif;
    letter-spacing: 0.5px;
}

/* 价格数字 */
.bill-amount-wrap {
    font-size: 16px;
    font-weight: 700;
    font-family: 'Montserrat', sans-serif;
    letter-spacing: 0.5px;
}

.bill-income-text {
    color: #07c160;
}

.bill-expense-text {
    color: #2b2b2b;
}

/* 彻底隐藏掉旧版的账单样式，防止冲突 */
.bill-card-minimal { display: none !important; }
/* =========================================
   [终极韩系] 亲密付高级定制气泡卡片
   ========================================= */
.msg-intimate-card {
    width: 250px !important;
    max-width: 100%;
    background: #ffffff;
    border-radius: 24px;
    padding: 24px 20px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.04);
    border: 1px solid rgba(0,0,0,0.03);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    font-family: 'Montserrat', 'PingFang SC', sans-serif;
    box-sizing: border-box;
    margin: 5px 0;
}

/* 强制背景透明 */
.message-bubble.rich-bubble .msg-intimate-card { color: #333; }

/* 顶部圆形 Icon */
.intimate-icon-wrap {
    width: 52px; height: 52px;
    background: #fcfcfc;
    border-radius: 50%;
    display: flex; justify-content: center; align-items: center;
    font-size: 20px; color: #2b2b2b;
    border: 1px solid #f0f0f0;
    margin-bottom: 5px;
}

/* 标题和金额 */
.intimate-title {
    font-size: 11px; color: #999; font-weight: 600; letter-spacing: 1px;
}
.intimate-amount {
    font-size: 32px; font-weight: 300; color: #111; line-height: 1; margin-bottom: 5px; letter-spacing: -1px;
}

/* 分割线 */
.intimate-divider {
    width: 100%; height: 1px; background: rgba(0,0,0,0.03); margin: 5px 0;
}

/* 底部按钮与状态 */
.intimate-btn-group {
    display: flex; gap: 10px; width: 100%;
}
.intimate-btn {
    flex: 1; padding: 12px 0; border-radius: 14px; font-size: 12px; font-weight: 600; cursor: pointer; text-align: center; transition: 0.2s; letter-spacing: 0.5px;
}
.intimate-btn.black { background: #2b2b2b; color: #fff; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
.intimate-btn.black:active { transform: scale(0.95); }
.intimate-btn.gray { background: #f5f5f5; color: #888; }
.intimate-btn.gray:active { background: #eee; }

/* 锁定后的状态条 */
.intimate-status {
    width: 100%; padding: 12px 0; background: #fafafa; border-radius: 14px; font-size: 12px; color: #888; text-align: center; font-weight: 600; letter-spacing: 1px; border: 1px solid #f5f5f5;
}
.intimate-status.accepted { background: #fdfdfd; color: #333; border-color: #eee; }
/* === 全局 Toast 提示 (窄弹窗) === */
#k-global-toast {
    position: fixed;
    top: 60px;
    left: 50%;
    transform: translateX(-50%) translateY(-20px);
    background: rgba(43, 43, 43, 0.95);
    color: #fff;
    padding: 10px 20px;
    border-radius: 20px;
    font-size: 13px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.15);
    z-index: 99999;
    opacity: 0;
    pointer-events: none;
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    backdrop-filter: blur(10px);
    white-space: nowrap;
    display: flex;
    align-items: center;
    gap: 8px;
}
#k-global-toast.show {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
}
/* =========================================
   [全新韩系极简] 兼职中心 & 小游戏样式
   ========================================= */

/* 职业卡片 - 黑白灰风格 */
.job-card-korean {
    display: flex; align-items: center; gap: 15px;
    padding: 22px 20px; margin-bottom: 16px;
    background: #ffffff;
    border: 1px solid rgba(0,0,0,0.04);
    border-radius: 20px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.03);
    cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;
    position: relative; overflow: hidden;
}
.job-card-korean:active { transform: scale(0.98); background: #fdfdfd; }
.job-k-icon {
    width: 46px; height: 46px; border-radius: 14px;
    display: flex; justify-content: center; align-items: center;
    font-size: 18px; flex-shrink: 0;
}
.job-k-info { flex: 1; }
.job-k-info .title { font-size: 15px; font-weight: 700; color: #111; margin-bottom: 5px; }
.job-k-info .desc { font-size: 11px; color: #888; }
.job-k-pay { font-size: 18px; font-weight: 300; font-family: 'Montserrat', sans-serif; color: #111; }

/* 游戏通用容器 */
.game-view-box {
    display: none; 
    width: 100%; height: 100%;
    position: absolute; top: 0; left: 0;
}

/* 游戏头部状态栏 */
.game-k-header {
    position: absolute; top: 0; left: 0; width: 100%;
    padding: 15px 20px; display: flex; justify-content: space-between; align-items: center;
    background: rgba(255,255,255,0.9); backdrop-filter: blur(10px);
    z-index: 100; border-bottom: 1px solid rgba(0,0,0,0.03);
}
.timer-box { font-weight: 700; font-family: 'Montserrat'; color: #111; font-size: 14px; display:flex; align-items:center; gap:5px;}
.score-box { font-size: 13px; color: #555; }
.btn-quit-game {
    background: #f5f5f5; color: #555; border: none; border-radius: 12px;
    padding: 6px 12px; font-size: 11px; font-weight: 600; cursor: pointer;
}
.btn-quit-game:active { background: #e0e0e0; }

/* --- 游戏1：收银员 --- */
#g1-belt {
    width: 100%; height: 100%;
    position: absolute; top: 0; left: 0;
    overflow: hidden;
    background: #fafafa;
    background-image: repeating-linear-gradient(0deg, transparent, transparent 40px, rgba(0,0,0,0.02) 40px, rgba(0,0,0,0.02) 80px); /* 斑马线模拟传送带 */
}
.g1-item {
    position: absolute;
    font-size: 45px;
    cursor: pointer;
    /* 核心修复：确保能被点到 */
    z-index: 10;
    animation: fallDown linear forwards;
    user-select: none;
    filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
}
.g1-item:active { transform: scale(1.3); opacity: 0.2; }
@keyframes fallDown {
    from { top: -60px; transform: rotate(0deg); }
    to { top: 110%; transform: rotate(30deg); }
}
.g1-scanner-line {
    position: absolute; top: 75%; left: 0; width: 100%; height: 2px;
    background: rgba(255,0,0,0.5); 
    box-shadow: 0 0 10px rgba(255,0,0,0.5);
    pointer-events: none; z-index: 5;
}

/* --- 游戏2：咖啡师 --- */
.g2-customer-bubble {
    background: #fff; padding: 15px 20px; border-radius: 20px 20px 20px 4px;
    border: 1px solid #eee; margin-bottom: 40px; margin-top: 60px;
    font-size: 13px; font-weight: 600; color: #333;
    box-shadow: 0 5px 15px rgba(0,0,0,0.03);
    text-align: center; line-height: 1.5;
}
.g2-cup-area {
    height: 140px; display: flex; justify-content: center; align-items: flex-end; margin-bottom: 40px;
}
#g2-cup {
    width: 80px; height: 110px; border: 4px solid #ddd; border-top: none;
    border-radius: 0 0 20px 20px; position: relative; overflow: hidden; background: rgba(255,255,255,0.8);
    box-shadow: 0 10px 20px rgba(0,0,0,0.02);
}
#g2-liquid {
    position: absolute; bottom: 0; left: 0; width: 100%; height: 0%;
    background: #6F4E37; transition: height 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275), background-color 0.3s;
}
/* 新增：倒入配料的小图标显示区 */
#g2-ingredients-display {
    position: absolute; width: 100%; height: 100%; top:0; left:0;
    display: flex; flex-direction: column-reverse; align-items: center; justify-content: flex-start;
    padding-bottom: 5px; gap: 2px; font-size: 18px; z-index: 2;
}

.g2-controls {
    display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin-bottom: 30px; width: 100%; max-width: 320px;
}
.g2-controls button {
    background: #fff; border: 1px solid #eee; padding: 12px 0;
    border-radius: 16px; font-size: 22px; cursor: pointer;
    box-shadow: 0 4px 10px rgba(0,0,0,0.02); transition: 0.2s;
    display: flex; flex-direction: column; align-items: center; gap: 4px;
}
.g2-controls button span { font-size: 10px; color: #888; font-weight: 600; }
.g2-controls button:active { background: #f5f5f5; transform: scale(0.9); }

.g2-serve-btn {
    width: 200px; height: 48px; background: #111; color: #fff;
    border: none; border-radius: 24px; font-weight: 600; font-size: 14px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.15); transition: 0.2s;
}
.g2-serve-btn:active { transform: scale(0.95); }

/* --- 游戏3：黑客 --- */
.g3-bar-container {
    width: 280px; height: 24px; border: 2px solid #333;
    border-radius: 12px; position: relative; overflow: hidden;
    background: #222; margin-bottom: 50px;
}
.g3-target-zone {
    position: absolute; top: 0; bottom: 0;
    width: 40px; background: rgba(255, 255, 255, 0.2);
    border-left: 2px solid #fff; border-right: 2px solid #fff;
    /* 取消 transform 的 translateX，完全依赖 left 定位 */
}
.g3-cursor {
    position: absolute; top: -2px; bottom: -2px; left: 0;
    width: 4px; background: #ff4d4f;
    box-shadow: 0 0 10px #ff4d4f;
    border-radius: 2px;
}
.g3-lock-btn {
    width: 140px; height: 140px; border-radius: 50%;
    background: #111; border: 4px solid #333;
    color: #fff; font-weight: 700; font-family: 'Montserrat', sans-serif;
    font-size: 16px; cursor: pointer; letter-spacing: 2px;
    transition: 0.1s;
    display: flex; justify-content: center; align-items: center;
}
.g3-lock-btn:active { background: #222; border-color: #555; transform: scale(0.95); }
/* =========================================
   [新增] 模拟股市 韩系黑白灰风格
   ========================================= */
.stock-card {
    background: #ffffff;
    border: 1px solid rgba(0,0,0,0.04);
    border-radius: 16px;
    padding: 16px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 4px 15px rgba(0,0,0,0.02);
    cursor: pointer;
    transition: transform 0.2s;
}
.stock-card:active { transform: scale(0.98); background: #fdfdfd; }

.stock-info-left {
    display: flex;
    flex-direction: column;
    gap: 4px;
}
.stock-name { font-size: 14px; font-weight: 700; color: #111; }
.stock-code { font-size: 10px; color: #999; font-family: 'Montserrat', sans-serif; letter-spacing: 1px; }

.stock-info-right {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 4px;
}
.stock-price { font-size: 16px; font-weight: 600; font-family: 'Montserrat', sans-serif; color: #111; }
.stock-tag { 
    font-size: 11px; 
    font-weight: 700; 
    padding: 3px 8px; 
    border-radius: 6px; 
    font-family: 'Montserrat', sans-serif;
}

/* 黑白灰风格的涨跌：涨是深黑底白字，跌是浅灰底深灰字 */
.stock-up { background: #111; color: #fff; }
.stock-down { background: #f0f0f0; color: #555; }
.stock-flat { background: #fafafa; color: #888; border: 1px solid #eee; }

.stock-color-up { color: #111 !important; }
.stock-color-down { color: #888 !important; }
/* =========================================
   [韩系极简] 电子宠物 (Pet App) - Black & White
   ========================================= */

:root {
    /* 韩系黑白灰配色 */
    --pet-bg: #ffffff;
    --pet-line: #333333;
    --pet-gray: #f2f2f2;
    --pet-shadow: rgba(0,0,0,0.05);
    --pet-accent: #000000;
}

/* 1. 房间容器 (清新简约风) */
.pet-room-stage {
    position: relative;
    width: 100%;
    height: 60%;
    background-color: #f0f0f0; 
    background-size: cover;
    background-position: center;
    overflow: hidden;
    transition: filter 1s ease, background 0.3s;
}

/* 地板 (清新浅色) */
.pet-floor {
    position: absolute;
    bottom: 0;
    width: 100%;
    height: 35%;
    /* 默认柔和的浅木色/米色 */
    background-color: #fdfbf7; 
    background-size: cover;
    background-position: center top;
    /* 去掉原本刺眼的黑线，改为淡淡的阴影分割 */
    box-shadow: 0 -2px 10px rgba(0,0,0,0.03);
    transition: background 0.3s;
}

/* 窗户 (支持自定义图) */
.pet-window {
    position: absolute; top: 40px; left: 50%; transform: translateX(-50%);
    width: 120px; height: 140px; 
    background-color: #fff;
    background-size: cover;
    background-position: center;
    border: 4px solid #fff; 
    border-radius: 60px 60px 0 0; /* 拱形窗 */
    overflow: hidden;
    box-shadow: 0 10px 25px rgba(0,0,0,0.05);
}
/* 如果没传图片，显示默认的线条效果 */
.pet-window::after {
    content:''; position:absolute; bottom:0; left:50%; transform:translateX(-50%);
    width:100%; height:100%;
    background: repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(0,0,0,0.02) 10px, rgba(0,0,0,0.02) 12px);
    pointer-events: none;
}


/* 夜晚模式 */
.pet-room-stage.night-mode { filter: invert(0.9) hue-rotate(180deg); } 

/* 2. 宠物 & 家具 */
.pet-entity {
    position: absolute; width: 80px; height: 80px;
    left: 50%; top: 70%; transform: translate(-50%, -50%);
    z-index: 10; cursor: grab;
    transition: top 3s linear, left 3s linear;
    display: flex; justify-content: center; align-items: flex-end;
}
/* 宠物被提起来时的样式和动画 */
.pet-entity.dragging { 
    cursor: grabbing !important; 
    transition: none !important; 
    transform: translate(-50%, -50%) scale(1.1) !important; 
    z-index: 8000 !important; 
}
.pet-entity.dragging .pet-img-wrapper {
    animation: struggle 0.5s infinite;
}
@keyframes struggle {
    0% { transform: rotate(-5deg); }
    50% { transform: rotate(5deg); }
    100% { transform: rotate(-5deg); }
}

/* 强制提高弹窗的层级，确保在宠物之上 */
.modal-overlay,
.pet-dialog-overlay,
.k-full-modal {
    z-index: 10000 !important;
}

.pet-img-wrapper img { width: 100%; height: 100%; object-fit: contain; filter: grayscale(100%); } /* 强制黑白 */

/* 家具 (可移动) */
.pet-furniture {
    position: absolute;
    font-size: 40px;
    z-index: 5;
    cursor: grab;
    filter: grayscale(100%); /* 家具也黑白 */
    transition: transform 0.2s;
}
.pet-furniture.dragging {
    cursor: grabbing;
    transform: scale(1.2);
    z-index: 100; /* 拖动时置顶 */
    opacity: 0.8;
}
.pet-item { position: absolute; font-size: 24px; z-index: 8; animation: popIn 0.3s; }

/* 3. 底部 UI (黑白灰) */
.pet-ui-container {
    flex: 1; background: #fff; 
    padding: 20px; display: flex; flex-direction: column; gap: 15px;
    position: relative; z-index: 20;
}

/* 状态条 */
.pet-stats-bar {
    display: flex; justify-content: space-around; align-items: center;
    border: 2px solid var(--pet-line);
    border-radius: 12px; padding: 10px;
    background: #fff;
    box-shadow: 4px 4px 0 var(--pet-line);
}
.pet-stat { font-size: 12px; font-weight: 700; color: var(--pet-line); font-family: 'Montserrat'; }

/* 操作按钮 */
.pet-actions-grid {
    display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px;
}
.pet-action-btn {
    display: flex; flex-direction: column; align-items: center; gap: 6px; cursor: pointer;
}
.pet-btn-icon {
    width: 50px; height: 50px; 
    background: #fff; 
    border: 2px solid var(--pet-line); 
    border-radius: 50%; /* 圆形图标 */
    display: flex; justify-content: center; align-items: center;
    font-size: 20px; color: var(--pet-line);
    transition: 0.2s;
}
.pet-action-btn:active .pet-btn-icon { background: var(--pet-line); color: #fff; transform: scale(0.95); }
.pet-btn-label { font-size: 10px; font-weight: 600; color: #666; letter-spacing: 1px; }

/* 4. 自定义可爱对话框 (Custom Dialog) */
.pet-dialog-overlay {
    position: absolute; inset: 0; background: rgba(255,255,255,0.6); backdrop-filter: blur(2px);
    z-index: 200; display: none; align-items: center; justify-content: center;
}
.pet-dialog-overlay.active { display: flex; animation: fadeIn 0.3s; }

.pet-dialog-box {
    background: #fff;
    border: 3px solid var(--pet-line);
    border-radius: 20px;
    padding: 25px;
    width: 80%;
    max-width: 300px;
    text-align: center;
    box-shadow: 8px 8px 0 rgba(0,0,0,0.1);
    position: relative;
    animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}
.pet-dialog-content { font-size: 14px; color: #333; line-height: 1.6; margin-bottom: 20px; font-weight: 500; }
.pet-dialog-btn {
    background: var(--pet-line); color: #fff; border: none;
    padding: 8px 25px; border-radius: 20px; font-size: 12px; cursor: pointer; font-weight: 700;
}

/* 5. 商店 Tabs */
.shop-tabs { display: flex; gap: 10px; margin-bottom: 15px; border-bottom: 2px solid #eee; padding-bottom: 10px; }
.shop-tab { font-size: 12px; font-weight: 700; color: #999; cursor: pointer; padding: 5px 10px; }
.shop-tab.active { color: #333; background: #eee; border-radius: 8px; }

/* 6. 相册与拍立得 (Polaroid) */
.album-grid {
    display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;
    max-height: 400px; overflow-y: auto; padding: 5px;
}

/* 翻转卡片容器 */
.polaroid-card {
    background: transparent;
    width: 100%; aspect-ratio: 3/4;
    perspective: 1000px;
    cursor: pointer;
}
.polaroid-inner {
    position: relative; width: 100%; height: 100%;
    text-align: center; transition: transform 0.8s;
    transform-style: preserve-3d;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}
.polaroid-card.flipped .polaroid-inner { transform: rotateY(180deg); }

/* 正面与背面 */
.polaroid-front, .polaroid-back {
    position: absolute; width: 100%; height: 100%;
    -webkit-backface-visibility: hidden; backface-visibility: hidden;
    background: #fff; border: 1px solid #eee; padding: 10px 10px 30px 10px;
    display: flex; flex-direction: column;
}
/* 正面：图片 */
.p-photo { flex: 1; background: #333; overflow: hidden; }
.p-photo img { width: 100%; height: 100%; object-fit: cover; filter: grayscale(100%) contrast(1.2); }
/* 背面：文字 (旋转180度) */
.polaroid-back { transform: rotateY(180deg); justify-content: center; align-items: center; padding: 20px; }
.p-text { 
    font-family: 'Alex Brush', cursive; font-size: 16px; color: #555; 
    line-height: 1.5; text-align: center; 
}
.p-date { position: absolute; bottom: 10px; right: 10px; font-size: 9px; color: #ccc; font-family: monospace; }

/* 气泡美化 */
.pet-bubble-pretty {
    position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%);
    background: #fff; border: 2px solid #333; color: #333;
    padding: 8px 12px; border-radius: 12px; font-size: 12px; font-weight: 600;
    white-space: nowrap; box-shadow: 4px 4px 0 rgba(0,0,0,0.1);
    opacity: 0; transition: 0.3s; pointer-events: none;
}
.pet-bubble-pretty.show { opacity: 1; transform: translateX(-50%) translateY(-10px); }
.pet-bubble-pretty::after {
    content: ''; position: absolute; top: 100%; left: 50%; margin-left: -6px;
    border-width: 6px; border-style: solid; border-color: #333 transparent transparent transparent;
}
/* =========================================
   1. 线下模式：字体缩小与精致化排版
   ========================================= */
.offline-entry.ai .oe-text, 
.offline-entry.user .oe-text,
.oe-text {
    font-size: 13.5px !important;  /* 原本是16.5px，现在调小显得精致 */
    line-height: 1.8 !important; 
}
.offline-entry.ai .oe-text i, 
.offline-entry.ai .oe-text em,
.oe-text i, .oe-text em {
    font-size: 12px !important;    /* 动作描述字号再稍微小一点 */
}


/* =========================================
   2. 电子宠物：韩系黑白灰高定美化补丁
   ========================================= */

/* 房间背景：奶白与浅灰，去掉刺眼线条 */
.pet-room-stage { background-color: #fafafa !important; }
.pet-floor {
    background-color: #f5f5f5 !important;
    box-shadow: none !important;
    border-top: 1px solid rgba(0,0,0,0.03) !important;
}
.pet-window {
    border: 1px solid #f0f0f0 !important;
    box-shadow: 0 20px 40px rgba(0,0,0,0.03) !important;
    border-radius: 80px 80px 0 0 !important;
}

/* 顶部状态条：悬浮胶囊，去除彩色，统一黑白灰 */
.pet-stats-bar {
    border: 1px solid rgba(0,0,0,0.04) !important;
    box-shadow: 0 10px 30px rgba(0,0,0,0.03) !important;
    border-radius: 24px !important;
    background: rgba(255, 255, 255, 0.9) !important;
    padding: 16px 20px !important;
    backdrop-filter: blur(10px);
}
.pet-stat {
    color: #999 !important;
    font-size: 10px !important;
    letter-spacing: 0.5px !important;
}
/* 强行覆盖HTML中写死的绿/橙/黄色，改为深灰系 */
#pet-stat-hunger, #pet-stat-mood, #pet-stat-money {
    color: #2b2b2b !important;
    font-size: 14px !important;
    font-weight: 700 !important;
    margin-left: 4px;
}
/* 签到按钮变成高级质感 */
#pet-daily-btn {
    background: #f5f5f5 !important;
    color: #555 !important;
    border-radius: 20px !important;
    padding: 6px 14px !important;
    font-weight: 600 !important;
    transition: 0.3s;
}
#pet-daily-btn:hover { background: #e0e0e0 !important; color: #2b2b2b !important; }

/* 底部操作网格：去除黑粗框，变成奶油块 */
.pet-btn-icon {
    border: 1px solid rgba(0,0,0,0.03) !important;
    background: #fcfcfc !important;
    box-shadow: 0 6px 16px rgba(0,0,0,0.04) !important;
    color: #666 !important;
    border-radius: 18px !important; /* 微微圆角矩形更好看 */
}
.pet-action-btn:active .pet-btn-icon {
    background: #2b2b2b !important;
    color: #fff !important;
    transform: scale(0.92);
}
.pet-btn-label { color: #aaa !important; font-size: 9px !important; }

/* 对话气泡与弹窗：柔和阴影，去边框 */
.pet-bubble-pretty {
    border: none !important;
    box-shadow: 0 12px 30px rgba(0,0,0,0.06) !important;
    border-radius: 16px !important;
    background: rgba(255, 255, 255, 0.95) !important;
    padding: 10px 16px !important;
    color: #444 !important;
    letter-spacing: 0.5px;
}
.pet-bubble-pretty::after {
    border-top-color: rgba(255, 255, 255, 0.95) !important;
}

/* 核心弹窗变高级 */
.pet-dialog-box {
    border: 1px solid rgba(255,255,255,0.8) !important;
    box-shadow: 0 20px 50px rgba(0,0,0,0.1) !important;
    border-radius: 24px !important;
    padding: 30px !important;
}
.pet-dialog-btn {
    background: #2b2b2b !important;
    color: #fff !important;
    border-radius: 20px !important;
    height: 44px !important;
    font-size: 13px !important;
}

/* 相册卡片去硬边框 */
.polaroid-front, .polaroid-back {
    border: 1px solid #f9f9f9 !important;
    box-shadow: 0 10px 25px rgba(0,0,0,0.04) !important;
    border-radius: 8px !important;
}
/* =========================================
   [新增] 宠物APP 2.0 升级样式
   ========================================= */

/* 1. 窗户升级：带框框和背景色 */
.pet-window {
    border: 6px solid var(--pet-window-frame, #333) !important; /* 窗框颜色变量 */
    background-color: var(--pet-window-bg, #87ceeb) !important; /* 窗户玻璃颜色 */
    border-radius: 60px 60px 0 0 !important; /* 拱形 */
    box-shadow: 
        0 0 0 4px #fff, /* 外层白边 */
        inset 0 0 20px rgba(0,0,0,0.1) !important; /* 内阴影 */
    overflow: hidden;
    transition: all 0.3s ease;
}

/* 2. 宠物翻转与动画 */
.pet-entity {
    transition: top 3s linear, left 3s linear, transform 0.3s ease !important; /* 增加 transform 过渡 */
}
.pet-entity.flipped .pet-img-wrapper img {
    transform: scaleX(-1); /* 左右镜像翻转 */
}
.pet-entity:active {
    transform: scale(0.95) !important; /* 点击时的按压感 */
}

/* 3. 点击时的可爱浮动表情 */
.pet-reaction-float {
    position: absolute;
    font-size: 24px;
    font-weight: bold;
    pointer-events: none;
    animation: floatUpFade 1s ease-out forwards;
    z-index: 100;
    text-shadow: 0 2px 5px rgba(255,255,255,0.8);
}

/* 4. 领养/初始化弹窗 */
.pet-setup-step {
    display: none;
    animation: fadeIn 0.3s;
}
.pet-setup-step.active {
    display: block;
}

/* 5. 宠物朋友圈 (Moments) */
.pet-moments-view {
    position: absolute;
    inset: 0;
    background: #f7f7f7;
    z-index: 50;
    display: none;
    flex-direction: column;
    animation: slideUp 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
}
.pet-moments-view.show {
    display: flex;
}

.pet-moment-card {
    background: #fff;
    margin: 15px;
    padding: 20px;
    border-radius: 20px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.03);
    border: 1px solid rgba(0,0,0,0.02);
}
.pet-moment-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 12px;
}
.pet-moment-avatar {
    width: 44px; height: 44px;
    border-radius: 50%;
    background: #f0f0f0;
    border: 2px solid #fff;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    overflow: hidden;
}
.pet-moment-avatar img { width: 100%; height: 100%; object-fit: cover; }
.pet-moment-info { flex: 1; }
.pet-moment-name { font-weight: 700; font-size: 14px; color: #333; }
.pet-moment-time { font-size: 10px; color: #999; }
.pet-moment-text {
    font-size: 13px;
    color: #444;
    line-height: 1.6;
    background: #fcfcfc;
    padding: 12px;
    border-radius: 12px;
    border: 1px dashed #eee;
}
.pet-moment-action {
    margin-top: 10px;
    text-align: right;
    font-size: 11px;
    color: #aaa;
}

/* 6. 设置面板的分页样式 */
.pet-settings-tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
    border-bottom: 1px solid #eee;
    padding-bottom: 10px;
}
.pet-setting-tab {
    padding: 5px 10px;
    font-size: 12px;
    color: #999;
    cursor: pointer;
    border-radius: 8px;
    transition: 0.2s;
}
.pet-setting-tab.active {
    background: #333;
    color: #fff;
    font-weight: 700;
}
.pet-stage-box {
    background: #f9f9f9;
    border: 1px solid #eee;
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 10px;
    display: flex; 
    align-items: center;
    gap: 15px;
}
.pet-stage-img {
    width: 50px; height: 50px; 
    background: #fff; border-radius: 8px; 
    object-fit: contain;
    border: 1px solid #ddd;
}
.pet-stage-info { flex: 1; }
.pet-stage-title { font-size: 12px; font-weight: 700; color: #333; }
.pet-stage-desc { font-size: 10px; color: #999; margin-top: 2px; }

/* 窗框颜色选择器美化 */
.color-circle-picker {
    width: 24px; height: 24px;
    border-radius: 50%;
    border: 2px solid #fff;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    cursor: pointer;
    display: inline-block;
    margin-right: 5px;
}
.color-circle-picker.active {
    transform: scale(1.2);
    border-color: #333;
}
